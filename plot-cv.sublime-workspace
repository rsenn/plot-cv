{
	"auto_complete":
	{
		"selected_items":
		[
			[
				"pathTo",
				"pathToPointIterator"
			],
			[
				"Element",
				"ElementTransformMatrix"
			],
			[
				"Elemen",
				"ElementTransformList"
			],
			[
				"getTra",
				"getTransformationList"
			],
			[
				"serialize",
				"serializeToString"
			],
			[
				"unitConv",
				"unitConvToMM"
			],
			[
				"lazy",
				"lazyProperties"
			],
			[
				"ex",
				"expansion"
			],
			[
				"isArra",
				"isArrayBuffer"
			],
			[
				"Extra",
				"ExtractRotation"
			],
			[
				"tra",
				"transformation"
			],
			[
				"define",
				"defineProperties"
			],
			[
				"getters",
				"gettersSetters"
			],
			[
				"circui",
				"circuitFilePath"
			],
			[
				"Conn",
				"ConnectionPoint"
			],
			[
				"parseCom",
				"parseCommentOrEmpty"
			],
			[
				"circ",
				"circuitFilePath"
			],
			[
				"built",
				"builtin_attr"
			],
			[
				"dep",
				"depthOrPred"
			],
			[
				"exte",
				"extendAsyncGenerator"
			],
			[
				"extend",
				"extendArray"
			],
			[
				"allo",
				"allowedDirs"
			],
			[
				"getOwnPr",
				"getOwnPropertyNames(...)"
			],
			[
				"Prom",
				"PromiseWorker"
			],
			[
				"trans",
				"transformation"
			],
			[
				"allow",
				"allowedDirs"
			],
			[
				"Get",
				"GetElementsBySignal"
			],
			[
				"GetEle",
				"GetElementsBySignal"
			],
			[
				"getOwn",
				"getOwnPropertyNames(...)"
			],
			[
				"ColorSi",
				"ColorSignals"
			],
			[
				"HTML",
				"HTMLTableRow"
			],
			[
				"HTMLTable",
				"HTMLTableColumn"
			],
			[
				"rend",
				"renderToString"
			],
			[
				"Pack",
				"Package2Circuit"
			],
			[
				"lazyP",
				"lazyProperties"
			],
			[
				"JS_Get",
				"JS_GetProperty"
			],
			[
				"Ret",
				"ReturnValuePathFunction"
			],
			[
				"cFunc",
				"cFuncListObjects"
			],
			[
				"isC",
				"isCFuncCall"
			],
			[
				"En",
				"EntityNames"
			],
			[
				"parseFrom",
				"parseFromString"
			],
			[
				"pseu",
				"pseudoClassArg"
			],
			[
				"pseudoC",
				"pseudoClassName"
			],
			[
				"Key",
				"KeyboardEvent"
			],
			[
				"getOp",
				"getOptionEntries"
			],
			[
				"setProp",
				"setPropertyValue"
			],
			[
				"parse",
				"parseSelectors"
			],
			[
				"JS_SetPr",
				"JS_SetPropertyStr"
			],
			[
				"jsm_buil",
				"jsm_builtin_init"
			],
			[
				"JS_Free",
				"JS_FreeCString"
			],
			[
				"JS_Set",
				"JS_SetProperty"
			],
			[
				"JS_New",
				"JS_NewObject"
			],
			[
				"ide",
				"importIdentifiers"
			],
			[
				"iden",
				"importIdentifiers"
			],
			[
				"import",
				"importIdentifiers"
			],
			[
				"ident",
				"identifierSets"
			],
			[
				"path_is",
				"path_is_absolute"
			],
			[
				"js_is_",
				"js_is_null_or_undefined"
			],
			[
				"path_skip_se",
				"path_skip_separator_s"
			],
			[
				"WRITABLE_METHO",
				"WRITABLE_METHOD_CLOSE"
			],
			[
				"list_fo",
				"list_for_each_prev"
			],
			[
				"JS_Th",
				"JS_ThrowOutOfMemory"
			],
			[
				"JS_",
				"JS_ThrowOutOfMemory"
			],
			[
				"underly",
				"underlying_source"
			],
			[
				"Tok",
				"TokenSequence"
			],
			[
				"JS_GetPr",
				"JS_GetPropertyStr"
			],
			[
				"JS_Thro",
				"JS_ThrowOutOfMemory"
			],
			[
				"getAt",
				"getAttributeNames"
			],
			[
				"self",
				"self_closing_tags"
			],
			[
				"self_",
				"self_closing_tags"
			],
			[
				"JS_PROP",
				"JS_PROP_ENUMERABLE"
			],
			[
				"depe",
				"dependencyMap"
			],
			[
				"de",
				"dependencyMap"
			],
			[
				"js_is_null",
				"js_is_null_or_undefined"
			],
			[
				"JS_P",
				"JS_PROP_ENUMERABLE"
			],
			[
				"JS_SetP",
				"JS_SetPropertyUint32"
			],
			[
				"spec",
				"specifiers"
			],
			[
				"Num",
				"NumericRange"
			],
			[
				"token_r",
				"token_release_rt"
			],
			[
				"JS_Thr",
				"JS_ThrowTypeError"
			],
			[
				"js_",
				"js_location_data"
			],
			[
				"debug_js_mall",
				"debug_js_malloc_usable_size"
			],
			[
				"repl",
				"replaceRange"
			],
			[
				"js_malloc_u",
				"js_malloc_usable_size_rt"
			],
			[
				"malloc",
				"malloc_usable_size"
			],
			[
				"all",
				"alloc_block_list"
			],
			[
				"alloc",
				"alloc_block_list"
			],
			[
				"path_skip",
				"path_skip_component"
			],
			[
				"jsm_mo",
				"jsm_module_loader"
			],
			[
				"JS_Throw",
				"JS_ThrowInternalError"
			],
			[
				"JS_AtomTo",
				"JS_AtomToValue"
			],
			[
				"inspect",
				"inspectSymbol"
			],
			[
				"at",
				"attributes"
			],
			[
				"parent",
				"parentElement"
			],
			[
				"owner",
				"ownerElement"
			],
			[
				"get",
				"getPrototypeOf"
			],
			[
				"child",
				"childElementCount"
			],
			[
				"getO",
				"getOwnPropertyNames"
			],
			[
				"js_misc_im",
				"js_misc_immutable_constructor"
			],
			[
				"obj",
				"object_tostring"
			],
			[
				"js_misc_immu",
				"js_misc_immutable_free"
			],
			[
				"js_misc_imm",
				"js_misc_immutable_constructor"
			],
			[
				"CMAKE_IMPORT",
				"CMAKE_IMPORT_LIBRARY_SUFFIX"
			],
			[
				"CMAKE_CUR",
				"CMAKE_CURRENT_BINARY_DIR"
			],
			[
				"js_is",
				"js_is_null_or_undefined"
			],
			[
				"js_asy",
				"js_async_socket_class_id"
			],
			[
				"JS_NewObj",
				"JS_NewObjectProtoClass"
			],
			[
				"async_",
				"async_socket_proto"
			],
			[
				"js_socket_class",
				"js_socket_class_id"
			],
			[
				"g",
				"getOwnPropertyNames(...)"
			],
			[
				"js_sockaddr_cl",
				"js_sockaddr_class_id"
			],
			[
				"js_so",
				"js_sockaddr_constructor"
			],
			[
				"js_sys",
				"js_syscallerror_class_id"
			],
			[
				"js_string",
				"js_stringdecoder_class_id"
			],
			[
				"js_pred",
				"js_predicate_class_id"
			],
			[
				"js_syn",
				"js_syntaxerror_class"
			],
			[
				"js_child",
				"js_child_process_class_id"
			],
			[
				"js_b",
				"js_blob_class_id"
			],
			[
				"js_loca",
				"js_location_class_id"
			],
			[
				"js_token_in",
				"js_token_inspect_funcs"
			],
			[
				"set",
				"setReadHandler"
			],
			[
				"js_get_",
				"js_get_propertystr_bool"
			],
			[
				"js_misc_ate",
				"js_misc_atexit_functions"
			],
			[
				"isF",
				"isFunction"
			],
			[
				"tab",
				"tab_atom_len"
			],
			[
				"isARr",
				"isArrayBuffer"
			],
			[
				"BIT",
				"BITFIELD_FROMARRAY"
			],
			[
				"to",
				"toStringTag"
			]
		]
	},
	"buffers":
	[
		{
			"file": "svg-crop-pad.js",
			"settings":
			{
				"buffer_size": 15936,
				"encoding": "UTF-8",
				"line_ending": "Unix"
			},
			"undo_stack":
			[
				[
					22,
					1,
					"insert",
					{
						"characters": ","
					},
					"AQAAAEk4AAAAAAAASjgAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABJOAAAAAAAAEk4AAAAAAAAAAAAAAAA8L8"
				],
				[
					23,
					1,
					"insert",
					{
						"characters": " unit:"
					},
					"BgAAAEo4AAAAAAAASzgAAAAAAAAAAAAASzgAAAAAAABMOAAAAAAAAAAAAABMOAAAAAAAAE04AAAAAAAAAAAAAE04AAAAAAAATjgAAAAAAAAAAAAATjgAAAAAAABPOAAAAAAAAAAAAABPOAAAAAAAAFA4AAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABKOAAAAAAAAEo4AAAAAAAAAAAAAAAA8L8"
				],
				[
					24,
					1,
					"insert",
					{
						"characters": " "
					},
					"AQAAAFA4AAAAAAAAUTgAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABQOAAAAAAAAFA4AAAAAAAAAAAAAAAA8L8"
				],
				[
					25,
					1,
					"insert_snippet",
					{
						"contents": "'$0'"
					},
					"AQAAAFE4AAAAAAAAUzgAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABROAAAAAAAAFE4AAAAAAAAAAAAAAAA8L8"
				],
				[
					26,
					1,
					"insert",
					{
						"characters": "mm"
					},
					"AgAAAFI4AAAAAAAAUzgAAAAAAAAAAAAAUzgAAAAAAABUOAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABSOAAAAAAAAFI4AAAAAAAAAAAAAAAA8L8"
				],
				[
					32,
					2,
					"left_delete",
					null,
					"AgAAABM4AAAAAAAAEzgAAAAAAAABAAAAbRI4AAAAAAAAEjgAAAAAAAABAAAAbQ",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAAUOAAAAAAAABQ4AAAAAAAAAAAAAAAA8L8"
				],
				[
					34,
					2,
					"left_delete",
					null,
					"AgAAAA04AAAAAAAADTgAAAAAAAABAAAAbQw4AAAAAAAADDgAAAAAAAABAAAAbQ",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAAOOAAAAAAAAA44AAAAAAAAAAAAAAAA8L8"
				],
				[
					39,
					1,
					"insert",
					{
						"characters": " "
					},
					"AQAAAEI4AAAAAAAAQzgAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABCOAAAAAAAAEI4AAAAAAAAAAAAAAAA8L8"
				],
				[
					41,
					1,
					"insert",
					{
						"characters": " "
					},
					"AQAAAEQ4AAAAAAAARTgAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABEOAAAAAAAAEQ4AAAAAAAAAAAAAAAA8L8"
				],
				[
					77,
					1,
					"insert",
					{
						"characters": ".round"
					},
					"BgAAAL84AAAAAAAAwDgAAAAAAAAAAAAAwDgAAAAAAADBOAAAAAAAAAAAAADBOAAAAAAAAMI4AAAAAAAAAAAAAMI4AAAAAAAAwzgAAAAAAAAAAAAAwzgAAAAAAADEOAAAAAAAAAAAAADEOAAAAAAAAMU4AAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAvzgAAAAAAAC/OAAAAAAAAAAAAAAAAPC/"
				],
				[
					78,
					1,
					"insert_snippet",
					{
						"contents": "($0)"
					},
					"AQAAAMU4AAAAAAAAxzgAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAxTgAAAAAAADFOAAAAAAAAAAAAAAAAPC/"
				],
				[
					79,
					1,
					"insert",
					{
						"characters": "precision"
					},
					"CQAAAMY4AAAAAAAAxzgAAAAAAAAAAAAAxzgAAAAAAADIOAAAAAAAAAAAAADIOAAAAAAAAMk4AAAAAAAAAAAAAMk4AAAAAAAAyjgAAAAAAAAAAAAAyjgAAAAAAADLOAAAAAAAAAAAAADLOAAAAAAAAMw4AAAAAAAAAAAAAMw4AAAAAAAAzTgAAAAAAAAAAAAAzTgAAAAAAADOOAAAAAAAAAAAAADOOAAAAAAAAM84AAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAxjgAAAAAAADGOAAAAAAAAAAAAAAAAPC/"
				],
				[
					90,
					1,
					"insert",
					{
						"characters": "e-6"
					},
					"AwAAANQuAAAAAAAA1S4AAAAAAAAAAAAA1S4AAAAAAADWLgAAAAAAAAAAAADWLgAAAAAAANcuAAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAA1C4AAAAAAADULgAAAAAAAAAAAAAAAPC/"
				],
				[
					92,
					1,
					"left_delete",
					null,
					"AQAAANYuAAAAAAAA1i4AAAAAAAABAAAANg",
					"AQAAAAAAAAABAAAA1y4AAAAAAADXLgAAAAAAAAAAAAAAAPC/"
				],
				[
					93,
					1,
					"insert",
					{
						"characters": "3"
					},
					"AQAAANYuAAAAAAAA1y4AAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAA1i4AAAAAAADWLgAAAAAAAAAAAAAAAPC/"
				],
				[
					100,
					1,
					"insert",
					{
						"characters": "n"
					},
					"AQAAAMk4AAAAAAAAyjgAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAyTgAAAAAAADJOAAAAAAAAAAAAAAAAPC/"
				],
				[
					101,
					1,
					"insert",
					{
						"characters": " =>"
					},
					"AwAAAMo4AAAAAAAAyzgAAAAAAAAAAAAAyzgAAAAAAADMOAAAAAAAAAAAAADMOAAAAAAAAM04AAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAyjgAAAAAAADKOAAAAAAAAAAAAAAAAPC/"
				],
				[
					102,
					1,
					"insert",
					{
						"characters": " "
					},
					"AQAAAM04AAAAAAAAzjgAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAzTgAAAAAAADNOAAAAAAAAAAAAAAAAPC/"
				],
				[
					105,
					1,
					"insert",
					{
						"characters": "roundTo("
					},
					"CAAAAM44AAAAAAAAzzgAAAAAAAAAAAAAzzgAAAAAAADQOAAAAAAAAAAAAADQOAAAAAAAANE4AAAAAAAAAAAAANE4AAAAAAAA0jgAAAAAAAAAAAAA0jgAAAAAAADTOAAAAAAAAAAAAADTOAAAAAAAANQ4AAAAAAAAAAAAANQ4AAAAAAAA1TgAAAAAAAAAAAAA1TgAAAAAAADWOAAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAzjgAAAAAAADOOAAAAAAAAAAAAAAAAPC/"
				],
				[
					109,
					1,
					"insert",
					{
						"characters": ")"
					},
					"AQAAAOE4AAAAAAAA4jgAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAA4TgAAAAAAADhOAAAAAAAAAAAAAAAAPC/"
				],
				[
					127,
					1,
					"insert",
					{
						"characters": ",roundTo"
					},
					"CAAAAKUAAAAAAAAApgAAAAAAAAAAAAAApgAAAAAAAACnAAAAAAAAAAAAAACnAAAAAAAAAKgAAAAAAAAAAAAAAKgAAAAAAAAAqQAAAAAAAAAAAAAAqQAAAAAAAACqAAAAAAAAAAAAAACqAAAAAAAAAKsAAAAAAAAAAAAAAKsAAAAAAAAArAAAAAAAAAAAAAAArAAAAAAAAACtAAAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAApQAAAAAAAAClAAAAAAAAAAAAAAAAAPC/"
				],
				[
					143,
					1,
					"insert",
					{
						"characters": "nm,"
					},
					"AwAAAN44AAAAAAAA3zgAAAAAAAAAAAAA3zgAAAAAAADgOAAAAAAAAAAAAADgOAAAAAAAAOE4AAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAA3jgAAAAAAADeOAAAAAAAAAAAAAAAAPC/"
				],
				[
					144,
					2,
					"left_delete",
					null,
					"AgAAAOA4AAAAAAAA4DgAAAAAAAABAAAALN84AAAAAAAA3zgAAAAAAAABAAAAbQ",
					"AQAAAAAAAAABAAAA4TgAAAAAAADhOAAAAAAAAAAAAAAAAPC/"
				],
				[
					145,
					1,
					"insert",
					{
						"characters": ","
					},
					"AQAAAN84AAAAAAAA4DgAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAA3zgAAAAAAADfOAAAAAAAAAAAAAAAAPC/"
				],
				[
					146,
					1,
					"insert",
					{
						"characters": " "
					},
					"AQAAAOA4AAAAAAAA4TgAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAA4DgAAAAAAADgOAAAAAAAAAAAAAAAAPC/"
				],
				[
					188,
					1,
					"insert",
					{
						"characters": "\n"
					},
					"AwAAAPQ4AAAAAAAA9TgAAAAAAAAAAAAA9TgAAAAAAAD5OAAAAAAAAAAAAAD5OAAAAAAAAPk4AAAAAAAABwAAACBlbHNlIHs",
					"AQAAAAAAAAABAAAA9DgAAAAAAAD7OAAAAAAAAAAAAAAAAPC/"
				],
				[
					192,
					1,
					"insert",
					{
						"characters": "\n\n"
					},
					"BwAAAGk4AAAAAAAAajgAAAAAAAAAAAAAajgAAAAAAABuOAAAAAAAAAAAAABuOAAAAAAAAG44AAAAAAAABAAAAGVsc2X2OAAAAAAAAPY4AAAAAAAABAAAACAgICBuOAAAAAAAAG84AAAAAAAAAAAAAG84AAAAAAAAczgAAAAAAAAAAAAAajgAAAAAAABqOAAAAAAAAAQAAAAgICAg",
					"AQAAAAAAAAABAAAAaTgAAAAAAABtOAAAAAAAAAAAAAAAAPC/"
				],
				[
					206,
					1,
					"insert",
					{
						"characters": " "
					},
					"AgAAAIY9AAAAAAAAhz0AAAAAAAAAAAAAhz0AAAAAAACHPQAAAAAAAAIAAAB9Cg",
					"AQAAAAAAAAABAAAAhj0AAAAAAACIPQAAAAAAAAAAAAAAAPC/"
				],
				[
					208,
					1,
					"revert",
					null,
					"AgAAAAAAAAAAAAAAAAAAAAAAAABFPgAAIyEvdXNyL2Jpbi9lbnYgcWpzbQppbXBvcnQgeyBDb25zb2xlIH0gZnJvbSAnY29uc29sZSc7CmltcG9ydCB7IGtpbGwsIFNJR1VTUjEgfSBmcm9tICdvcyc7CmltcG9ydCB7IGdldE9wdCwgc2hvd0hlbHAsIGlzT2JqZWN0LCBtYXBXcmFwcGVyLCBzdGFydEludGVyYWN0aXZlLCBkZWZpbmUgLHJvdW5kVG99IGZyb20gJ3V0aWwnOwppbXBvcnQgeyBiYXNlbmFtZSwgZXh0bmFtZSB9IGZyb20gJ3BhdGgnOwppbXBvcnQgeyBFbnRpdGllcywgbm9kZVR5cGVzLCBQcm90b3R5cGVzLCBGYWN0b3J5LCBQYXJzZXIsIFNlcmlhbGl6ZXIsIEludGVyZmFjZSwgTm9kZSwgTm9kZUxpc3QsIE5hbWVkTm9kZU1hcCwgRWxlbWVudCwgRG9jdW1lbnQsIEF0dHIsIFRleHQsIENvbW1lbnQsIFRva2VuTGlzdCwgQ1NTU3R5bGVEZWNsYXJhdGlvbiwgR2V0VHlwZSB9IGZyb20gJy4vcXVpY2tqcy9xanMtbW9kdWxlcy9saWIvZG9tLmpzJzsKLy9pbXBvcnQgeyBUcmFuc2Zvcm1hdGlvbiwgUm90YXRpb24sIFRyYW5zbGF0aW9uLCBTY2FsaW5nLCBNYXRyaXhUcmFuc2Zvcm1hdGlvbiwgVHJhbnNmb3JtYXRpb25MaXN0IH0gZnJvbSAnLi9saWIvZ2VvbS90cmFuc2Zvcm1hdGlvbi5qcyc7CmltcG9ydCB7IEJCb3gsIGlzQkJveCB9IGZyb20gJy4vbGliL2dlb20vYmJveC5qcyc7CmltcG9ydCB7IFNpemUsIGlzU2l6ZSB9IGZyb20gJy4vbGliL2dlb20vc2l6ZS5qcyc7CmltcG9ydCB7IFRyZWVJdGVyYXRvciB9IGZyb20gJ3RyZWVfd2Fsa2VyJzsKaW1wb3J0IHsgV3JpdGVGaWxlIH0gZnJvbSAnLi9pby1oZWxwZXJzLmpzJzsKaW1wb3J0IHsgTWF0cml4LCBpc01hdHJpeCwgSW1tdXRhYmxlTWF0cml4IH0gZnJvbSAnLi9saWIvZ2VvbS9tYXRyaXguanMnOwppbXBvcnQgeyBUcmFuc2Zvcm1hdGlvbiwgSW1tdXRhYmxlVHJhbnNmb3JtYXRpb24sIFJvdGF0aW9uLCBJbW11dGFibGVSb3RhdGlvbiwgVHJhbnNsYXRpb24sIEltbXV0YWJsZVRyYW5zbGF0aW9uLCBTY2FsaW5nLCBJbW11dGFibGVTY2FsaW5nLCBNYXRyaXhUcmFuc2Zvcm1hdGlvbiwgSW1tdXRhYmxlTWF0cml4VHJhbnNmb3JtYXRpb24sIFRyYW5zZm9ybWF0aW9uTGlzdCwgSW1tdXRhYmxlVHJhbnNmb3JtYXRpb25MaXN0IH0gZnJvbSAnLi9saWIvZ2VvbS90cmFuc2Zvcm1hdGlvbi5qcyc7CmltcG9ydCB7IFBvaW50IH0gZnJvbSAnLi9saWIvZ2VvbS9wb2ludC5qcyc7CmltcG9ydCB7IFBvaW50TGlzdCB9IGZyb20gJy4vbGliL2dlb20vcG9pbnRMaXN0LmpzJzsKaW1wb3J0IHsgU3ZnUGF0aCB9IGZyb20gJy4vbGliL3N2Zy9wYXRoLmpzJzsKaW1wb3J0IGV4dGVuZEdlbmVyYXRvciBmcm9tICdleHRlbmRHZW5lcmF0b3InOwppbXBvcnQgZXh0ZW5kQXJyYXkgZnJvbSAnZXh0ZW5kQXJyYXknOwppbXBvcnQgeyByZWFkIGFzIHJlYWRYTUwsIHdyaXRlIGFzIHdyaXRlWE1MIH0gZnJvbSAneG1sJzsKaW1wb3J0ICogYXMgZGVlcCBmcm9tICdkZWVwJzsKCmV4dGVuZEdlbmVyYXRvcigpOwpleHRlbmRBcnJheSgpOwoKZnVuY3Rpb24gcGFyc2VTVkdQYXRoKHMpIHsKICBsZXQgeyBsZW5ndGgsIHNlZ21lbnQgfSA9IHsKICAgIGxlbmd0aDogeyBhOiA3LCBjOiA2LCBoOiAxLCBsOiAyLCBtOiAyLCBxOiA0LCBzOiA0LCB0OiAyLCB2OiAxLCB6OiAwIH0sCiAgICBzZWdtZW50OiAvKFthc3R2enFtaGxjXSkoW15hc3R2enFtaGxjXSopL2dpCiAgfTsKCiAgY29uc3QgbiA9IC8tP1swLTldKlwuP1swLTldKyg/OmVbLStdP1xkKyk/L2dpOwogIGNvbnN0IHBhcnNlVmFsdWVzID0gYXJncyA9PiB7CiAgICBsZXQgbm0gPSBhcmdzLm1hdGNoKG4pOwogICAgcmV0dXJuIG5tID8gbm0ubWFwKE51bWJlcikgOiBbXTsKICB9OwogIGxldCByID0gbmV3IFN2Z1BhdGgoKTsKCiAgaWYodHlwZW9mIHMgIT0gJ3N0cmluZycgJiYgaXNPYmplY3QocykgJiYgdHlwZW9mIHMuZ2V0QXR0cmlidXRlID09ICdmdW5jdGlvbicpIHMgPSBzLmdldEF0dHJpYnV0ZSgnZCcpOwoKICBzLnJlcGxhY2Uoc2VnbWVudCwgKF8sIGMsIGFyZ3MpID0+IHsKICAgIGxldCB0ID0gYy50b0xvd2VyQ2FzZSgpOwogICAgYXJncyA9IHBhcnNlVmFsdWVzKGFyZ3MpOwogICAgLy9vdmVybG9hZGVkIG1vdmVUbwogICAgaWYodCA9PSAnbScgJiYgYXJncy5sZW5ndGggPiAyKSB7CiAgICAgIHIuY21kKC4uLltjXS5jb25jYXQoYXJncy5zcGxpY2UoMCwgMikpKTsKICAgICAgdCA9ICdsJzsKICAgICAgYyA9IGMgPT0gJ20nID8gJ2wnIDogJ0wnOwogICAgfQogICAgd2hpbGUodHJ1ZSkgewogICAgICBpZihhcmdzLmxlbmd0aCA9PSBsZW5ndGhbdF0pIHsKICAgICAgICBhcmdzLnVuc2hpZnQoYyk7CiAgICAgICAgci5jbWQoLi4uYXJncyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmKGFyZ3MubGVuZ3RoIDwgbGVuZ3RoW3RdKSB0aHJvdyBuZXcgRXJyb3IoYG1hbGZvcm1lZCBwYXRoIGRhdGEgKCR7YXJncy5sZW5ndGh9IDwgJHtsZW5ndGhbdF19KTogJHtjfSAke2FyZ3N9YCk7CiAgICAgIHIuY21kKC4uLltjXS5jb25jYXQoYXJncy5zcGxpY2UoMCwgbGVuZ3RoW3RdKSkpOwogICAgfQogIH0pOwogIHJldHVybiByOwp9CgpmdW5jdGlvbiBzcGxpdFBhdGgocHMpIHsKICBsZXQgaSA9IDAsCiAgICBjbWRzID0gW107CiAgZm9yKGxldCBbbV0gb2YgcHMubWF0Y2hBbGwoLyhbYS16QS1aXXwtP1swLTldKig/OlwuWzAtOV0rfCkpL2cpKSB7CiAgICBpZihtID09PSAnJykgY29udGludWU7CiAgICBpZighaXNOYU4oK20pKSBtID0gK207CiAgICBlbHNlIGlmKGkgPT0gMCkgbSA9IG0udG9VcHBlckNhc2UoKTsKICAgIGlmKHR5cGVvZiBtID09ICdzdHJpbmcnKSBjbWRzLnB1c2goW21dKTsKICAgIGVsc2UgY21kcy5sYXN0LnB1c2gobSk7CiAgICArK2k7CiAgfQogIHJldHVybiBjbWRzOwp9CgpmdW5jdGlvbiogcGF0aFRvQWJzb2x1dGUocGF0aCkgewogIGxldCBwcmV2ID0gWzAsIDBdOwogIGZvcihsZXQgW2NtZCwgeCwgeV0gb2Ygc3BsaXRQYXRoKHBhdGgpKSB7CiAgICB5aWVsZCBbY21kLCB4ICsgcHJldlswXSwgeSArIHByZXZbMV1dOwoKICAgIHByZXYgPSBbeCA/PyBwcmV2WzBdLCB5ID8/IHByZXZbMV1dOwogIH0KfQoKZnVuY3Rpb24gcGF0aFRvUG9pbnRzKHBhdGgpIHsKICBsZXQgcmVzdWx0ID0gW10sCiAgICBzcGxpdHRlZCA9IHNwbGl0UGF0aChwYXRoKTsKICBsZXQgeyBsZW5ndGggfSA9IHNwbGl0dGVkOwogIGxldCBsYXN0bW92ZTsKICBsZXQgcHJldiA9IG5ldyBQb2ludCgwLCAwKTsKICBjb25zdCBpc1VwcGVyID0gcyA9PiBzLnRvVXBwZXJDYXNlKCkgPT0gczsKICBmb3IobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgIGxldCBwdCwKICAgICAgY21kID0gc3BsaXR0ZWRbaV07CiAgICBjb25zdCBNYWtlUG9pbnQgPSAoeCwgeSkgPT4gT2JqZWN0LmFzc2lnbihuZXcgUG9pbnQoeCwgeSksIHsgY21kIH0pOwoKICAgIHN3aXRjaCAoY21kWzBdLnRvTG93ZXJDYXNlKCkpIHsKICAgICAgY2FzZSAneic6CiAgICAgICAgcHQgPSBNYWtlUG9pbnQoK2xhc3Rtb3ZlWzFdLCArbGFzdG1vdmVbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICd2JzoKICAgICAgICBwdCA9IE1ha2VQb2ludCgwLCArY21kWzFdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnaCc6CiAgICAgICAgcHQgPSBNYWtlUG9pbnQoK2NtZFsxXSwgMCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3onOgogICAgICAgIHB0ID0gTWFrZVBvaW50KHVuZGVmaW5lZCwgdW5kZWZpbmVkKTsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICBwdCA9IE1ha2VQb2ludCguLi5jbWQuc2xpY2UoLTIpLm1hcChuID0+ICtuKSk7CiAgICAgICAgaWYoY21kWzBdLnRvTG93ZXJDYXNlKCkgPT0gJ20nKSBsYXN0bW92ZSA9IFsuLi5wdF07CiAgICAgICAgYnJlYWs7CiAgICB9CgogICAgZGVmaW5lKHB0LCB7IGNtZCB9KTsKCiAgICByZXN1bHQucHVzaChwdCk7CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KCmZ1bmN0aW9uKiBwb2ludHNUb0Fic29sdXRlKGl0KSB7CiAgbGV0IHByZXYgPSBuZXcgUG9pbnQoMCwgMCksCiAgICBpID0gMDsKICBjb25zdCBpc1VwcGVyID0gcyA9PiBzLnRvVXBwZXJDYXNlKCkgPT0gczsKCiAgZm9yKGxldCBwdCBvZiBpdCkgewogICAgbGV0IHAgPSBpc1VwcGVyKHB0LmNtZFswXSkgPyBwdC5jbG9uZSgpIDogcHQuc3VtKHByZXYpOwogICAgcC5yb3VuZCgpOwogICAgcC5jbWQgPSBwdC5jbWQ7CiAgICB5aWVsZCAocHJldiA9IHApOwogIH0KfQoKT2JqZWN0LmFzc2lnbihnbG9iYWxUaGlzLCB7CiAgRW50aXRpZXMsCiAgbm9kZVR5cGVzLAogIFByb3RvdHlwZXMsCiAgRmFjdG9yeSwKICBQYXJzZXIsCiAgU2VyaWFsaXplciwKICBJbnRlcmZhY2UsCiAgTm9kZSwKICBOb2RlTGlzdCwKICBOYW1lZE5vZGVNYXAsCiAgRWxlbWVudCwKICBEb2N1bWVudCwKICBBdHRyLAogIFRleHQsCiAgQ29tbWVudCwKICBUb2tlbkxpc3QsCiAgQ1NTU3R5bGVEZWNsYXJhdGlvbiwKICBHZXRUeXBlCn0pOwpPYmplY3QuYXNzaWduKGdsb2JhbFRoaXMsIHsKICBUcmVlSXRlcmF0b3IsCiAgQkJveCwKICBpc0JCb3gsCiAgU2l6ZSwKICBpc1NpemUsCiAgTWF0cml4LAogIFBvaW50LAogIFBvaW50TGlzdCwKICBwYXJzZVNWR1BhdGgsCiAgc3BsaXRQYXRoLAogIHBhdGhUb1BvaW50cywKICBwb2ludHNUb0Fic29sdXRlLAogIE51bWVyaWNBcmdzLAogIFBhcmVudFBhdGhzLAogIEN1bXVsYXRpdmVQYXRocywKICBBbGxQYXJlbnRzLAogIGdldFRyYW5zZm9ybWF0aW9uTWF0cml4LAogIGdldFRyYW5zZm9ybWF0aW9uTGlzdCwKICBBbGxUcmFuc2Zvcm1zLAogIEVsZW1lbnRUcmFuc2Zvcm1NYXRyaXgsCiAgRWxlbWVudFRyYW5zZm9ybUxpc3QsCiAgR2V0WFksCiAgR2V0UG9pbnRzLAogIEdldE1hdHJpeCwKICBHZXRUcmFuc2Zvcm1lZFBvaW50cywKICBQb3NpdGlvbmVkRWxlbWVudHMsCiAgSGFzUGFyZW50LAogIEdldEJvdW5kcywKICBQcm9jZXNzUGF0aCwKICB1bml0Q29udlRvTU0sCiAgdW5pdENvbnYsCiAgdW5pdENvbnZUbywKICBnZXRWaWV3Qm94LAogIGdldFdpZHRoSGVpZ2h0LAogIFhNTDJTdHJpbmcKfSk7CgpPYmplY3QuYXNzaWduKGdsb2JhbFRoaXMsIHsKICBzYXZlKGZpbGVuYW1lKSB7CiAgICBmaWxlbmFtZSA/Pz0gYmFzZW5hbWUoZ2xvYmFsVGhpcy5maWxlLCBleHRuYW1lKGdsb2JhbFRoaXMuZmlsZSkpICsgJy5vdXQuc3ZnJzsKICAgIGNvbnN0IHN0ciA9IHNlcmlhbGl6ZXIuc2VyaWFsaXplVG9TdHJpbmcoZG9jdW1lbnQpOwoKICAgIGxldCByZXQgPSBXcml0ZUZpbGUoZmlsZW5hbWUsIHN0cik7CiAgICBjb25zb2xlLmxvZyhgJyR7ZmlsZW5hbWV9JyB3cml0dGVuLmApOwogICAgcmV0dXJuIHJldDsKICB9Cn0pOwoKZnVuY3Rpb24qIE51bWVyaWNBcmdzKHMsIHQgPSBhID0+IGEpIHsKICBmb3IobGV0IFttXSBvZiBzLm1hdGNoQWxsKC8oXHMrfFstKy4wLTldK3xbXi0rLjAtOVxzXSspW2Etel0qL2cpKSBpZihtLnRyaW0oKSAhPSAnJykgeWllbGQgdChtKTsKfQoKY29uc3QgZGVyZWYgPSBwID0+IG9iaiA9PiBwLnJlZHVjZSgobywgaykgPT4gb1trXSwgb2JqKTsKCmZ1bmN0aW9uKiBQYXJlbnRQYXRocyhwKSB7CiAgbGV0IHBsZW4gPSBwLmxlbmd0aDsKICBmb3IobGV0IGkgPSAyOyBpIDw9IHBsZW47IGkgKz0gMikgeWllbGQgcC5zbGljZSgwLCBpKTsKfQoKZnVuY3Rpb24qIEN1bXVsYXRpdmVQYXRocyhwKSB7CiAgbGV0IHBsZW4gPSBwLmxlbmd0aDsKICBmb3IobGV0IGkgPSAyOyBpIDw9IHBsZW47IGkgKz0gMikgeWllbGQgcC5zbGljZShpIC0gMiwgaSk7Cn0KCmZ1bmN0aW9uKiBBbGxQYXJlbnRzKGVsZW0pIHsKICBsZXQgb2JqID0gTm9kZS5kb2N1bWVudChlbGVtKTsKICBmb3IobGV0IHAgb2YgQ3VtdWxhdGl2ZVBhdGhzKE5vZGUucGF0aChlbGVtKSkpIHsKICAgIGlmKG9iai50YWdOYW1lWzBdICE9ICc/JykgeWllbGQgb2JqOwogICAgb2JqID0gZGVyZWYocCkob2JqKTsKICB9Cn0KCmZ1bmN0aW9uIEFsbFRyYW5zZm9ybXMoZWxlbSwgZ2V0dGVyID0gZ2V0VHJhbnNmb3JtYXRpb25NYXRyaXgpIHsKICBsZXQgdCA9IFtdOwogIGZvcihsZXQgZSBvZiBBbGxQYXJlbnRzKGVsZW0pKSBpZihlLmhhc0F0dHJpYnV0ZSgndHJhbnNmb3JtJykpIHQucHVzaChnZXR0ZXIoZSkpOwogIGlmKGVsZW0uaGFzQXR0cmlidXRlKCd0cmFuc2Zvcm0nKSkgdC5wdXNoKGdldHRlcihlbGVtKSk7CiAgcmV0dXJuIHQ7Cn0KCmZ1bmN0aW9uIEVsZW1lbnRUcmFuc2Zvcm1MaXN0KGVsZW0pIHsKICByZXR1cm4gbmV3IFRyYW5zZm9ybWF0aW9uTGlzdCgpLmNvbmNhdCguLi5BbGxUcmFuc2Zvcm1zKGUsIGdldFRyYW5zZm9ybWF0aW9uTGlzdCkpOwp9CgpmdW5jdGlvbiBFbGVtZW50VHJhbnNmb3JtTWF0cml4KGVsZW0pIHsKICByZXR1cm4gTWF0cml4Lm11bHRpcGx5KC4uLkFsbFRyYW5zZm9ybXMoZWxlbSwgZ2V0VHJhbnNmb3JtYXRpb25NYXRyaXgpKTsKfQoKZnVuY3Rpb24gR2V0WFkoZWxlbSkgewogIHJldHVybiBuZXcgUG9pbnQoK2VsZW0uZ2V0QXR0cmlidXRlKCd4JyksICtlbGVtLmdldEF0dHJpYnV0ZSgneScpKTsKfQoKZnVuY3Rpb24gR2V0UG9pbnRzKGVsZW0pIHsKICBsZXQgdCA9IFtdOwoKICBpZihlbGVtLnRhZ05hbWUgPT0gJ3N5bWJvbCcpIHJldHVybiBHZXRQb2ludHMoZWxlbS5maXJzdEVsZW1lbnRDaGlsZCk7CgogIGlmKGVsZW0uaGFzQXR0cmlidXRlKCd4bGluazpocmVmJykpIHsKICAgIGxldCBlLCBwb2ludHMsIHh5LCBtLCBpZDsKICAgIGlkID0gZWxlbS5nZXRBdHRyaWJ1dGUoJ3hsaW5rOmhyZWYnKTsKICAgIHh5ID0gR2V0WFkoZWxlbSk7CiAgICBtID0gbmV3IE1hdHJpeCgpLnRyYW5zbGF0ZSguLi54eSk7CgogICAgaWYoKGUgPSBOb2RlLmRvY3VtZW50KGVsZW0pLnF1ZXJ5U2VsZWN0b3IoaWQpKSkgcmV0dXJuIEdldFBvaW50cyhlKS5tYXAocCA9PiBwLnRyYW5zZm9ybShtKSk7CiAgfQoKICBpZihlbGVtLmhhc0F0dHJpYnV0ZSgnZCcpKSB7CiAgICB0cnkgewogICAgICBsZXQgcHAgPSBwYXRoVG9Qb2ludHMoZWxlbS5nZXRBdHRyaWJ1dGUoJ2QnKSk7CiAgICAgIHJldHVybiBwcDsKICAgICAgLyogICAgICBsZXQgcGEgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YocHAsIFBvaW50TGlzdC5wcm90b3R5cGUpOwoKICAgICAgcGEucG9pbnRzID0gcHA7CgogICAgICByZXR1cm4gcGE7Ki8KICAgIH0gY2F0Y2goZSkgewogICAgICBjb25zb2xlLmxvZygnRVJST1InLCBlLm1lc3NhZ2UgKyAnXG4nICsgZS5zdGFjayk7CiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIGxldCBzdmdQID0gcGFyc2VTVkdQYXRoKGVsZW0uZ2V0QXR0cmlidXRlKCdkJykpOwogICAgcmV0dXJuIG5ldyBQb2ludExpc3QoCiAgICAgIHN2Z1AuY29tbWFuZHMKICAgICAgICAubWFwKGMgPT4gYy5hcmdzKQogICAgICAgIC5maWx0ZXIoYSA9PiBhLmxlbmd0aCA+PSAyICYmICghaXNOYU4oK2FbMF0pIHx8ICFpc05hTigrYVsxXSkpKQogICAgICAgIC5tYXAoKFt4LCB5XSkgPT4gbmV3IFBvaW50KHgsIHkpKQogICAgKTsKICB9CiAgaWYoZWxlbS5oYXNBdHRyaWJ1dGUoJ3gnKSAmJiBlbGVtLmhhc0F0dHJpYnV0ZSgneScpKSByZXR1cm4gbmV3IFBvaW50TGlzdChbR2V0WFkoZWxlbSldKTsKCiAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgZ2V0dGluZyBwb2ludCBkYXRhIGZvciBlbGVtZW50ICR7WE1MMlN0cmluZyhlbGVtKX1gKTsKfQoKZnVuY3Rpb24gR2V0VHJhbnNmb3JtZWRQb2ludHMoZWxlbSkgewogIGxldCBtYXRyaXggPSBFbGVtZW50VHJhbnNmb3JtTWF0cml4KGVsZW0pOwogIGxldCBwb2ludHMgPSBuZXcgUG9pbnRMaXN0KEdldFBvaW50cyhlbGVtKSk7CgogIHJldHVybiBwb2ludHMuY2xvbmUoKS50cmFuc2Zvcm0obWF0cml4KTsKfQoKZnVuY3Rpb24gR2V0TWF0cml4KGVsZW0pIHsKICByZXR1cm4gTWF0cml4Lm11bHRpcGx5KC4uLkFsbFRyYW5zZm9ybXMoZWxlbSkpOwp9CgpmdW5jdGlvbiBJc0NsaXBQYXRoKGVsZW0pIHsKICBsZXQgcCA9IFsuLi5BbGxQYXJlbnRzKGVsZW0pXTsKICBjb25zb2xlLmxvZygKICAgICdJc0NsaXBQYXRoJywKICAgIHAubWFwKGUgPT4gZS50YWdOYW1lKQogICk7CgogIHJldHVybiBwLnNvbWUoZSA9PiBlLnRhZ05hbWUgPT0gJ2NsaXBQYXRoJyk7Cn0KCmZ1bmN0aW9uIEhhc0NsaXBQYXRoKGVsZW0pIHsKICBsZXQgcCA9IFsuLi5BbGxQYXJlbnRzKGVsZW0pLCBlbGVtXTsKCiAgcmV0dXJuIHAuc29tZShlID0+IGUuaGFzQXR0cmlidXRlKCdjbGlwLXBhdGgnKSk7Cn0KCmZ1bmN0aW9uKiBQb3NpdGlvbmVkRWxlbWVudHMoc3ZnRWxlbSA9IHN2Zywgc2tpcCkgewogIHNraXAgPz89ICgoKSA9PiB7CiAgICBsZXQgZGVmcyA9IHN2Z0VsZW0ucXVlcnlTZWxlY3RvcignZGVmcycpOwogICAgbGV0IGRlZnNQYXRoID0gTm9kZS5wYXRoKGRlZnMpLnNsaWNlKE5vZGUucGF0aChzdmdFbGVtKS5sZW5ndGgpOwogICAgcmV0dXJuICh2LCBwKSA9PiBwLnNsaWNlKDAsIGRlZnNQYXRoLmxlbmd0aCkuZXF1YWwoZGVmc1BhdGgpOwogIH0pKCk7CgogIGZvcihsZXQgW3ZhbHVlLCBwYXRoXSBvZiBkZWVwLml0ZXJhdGUoTm9kZS5yYXcoc3ZnRWxlbSksIGUgPT4gWydkJywgJ3gnLCAneSddLnNvbWUobiA9PiBuIGluIGUuYXR0cmlidXRlcykpKSB7CiAgICBpZihza2lwKHZhbHVlLCBwYXRoKSkgY29udGludWU7CiAgICBsZXQgZWxlbSA9IGRlcmVmKHBhdGgpKHN2Z0VsZW0pOwoKICAgIC8qIHNraXAgdGhlbSBmb3Igbm93ICovCiAgICBpZihIYXNDbGlwUGF0aChlbGVtKSkgewogICAgICAvL2NvbnNvbGUubG9nKCdQb3NpdGlvbmVkRWxlbWVudHMgc2tpcHBpbmcnLCBlbGVtKTsKICAgICAgY29udGludWU7CiAgICB9CiAgICB5aWVsZCBlbGVtOwogIH0KfQoKZnVuY3Rpb24gSGFzUGFyZW50KGVsZW0sIG90aGVyKSB7CiAgbGV0IGUgPSBOb2RlLnBhdGgoZWxlbSk7CiAgbGV0IG8gPSBOb2RlLnBhdGgob3RoZXIpOwoKICBmb3IobGV0IGkgPSAwOyBpIDwgby5sZW5ndGg7IGkrKykgewogICAgaWYob1tpXSAhPSBlW2ldKSByZXR1cm4gZmFsc2U7CiAgfQogIHJldHVybiB0cnVlOwp9CgpsZXQgcG9zaXRpb25lZCA9IChnbG9iYWxUaGlzLnBvc2l0aW9uZWQgPSBuZXcgU2V0KCkpOwpsZXQgcG9zaXRpb25lZFByb3BzID0gKGdsb2JhbFRoaXMucG9zaXRpb25lZFByb3BzID0gbWFwV3JhcHBlcihuZXcgV2Vha01hcCgpKSk7CgpmdW5jdGlvbiBHZXRCb3VuZHMoc3ZnRWxlbSA9IHN2ZykgewogIGxldCBiYiA9IG5ldyBCQm94KCk7CgogIGZvcihsZXQgZWxlbWVudCBvZiBQb3NpdGlvbmVkRWxlbWVudHMoc3ZnRWxlbSkpIHsKICAgIC8qbGV0IG1hdHJpeCA9IEdldE1hdHJpeChlbGVtZW50KTsKICAgIGxldCBwb2ludHMgPSBHZXRQb2ludHMoZWxlbWVudCk7CgogICAgcG9zaXRpb25lZC5hZGQoZWxlbWVudCk7CiAgICBwb3NpdGlvbmVkUHJvcHMuc2V0KGVsZW1lbnQsIHsgbWF0cml4LCBwb2ludHMgfSk7CgogICAgZm9yKGxldCBwb2ludCBvZiBwb2ludHMuY2xvbmUoKS50cmFuc2Zvcm0obWF0cml4KSkqLwogICAgZm9yKGxldCBwb2ludCBvZiBHZXRUcmFuc2Zvcm1lZFBvaW50cyhlbGVtZW50KSkgYmIudXBkYXRlKHBvaW50LCAwLCBlbGVtZW50KTsKICB9CgogIHJldHVybiBiYjsKfQoKZnVuY3Rpb24qIFByb2Nlc3NQYXRoKGQpIHsKICBsZXQgYywKICAgIGkgPSAwLAogICAgYSA9IFtdOwogIGZvcihsZXQgW21dIG9mIGQubWF0Y2hBbGwoLyhccyt8Wy0rLjAtOV0rfFteLSsuMC05XHNdKykvZykpIHsKICAgIGlmKG0udHJpbSgpID09ICcnKSBjb250aW51ZTsKICAgIGNvbnN0IG4gPSArbTsKICAgIGlmKGlzTmFOKG4pKSB7CiAgICAgIGMgPSBtOwogICAgICBpID0gMDsKICAgICAgYSA9IFtdOwogICAgICBjb250aW51ZTsKICAgIH0KICAgIGlmKGMudG9Mb3dlckNhc2UoKSA9PSAndicpIGkgPSAxOwogICAgaSAmPSAxOwogICAgYVtpXSA9IG47CiAgICBpZigrK2kgPj0gMiB8fCAnVnZIaCcuaW5kZXhPZihjKSAhPSAtMSkgeWllbGQgYTsKICB9Cn0KCmZ1bmN0aW9uIHVuaXRDb252VG9NTSh2YWx1ZSkgewogIGlmKC9wdFxzKiQvaS50ZXN0KHZhbHVlKSkgcmV0dXJuICgrdmFsdWUucmVwbGFjZSgvXHMqcHRccyokL2dpLCAnJykgKiAzKSAvIDguNTsKICBpZigvcGNccyokL2kudGVzdCh2YWx1ZSkpIHJldHVybiArdmFsdWUucmVwbGFjZSgvXHMqcGNccyokL2dpLCAnJykgKiA0LjIzMzMzOwogIGlmKC9pblxzKiQvaS50ZXN0KHZhbHVlKSkgcmV0dXJuICt2YWx1ZS5yZXBsYWNlKC9ccyppblxzKiQvZ2ksICcnKSAqIDI1LjQ7CiAgaWYoL21pbFxzKiQvaS50ZXN0KHZhbHVlKSkgcmV0dXJuICt2YWx1ZS5yZXBsYWNlKC9ccyptaWxccyokL2dpLCAnJykgKiAwLjAyNTQ7CiAgaWYoL2NtXHMqJC9pLnRlc3QodmFsdWUpKSByZXR1cm4gK3ZhbHVlLnJlcGxhY2UoL1xzKmNtXHMqJC9naSwgJycpICogMTA7CiAgaWYoL21tXHMqJC9pLnRlc3QodmFsdWUpKSByZXR1cm4gK3ZhbHVlLnJlcGxhY2UoL1xzKm1tXHMqJC9naSwgJycpOwogIGlmKC9weFxzKiQvaS50ZXN0KHZhbHVlKSB8fCAhaXNOYU4oK3ZhbHVlKSkgcmV0dXJuICsodmFsdWUgKyAnJykucmVwbGFjZSgvXHMqcHhccyokL2dpLCAnJykgLyAzLjc3OTUyNzU1OTUzMTI3OTA2MjYxOwp9Cgpjb25zdCBNaWxsaW1ldGVyVG8gPSB7CiAgcGM6IG1tID0+IG1tICogMC4yMzYyMiwKICBweDogbW0gPT4gbW0gKiAzLjc3OTUyNzU1OTUzMTI3OTA2MjYxLAogIHB0OiBtbSA9PiAobW0gKiA4LjUpIC8gMywKICBpbjogbW0gPT4gbW0gLyAyNS40LAogIG1pbDogbW0gPT4gbW0gLyAwLjAyNTQsCiAgY206IG1tID0+IG1tICogMWUtMSwKICBtbTogbW0gPT4gbW0sCiAgbTogbW0gPT4gbW0gKiAxZS0zCn07CgpmdW5jdGlvbiB1bml0Q29udih1bml0KSB7CiAgcmV0dXJuIHZhbHVlID0+IE1pbGxpbWV0ZXJUb1t1bml0XSh1bml0Q29udlRvTU0odmFsdWUpKTsKfQoKZnVuY3Rpb24gdW5pdENvbnZUbyh2YWx1ZSwgdW5pdCkgewogIGxldCBtbSA9IHVuaXRDb252VG9NTSh2YWx1ZSk7CiAgcmV0dXJuIE1pbGxpbWV0ZXJUb1t1bml0XShtbSkgKyB1bml0Owp9CgpmdW5jdGlvbiBnZXRWaWV3Qm94KHN2Z0VsZW0gPSBzdmcpIHsKICBpZihzdmdFbGVtLmhhc0F0dHJpYnV0ZSgndmlld0JveCcpKSB7CiAgICBsZXQgdmlld0JveCA9IHN2Z0VsZW0uZ2V0QXR0cmlidXRlKCd2aWV3Qm94Jyk7CiAgICByZXR1cm4gQkJveC5mcm9tU1ZHKHZpZXdCb3ggKyAnJyk7CiAgfQoKICAvL3JldHVybiBuZXcgQkJveCgwLCAwLCAuLi5nZXRXaWR0aEhlaWdodChzdmdFbGVtKSk7Cn0KCmZ1bmN0aW9uIFhNTDJTdHJpbmcoZWxlbSkgewogIHJldHVybiBuZXcgU2VyaWFsaXplcigpLnNlcmlhbGl6ZVRvU3RyaW5nKGVsZW0pOwp9CgpmdW5jdGlvbiBnZXRXaWR0aEhlaWdodChzdmdFbGVtID0gc3ZnLCB0ID0gYSA9PiBhKSB7CiAgaWYoc3ZnRWxlbS5oYXNBdHRyaWJ1dGUoJ3dpZHRoJykgJiYgc3ZnRWxlbS5oYXNBdHRyaWJ1dGUoJ2hlaWdodCcpKSB7CiAgICBsZXQgd2lkdGggPSBzdmdFbGVtLmdldEF0dHJpYnV0ZSgnd2lkdGgnKTsKICAgIGxldCBoZWlnaHQgPSBzdmdFbGVtLmdldEF0dHJpYnV0ZSgnaGVpZ2h0Jyk7CgogICAgcmV0dXJuIG5ldyBTaXplKHQod2lkdGgpLCB0KGhlaWdodCkpOwogIH0KCiAgcmV0dXJuIG5ldyBTaXplKC4uLmdldFZpZXdCb3goc3ZnRWxlbSkuc2l6ZSk7Cn0KCmZ1bmN0aW9uIGdldFRyYW5zZm9ybWF0aW9uTGlzdChlKSB7CiAgaWYoZS5oYXNBdHRyaWJ1dGUoJ3RyYW5zZm9ybScpKSByZXR1cm4gbmV3IFRyYW5zZm9ybWF0aW9uTGlzdChlLmdldEF0dHJpYnV0ZSgndHJhbnNmb3JtJykpOwp9CgpmdW5jdGlvbiBnZXRUcmFuc2Zvcm1hdGlvbk1hdHJpeChlKSB7CiAgbGV0IHRsOwoKICBpZigodGwgPSBnZXRUcmFuc2Zvcm1hdGlvbkxpc3QoZSkpKSByZXR1cm4gdGwudG9NYXRyaXgoKTsKfQoKZnVuY3Rpb24gbWFpbiguLi5hcmdzKSB7CiAgbGV0IGRlYnVnID0gMDsKICBsZXQgdW5pdCA9ICdtbSc7CiAgbGV0IHByZWNpc2lvbiA9IDFlLTM7CiAgbGV0IHNpemUgPSAwOwogIGxldCBwYWRkaW5nID0gMDsKCiAgT2JqZWN0LmFzc2lnbihnbG9iYWxUaGlzLCB7CiAgICBOdW1lcmljQXJncywKICAgIFByb2Nlc3NQYXRoLAogICAgdW5pdENvbnZUb01NLAogICAgdW5pdENvbnZUbywKICAgIE1pbGxpbWV0ZXJUbywKICAgIGdldFZpZXdCb3gsCiAgICBnZXRXaWR0aEhlaWdodCwKICAgIGdldFRyYW5zZm9ybWF0aW9uTWF0cml4LAogICAgVHJhbnNmb3JtYXRpb24sCiAgICBSb3RhdGlvbiwKICAgIFRyYW5zbGF0aW9uLAogICAgU2NhbGluZywKICAgIE1hdHJpeFRyYW5zZm9ybWF0aW9uLAogICAgVHJhbnNmb3JtYXRpb25MaXN0LAogICAgZGVyZWYKICB9KTsKCiAgLy8gIGdsb2JhbFRoaXMuY29uc29sZSA9IG5ldyBDb25zb2xlKHN0ZC5lcnIsIHsgZGVwdGg6IDIsIGN1c3RvbUluc3BlY3Q6IGZhbHNlLCBjb21wYWN0OiBmYWxzZSwgcHJvdG9DaGFpbjogdHJ1ZSB9KTsKCiAgbGV0IG9wdHM7CiAgbGV0IHBhcmFtcyA9IChnbG9iYWxUaGlzLnBhcmFtcyA9IGdldE9wdCgKICAgIChvcHRzID0gewogICAgICBoZWxwOiBbZmFsc2UsIChfeCwgX3ksIG9wdHMpID0+IHNob3dIZWxwKG9wdHMpLCAnaCddLAogICAgICBkZWJ1ZzogW2ZhbHNlLCAoKSA9PiArK2RlYnVnLCAneCddLAogICAgICB1bml0OiBbdHJ1ZSwgYSA9PiAodW5pdCA9IGEpLCAndSddLAogICAgICBwcmVjaXNpb246IFt0cnVlLCBhID0+IChwcmVjaXNpb24gPSArYSksICdhJ10sCiAgICAgICdwcmludC1zaXplJzogW2ZhbHNlLCBudWxsLCAnUCddLAogICAgICBib3VuZHM6IFtmYWxzZSwgbnVsbCwgJ2InXSwKICAgICAgc2l6ZTogW3RydWUsIGEgPT4gKHNpemUgPSB1bml0Q29udlRvTU0oYSkpLCAncyddLAogICAgICBpbnRlcmFjdGl2ZTogW2ZhbHNlLCBudWxsLCAneSddLAogICAgICBwYWRkaW5nOiBbdHJ1ZSwgbnVsbCwgJ3AnXSwKICAgICAgJ0AnOiAnZmlsZXMnCiAgICB9KSwKICAgIGFyZ3MKICApKTsKICBsZXQgZmlsZXMgPSBwYXJhbXNbJ0AnXTsKICBsZXQgcGFyc2VyID0gKGdsb2JhbFRoaXMucGFyc2VyID0gbmV3IFBhcnNlcigpKTsKICBsZXQgc2VyaWFsaXplciA9IChnbG9iYWxUaGlzLnNlcmlhbGl6ZXIgPSBuZXcgU2VyaWFsaXplcigpKTsKICBsZXQgcHJpbnQgPSAoZmlsZSwgLi4uYXJncykgPT4gc3RkLnB1dHMoYXJncy5qb2luKCcgJykgKyAnXG4nKTsKCiAgaWYoZmlsZXMubGVuZ3RoID09IDApIHNob3dIZWxwKG9wdHMsIDEpOwogIGlmKGZpbGVzLmxlbmd0aCA+IDEpIHByaW50ID0gKGZpbGUsIC4uLmFyZ3MpID0+IHN0ZC5wdXRzKGZpbGUgKyAnOiAnICsgYXJncy5qb2luKCcgJykgKyAnXG4nKTsKCiAgZm9yKGxldCBmaWxlIG9mIGZpbGVzKSB7CiAgICBpZihwYXJhbXMuZGVidWcgPj0gMSkgY29uc29sZS5sb2coJ1Byb2Nlc3Npbmc6JywgZmlsZSk7CgogICAgbGV0IHhtbCxzdmc7Cgp0cnkgewogICAgeG1sID0gKGdsb2JhbFRoaXMuZG9jdW1lbnQgPSBwYXJzZXIucGFyc2VGcm9tRmlsZSgoZ2xvYmFsVGhpcy5maWxlID0gZmlsZSksICd1dGYtOCcpKTsKCiAgICAvLyBjb25zb2xlLmxvZygneG1sJywgY29uc29sZS5jb25maWcoeyBjdXN0b21JbnNwZWN0OiBmYWxzZSB9KSwgeG1sKTsKICAgIHN2ZyA9IChnbG9iYWxUaGlzLnN2ZyA9IHhtbC5xdWVyeVNlbGVjdG9yKCdzdmcnKSk7Cn1jYXRjaChlKSB7CiAgY29uc29sZS5sb2coYEVSUk9SIGxvYWRpbmcgJyR7ZmlsZX0nYCwgZS5tZXNzYWdlKydcbicrZS5zdGFjayk7Cn0KICAgIGxldCBzaXplVW5pdCA9IChnbG9iYWxUaGlzLnNpemUgPSBnZXRXaWR0aEhlaWdodChzdmcpKTsKICAgIGxldCBzaXplID0gKGdsb2JhbFRoaXMuc2l6ZSA9IGdldFdpZHRoSGVpZ2h0KHN2ZywgdW5pdENvbnZUb01NKS5yb3VuZChwcmVjaXNpb24pKTsKICAgIGxldCB3cml0ZVVuaXRzID0gKGdsb2JhbFRoaXMud3JpdGVVbml0cyA9IFtzaXplVW5pdC51bml0cy53aWR0aCwgc2l6ZVVuaXQudW5pdHMuaGVpZ2h0XSk7CgogICAgbGV0IHZpZXdCb3hPbGQgPSAoZ2xvYmFsVGhpcy52aWV3Qm94T2xkID0gZ2V0Vmlld0JveChzdmcpID8/IHNpemUpOwogICAgLy9jb25zb2xlLmxvZygndmlld0JveCcsIHsgdmlld0JveE9sZCB9KTsKICAgLy8gY29uc29sZS5sb2coJ3NpemUnLCB7IHNpemUgfSwgc2l6ZS51bml0cyk7CiAgICBsZXQgeGZhY3RvciA9IChnbG9iYWxUaGlzLnhmYWN0b3IgPSB2aWV3Qm94T2xkLndpZHRoIC8gc2l6ZVVuaXQud2lkdGgpOwogICAgbGV0IHlmYWN0b3IgPSAoZ2xvYmFsVGhpcy55ZmFjdG9yID0gdmlld0JveE9sZC5oZWlnaHQgLyBzaXplVW5pdC5oZWlnaHQpOwoKICAgIGlmKHBhcmFtc1sncHJpbnQtc2l6ZSddKSB7CiAgICAgIHNpemUudW5pdHMgPSBbJycsICcnXTsKICAgICAgcHJpbnQoZmlsZSwgc2l6ZS50b1N0cmluZyh7IHNlcGFyYXRvcjogJyB4ICcgLCB1bml0OiAnbW0nfSkpOwogICAgfSAKCiAgICAgaWYocGFyYW1zWydib3VuZHMnXSkgewogICAgICBsZXQgYmIgPSAoZ2xvYmFsVGhpcy5iYiA9IEdldEJvdW5kcyhzdmcpKTsKICAgICAgcHJpbnQoZmlsZSwgYmIucm91bmQobiA9PiByb3VuZFRvKG4sIHByZWNpc2lvbikpKTsKICAgIH0KCiAgICAgIGxldCBuZXdWaWV3Qm94LAogICAgICAgIHZpZXdCb3ggPSAoZ2xvYmFsVGhpcy52aWV3Qm94ID0gdmlld0JveE9sZC5pbnNldCgwKSk7CgogICAgICBpZihwYXJhbXMucGFkZGluZykgewogICAgICAgIGxldCBjb252ID0gd3JpdGVVbml0cy5tYXAodSA9PiB1bml0Q29udih1KSk7CgogICAgICAgIGxldCBwYWQgPSAoZ2xvYmFsVGhpcy5wYWQgPSBbLi4uTnVtZXJpY0FyZ3MocGFyYW1zLnBhZGRpbmcpXSkubWFwKChhLCBpKSA9PiB7CiAgICAgICAgICBsZXQgZiA9IGkgJiAxID8geGZhY3RvciA6IHlmYWN0b3I7CiAgICAgICAgICBsZXQgdSA9IHdyaXRlVW5pdHNbKGkgJiAxKSBeIDFdOwoKICAgICAgICAgIGxldCBpZHggPSAoaSAmIDEpIF4gMTsKCiAgICAgICAgICBjb25zb2xlLmxvZygnaWR4JywgaWR4LCB1LCBjb252W2lkeF0pOwoKICAgICAgICAgIHJldHVybiBjb252W2lkeF0oYSkgKiBmOwogICAgICAgIH0pOwoKICAgICAgICBjb25zb2xlLmxvZygncGFkJywgcGFkKTsKCiAgICAgICAgbmV3Vmlld0JveCA9IGdsb2JhbFRoaXMubmV3Vmlld0JveCA9IHZpZXdCb3gub3V0c2V0KC4uLnBhZCk7CiAgICAgIH0KCiAgICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3ZpZXdCb3gnLCAobmV3Vmlld0JveCA/Pz0gdmlld0JveCkudG9TVkcoKSk7CgogICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IG5ld1ZpZXdCb3g7CiAgICAgIGNvbnNvbGUubG9nKCd2aWV3Qm94Jywgdmlld0JveCwgdmlld0JveC50b1NWRygpKTsKICAgICAgY29uc29sZS5sb2coJ25ld1ZpZXdCb3gnLCBuZXdWaWV3Qm94LCBuZXdWaWV3Qm94LnRvU1ZHKCkpOwoKICAgICAgbGV0IHcgPSAoZ2xvYmFsVGhpcy53ID0gd2lkdGggLyB4ZmFjdG9yKTsKICAgICAgbGV0IGggPSAoZ2xvYmFsVGhpcy5oID0gaGVpZ2h0IC8geWZhY3Rvcik7CiAgICAgIGNvbnNvbGUubG9nKCdhdHRyaWJ1dGVzJywgeyB3LCBoIH0pOwoKICAgICAgc3ZnLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCB3ICsgd3JpdGVVbml0c1swXSk7CiAgICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIGggKyB3cml0ZVVuaXRzWzFdKTsKCiAgICAgIFdyaXRlRmlsZShiYXNlbmFtZShmaWxlLCAnLnN2ZycpICsgJy5vdXQuc3ZnJywgc2VyaWFsaXplci5zZXJpYWxpemVUb1N0cmluZyhkb2N1bWVudCkpOwogICAgIAogICAgaWYocGFyYW1zLmludGVyYWN0aXZlKSBraWxsKHByb2Nlc3MucGlkLCBTSUdVU1IxKTsKICB9Cn0KCnRyeSB7CiAgbWFpbiguLi5zY3JpcHRBcmdzLnNsaWNlKDEpKTsKfSBjYXRjaChlKSB7CiAgY29uc29sZS5sb2coJ0VSUk9SJywgZS5tZXNzYWdlICsgJ1xuJyArIGUuc3RhY2spOwogIHN0YXJ0SW50ZXJhY3RpdmUoKTsKfQoAAAAAAAAAAEA+AAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAhz0AAAAAAACHPQAAAAAAAAAAAAAAAPC/"
				]
			]
		},
		{
			"file": "lib/geom/bbox.js",
			"settings":
			{
				"buffer_size": 7020,
				"line_ending": "Unix"
			},
			"undo_stack":
			[
			]
		},
		{
			"file": "eagle2svg.js",
			"redo_stack":
			[
				[
					139,
					1,
					"revert",
					null,
					"AgAAAAAAAAAAAAAAAAAAAAAAAACHCQAAIyEvdXNyL2Jpbi9lbnYgcWpzbQppbXBvcnQgKiBhcyB1dGlsIGZyb20gJy4vbGliL21pc2MuanMnOwppbXBvcnQgKiBhcyBkZWVwIGZyb20gJy4vbGliL2RlZXAuanMnOwppbXBvcnQgKiBhcyBwYXRoIGZyb20gJy4vbGliL3BhdGguanMnOwppbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7CmltcG9ydCB7IGxvZywgRWFnbGVEb2N1bWVudCwgUmVuZGVyZXIsIEVhZ2xlUHJvamVjdCB9IGZyb20gJy4vbGliL2VhZ2xlLmpzJzsKaW1wb3J0IHJlcXVpcmUgZnJvbSAncmVxdWlyZSc7CmltcG9ydCB7IENvbnNvbGUgfSBmcm9tICdjb25zb2xlJzsKaW1wb3J0IHsgcmVhZCBhcyBmcm9tWE1MLCB3cml0ZSBhcyB0b1hNTCB9IGZyb20gJy4vbGliL3htbC5qcyc7CmltcG9ydCB7IFdyaXRlRmlsZSB9IGZyb20gJy4vaW8taGVscGVycy5qcyc7CmltcG9ydCB7IGdldE9wdCB9IGZyb20gJ3V0aWwnOwppbXBvcnQgeyByZWFkRmlsZVN5bmMgfSBmcm9tICdmcyc7CmltcG9ydCB7IFJlYWN0Q29tcG9uZW50LCByZW5kZXIgfSBmcm9tICcuL2xpYi9kb20vcHJlYWN0Q29tcG9uZW50LmpzJzsKaW1wb3J0IHJlbmRlclRvU3RyaW5nIGZyb20gJy4vbGliL3ByZWFjdC1yZW5kZXItdG8tc3RyaW5nLmpzJzsKaW1wb3J0IHsgUkdCQSwgaXNSR0JBLCBJbW11dGFibGVSR0JBLCBkZWZhdWx0IGFzIHJnYmEgfSBmcm9tICcuL2xpYi9jb2xvci9yZ2JhLmpzJzsKCmxldCBkZWJ1Z0ZsYWcgPSBmYWxzZTsKCmZ1bmN0aW9uIHJlbmRlcihkb2MsIGZpbGVuYW1lKSB7CiAgaWYoZG9jIGluc3RhbmNlb2YgRWFnbGVQcm9qZWN0KSB7CiAgICByZW5kZXIoZG9jLnNjaGVtYXRpYyk7CiAgICByZW5kZXIoZG9jLmJvYXJkKTsKICAgIHJldHVybjsKICB9CiAgbGV0IHJlbmRlcmVyID0gbmV3IFJlbmRlcmVyKGRvYywgUmVhY3RDb21wb25lbnQuYXBwZW5kLCBkZWJ1Z0ZsYWcpOwoKICAvKiByZW5kZXJlci5zZXRQYWxldHRlKFsKICAgIFsweGZmLCAweGZmLCAweGZmXSwKICAgIFsweDRiLCAweDRiLCAweGE1XSwKICAgIFswLCAwLCAwXSwKICAgIFsweDRiLCAweGE1LCAweGE1XSwKICAgIFswLCAwLCAwXSwKICAgIFsweGE1LCAweDRiLCAweGE1XSwKICAgIFsweGE1LCAweGE1LCAweDRiXSwKICAgIFswLCAwLCAwXSwKICAgIFsweDRiLCAweDRiLCAweGZmXSwKICAgIFsweDRiLCAweGZmLCAweDRiXSwKICAgIFsweDRiLCAweGZmLCAweGZmXSwKICAgIFsweGZmLCAweDRiLCAweDRiXSwKICAgIFsweGZmLCAweDRiLCAweGZmXSwKICAgIFsweGZmLCAweGZmLCAweDRiXSwKICAgIFsweDRiLCAweDRiLCAweDRiXSwKICAgIFsweGE1LCAweGE1LCAweGE1XSwKICAgIFswLCAwLCAwXQogIF0ubWFwKChbcixnLGJdKSA9PiBuZXcgUkdCQShyLGcsYikpKTsqLwoKICBsZXQgc3RyOwogIGxldCBzdmcgPSByZW5kZXJlci5yZW5kZXIoZG9jKTsKICB0cnkgewogICAgc3RyID0gcmVuZGVyVG9TdHJpbmcoc3ZnKTsKICB9IGNhdGNoKGUpIHsKICAgIGNvbnNvbGUubG9nKCdFUlJPUjonLCBlKTsKICAgIGNvbnNvbGUubG9nKCdTVEFDSzonLCBlLnN0YWNrKTsKICB9CiAgICBsZXQgeG1sID0gZnJvbVhNTChzdHIpOwoKICBmaWxlbmFtZSA/Pz0KICAgIHBhdGguYmFzZW5hbWUoZG9jLmZpbGVuYW1lLCAnLicgKyBkb2MudHlwZSkgKwogICAgJy0nICsKICAgIHsgc2NoOiAnc2NoZW1hdGljJywgYnJkOiAnYm9hcmQnLCBsYnI6ICdsaWJyYXJ5JyB9W2RvYy50eXBlXSArCiAgICAnLnN2Zyc7CgogIGlmKGZpbGVuYW1lKSB7CiAgICBsZXQgcmV0OwogICAgcmV0ID0gV3JpdGVGaWxlKGZpbGVuYW1lLCAoc3RyID0gdG9YTUwoeG1sKSkpOwogICAgY29uc29sZS5sb2coYFNhdmluZyB0byAnJHtmaWxlbmFtZX0nLi4uYCwgcmV0KTsKICB9CiAgcmV0dXJuIHN0cjsKfQoKZnVuY3Rpb24gbWFpbiguLi5hcmdzKSB7CiAgZ2xvYmFsVGhpcy5jb25zb2xlID0gbmV3IENvbnNvbGUoewogICAgaW5zcGVjdE9wdGlvbnM6IHsgbWF4QXJyYXlMZW5ndGg6IDEwMCwgY29sb3JzOiB0cnVlLCBkZXB0aDogMiwgY29tcGFjdDogMCwgY3VzdG9tSW5zcGVjdDogdHJ1ZSB9CiAgfSk7CiAKICBsZXQgcGFyYW1zID0gZ2V0T3B0KAogICAgewogICAgICBkZWJ1ZzogW2ZhbHNlLCB2YWx1ZSA9PiAoZGVidWdGbGFnID0gdmFsdWUpLCAneCddLAogICAgICAnb3V0cHV0LWRpcic6IFt0cnVlLCBudWxsLCAnZCddLAogICAgICAnQCc6ICdpbnB1dCcKICAgIH0sCiAgICBhcmdzCiAgKTsKICAKICBmb3IobGV0IGFyZyBvZiBhcmdzKSB7CiAgICBsZXQgZG9jID0gRWFnbGVEb2N1bWVudC5vcGVuKGFyZywgeyByZWFkRmlsZVN5bmMgfSk7CiAKICAgIHJlbmRlcihkb2MpOwogIH0KfQoKdHJ5IHsKICBtYWluKC4uLnNjcmlwdEFyZ3Muc2xpY2UoMSkpOwp9IGNhdGNoKGVycm9yKSB7CiAgY29uc29sZS5sb2coYEZBSUw6ICR7ZXJyb3IubWVzc2FnZX1cbiR7ZXJyb3Iuc3RhY2t9YCk7Cn0KAAAAAAAAAADCCQAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAWwkAAAAAAABbCQAAAAAAAAAAAAAAAPC/"
				]
			],
			"settings":
			{
				"buffer_size": 2498,
				"encoding": "UTF-8",
				"line_ending": "Unix"
			},
			"undo_stack":
			[
				[
					9,
					1,
					"cut",
					null,
					"AQAAAAQGAAAAAAAABAYAAAAAAAA1AAAAICBjb25zb2xlLmxvZygncmVuZGVyZXIucGFsZXR0ZScsIHJlbmRlcmVyLnBhbGV0dGUpOwo",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAAEBgAAAAAAADkGAAAAAAAAAAAAAAAAAAA"
				],
				[
					10,
					1,
					"paste",
					null,
					"AQAAAAQGAAAAAAAAOQYAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAAEBgAAAAAAAAQGAAAAAAAAAAAAAAAA8L8"
				],
				[
					12,
					1,
					"paste",
					null,
					"AQAAAFcGAAAAAAAAjAYAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABXBgAAAAAAAFcGAAAAAAAAAAAAAAAAAAA"
				],
				[
					19,
					1,
					"insert",
					{
						"characters": "str"
					},
					"BAAAAGYGAAAAAAAAZwYAAAAAAAAAAAAAZwYAAAAAAABnBgAAAAAAABAAAAByZW5kZXJlci5wYWxldHRlZwYAAAAAAABoBgAAAAAAAAAAAABoBgAAAAAAAGkGAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABmBgAAAAAAAHYGAAAAAAAAAAAAAAAA8L8"
				],
				[
					24,
					1,
					"insert",
					{
						"characters": "str"
					},
					"BAAAAHUGAAAAAAAAdgYAAAAAAAAAAAAAdgYAAAAAAAB2BgAAAAAAAAcAAABwYWxldHRldgYAAAAAAAB3BgAAAAAAAAAAAAB3BgAAAAAAAHgGAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAB1BgAAAAAAAHwGAAAAAAAAAAAAAAAA8L8"
				],
				[
					29,
					2,
					"right_delete",
					null,
					"AgAAAGwGAAAAAAAAbAYAAAAAAAAIAAAAcmVuZGVyZXJsBgAAAAAAAGwGAAAAAAAAAQAAAC4",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABsBgAAAAAAAHQGAAAAAAAAAAAAAAAA8L8"
				],
				[
					42,
					1,
					"insert_snippet",
					{
						"contents": "{${0:$SELECTION}}"
					},
					"AgAAAGwGAAAAAAAAbAYAAAAAAAADAAAAc3RybAYAAAAAAABxBgAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABsBgAAAAAAAG8GAAAAAAAAAAAAAAAA8L8"
				],
				[
					43,
					1,
					"insert",
					{
						"characters": "ÃŸvg,m"
					},
					"BgAAAG0GAAAAAAAAbgYAAAAAAAAAAAAAbgYAAAAAAABuBgAAAAAAAAMAAABzdHJuBgAAAAAAAG8GAAAAAAAAAAAAAG8GAAAAAAAAcAYAAAAAAAAAAAAAcAYAAAAAAABxBgAAAAAAAAAAAABxBgAAAAAAAHIGAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABtBgAAAAAAAHAGAAAAAAAAAAAAAAAA8L8"
				],
				[
					44,
					5,
					"left_delete",
					null,
					"BQAAAHEGAAAAAAAAcQYAAAAAAAABAAAAbXAGAAAAAAAAcAYAAAAAAAABAAAALG8GAAAAAAAAbwYAAAAAAAABAAAAZ24GAAAAAAAAbgYAAAAAAAABAAAAdm0GAAAAAAAAbQYAAAAAAAACAAAAw58",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAByBgAAAAAAAHIGAAAAAAAAAAAAAAAA8L8"
				],
				[
					45,
					1,
					"insert",
					{
						"characters": "svg,str"
					},
					"BwAAAG0GAAAAAAAAbgYAAAAAAAAAAAAAbgYAAAAAAABvBgAAAAAAAAAAAABvBgAAAAAAAHAGAAAAAAAAAAAAAHAGAAAAAAAAcQYAAAAAAAAAAAAAcQYAAAAAAAByBgAAAAAAAAAAAAByBgAAAAAAAHMGAAAAAAAAAAAAAHMGAAAAAAAAdAYAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABtBgAAAAAAAG0GAAAAAAAAAAAAAAAA8L8"
				],
				[
					48,
					3,
					"left_delete",
					null,
					"AwAAAGgGAAAAAAAAaAYAAAAAAAABAAAAcmcGAAAAAAAAZwYAAAAAAAABAAAAdGYGAAAAAAAAZgYAAAAAAAABAAAAcw",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABpBgAAAAAAAGkGAAAAAAAAAAAAAAAA8L8"
				],
				[
					49,
					1,
					"insert",
					{
						"characters": "render"
					},
					"BgAAAGYGAAAAAAAAZwYAAAAAAAAAAAAAZwYAAAAAAABoBgAAAAAAAAAAAABoBgAAAAAAAGkGAAAAAAAAAAAAAGkGAAAAAAAAagYAAAAAAAAAAAAAagYAAAAAAABrBgAAAAAAAAAAAABrBgAAAAAAAGwGAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABmBgAAAAAAAGYGAAAAAAAAAAAAAAAA8L8"
				],
				[
					72,
					1,
					"insert",
					{
						"characters": "2"
					},
					"AgAAADkIAAAAAAAAOggAAAAAAAAAAAAAOggAAAAAAAA6CAAAAAAAAAIAAAAxMA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAA5CAAAAAAAADsIAAAAAAAAAAAAAAAA8L8"
				],
				[
					119,
					1,
					"revert",
					null,
					"AgAAAAAAAAAAAAAAAAAAAAAAAAAiCgAAIyEvdXNyL2Jpbi9lbnYgcWpzbQppbXBvcnQgKiBhcyB1dGlsIGZyb20gJy4vbGliL21pc2MuanMnOwppbXBvcnQgKiBhcyBkZWVwIGZyb20gJy4vbGliL2RlZXAuanMnOwppbXBvcnQgKiBhcyBwYXRoIGZyb20gJy4vbGliL3BhdGguanMnOwppbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7CmltcG9ydCB7IGxvZywgRWFnbGVEb2N1bWVudCwgUmVuZGVyZXIsIEVhZ2xlUHJvamVjdCB9IGZyb20gJy4vbGliL2VhZ2xlLmpzJzsKaW1wb3J0IHJlcXVpcmUgZnJvbSAncmVxdWlyZSc7CmltcG9ydCB7IENvbnNvbGUgfSBmcm9tICdjb25zb2xlJzsKaW1wb3J0IHsgcmVhZCBhcyBmcm9tWE1MLCB3cml0ZSBhcyB0b1hNTCB9IGZyb20gJy4vbGliL3htbC5qcyc7CmltcG9ydCB7IFdyaXRlRmlsZSB9IGZyb20gJy4vaW8taGVscGVycy5qcyc7CmltcG9ydCB7IGdldE9wdCB9IGZyb20gJ3V0aWwnOwppbXBvcnQgeyByZWFkRmlsZVN5bmMgfSBmcm9tICdmcyc7CmltcG9ydCB7IFJlYWN0Q29tcG9uZW50LCByZW5kZXIgfSBmcm9tICcuL2xpYi9kb20vcHJlYWN0Q29tcG9uZW50LmpzJzsKaW1wb3J0IHJlbmRlclRvU3RyaW5nIGZyb20gJy4vbGliL3ByZWFjdC1yZW5kZXItdG8tc3RyaW5nLmpzJzsKaW1wb3J0IHsgUkdCQSwgaXNSR0JBLCBJbW11dGFibGVSR0JBLCBkZWZhdWx0IGFzIHJnYmEgfSBmcm9tICcuL2xpYi9jb2xvci9yZ2JhLmpzJzsKCmxldCBkZWJ1Z0ZsYWcgPSBmYWxzZTsKCmZ1bmN0aW9uIHJlbmRlcihkb2MsIGZpbGVuYW1lKSB7CiAgaWYoZG9jIGluc3RhbmNlb2YgRWFnbGVQcm9qZWN0KSB7CiAgICByZW5kZXIoZG9jLnNjaGVtYXRpYyk7CiAgICByZW5kZXIoZG9jLmJvYXJkKTsKICAgIHJldHVybjsKICB9CiAgbGV0IHJlbmRlcmVyID0gbmV3IFJlbmRlcmVyKGRvYywgUmVhY3RDb21wb25lbnQuYXBwZW5kLCBkZWJ1Z0ZsYWcpOwoKICAvKiByZW5kZXJlci5zZXRQYWxldHRlKFsKICAgIFsweGZmLCAweGZmLCAweGZmXSwKICAgIFsweDRiLCAweDRiLCAweGE1XSwKICAgIFswLCAwLCAwXSwKICAgIFsweDRiLCAweGE1LCAweGE1XSwKICAgIFswLCAwLCAwXSwKICAgIFsweGE1LCAweDRiLCAweGE1XSwKICAgIFsweGE1LCAweGE1LCAweDRiXSwKICAgIFswLCAwLCAwXSwKICAgIFsweDRiLCAweDRiLCAweGZmXSwKICAgIFsweDRiLCAweGZmLCAweDRiXSwKICAgIFsweDRiLCAweGZmLCAweGZmXSwKICAgIFsweGZmLCAweDRiLCAweDRiXSwKICAgIFsweGZmLCAweDRiLCAweGZmXSwKICAgIFsweGZmLCAweGZmLCAweDRiXSwKICAgIFsweDRiLCAweDRiLCAweDRiXSwKICAgIFsweGE1LCAweGE1LCAweGE1XSwKICAgIFswLCAwLCAwXQogIF0ubWFwKChbcixnLGJdKSA9PiBuZXcgUkdCQShyLGcsYikpKTsqLwoKICBsZXQgc3RyOwogIGxldCBzdmcgPSByZW5kZXJlci5yZW5kZXIoZG9jKTsKICB0cnkgewogICAgc3RyID0gcmVuZGVyVG9TdHJpbmcoc3ZnKTsKICB9IGNhdGNoKGUpIHsKICAgIGNvbnNvbGUubG9nKCdFUlJPUjonLCBlKTsKICAgIGNvbnNvbGUubG9nKCdTVEFDSzonLCBlLnN0YWNrKTsKICB9CiAgY29uc29sZS5sb2coJ3JlbmRlcmVyLnBhbGV0dGUnLCByZW5kZXJlci5wYWxldHRlKTsKICAvL2NvbnNvbGUubG9nKCdzdHInLCBzdHIpOwoKICBjb25zb2xlLmxvZygncmVuZGVyJywge3N2ZyxzdHJ9KTsKICBsZXQgeG1sID0gZnJvbVhNTChzdHIpOwoKICBmaWxlbmFtZSA/Pz0gcGF0aC5iYXNlbmFtZShkb2MuZmlsZW5hbWUsICcuJyArIGRvYy50eXBlKSArICctJyArIHsgc2NoOiAnc2NoZW1hdGljJywgYnJkOiAnYm9hcmQnLCBsYnI6ICdsaWJyYXJ5JyB9W2RvYy50eXBlXSArICcuc3ZnJzsKCiAgaWYoZmlsZW5hbWUpIHsKICAgIGxldCByZXQ7CiAgICByZXQgPSBXcml0ZUZpbGUoZmlsZW5hbWUsIChzdHIgPSB0b1hNTCh4bWwpKSk7CiAgICBjb25zb2xlLmxvZyhgU2F2aW5nIHRvICcke2ZpbGVuYW1lfScuLi5gLCByZXQpOwogIH0KICByZXR1cm4gc3RyOwp9CgpmdW5jdGlvbiBtYWluKC4uLmFyZ3MpIHsKICBnbG9iYWxUaGlzLmNvbnNvbGUgPSBuZXcgQ29uc29sZSh7CiAgICBpbnNwZWN0T3B0aW9uczogeyBtYXhBcnJheUxlbmd0aDogMTAwLCBjb2xvcnM6IHRydWUsIGRlcHRoOiAyLCBjb21wYWN0OiAxLCBjdXN0b21JbnNwZWN0OiB0cnVlIH0KICB9KTsKICBjb25zb2xlLmxvZygnYXJncycsIGFyZ3MpOwoKICBsZXQgcGFyYW1zID0gZ2V0T3B0KAogICAgewogICAgICBkZWJ1ZzogW2ZhbHNlLCB2YWx1ZSA9PiAoZGVidWdGbGFnID0gdmFsdWUpLCAneCddLAogICAgICAnb3V0cHV0LWRpcic6IFt0cnVlLCBudWxsLCAnZCddLAogICAgICAnQCc6ICdpbnB1dCcKICAgIH0sCiAgICBhcmdzCiAgKTsKICBmb3IobGV0IGFyZyBvZiBhcmdzKSB7CiAgICBsZXQgZG9jID0gRWFnbGVEb2N1bWVudC5vcGVuKGFyZywgeyByZWFkRmlsZVN5bmMgfSk7CgogICAgY29uc29sZS5sb2coJ2RvYycsIGRvYyk7CgogICAgcmVuZGVyKGRvYyk7CiAgfQp9Cgp0cnkgewogIG1haW4oLi4uc2NyaXB0QXJncy5zbGljZSgxKSk7Cn0gY2F0Y2goZXJyb3IpIHsKICBjb25zb2xlLmxvZyhgRkFJTDogJHtlcnJvci5tZXNzYWdlfVxuJHtlcnJvci5zdGFja31gKTsKfQoAAAAAAAAAADUKAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADWCQAAAAAAAOcJAAAAAAAAAAAAAAAA8L8"
				],
				[
					139,
					1,
					"insert",
					{
						"characters": "0"
					},
					"AgAAAFgIAAAAAAAAWQgAAAAAAAAAAAAAWQgAAAAAAABZCAAAAAAAAAEAAAAx",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABYCAAAAAAAAFkIAAAAAAAAAAAAAAAA8L8"
				],
				[
					156,
					1,
					"insert",
					{
						"characters": "//"
					},
					"AgAAAFgGAAAAAAAAWQYAAAAAAAAAAAAAWQYAAAAAAABaBgAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABYBgAAAAAAAFgGAAAAAAAAAAAAAAAA8L8"
				],
				[
					162,
					1,
					"insert",
					{
						"characters": " "
					},
					"AgAAAAEGAAAAAAAAAgYAAAAAAAAAAAAAAgYAAAAAAAACBgAAAAAAAH8AAAAgfQogIGNvbnNvbGUubG9nKCdyZW5kZXJlci5wYWxldHRlJywgcmVuZGVyZXIucGFsZXR0ZSk7CiAgLy9jb25zb2xlLmxvZygnc3RyJywgc3RyKTsKCiAvLyBjb25zb2xlLmxvZygncmVuZGVyJywgeyBzdmcsIHN0ciB9KTsK",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAABBgAAAAAAAIAGAAAAAAAAAAAAAAAA8L8"
				],
				[
					165,
					1,
					"insert",
					{
						"characters": "}"
					},
					"AQAAAAIGAAAAAAAAAwYAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAACBgAAAAAAAAIGAAAAAAAAAAAAAAAA8L8"
				],
				[
					166,
					1,
					"insert",
					{
						"characters": "\n"
					},
					"AgAAAAMGAAAAAAAABAYAAAAAAAAAAAAABAYAAAAAAAAGBgAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAADBgAAAAAAAAMGAAAAAAAAAAAAAAAA8L8"
				],
				[
					178,
					1,
					"insert",
					{
						"characters": " "
					},
					"AgAAAP8HAAAAAAAAAAgAAAAAAAAAAAAAAAgAAAAAAAAACAAAAAAAAB0AAAAgIGNvbnNvbGUubG9nKCdhcmdzJywgYXJncyk7Cg",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAD/BwAAAAAAABwIAAAAAAAAAAAAAAAA8L8"
				],
				[
					193,
					1,
					"insert",
					{
						"characters": " "
					},
					"AgAAAPgIAAAAAAAA+QgAAAAAAAAAAAAA+QgAAAAAAAD5CAAAAAAAAB4AAAAKICAgIGNvbnNvbGUubG9nKCdkb2MnLCBkb2MpOwo",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAD4CAAAAAAAABYJAAAAAAAAAAAAAAAA8L8"
				],
				[
					198,
					1,
					"insert",
					{
						"characters": "\n"
					},
					"AgAAAKUIAAAAAAAApggAAAAAAAAAAAAApggAAAAAAACoCAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAClCAAAAAAAAKUIAAAAAAAAAAAAAAAA8L8"
				],
				[
					65,
					1,
					"cut",
					null,
					"AQAAADMGAAAAAAAAMwYAAAAAAACHAAAAIHBhdGguYmFzZW5hbWUoZG9jLmZpbGVuYW1lLCAnLicgKyBkb2MudHlwZSkgKwogICAgJy0nICsKICAgIHsgc2NoOiAnc2NoZW1hdGljJywgYnJkOiAnYm9hcmQnLCBsYnI6ICdsaWJyYXJ5JyB9W2RvYy50eXBlXSArCiAgICAnLnN2Zyc7",
					"AQAAAAAAAAABAAAAMwYAAAAAAAC6BgAAAAAAAAAAAAAAAPC/"
				],
				[
					68,
					1,
					"insert",
					{
						"characters": ","
					},
					"AQAAAIQIAAAAAAAAhQgAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAhAgAAAAAAACECAAAAAAAAAAAAAAAAPC/"
				],
				[
					69,
					1,
					"insert",
					{
						"characters": " "
					},
					"AQAAAIUIAAAAAAAAhggAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAhQgAAAAAAACFCAAAAAAAAAAAAAAAAPC/"
				],
				[
					70,
					1,
					"paste",
					null,
					"AQAAAIYIAAAAAAAADQkAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAhggAAAAAAACGCAAAAAAAAAAAAAAAAPC/"
				],
				[
					71,
					1,
					"left_delete",
					null,
					"AQAAAAwJAAAAAAAADAkAAAAAAAABAAAAOw",
					"AQAAAAAAAAABAAAADQkAAAAAAAANCQAAAAAAAAAAAAAAAPC/"
				],
				[
					84,
					1,
					"insert",
					{
						"characters": " "
					},
					"AgAAACMGAAAAAAAAJAYAAAAAAAAAAAAAJAYAAAAAAAAkBgAAAAAAABEAAABmaWxlbmFtZSA/Pz0KICAgCg",
					"AQAAAAAAAAABAAAAIwYAAAAAAAA0BgAAAAAAAAAAAAAAAPC/"
				],
				[
					97,
					1,
					"cut",
					null,
					"AQAAAHcIAAAAAAAAdwgAAAAAAACFAAAAcGF0aC5iYXNlbmFtZShkb2MuZmlsZW5hbWUsICcuJyArIGRvYy50eXBlKSArCiAgICAnLScgKwogICAgeyBzY2g6ICdzY2hlbWF0aWMnLCBicmQ6ICdib2FyZCcsIGxicjogJ2xpYnJhcnknIH1bZG9jLnR5cGVdICsKICAgICcuc3ZnJw",
					"AQAAAAAAAAABAAAAdwgAAAAAAAD8CAAAAAAAAAAAAAAAAPC/"
				],
				[
					101,
					1,
					"insert",
					{
						"characters": "let"
					},
					"AwAAAGUIAAAAAAAAZggAAAAAAAAAAAAAZggAAAAAAABnCAAAAAAAAAAAAABnCAAAAAAAAGgIAAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAZQgAAAAAAABlCAAAAAAAAAAAAAAAwFZA"
				],
				[
					102,
					1,
					"insert",
					{
						"characters": " file="
					},
					"BgAAAGgIAAAAAAAAaQgAAAAAAAAAAAAAaQgAAAAAAABqCAAAAAAAAAAAAABqCAAAAAAAAGsIAAAAAAAAAAAAAGsIAAAAAAAAbAgAAAAAAAAAAAAAbAgAAAAAAABtCAAAAAAAAAAAAABtCAAAAAAAAG4IAAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAaAgAAAAAAABoCAAAAAAAAAAAAAAAAPC/"
				],
				[
					103,
					1,
					"paste",
					null,
					"AQAAAG4IAAAAAAAA8wgAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAbggAAAAAAABuCAAAAAAAAAAAAAAAAPC/"
				],
				[
					104,
					1,
					"insert",
					{
						"characters": ";"
					},
					"AQAAAPMIAAAAAAAA9AgAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAA8wgAAAAAAADzCAAAAAAAAAAAAAAAAPC/"
				],
				[
					105,
					1,
					"insert",
					{
						"characters": "\n\nif"
					},
					"BwAAAPQIAAAAAAAA9QgAAAAAAAAAAAAA9QgAAAAAAAD5CAAAAAAAAAAAAAD5CAAAAAAAAPoIAAAAAAAAAAAAAPoIAAAAAAAA/ggAAAAAAAAAAAAA9QgAAAAAAAD1CAAAAAAAAAQAAAAgICAg+ggAAAAAAAD7CAAAAAAAAAAAAAD7CAAAAAAAAPwIAAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAA9AgAAAAAAAD0CAAAAAAAAAAAAAAAAPC/"
				],
				[
					106,
					1,
					"insert_snippet",
					{
						"contents": "($0)"
					},
					"AQAAAPwIAAAAAAAA/ggAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAA/AgAAAAAAAD8CAAAAAAAAAAAAAAAAPC/"
				],
				[
					107,
					1,
					"insert",
					{
						"characters": "params"
					},
					"BgAAAP0IAAAAAAAA/ggAAAAAAAAAAAAA/ggAAAAAAAD/CAAAAAAAAAAAAAD/CAAAAAAAAAAJAAAAAAAAAAAAAAAJAAAAAAAAAQkAAAAAAAAAAAAAAQkAAAAAAAACCQAAAAAAAAAAAAACCQAAAAAAAAMJAAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAA/QgAAAAAAAD9CAAAAAAAAAAAAAAAAPC/"
				],
				[
					108,
					1,
					"insert_snippet",
					{
						"contents": "[$0]"
					},
					"AQAAAAMJAAAAAAAABQkAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAAwkAAAAAAAADCQAAAAAAAAAAAAAAAPC/"
				],
				[
					109,
					1,
					"insert_snippet",
					{
						"contents": "'$0'"
					},
					"AQAAAAQJAAAAAAAABgkAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAABAkAAAAAAAAECQAAAAAAAAAAAAAAAPC/"
				],
				[
					110,
					1,
					"insert",
					{
						"characters": "opu"
					},
					"AwAAAAUJAAAAAAAABgkAAAAAAAAAAAAABgkAAAAAAAAHCQAAAAAAAAAAAAAHCQAAAAAAAAgJAAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAABQkAAAAAAAAFCQAAAAAAAAAAAAAAAPC/"
				],
				[
					111,
					2,
					"left_delete",
					null,
					"AgAAAAcJAAAAAAAABwkAAAAAAAABAAAAdQYJAAAAAAAABgkAAAAAAAABAAAAcA",
					"AQAAAAAAAAABAAAACAkAAAAAAAAICQAAAAAAAAAAAAAAAPC/"
				],
				[
					112,
					1,
					"insert",
					{
						"characters": "utput-dir"
					},
					"CQAAAAYJAAAAAAAABwkAAAAAAAAAAAAABwkAAAAAAAAICQAAAAAAAAAAAAAICQAAAAAAAAkJAAAAAAAAAAAAAAkJAAAAAAAACgkAAAAAAAAAAAAACgkAAAAAAAALCQAAAAAAAAAAAAALCQAAAAAAAAwJAAAAAAAAAAAAAAwJAAAAAAAADQkAAAAAAAAAAAAADQkAAAAAAAAOCQAAAAAAAAAAAAAOCQAAAAAAAA8JAAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAABgkAAAAAAAAGCQAAAAAAAAAAAAAAAPC/"
				],
				[
					115,
					1,
					"insert",
					{
						"characters": "\nfile=path."
					},
					"DgAAABIJAAAAAAAAEwkAAAAAAAAAAAAAEwkAAAAAAAAXCQAAAAAAAAAAAAATCQAAAAAAABMJAAAAAAAABAAAACAgICATCQAAAAAAABkJAAAAAAAAAAAAABkJAAAAAAAAGgkAAAAAAAAAAAAAGgkAAAAAAAAbCQAAAAAAAAAAAAAbCQAAAAAAABwJAAAAAAAAAAAAABwJAAAAAAAAHQkAAAAAAAAAAAAAHQkAAAAAAAAeCQAAAAAAAAAAAAAeCQAAAAAAAB8JAAAAAAAAAAAAAB8JAAAAAAAAIAkAAAAAAAAAAAAAIAkAAAAAAAAhCQAAAAAAAAAAAAAhCQAAAAAAACIJAAAAAAAAAAAAACIJAAAAAAAAIwkAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAEgkAAAAAAAASCQAAAAAAAAAAAAAAAPC/"
				],
				[
					116,
					1,
					"insert",
					{
						"characters": "join"
					},
					"BAAAACMJAAAAAAAAJAkAAAAAAAAAAAAAJAkAAAAAAAAlCQAAAAAAAAAAAAAlCQAAAAAAACYJAAAAAAAAAAAAACYJAAAAAAAAJwkAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAIwkAAAAAAAAjCQAAAAAAAAAAAAAAAPC/"
				],
				[
					117,
					1,
					"insert_snippet",
					{
						"contents": "($0)"
					},
					"AQAAACcJAAAAAAAAKQkAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAJwkAAAAAAAAnCQAAAAAAAAAAAAAAAPC/"
				],
				[
					118,
					1,
					"insert",
					{
						"characters": "file"
					},
					"BAAAACgJAAAAAAAAKQkAAAAAAAAAAAAAKQkAAAAAAAAqCQAAAAAAAAAAAAAqCQAAAAAAACsJAAAAAAAAAAAAACsJAAAAAAAALAkAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAKAkAAAAAAAAoCQAAAAAAAAAAAAAAAPC/"
				],
				[
					119,
					4,
					"left_delete",
					null,
					"BAAAACsJAAAAAAAAKwkAAAAAAAABAAAAZSoJAAAAAAAAKgkAAAAAAAABAAAAbCkJAAAAAAAAKQkAAAAAAAABAAAAaSgJAAAAAAAAKAkAAAAAAAABAAAAZg",
					"AQAAAAAAAAABAAAALAkAAAAAAAAsCQAAAAAAAAAAAAAAAPC/"
				],
				[
					120,
					1,
					"insert",
					{
						"characters": "params"
					},
					"BgAAACgJAAAAAAAAKQkAAAAAAAAAAAAAKQkAAAAAAAAqCQAAAAAAAAAAAAAqCQAAAAAAACsJAAAAAAAAAAAAACsJAAAAAAAALAkAAAAAAAAAAAAALAkAAAAAAAAtCQAAAAAAAAAAAAAtCQAAAAAAAC4JAAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAKAkAAAAAAAAoCQAAAAAAAAAAAAAAAPC/"
				],
				[
					121,
					1,
					"insert_snippet",
					{
						"contents": "[$0]"
					},
					"AQAAAC4JAAAAAAAAMAkAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAALgkAAAAAAAAuCQAAAAAAAAAAAAAAAPC/"
				],
				[
					122,
					1,
					"insert_snippet",
					{
						"contents": "'$0'"
					},
					"AQAAAC8JAAAAAAAAMQkAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAALwkAAAAAAAAvCQAAAAAAAAAAAAAAAPC/"
				],
				[
					123,
					1,
					"insert",
					{
						"characters": "output-dir"
					},
					"CgAAADAJAAAAAAAAMQkAAAAAAAAAAAAAMQkAAAAAAAAyCQAAAAAAAAAAAAAyCQAAAAAAADMJAAAAAAAAAAAAADMJAAAAAAAANAkAAAAAAAAAAAAANAkAAAAAAAA1CQAAAAAAAAAAAAA1CQAAAAAAADYJAAAAAAAAAAAAADYJAAAAAAAANwkAAAAAAAAAAAAANwkAAAAAAAA4CQAAAAAAAAAAAAA4CQAAAAAAADkJAAAAAAAAAAAAADkJAAAAAAAAOgkAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAMAkAAAAAAAAwCQAAAAAAAAAAAAAAAPC/"
				],
				[
					125,
					1,
					"insert",
					{
						"characters": ","
					},
					"AQAAADwJAAAAAAAAPQkAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAPAkAAAAAAAA8CQAAAAAAAAAAAAAAAPC/"
				],
				[
					126,
					1,
					"insert",
					{
						"characters": " fiole"
					},
					"BgAAAD0JAAAAAAAAPgkAAAAAAAAAAAAAPgkAAAAAAAA/CQAAAAAAAAAAAAA/CQAAAAAAAEAJAAAAAAAAAAAAAEAJAAAAAAAAQQkAAAAAAAAAAAAAQQkAAAAAAABCCQAAAAAAAAAAAABCCQAAAAAAAEMJAAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAPQkAAAAAAAA9CQAAAAAAAAAAAAAAAPC/"
				],
				[
					127,
					3,
					"left_delete",
					null,
					"AwAAAEIJAAAAAAAAQgkAAAAAAAABAAAAZUEJAAAAAAAAQQkAAAAAAAABAAAAbEAJAAAAAAAAQAkAAAAAAAABAAAAbw",
					"AQAAAAAAAAABAAAAQwkAAAAAAABDCQAAAAAAAAAAAAAAAPC/"
				],
				[
					128,
					1,
					"insert",
					{
						"characters": "le"
					},
					"AgAAAEAJAAAAAAAAQQkAAAAAAAAAAAAAQQkAAAAAAABCCQAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAQAkAAAAAAABACQAAAAAAAAAAAAAAAPC/"
				],
				[
					130,
					1,
					"insert",
					{
						"characters": ";"
					},
					"AQAAAEMJAAAAAAAARAkAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAQwkAAAAAAABDCQAAAAAAAAAAAAAAAPC/"
				],
				[
					131,
					1,
					"insert",
					{
						"characters": "\n"
					},
					"BAAAAEQJAAAAAAAARQkAAAAAAAAAAAAARQkAAAAAAABLCQAAAAAAAAAAAABFCQAAAAAAAEUJAAAAAAAABgAAACAgICAgIEUJAAAAAAAASQkAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAARAkAAAAAAABECQAAAAAAAAAAAAAAAPC/"
				],
				[
					135,
					1,
					"insert",
					{
						"characters": "file"
					},
					"BQAAAFsJAAAAAAAAXAkAAAAAAAAAAAAARQkAAAAAAABFCQAAAAAAAAQAAAAgICAgWAkAAAAAAABZCQAAAAAAAAAAAABZCQAAAAAAAFoJAAAAAAAAAAAAAFoJAAAAAAAAWwkAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAWwkAAAAAAABbCQAAAAAAAAAAAAAAAPC/"
				],
				[
					138,
					1,
					"revert",
					null,
					"AgAAAAAAAAAAAAAAAAAAAAAAAADXCQAAIyEvdXNyL2Jpbi9lbnYgcWpzbQppbXBvcnQgKiBhcyB1dGlsIGZyb20gJy4vbGliL21pc2MuanMnOwppbXBvcnQgKiBhcyBkZWVwIGZyb20gJy4vbGliL2RlZXAuanMnOwppbXBvcnQgKiBhcyBwYXRoIGZyb20gJy4vbGliL3BhdGguanMnOwppbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7CmltcG9ydCB7IGxvZywgRWFnbGVEb2N1bWVudCwgUmVuZGVyZXIsIEVhZ2xlUHJvamVjdCB9IGZyb20gJy4vbGliL2VhZ2xlLmpzJzsKaW1wb3J0IHJlcXVpcmUgZnJvbSAncmVxdWlyZSc7CmltcG9ydCB7IENvbnNvbGUgfSBmcm9tICdjb25zb2xlJzsKaW1wb3J0IHsgcmVhZCBhcyBmcm9tWE1MLCB3cml0ZSBhcyB0b1hNTCB9IGZyb20gJy4vbGliL3htbC5qcyc7CmltcG9ydCB7IFdyaXRlRmlsZSB9IGZyb20gJy4vaW8taGVscGVycy5qcyc7CmltcG9ydCB7IGdldE9wdCB9IGZyb20gJ3V0aWwnOwppbXBvcnQgeyByZWFkRmlsZVN5bmMgfSBmcm9tICdmcyc7CmltcG9ydCB7IFJlYWN0Q29tcG9uZW50LCByZW5kZXIgfSBmcm9tICcuL2xpYi9kb20vcHJlYWN0Q29tcG9uZW50LmpzJzsKaW1wb3J0IHJlbmRlclRvU3RyaW5nIGZyb20gJy4vbGliL3ByZWFjdC1yZW5kZXItdG8tc3RyaW5nLmpzJzsKaW1wb3J0IHsgUkdCQSwgaXNSR0JBLCBJbW11dGFibGVSR0JBLCBkZWZhdWx0IGFzIHJnYmEgfSBmcm9tICcuL2xpYi9jb2xvci9yZ2JhLmpzJzsKCmxldCBkZWJ1Z0ZsYWcgPSBmYWxzZTsKCmZ1bmN0aW9uIHJlbmRlcihkb2MsIGZpbGVuYW1lKSB7CiAgaWYoZG9jIGluc3RhbmNlb2YgRWFnbGVQcm9qZWN0KSB7CiAgICByZW5kZXIoZG9jLnNjaGVtYXRpYyk7CiAgICByZW5kZXIoZG9jLmJvYXJkKTsKICAgIHJldHVybjsKICB9CiAgbGV0IHJlbmRlcmVyID0gbmV3IFJlbmRlcmVyKGRvYywgUmVhY3RDb21wb25lbnQuYXBwZW5kLCBkZWJ1Z0ZsYWcpOwoKICAvKiByZW5kZXJlci5zZXRQYWxldHRlKFsKICAgIFsweGZmLCAweGZmLCAweGZmXSwKICAgIFsweDRiLCAweDRiLCAweGE1XSwKICAgIFswLCAwLCAwXSwKICAgIFsweDRiLCAweGE1LCAweGE1XSwKICAgIFswLCAwLCAwXSwKICAgIFsweGE1LCAweDRiLCAweGE1XSwKICAgIFsweGE1LCAweGE1LCAweDRiXSwKICAgIFswLCAwLCAwXSwKICAgIFsweDRiLCAweDRiLCAweGZmXSwKICAgIFsweDRiLCAweGZmLCAweDRiXSwKICAgIFsweDRiLCAweGZmLCAweGZmXSwKICAgIFsweGZmLCAweDRiLCAweDRiXSwKICAgIFsweGZmLCAweDRiLCAweGZmXSwKICAgIFsweGZmLCAweGZmLCAweDRiXSwKICAgIFsweDRiLCAweDRiLCAweDRiXSwKICAgIFsweGE1LCAweGE1LCAweGE1XSwKICAgIFswLCAwLCAwXQogIF0ubWFwKChbcixnLGJdKSA9PiBuZXcgUkdCQShyLGcsYikpKTsqLwoKICBsZXQgc3RyOwogIGxldCBzdmcgPSByZW5kZXJlci5yZW5kZXIoZG9jKTsKICB0cnkgewogICAgc3RyID0gcmVuZGVyVG9TdHJpbmcoc3ZnKTsKICB9IGNhdGNoKGUpIHsKICAgIGNvbnNvbGUubG9nKCdFUlJPUjonLCBlKTsKICAgIGNvbnNvbGUubG9nKCdTVEFDSzonLCBlLnN0YWNrKTsKICB9CiAgICBsZXQgeG1sID0gZnJvbVhNTChzdHIpOwoKICAgCiAgaWYoZmlsZW5hbWUpIHsKICAgIGxldCByZXQ7CiAgICByZXQgPSBXcml0ZUZpbGUoZmlsZW5hbWUsIChzdHIgPSB0b1hNTCh4bWwpKSk7CiAgICBjb25zb2xlLmxvZyhgU2F2aW5nIHRvICcke2ZpbGVuYW1lfScuLi5gLCByZXQpOwogIH0KICByZXR1cm4gc3RyOwp9CgpmdW5jdGlvbiBtYWluKC4uLmFyZ3MpIHsKICBnbG9iYWxUaGlzLmNvbnNvbGUgPSBuZXcgQ29uc29sZSh7CiAgICBpbnNwZWN0T3B0aW9uczogeyBtYXhBcnJheUxlbmd0aDogMTAwLCBjb2xvcnM6IHRydWUsIGRlcHRoOiAyLCBjb21wYWN0OiAwLCBjdXN0b21JbnNwZWN0OiB0cnVlIH0KICB9KTsKIAogIGxldCBwYXJhbXMgPSBnZXRPcHQoCiAgICB7CiAgICAgIGRlYnVnOiBbZmFsc2UsIHZhbHVlID0+IChkZWJ1Z0ZsYWcgPSB2YWx1ZSksICd4J10sCiAgICAgICdvdXRwdXQtZGlyJzogW3RydWUsIG51bGwsICdkJ10sCiAgICAgICdAJzogJ2lucHV0JwogICAgfSwKICAgIGFyZ3MKICApOwogIAogIGZvcihsZXQgYXJnIG9mIGFyZ3MpIHsKICAgIGxldCBkb2MgPSBFYWdsZURvY3VtZW50Lm9wZW4oYXJnLCB7IHJlYWRGaWxlU3luYyB9KTsKIGxldCBmaWxlPXBhdGguYmFzZW5hbWUoZG9jLmZpbGVuYW1lLCAnLicgKyBkb2MudHlwZSkgKwogICAgJy0nICsKICAgIHsgc2NoOiAnc2NoZW1hdGljJywgYnJkOiAnYm9hcmQnLCBsYnI6ICdsaWJyYXJ5JyB9W2RvYy50eXBlXSArCiAgICAnLnN2Zyc7CgogICAgaWYocGFyYW1zWydvdXRwdXQtZGlyJ10pCiAgICAgIGZpbGU9cGF0aC5qb2luKHBhcmFtc1snb3V0cHV0LWRpciddLCBmaWxlKTsKCiAgICByZW5kZXIoZG9jLCAgZmlsZSk7CiAgfQp9Cgp0cnkgewogIG1haW4oLi4uc2NyaXB0QXJncy5zbGljZSgxKSk7Cn0gY2F0Y2goZXJyb3IpIHsKICBjb25zb2xlLmxvZyhgRkFJTDogJHtlcnJvci5tZXNzYWdlfVxuJHtlcnJvci5zdGFja31gKTsKfQoAAAAAAAAAAMIJAAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAWwkAAAAAAABbCQAAAAAAAAAAAAAAAPC/"
				]
			]
		},
		{
			"file": "quickjs/qjs-modules/src/qjsm.c",
			"settings":
			{
				"buffer_size": 46181,
				"encoding": "UTF-8",
				"line_ending": "Unix"
			}
		},
		{
			"file": "lib/eagle/svgRenderer.js",
			"settings":
			{
				"buffer_size": 11951,
				"encoding": "UTF-8",
				"line_ending": "Unix"
			},
			"undo_stack":
			[
				[
					13,
					1,
					"insert",
					{
						"characters": "\n"
					},
					"AQAAAOsIAAAAAAAA7AgAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADrCAAAAAAAAOsIAAAAAAAAAAAAAAAAAAA"
				],
				[
					15,
					1,
					"insert",
					{
						"characters": "\n"
					},
					"AQAAAKYIAAAAAAAApwgAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAACmCAAAAAAAAKYIAAAAAAAAAAAAAAAAAAA"
				],
				[
					17,
					3,
					"right_delete",
					null,
					"AwAAAK4IAAAAAAAArggAAAAAAAABAAAAIK4IAAAAAAAArggAAAAAAAABAAAAL64IAAAAAAAArggAAAAAAAABAAAALw",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAACuCAAAAAAAAK4IAAAAAAAAAAAAAAAA8L8"
				],
				[
					20,
					9,
					"left_delete",
					null,
					"CQAAAOQIAAAAAAAA5AgAAAAAAAABAAAAIOMIAAAAAAAA4wgAAAAAAAABAAAAL+IIAAAAAAAA4ggAAAAAAAABAAAAKuEIAAAAAAAA4QgAAAAAAAABAAAAZuAIAAAAAAAA4AgAAAAAAAABAAAAZd8IAAAAAAAA3wgAAAAAAAABAAAAct4IAAAAAAAA3ggAAAAAAAABAAAALN0IAAAAAAAA3QgAAAAAAAABAAAAKtwIAAAAAAAA3AgAAAAAAAABAAAALw",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADlCAAAAAAAAOUIAAAAAAAAAAAAAAAA8L8"
				],
				[
					26,
					1,
					"insert",
					{
						"characters": ","
					},
					"AQAAAN0IAAAAAAAA3ggAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADdCAAAAAAAAN0IAAAAAAAAAAAAAAAA8L8"
				],
				[
					27,
					1,
					"insert",
					{
						"characters": " path.pa"
					},
					"CAAAAN4IAAAAAAAA3wgAAAAAAAAAAAAA3wgAAAAAAADgCAAAAAAAAAAAAADgCAAAAAAAAOEIAAAAAAAAAAAAAOEIAAAAAAAA4ggAAAAAAAAAAAAA4ggAAAAAAADjCAAAAAAAAAAAAADjCAAAAAAAAOQIAAAAAAAAAAAAAOQIAAAAAAAA5QgAAAAAAAAAAAAA5QgAAAAAAADmCAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADeCAAAAAAAAN4IAAAAAAAAAAAAAAAA8L8"
				],
				[
					28,
					2,
					"left_delete",
					null,
					"AgAAAOUIAAAAAAAA5QgAAAAAAAABAAAAYeQIAAAAAAAA5AgAAAAAAAABAAAAcA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADmCAAAAAAAAOYIAAAAAAAAAAAAAAAA8L8"
				],
				[
					29,
					1,
					"insert",
					{
						"characters": "apply"
					},
					"BQAAAOQIAAAAAAAA5QgAAAAAAAAAAAAA5QgAAAAAAADmCAAAAAAAAAAAAADmCAAAAAAAAOcIAAAAAAAAAAAAAOcIAAAAAAAA6AgAAAAAAAAAAAAA6AgAAAAAAADpCAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADkCAAAAAAAAOQIAAAAAAAAAAAAAAAA8L8"
				],
				[
					32,
					1,
					"insert",
					{
						"characters": "m"
					},
					"AQAAAOkIAAAAAAAA6ggAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADpCAAAAAAAAOkIAAAAAAAAAAAAAAAA8L8"
				],
				[
					33,
					1,
					"insert",
					{
						"characters": " "
					},
					"AQAAAOoIAAAAAAAA6wgAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADqCAAAAAAAAOoIAAAAAAAAAAAAAAAA8L8"
				],
				[
					34,
					2,
					"left_delete",
					null,
					"AgAAAOoIAAAAAAAA6ggAAAAAAAABAAAAIOkIAAAAAAAA6QgAAAAAAAABAAAAbQ",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADrCAAAAAAAAOsIAAAAAAAAAAAAAAAA8L8"
				],
				[
					35,
					1,
					"insert",
					{
						"characters": ","
					},
					"AQAAAOkIAAAAAAAA6ggAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADpCAAAAAAAAOkIAAAAAAAAAAAAAAAA8L8"
				],
				[
					36,
					1,
					"insert",
					{
						"characters": " util:"
					},
					"BgAAAOoIAAAAAAAA6wgAAAAAAAAAAAAA6wgAAAAAAADsCAAAAAAAAAAAAADsCAAAAAAAAO0IAAAAAAAAAAAAAO0IAAAAAAAA7ggAAAAAAAAAAAAA7ggAAAAAAADvCAAAAAAAAAAAAADvCAAAAAAAAPAIAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADqCAAAAAAAAOoIAAAAAAAAAAAAAAAA8L8"
				],
				[
					37,
					1,
					"left_delete",
					null,
					"AQAAAO8IAAAAAAAA7wgAAAAAAAABAAAAOg",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADwCAAAAAAAAPAIAAAAAAAAAAAAAAAA8L8"
				],
				[
					38,
					1,
					"insert",
					{
						"characters": ".getMethodNames"
					},
					"DwAAAO8IAAAAAAAA8AgAAAAAAAAAAAAA8AgAAAAAAADxCAAAAAAAAAAAAADxCAAAAAAAAPIIAAAAAAAAAAAAAPIIAAAAAAAA8wgAAAAAAAAAAAAA8wgAAAAAAAD0CAAAAAAAAAAAAAD0CAAAAAAAAPUIAAAAAAAAAAAAAPUIAAAAAAAA9ggAAAAAAAAAAAAA9ggAAAAAAAD3CAAAAAAAAAAAAAD3CAAAAAAAAPgIAAAAAAAAAAAAAPgIAAAAAAAA+QgAAAAAAAAAAAAA+QgAAAAAAAD6CAAAAAAAAAAAAAD6CAAAAAAAAPsIAAAAAAAAAAAAAPsIAAAAAAAA/AgAAAAAAAAAAAAA/AgAAAAAAAD9CAAAAAAAAAAAAAD9CAAAAAAAAP4IAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADvCAAAAAAAAO8IAAAAAAAAAAAAAAAA8L8"
				],
				[
					39,
					1,
					"insert_snippet",
					{
						"contents": "($0)"
					},
					"AQAAAP4IAAAAAAAAAAkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAD+CAAAAAAAAP4IAAAAAAAAAAAAAAAA8L8"
				],
				[
					40,
					1,
					"insert",
					{
						"characters": "path"
					},
					"BAAAAP8IAAAAAAAAAAkAAAAAAAAAAAAAAAkAAAAAAAABCQAAAAAAAAAAAAABCQAAAAAAAAIJAAAAAAAAAAAAAAIJAAAAAAAAAwkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAD/CAAAAAAAAP8IAAAAAAAAAAAAAAAA8L8"
				],
				[
					45,
					1,
					"insert",
					{
						"characters": ","
					},
					"AQAAAAMJAAAAAAAABAkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAADCQAAAAAAAAMJAAAAAAAAAAAAAAAA8L8"
				],
				[
					46,
					1,
					"insert",
					{
						"characters": " 2,0"
					},
					"BAAAAAQJAAAAAAAABQkAAAAAAAAAAAAABQkAAAAAAAAGCQAAAAAAAAAAAAAGCQAAAAAAAAcJAAAAAAAAAAAAAAcJAAAAAAAACAkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAAECQAAAAAAAAQJAAAAAAAAAAAAAAAA8L8"
				],
				[
					50,
					1,
					"left_delete",
					null,
					"AQAAAAUJAAAAAAAABQkAAAAAAAABAAAAMg",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAAGCQAAAAAAAAYJAAAAAAAAAAAAAAAA8L8"
				],
				[
					51,
					1,
					"insert",
					{
						"characters": "1"
					},
					"AQAAAAUJAAAAAAAABgkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAAFCQAAAAAAAAUJAAAAAAAAAAAAAAAA8L8"
				],
				[
					54,
					1,
					"left_delete",
					null,
					"AQAAAAUJAAAAAAAABQkAAAAAAAABAAAAMQ",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAAGCQAAAAAAAAYJAAAAAAAAAAAAAAAA8L8"
				],
				[
					55,
					1,
					"insert",
					{
						"characters": "2"
					},
					"AQAAAAUJAAAAAAAABgkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAAFCQAAAAAAAAUJAAAAAAAAAAAAAAAA8L8"
				],
				[
					66,
					1,
					"insert",
					{
						"characters": "deref"
					},
					"BgAAADIJAAAAAAAAMwkAAAAAAAAAAAAAMwkAAAAAAAAzCQAAAAAAAAUAAABhcHBseTMJAAAAAAAANAkAAAAAAAAAAAAANAkAAAAAAAA1CQAAAAAAAAAAAAA1CQAAAAAAADYJAAAAAAAAAAAAADYJAAAAAAAANwkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAAyCQAAAAAAADcJAAAAAAAAAAAAAAAA8L8"
				],
				[
					73,
					1,
					"insert",
					{
						"characters": "//"
					},
					"AgAAAK4IAAAAAAAArwgAAAAAAAAAAAAArwgAAAAAAACwCAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAACuCAAAAAAAAK4IAAAAAAAAAAAAAACASEA"
				],
				[
					82,
					1,
					"run_macro_file",
					{
						"file": "res://Packages/Default/Add Line in Braces.sublime-macro"
					},
					"BgAAAJcJAAAAAAAAmAkAAAAAAAAAAAAAmAkAAAAAAACgCQAAAAAAAAAAAACgCQAAAAAAAKEJAAAAAAAAAAAAAKEJAAAAAAAAqQkAAAAAAAAAAAAAmAkAAAAAAACYCQAAAAAAAAgAAAAgICAgICAgIJgJAAAAAAAAogkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAACXCQAAAAAAAJcJAAAAAAAAAAAAAAAA8L8"
				],
				[
					85,
					1,
					"paste",
					null,
					"AQAAAKIJAAAAAAAA2wkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAACiCQAAAAAAAKIJAAAAAAAAAAAAAAAA8L8"
				],
				[
					107,
					1,
					"paste",
					null,
					"AgAAALEJAAAAAAAAyQkAAAAAAAAAAAAAyQkAAAAAAADJCQAAAAAAAAQAAABGQUlM",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAACxCQAAAAAAALUJAAAAAAAAAAAAAAAA8L8"
				],
				[
					108,
					6,
					"left_delete",
					null,
					"BgAAAMgJAAAAAAAAyAkAAAAAAAABAAAAJ8cJAAAAAAAAxwkAAAAAAAABAAAAZcYJAAAAAAAAxgkAAAAAAAABAAAAdMUJAAAAAAAAxQkAAAAAAAABAAAAYcQJAAAAAAAAxAkAAAAAAAABAAAAZcMJAAAAAAAAwwkAAAAAAAABAAAAcg",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADJCQAAAAAAAMkJAAAAAAAAAAAAAAAA8L8"
				],
				[
					109,
					1,
					"insert",
					{
						"characters": "onstructor"
					},
					"CgAAAMMJAAAAAAAAxAkAAAAAAAAAAAAAxAkAAAAAAADFCQAAAAAAAAAAAADFCQAAAAAAAMYJAAAAAAAAAAAAAMYJAAAAAAAAxwkAAAAAAAAAAAAAxwkAAAAAAADICQAAAAAAAAAAAADICQAAAAAAAMkJAAAAAAAAAAAAAMkJAAAAAAAAygkAAAAAAAAAAAAAygkAAAAAAADLCQAAAAAAAAAAAADLCQAAAAAAAMwJAAAAAAAAAAAAAMwJAAAAAAAAzQkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADDCQAAAAAAAMMJAAAAAAAAAAAAAAAA8L8"
				],
				[
					110,
					1,
					"insert",
					{
						"characters": " ERROR:"
					},
					"BwAAAM0JAAAAAAAAzgkAAAAAAAAAAAAAzgkAAAAAAADPCQAAAAAAAAAAAADPCQAAAAAAANAJAAAAAAAAAAAAANAJAAAAAAAA0QkAAAAAAAAAAAAA0QkAAAAAAADSCQAAAAAAAAAAAADSCQAAAAAAANMJAAAAAAAAAAAAANMJAAAAAAAA1AkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADNCQAAAAAAAM0JAAAAAAAAAAAAAAAA8L8"
				],
				[
					111,
					1,
					"right_delete",
					null,
					"AQAAANQJAAAAAAAA1AkAAAAAAAABAAAAOg",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADUCQAAAAAAANQJAAAAAAAAAAAAAAAA8L8"
				],
				[
					115,
					1,
					"left_delete",
					null,
					"AQAAAPgJAAAAAAAA+AkAAAAAAAABAAAACg",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAD5CQAAAAAAAPkJAAAAAAAAAAAAAABAekA"
				],
				[
					121,
					1,
					"insert",
					{
						"characters": "er"
					},
					"AgAAAJQJAAAAAAAAlQkAAAAAAAAAAAAAlQkAAAAAAACWCQAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAACUCQAAAAAAAJQJAAAAAAAAAAAAAAAA8L8"
				],
				[
					122,
					2,
					"left_delete",
					null,
					"AgAAAJUJAAAAAAAAlQkAAAAAAAABAAAAcpQJAAAAAAAAlAkAAAAAAAABAAAAZQ",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAACWCQAAAAAAAJYJAAAAAAAAAAAAAAAA8L8"
				],
				[
					123,
					1,
					"insert",
					{
						"characters": "rror"
					},
					"BAAAAJQJAAAAAAAAlQkAAAAAAAAAAAAAlQkAAAAAAACWCQAAAAAAAAAAAACWCQAAAAAAAJcJAAAAAAAAAAAAAJcJAAAAAAAAmAkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAACUCQAAAAAAAJQJAAAAAAAAAAAAAAAA8L8"
				],
				[
					150,
					1,
					"insert",
					{
						"characters": " patrh"
					},
					"BgAAAC4JAAAAAAAALwkAAAAAAAAAAAAALwkAAAAAAAAwCQAAAAAAAAAAAAAwCQAAAAAAADEJAAAAAAAAAAAAADEJAAAAAAAAMgkAAAAAAAAAAAAAMgkAAAAAAAAzCQAAAAAAAAAAAAAzCQAAAAAAADQJAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAAuCQAAAAAAAC4JAAAAAAAAAAAAAAAA8L8"
				],
				[
					151,
					2,
					"left_delete",
					null,
					"AgAAADMJAAAAAAAAMwkAAAAAAAABAAAAaDIJAAAAAAAAMgkAAAAAAAABAAAAcg",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAA0CQAAAAAAADQJAAAAAAAAAAAAAAAA8L8"
				],
				[
					152,
					1,
					"insert",
					{
						"characters": "h.reduce"
					},
					"CAAAADIJAAAAAAAAMwkAAAAAAAAAAAAAMwkAAAAAAAA0CQAAAAAAAAAAAAA0CQAAAAAAADUJAAAAAAAAAAAAADUJAAAAAAAANgkAAAAAAAAAAAAANgkAAAAAAAA3CQAAAAAAAAAAAAA3CQAAAAAAADgJAAAAAAAAAAAAADgJAAAAAAAAOQkAAAAAAAAAAAAAOQkAAAAAAAA6CQAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAAyCQAAAAAAADIJAAAAAAAAAAAAAAAA8L8"
				],
				[
					153,
					2,
					"insert_snippet",
					{
						"contents": "($0)"
					},
					"AgAAADoJAAAAAAAAPAkAAAAAAAAAAAAAOwkAAAAAAAA9CQAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAA6CQAAAAAAADoJAAAAAAAAAAAAAAAA8L8"
				],
				[
					154,
					1,
					"insert",
					{
						"characters": "acc,p"
					},
					"BQAAADwJAAAAAAAAPQkAAAAAAAAAAAAAPQkAAAAAAAA+CQAAAAAAAAAAAAA+CQAAAAAAAD8JAAAAAAAAAAAAAD8JAAAAAAAAQAkAAAAAAAAAAAAAQAkAAAAAAABBCQAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAA8CQAAAAAAADwJAAAAAAAAAAAAAAAA8L8"
				],
				[
					156,
					1,
					"insert",
					{
						"characters": " =>"
					},
					"AwAAAEIJAAAAAAAAQwkAAAAAAAAAAAAAQwkAAAAAAABECQAAAAAAAAAAAABECQAAAAAAAEUJAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABCCQAAAAAAAEIJAAAAAAAAAAAAAAAA8L8"
				],
				[
					157,
					1,
					"insert",
					{
						"characters": "  "
					},
					"AgAAAEUJAAAAAAAARgkAAAAAAAAAAAAARgkAAAAAAABHCQAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABFCQAAAAAAAEUJAAAAAAAAAAAAAAAA8L8"
				],
				[
					158,
					1,
					"insert",
					{
						"characters": "acc"
					},
					"AwAAAEcJAAAAAAAASAkAAAAAAAAAAAAASAkAAAAAAABJCQAAAAAAAAAAAABJCQAAAAAAAEoJAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABHCQAAAAAAAEcJAAAAAAAAAAAAAAAA8L8"
				],
				[
					159,
					1,
					"insert_snippet",
					{
						"contents": "[$0]"
					},
					"AQAAAEoJAAAAAAAATAkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABKCQAAAAAAAEoJAAAAAAAAAAAAAAAA8L8"
				],
				[
					160,
					1,
					"insert",
					{
						"characters": "op"
					},
					"AgAAAEsJAAAAAAAATAkAAAAAAAAAAAAATAkAAAAAAABNCQAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABLCQAAAAAAAEsJAAAAAAAAAAAAAAAA8L8"
				],
				[
					161,
					2,
					"left_delete",
					null,
					"AgAAAEwJAAAAAAAATAkAAAAAAAABAAAAcEsJAAAAAAAASwkAAAAAAAABAAAAbw",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABNCQAAAAAAAE0JAAAAAAAAAAAAAAAA8L8"
				],
				[
					162,
					1,
					"insert",
					{
						"characters": "p"
					},
					"AQAAAEsJAAAAAAAATAkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABLCQAAAAAAAEsJAAAAAAAAAAAAAAAA8L8"
				],
				[
					164,
					1,
					"insert",
					{
						"characters": ","
					},
					"AQAAAE0JAAAAAAAATgkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABNCQAAAAAAAE0JAAAAAAAAAAAAAAAA8L8"
				],
				[
					165,
					1,
					"insert",
					{
						"characters": " doc"
					},
					"BAAAAE4JAAAAAAAATwkAAAAAAAAAAAAATwkAAAAAAABQCQAAAAAAAAAAAABQCQAAAAAAAFEJAAAAAAAAAAAAAFEJAAAAAAAAUgkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABOCQAAAAAAAE4JAAAAAAAAAAAAAAAA8L8"
				],
				[
					167,
					1,
					"insert",
					{
						"characters": ";"
					},
					"AQAAAFMJAAAAAAAAVAkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABTCQAAAAAAAFMJAAAAAAAAAAAAAAAA8L8"
				],
				[
					168,
					1,
					"insert",
					{
						"characters": " &//"
					},
					"BAAAAFQJAAAAAAAAVQkAAAAAAAAAAAAAVQkAAAAAAABWCQAAAAAAAAAAAABWCQAAAAAAAFcJAAAAAAAAAAAAAFcJAAAAAAAAWAkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABUCQAAAAAAAFQJAAAAAAAAAAAAAAAA8L8"
				],
				[
					169,
					3,
					"left_delete",
					null,
					"AwAAAFcJAAAAAAAAVwkAAAAAAAABAAAAL1YJAAAAAAAAVgkAAAAAAAABAAAAL1UJAAAAAAAAVQkAAAAAAAABAAAAJg",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABYCQAAAAAAAFgJAAAAAAAAAAAAAAAA8L8"
				],
				[
					170,
					1,
					"insert",
					{
						"characters": "//"
					},
					"AgAAAFUJAAAAAAAAVgkAAAAAAAAAAAAAVgkAAAAAAABXCQAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABVCQAAAAAAAFUJAAAAAAAAAAAAAAAA8L8"
				],
				[
					192,
					1,
					"insert",
					{
						"characters": "[..."
					},
					"BAAAAC8JAAAAAAAAMAkAAAAAAAAAAAAAMAkAAAAAAAAxCQAAAAAAAAAAAAAxCQAAAAAAADIJAAAAAAAAAAAAADIJAAAAAAAAMwkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAAvCQAAAAAAAC8JAAAAAAAAAAAAAAAA8L8"
				],
				[
					194,
					1,
					"insert",
					{
						"characters": "]"
					},
					"AQAAADcJAAAAAAAAOAkAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAA3CQAAAAAAADcJAAAAAAAAAAAAAAAA8L8"
				]
			]
		},
		{
			"file": "quickjs/qjs-modules/lib/util.js",
			"settings":
			{
				"buffer_size": 63358,
				"line_ending": "Unix"
			},
			"undo_stack":
			[
				[
					1,
					1,
					"revert",
					null,
					"AgAAAAAAAAAAAAAAAAAAAAAAAAB+9wAALy9pbXBvcnQgeyBTeXNjYWxsRXJyb3IgfSBmcm9tICdzeXNjYWxsZXJyb3InOwppbXBvcnQgeyBzZWFyY2hBcnJheUJ1ZmZlciwgZHVwQXJyYXlCdWZmZXIsIGVzY2FwZSwgZ2V0UHJvdG90eXBlQ2hhaW4sIGlzQXJyYXksIGlzQmlnRGVjaW1hbCwgaXNCaWdGbG9hdCwgaXNCaWdJbnQsIGlzQm9vbCwgaXNDRnVuY3Rpb24sIGlzQ29uc3RydWN0b3IsIGlzRW1wdHlTdHJpbmcsIGlzRXJyb3IsIGlzRXhjZXB0aW9uLCBpc0V4dGVuc2libGUsIGlzRnVuY3Rpb24sIGlzSFRNTEREQSwgaXNJbnN0YW5jZU9mLCBpc0ludGVnZXIsIGlzSm9iUGVuZGluZywgaXNMaXZlT2JqZWN0LCBpc051bGwsIGlzTnVtYmVyLCBpc09iamVjdCwgaXNSZWdpc3RlcmVkQ2xhc3MsIGlzU3RyaW5nLCBpc1N5bWJvbCwgaXNVbmNhdGNoYWJsZUVycm9yLCBpc1VuZGVmaW5lZCwgaXNVbmluaXRpYWxpemVkLCBpc0FycmF5QnVmZmVyLCByYW5kLCB0b0FycmF5QnVmZmVyLCB0b1N0cmluZywgYml0cywgZ2V0VHlwZU5hbWUsIGF0ZXhpdCwgZ2V0cGlkIH0gZnJvbSAnbWlzYyc7CmltcG9ydCB7IGV4dGVuZEFycmF5LCBBcnJheUV4dGVuc2lvbnMgfSBmcm9tICcuL2V4dGVuZEFycmF5LmpzJzsKaW1wb3J0IHsgZXh0ZW5kR2VuZXJhdG9yLCBHZW5lcmF0b3JFeHRlbnNpb25zLCBHZW5lcmF0b3JQcm90b3R5cGUgfSBmcm9tICcuL2V4dGVuZEdlbmVyYXRvci5qcyc7CmltcG9ydCB7IEFzeW5jR2VuZXJhdG9yRXh0ZW5zaW9ucywgQXN5bmNHZW5lcmF0b3JQcm90b3R5cGUsIEFzeW5jR2VuZXJhdG9yQ29uc3RydWN0b3IgfSBmcm9tICcuL2V4dGVuZEFzeW5jR2VuZXJhdG9yLmpzJzsKLy9pbXBvcnQgeyBNYXRoRXh0ZW5zaW9ucywgZXh0ZW5kTWF0aCB9IGZyb20gJy4vZXh0ZW5kTWF0aC5qcyc7CmltcG9ydCAqIGFzIG9zIGZyb20gJ29zJzsKaW1wb3J0IHsgYmFzZW5hbWUgfSBmcm9tICdwYXRoJzsKCmNvbnN0IHNsaWNlRm4gPSB4ID0+CiAgKHsKICAgIEFycmF5OiBBcnJheS5wcm90b3R5cGUuc2xpY2UsCiAgICBTdHJpbmc6IFN0cmluZy5wcm90b3R5cGUuc2xpY2UsCiAgICBBcnJheUJ1ZmZlcihzdGFydCwgZW5kKSB7CiAgICAgIHN0YXJ0ID8/PSAwOwogICAgICBlbmQgPz89IHRoaXMuYnl0ZUxlbmd0aDsKICAgICAgcmV0dXJuIGR1cEFycmF5QnVmZmVyKHRoaXMsIHN0YXJ0LCBlbmQgLSBzdGFydCk7CiAgICB9LAogICAgU2hhcmVkQXJyYXlCdWZmZXI6IFNoYXJlZEFycmF5QnVmZmVyLnByb3RvdHlwZS5zbGljZSwKICAgIFVpbnQ4Q2xhbXBlZEFycmF5OiBVaW50OENsYW1wZWRBcnJheS5wcm90b3R5cGUuc2xpY2UsCiAgICBJbnQ4QXJyYXk6IEludDhBcnJheS5wcm90b3R5cGUuc2xpY2UsCiAgICBVaW50OEFycmF5OiBVaW50OEFycmF5LnByb3RvdHlwZS5zbGljZSwKICAgIEludDE2QXJyYXk6IEludDE2QXJyYXkucHJvdG90eXBlLnNsaWNlLAogICAgVWludDE2QXJyYXk6IFVpbnQxNkFycmF5LnByb3RvdHlwZS5zbGljZSwKICAgIEludDMyQXJyYXk6IEludDMyQXJyYXkucHJvdG90eXBlLnNsaWNlLAogICAgVWludDMyQXJyYXk6IFVpbnQzMkFycmF5LnByb3RvdHlwZS5zbGljZSwKICAgIEJpZ0ludDY0QXJyYXk6IEJpZ0ludDY0QXJyYXkucHJvdG90eXBlLnNsaWNlLAogICAgQmlnVWludDY0QXJyYXk6IEJpZ1VpbnQ2NEFycmF5LnByb3RvdHlwZS5zbGljZSwKICAgIEZsb2F0MzJBcnJheTogRmxvYXQzMkFycmF5LnByb3RvdHlwZS5zbGljZSwKICAgIEZsb2F0NjRBcnJheTogRmxvYXQ2NEFycmF5LnByb3RvdHlwZS5zbGljZQogIH1bZ2V0VHlwZU5hbWUoeCldKTsKCmV4cG9ydCBjb25zdCBzbGljZSA9ICh4LCBzLCBlKSA9PiAoc2xpY2VGbih4KSA/PyB4LnNsaWNlKS5jYWxsKHgsIHMsIGUpOwoKLyp0eXBlb2YgeCA9PSAnb2JqZWN0JwogICAgPyBpc0FycmF5QnVmZmVyKHgpCiAgICAgID8gZHVwQXJyYXlCdWZmZXIoeCwgcywgZSkKICAgICAgOiBBcnJheS5pc0FycmF5KHgpCiAgICAgID8gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoeCwgcywgZSkKICAgICAgOiB4LnNsaWNlKHMsIGUpCiAgICA6IFN0cmluZy5wcm90b3R5cGUuc2xpY2UuY2FsbCh4LCBzLCBlKTsqLwpjb25zdCBzdHJpbmdpZnkgPSB2ID0+IGAke3Z9YDsKY29uc3QgcHJvdG9PZiA9IE9iamVjdC5nZXRQcm90b3R5cGVPZjsKY29uc3QgZm9ybWF0TnVtYmVyID0gbiA9PiAobiA9PT0gLTAgPyAnLTAnIDogYCR7bn1gKTsKY29uc3QgaXNOYXRpdmUgPSBmbiA9PiAvXFtuYXRpdmVcc2NvZGVcXS8udGVzdChzdHJpbmdpZnkoZm4pKTsKCi8qZnVuY3Rpb24gdXRpbCgpIHsKICByZXR1cm4gdXRpbDsKfQoKdXRpbC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSB1dGlsOyovCgpjb25zdCBBc3luY0Z1bmN0aW9uID0gYXN5bmMgZnVuY3Rpb24geCgpIHt9LmNvbnN0cnVjdG9yOwpjb25zdCBHZW5lcmF0b3JGdW5jdGlvbiA9IGZ1bmN0aW9uKiAoKSB7fS5jb25zdHJ1Y3RvcjsKY29uc3QgQXN5bmNHZW5lcmF0b3JGdW5jdGlvbiA9IGFzeW5jIGZ1bmN0aW9uKiAoKSB7fS5jb25zdHJ1Y3RvcjsKY29uc3QgVHlwZWRBcnJheSA9IHByb3RvT2YocHJvdG9PZihuZXcgVWludDE2QXJyYXkoMTApKSkuY29uc3RydWN0b3I7Cgpjb25zdCBTZXRJdGVyYXRvclByb3RvdHlwZSA9IHByb3RvT2YobmV3IFNldCgpLnZhbHVlcygpKTsKY29uc3QgTWFwSXRlcmF0b3JQcm90b3R5cGUgPSBwcm90b09mKG5ldyBNYXAoKS5lbnRyaWVzKCkpOwovL2NvbnN0IEdlbmVyYXRvclByb3RvdHlwZSA9IHByb3RvT2YoKGZ1bmN0aW9uKiAoKSB7fSkoKSk7CgovLyBwcmV0dGllci1pZ25vcmUKZXhwb3J0IGNvbnN0IGVycm9ycyA9IFtudWxsLCAnRVBFUk0nLCAnRU5PRU5UJywgJ0VTUkNIJywgJ0VJTlRSJywgJ0VJTycsICdFTlhJTycsICdFMkJJRycsICdFTk9FWEVDJywgJ0VCQURGJywgJ0VDSElMRCcsICdFQUdBSU4nLCAnRU5PTUVNJywgJ0VBQ0NFUycsICdFRkFVTFQnLCAnRU5PVEJMSycsICdFQlVTWScsICdFRVhJU1QnLCAnRVhERVYnLCAnRU5PREVWJywgJ0VOT1RESVInLCAnRUlTRElSJywgJ0VJTlZBTCcsICdFTkZJTEUnLCAnRU1GSUxFJywgJ0VOT1RUWScsICdFVFhUQlNZJywgJ0VGQklHJywgJ0VOT1NQQycsICdFU1BJUEUnLCAnRVJPRlMnLCAnRU1MSU5LJywgJ0VQSVBFJywgJ0VET00nLCAnRVJBTkdFJywgJ0VERUFETEsnLCAnRU5BTUVUT09MT05HJywgJ0VOT0xDSycsICdFTk9TWVMnLCAnRU5PVEVNUFRZJywgbnVsbCwgbnVsbCwgJ0VOT01TRycsICdFSURSTScsICdFQ0hSTkcnLCAnRUwyTlNZTkMnLCAnRUwzSExUJywgJ0VMM1JTVCcsICdFTE5STkcnLCAnRVVOQVRDSCcsICdFTk9DU0knLCAnRUwySExUJywgJ0VCQURFJywgJ0VCQURSJywgJ0VYRlVMTCcsICdFTk9BTk8nLCAnRUJBRFJRQycsIG51bGwsICcnLCAnRUJGT05UJywgJ0VOT1NUUicsICdFTk9EQVRBJywgJ0VUSU1FJywgJ0VOT1NSJywgJ0VOT05FVCcsICdFTk9QS0cnLCAnRVJFTU9URScsICdFTk9MSU5LJywgJ0VBRFYnLCAnRVNSTU5UJywgJ0VDT01NJywgJ0VQUk9UTycsICdFTVVMVElIT1AnLCAnRURPVERPVCcsICdFQkFETVNHJywgJ0VPVkVSRkxPVycsICdFTk9UVU5JUScsICdFQkFERkQnLCAnRVJFTUNIRycsICdFTElCQUNDJywgJ0VMSUJCQUQnLCAnRUxJQlNDTicsICdFTElCTUFYJywgJ0VMSUJFWEVDJywgJ0VJTFNFUScsICdFUkVTVEFSVCcsICdFU1RSUElQRScsICdFVVNFUlMnLCAnRU5PVFNPQ0snLCAnRURFU1RBRERSUkVRJywgJ0VNU0dTSVpFJywgJ0VQUk9UT1RZUEUnLCAnRU5PUFJPVE9PUFQnLCAnRVBST1RPTk9TVVBQT1JUJywgJ0VTT0NLVE5PU1VQUE9SVCcsICdFT1BOT1RTVVBQJywgJ0VQRk5PU1VQUE9SVCcsICdFQUZOT1NVUFBPUlQnLCAnRUFERFJJTlVTRScsICdFQUREUk5PVEFWQUlMJywgJ0VORVRET1dOJywgJ0VORVRVTlJFQUNIJywgJ0VORVRSRVNFVCcsICdFQ09OTkFCT1JURUQnLCAnRUNPTk5SRVNFVCcsICdFTk9CVUZTJywgJ0VJU0NPTk4nLCAnRU5PVENPTk4nLCAnRVNIVVRET1dOJywgJ0VUT09NQU5ZUkVGUycsICdFVElNRURPVVQnLCAnRUNPTk5SRUZVU0VEJywgJ0VIT1NURE9XTicsICdFSE9TVFVOUkVBQ0gnLCAnRUFMUkVBRFknLCAnRUlOUFJPR1JFU1MnLCAnRVNUQUxFJywgJ0VVQ0xFQU4nLCAnRU5PVE5BTScsICdFTkFWQUlMJywgJ0VJU05BTScsICdFUkVNT1RFSU8nLCAnRURRVU9UJywgJ0VOT01FRElVTScsICdFTUVESVVNVFlQRScsICdFQ0FOQ0VMRUQnLCAnRU5PS0VZJywgJ0VLRVlFWFBJUkVEJywgJ0VLRVlSRVZPS0VEJywgJ0VLRVlSRUpFQ1RFRCcsICdFT1dORVJERUFEJywgJ0VOT1RSRUNPVkVSQUJMRScsICdFUkZLSUxMJ107CgpleHBvcnQgY29uc3QgdHlwZXMgPSB7CiAgaXNBbnlBcnJheUJ1ZmZlcih2KSB7CiAgICByZXR1cm4gaXNPYmplY3QodikgJiYgKHYgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciB8fCB2IGluc3RhbmNlb2YgU2hhcmVkQXJyYXlCdWZmZXIpOwogIH0sCiAgaXNBcnJheUJ1ZmZlcih2KSB7CiAgICByZXR1cm4gaXNPYmplY3QodikgJiYgdiBpbnN0YW5jZW9mIEFycmF5QnVmZmVyOwogIH0sCiAgaXNCaWdJbnQ2NEFycmF5KHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiB2IGluc3RhbmNlb2YgQmlnSW50NjRBcnJheTsKICB9LAogIGlzQmlnVWludDY0QXJyYXkodikgewogICAgcmV0dXJuIGlzT2JqZWN0KHYpICYmIHYgaW5zdGFuY2VvZiBCaWdVaW50NjRBcnJheTsKICB9LAogIGlzRGF0ZSh2KSB7CiAgICByZXR1cm4gaXNPYmplY3QodikgJiYgdiBpbnN0YW5jZW9mIERhdGU7CiAgfSwKICBpc0Zsb2F0MzJBcnJheSh2KSB7CiAgICByZXR1cm4gaXNPYmplY3QodikgJiYgdiBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheTsKICB9LAogIGlzRmxvYXQ2NEFycmF5KHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiB2IGluc3RhbmNlb2YgRmxvYXQ2NEFycmF5OwogIH0sCiAgaXNJbnQ4QXJyYXkodikgewogICAgcmV0dXJuIGlzT2JqZWN0KHYpICYmIHYgaW5zdGFuY2VvZiBJbnQ4QXJyYXk7CiAgfSwKICBpc0ludDE2QXJyYXkodikgewogICAgcmV0dXJuIGlzT2JqZWN0KHYpICYmIHYgaW5zdGFuY2VvZiBJbnQxNkFycmF5OwogIH0sCiAgaXNJbnQzMkFycmF5KHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiB2IGluc3RhbmNlb2YgSW50MzJBcnJheTsKICB9LAogIGlzTWFwKHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiB2IGluc3RhbmNlb2YgTWFwOwogIH0sCiAgaXNQcm9taXNlKHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiB2IGluc3RhbmNlb2YgUHJvbWlzZTsKICB9LAogIGlzUHJveHkodikgewogICAgcmV0dXJuIGlzT2JqZWN0KHYpICYmIHYgaW5zdGFuY2VvZiBQcm94eTsKICB9LAogIGlzUmVnRXhwKHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiB2IGluc3RhbmNlb2YgUmVnRXhwOwogIH0sCiAgaXNTZXQodikgewogICAgcmV0dXJuIGlzT2JqZWN0KHYpICYmIHYgaW5zdGFuY2VvZiBTZXQ7CiAgfSwKICBpc1NoYXJlZEFycmF5QnVmZmVyKHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiB2IGluc3RhbmNlb2YgU2hhcmVkQXJyYXlCdWZmZXI7CiAgfSwKICBpc1VpbnQ4QXJyYXkodikgewogICAgcmV0dXJuIGlzT2JqZWN0KHYpICYmIHYgaW5zdGFuY2VvZiBVaW50OEFycmF5OwogIH0sCiAgaXNVaW50OENsYW1wZWRBcnJheSh2KSB7CiAgICByZXR1cm4gaXNPYmplY3QodikgJiYgdiBpbnN0YW5jZW9mIFVpbnQ4Q2xhbXBlZEFycmF5OwogIH0sCiAgaXNVaW50MTZBcnJheSh2KSB7CiAgICByZXR1cm4gaXNPYmplY3QodikgJiYgdiBpbnN0YW5jZW9mIFVpbnQxNkFycmF5OwogIH0sCiAgaXNVaW50MzJBcnJheSh2KSB7CiAgICByZXR1cm4gaXNPYmplY3QodikgJiYgdiBpbnN0YW5jZW9mIFVpbnQzMkFycmF5OwogIH0sCiAgaXNXZWFrTWFwKHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiB2IGluc3RhbmNlb2YgV2Vha01hcDsKICB9LAogIGlzV2Vha1NldCh2KSB7CiAgICByZXR1cm4gaXNPYmplY3QodikgJiYgdiBpbnN0YW5jZW9mIFdlYWtTZXQ7CiAgfSwKICBpc0RhdGFWaWV3KHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiB2IGluc3RhbmNlb2YgRGF0YVZpZXc7CiAgfSwKICBpc0Jvb2xlYW5PYmplY3QodikgewogICAgcmV0dXJuIGlzT2JqZWN0KHYpICYmIHYgaW5zdGFuY2VvZiBCb29sZWFuOwogIH0sCiAgaXNBc3luY0Z1bmN0aW9uKHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiB2IGluc3RhbmNlb2YgQXN5bmNGdW5jdGlvbjsKICB9LAogIGlzR2VuZXJhdG9yRnVuY3Rpb24odikgewogICAgcmV0dXJuIGlzT2JqZWN0KHYpICYmIHYgaW5zdGFuY2VvZiBHZW5lcmF0b3JGdW5jdGlvbjsKICB9LAogIGlzQXN5bmNHZW5lcmF0b3JGdW5jdGlvbih2KSB7CiAgICByZXR1cm4gaXNPYmplY3QodikgJiYgdiBpbnN0YW5jZW9mIEFzeW5jR2VuZXJhdG9yRnVuY3Rpb247CiAgfSwKICBpc051bWJlck9iamVjdCh2KSB7CiAgICByZXR1cm4gaXNPYmplY3QodikgJiYgdiBpbnN0YW5jZW9mIE51bWJlcjsKICB9LAogIGlzQmlnSW50T2JqZWN0KHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiB2IGluc3RhbmNlb2YgQmlnSW50OwogIH0sCiAgaXNTeW1ib2xPYmplY3QodikgewogICAgcmV0dXJuIHYgJiYgdiBpbnN0YW5jZW9mIFN5bWJvbDsKICB9LAogIGlzTmF0aXZlRXJyb3IodikgewogICAgcmV0dXJuIGlzT2JqZWN0KHYpICYmIHYgaW5zdGFuY2VvZiBFcnJvciAmJiBpc05hdGl2ZSh2LmNvbnN0cnVjdG9yKTsKICB9LAogIGlzTWFwSXRlcmF0b3IodikgewogICAgcmV0dXJuIGlzT2JqZWN0KHYpICYmIHByb3RvT2YodikgPT0gTWFwSXRlcmF0b3JQcm90b3R5cGU7CiAgfSwKICBpc1NldEl0ZXJhdG9yKHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiBwcm90b09mKHYpID09IFNldEl0ZXJhdG9yUHJvdG90eXBlOwogIH0sCiAgaXNTdHJpbmdPYmplY3QodikgewogICAgcmV0dXJuIGlzT2JqZWN0KHYpICYmIHYgaW5zdGFuY2VvZiBTdHJpbmc7CiAgfSwKICBpc0FycmF5QnVmZmVyVmlldyh2KSB7CiAgICByZXR1cm4gaXNPYmplY3QodikgJiYgQXJyYXlCdWZmZXIuaXNWaWV3KHYpOwogIH0sCiAgaXNBcmd1bWVudHNPYmplY3QodikgewogICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KSA9PSAnW29iamVjdCBBcmd1bWVudHNdJzsKICB9LAoKICAvKiBpc0V4dGVybmFsKHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiB2IGluc3RhbmNlb2YgRXh0ZXJuYWw7CiAgfSwqLwoKICBpc0JveGVkUHJpbWl0aXZlKHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiBbTnVtYmVyLCBTdHJpbmcsIEJvb2xlYW4sIEJpZ0ludCwgU3ltYm9sXS5zb21lKGN0b3IgPT4gdiBpbnN0YW5jZW9mIGN0b3IpOwogIH0sCgogIGlzR2VuZXJhdG9yT2JqZWN0KHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiBwcm90b09mKHYpID09IEdlbmVyYXRvclByb3RvdHlwZTsKICB9LAogIGlzVHlwZWRBcnJheSh2KSB7CiAgICByZXR1cm4gaXNPYmplY3QodikgJiYgdiBpbnN0YW5jZW9mIFR5cGVkQXJyYXk7CiAgfSwKICBpc01vZHVsZU5hbWVzcGFjZU9iamVjdCh2KSB7CiAgICByZXR1cm4gaXNPYmplY3QodikgJiYgdltTeW1ib2wudG9TdHJpbmdUYWddID09ICdNb2R1bGUnOwogIH0sCiAgaXNDb25zdHJ1Y3Rvcih2KSB7CiAgICByZXR1cm4gaXNGdW5jdGlvbih2KSAmJiAncHJvdG90eXBlJyBpbiB2OwogIH0sCiAgaXNJdGVyYWJsZSh2KSB7CiAgICByZXR1cm4gaXNPYmplY3QodikgJiYgaXNGdW5jdGlvbih2W1N5bWJvbC5pdGVyYXRvcl0pOwogIH0sCiAgaXNBc3luY0l0ZXJhYmxlKHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiBpc0Z1bmN0aW9uKHZbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKTsKICB9LAogIGlzSXRlcmF0b3IodikgewogICAgcmV0dXJuIGlzT2JqZWN0KHYpICYmIGlzRnVuY3Rpb24odi5uZXh0KTsKICB9LAogIGlzQXJyYXlMaWtlKHYpIHsKICAgIHJldHVybiBpc09iamVjdCh2KSAmJiB0eXBlb2Ygdi5sZW5ndGggPT0gJ251bWJlcicgJiYgTnVtYmVyLmlzSW50ZWdlcih2Lmxlbmd0aCk7CiAgfQp9OwoKZXhwb3J0IGZ1bmN0aW9uIGhhc0J1aWx0SW4obywgbSkgewogIHJldHVybiBpc05hdGl2ZShwcm90b09mKG8pW21dKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIGlzQXN5bmMoZm4pIHsKICBpZih0eXBlcy5pc0FzeW5jRnVuY3Rpb24oZm4pIHx8IHR5cGVzLmlzQXN5bmNHZW5lcmF0b3JGdW5jdGlvbihmbikpIHJldHVybiB0cnVlOwoKICBpZihpc0Z1bmN0aW9uKGZuKSkgcmV0dXJuIC9eYXN5bmNccytmdW5jdGlvbi8udGVzdChmbiArICcnKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdCguLi5hcmdzKSB7CiAgcmV0dXJuIGZvcm1hdFdpdGhPcHRpb25zSW50ZXJuYWwoeyBoaWRlS2V5czogWydjb25zdHJ1Y3RvciddIH0sIGFyZ3MpOwp9CgpleHBvcnQgZnVuY3Rpb24gZm9ybWF0V2l0aE9wdGlvbnMob3B0cywgLi4uYXJncykgewogIGlmKCFpc09iamVjdChvcHRzKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihgb3B0aW9ucyBhcmd1bWVudCBpcyBub3QgYW4gb2JqZWN0YCk7CiAgcmV0dXJuIGZvcm1hdFdpdGhPcHRpb25zSW50ZXJuYWwob3B0cywgYXJncyk7Cn0KCmZ1bmN0aW9uIGZvcm1hdFdpdGhPcHRpb25zSW50ZXJuYWwobywgdikgewogIGNvbnN0IHggPSB2WzBdOwogIGxldCBhID0gMDsKICBsZXQgcyA9ICcnOwogIGxldCBqID0gJyc7CiAgaWYodHlwZW9mIHggPT09ICdzdHJpbmcnKSB7CiAgICBpZih2Lmxlbmd0aCA9PT0gMSkgcmV0dXJuIHg7CiAgICBsZXQgdDsKICAgIGxldCBwID0gMDsKICAgIGZvcihsZXQgaSA9IDA7IGkgPCB4Lmxlbmd0aCAtIDE7IGkrKykgewogICAgICBpZih4W2ldID09ICclJykgewogICAgICAgIGxldCBmID0gJyc7CiAgICAgICAgd2hpbGUoJ3NqeGRPb2lmYyUnLmluZGV4T2YoeFtpICsgMV0pID09IC0xKSB7CiAgICAgICAgICBmICs9IHhbaSArIDFdOwogICAgICAgICAgKytpOwogICAgICAgIH0KICAgICAgICBpZihwIDwgaSkgcyArPSBzbGljZSh4LCBwLCBpKTsKICAgICAgICBwID0gaSArIDE7CgogICAgICAgIGNvbnN0IGMgPSBTdHJpbmcucHJvdG90eXBlLmNoYXJDb2RlQXQuY2FsbCh4LCArK2kpOwogICAgICAgIGlmKGEgKyAxICE9PSB2Lmxlbmd0aCkgewogICAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgIGNhc2UgMTE1OiAvLyAlcwogICAgICAgICAgICAgIGNvbnN0IHkgPSB2WysrYV07CiAgICAgICAgICAgICAgaWYodHlwZW9mIHkgPT09ICdudW1iZXInKSB0ID0gZm9ybWF0TnVtYmVyKHkpOwogICAgICAgICAgICAgIGVsc2UgaWYodHlwZW9mIHkgPT09ICdiaWdpbnQnKSB0ID0gYCR7eX1uYDsKICAgICAgICAgICAgICBlbHNlIGlmKHR5cGVvZiB5ICE9PSAnb2JqZWN0JyB8fCB5ID09PSBudWxsIHx8ICFoYXNCdWlsdEluKHksICd0b1N0cmluZycpKSB0ID0gU3RyaW5nKHkpOwogICAgICAgICAgICAgIGVsc2UgdCA9IGluc3BlY3QoeSwgeyAuLi5vLCBjb21wYWN0OiAzLCBjb2xvcnM6IGZhbHNlLCBkZXB0aDogMCB9KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAxMDY6IC8vICVqCiAgICAgICAgICAgICAgdCA9IHN0cmluZ2lmeSh2WysrYV0pOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDEyMDogLy8gJXgKICAgICAgICAgICAgY2FzZSAxMDA6IC8vICVkCiAgICAgICAgICAgICAgY29uc3QgbiA9IHZbKythXTsKICAgICAgICAgICAgICBpZih0eXBlb2YgbiA9PT0gJ2JpZ2ludCcpIHQgPSBgJHtufW5gOwogICAgICAgICAgICAgIGVsc2UgaWYodHlwZW9mIG4gPT09ICdzeW1ib2wnKSB0ID0gJ05hTic7CiAgICAgICAgICAgICAgZWxzZSB0ID0gZm9ybWF0TnVtYmVyKGMgPT0gMTIwID8gTnVtYmVyKG4pLnRvU3RyaW5nKDE2KSA6IE51bWJlcihuKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNzk6IC8vICVPCiAgICAgICAgICAgICAgdCA9IGluc3BlY3QodlsrK2FdLCBvKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAxMTE6IC8vICVvCiAgICAgICAgICAgICAgdCA9IC8qdlsrK2FdKycnID8/ICovIGluc3BlY3QodlsrK2FdLCB7CiAgICAgICAgICAgICAgICAuLi5vLAogICAgICAgICAgICAgICAgc2hvd0hpZGRlbjogdHJ1ZSwKICAgICAgICAgICAgICAgIHNob3dQcm94eTogdHJ1ZSwKICAgICAgICAgICAgICAgIGRlcHRoOiAxLAogICAgICAgICAgICAgICAgcHJvdG9DaGFpbjogZmFsc2UKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAxMDU6IC8vICVpCiAgICAgICAgICAgICAgY29uc3QgayA9IHZbKythXTsKICAgICAgICAgICAgICBpZih0eXBlb2YgayA9PT0gJ2JpZ2ludCcpIHQgPSBgJHtrfWA7CiAgICAgICAgICAgICAgZWxzZSBpZih0eXBlb2YgayA9PT0gJ3N5bWJvbCcpIHQgPSAnTmFOJzsKICAgICAgICAgICAgICBlbHNlIHQgPSBmb3JtYXROdW1iZXIocGFyc2VJbnQoaykpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDEwMjogLy8gJWYKICAgICAgICAgICAgICBjb25zdCBkID0gdlsrK2FdOwogICAgICAgICAgICAgIGlmKHR5cGVvZiBkID09PSAnc3ltYm9sJykgdCA9ICdOYU4nOwogICAgICAgICAgICAgIGVsc2UgdCA9IGZvcm1hdE51bWJlcihwYXJzZUZsb2F0KGQpKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA5OTogLy8gJWMKICAgICAgICAgICAgICBhICs9IDE7CiAgICAgICAgICAgICAgdCA9ICcnOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM3OiAvLyAlJQogICAgICAgICAgICAgIHMgKz0gc2xpY2UoeCwgcCwgaSk7CiAgICAgICAgICAgICAgcCA9IGkgKyAxOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYocCAhPT0gaSAtIDEpIHMgKz0gc2xpY2UoeCwgcCwgaSAtIDEpOwogICAgICAgICAgbGV0IHBhZCA9IHBhcnNlSW50KGYpOwogICAgICAgICAgaWYoTWF0aC5hYnMocGFkKSA+IDApIHQgPSB0WydwYWQnICsgKHBhZCA8IDAgPyAnRW5kJyA6ICdTdGFydCcpXShNYXRoLmFicyhwYWQpLCAvXi0/MC8udGVzdChmKSA/ICcwJyA6ICcgJyk7CiAgICAgICAgICBzICs9IHQ7CiAgICAgICAgICBwID0gaSArIDE7CiAgICAgICAgfSBlbHNlIGlmKGMgPT09IDM3KSB7CiAgICAgICAgICBzICs9IHNsaWNlKHgsIHAsIGkpOwogICAgICAgICAgcCA9IGkgKyAxOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYocCAhPT0gMCkgewogICAgICBhKys7CiAgICAgIGogPSAnICc7CiAgICAgIGlmKHAgPCB4Lmxlbmd0aCkgcyArPSBzbGljZSh4LCBwKTsKICAgIH0KICB9CiAgd2hpbGUoYSA8IHYubGVuZ3RoKSB7CiAgICBjb25zdCB5ID0gdlthXTsKICAgIHMgKz0gajsKICAgIHMgKz0gIWlzU3RyaW5nKHkpID8gaW5zcGVjdCh5LCBvKSA6IHk7CiAgICBqID0gJyAnOwogICAgYSsrOwogIH0KICByZXR1cm4gczsKfQoKZXhwb3J0IGZ1bmN0aW9uIGFzc2VydChhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlKSB7CiAgaWYoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSBleHBlY3RlZCA9IHRydWU7CgogIGlmKGFjdHVhbCA9PT0gZXhwZWN0ZWQpIHJldHVybjsKCiAgaWYoCiAgICBhY3R1YWwgIT09IG51bGwgJiYKICAgIGV4cGVjdGVkICE9PSBudWxsICYmCiAgICBpc09iamVjdChhY3R1YWwpICYmCiAgICBpc09iamVjdChleHBlY3RlZCkgJiYKICAgIGFjdHVhbC50b1N0cmluZygpID09PSBleHBlY3RlZC50b1N0cmluZygpCiAgKQogICAgcmV0dXJuOwoKICB0aHJvdyBFcnJvcigKICAgICdhc3NlcnRpb24gZmFpbGVkOiBnb3QgfCcgKyBhY3R1YWwgKyAnfCcgKyAnLCBleHBlY3RlZCB8JyArIGV4cGVjdGVkICsgJ3wnICsgKG1lc3NhZ2UgPyAnICgnICsgbWVzc2FnZSArICcpJyA6ICcnKQogICk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBzZXRJbnRlcnZhbChjYWxsYmFjaywgbXMpIHsKICBsZXQgbWFwID0gKHNldEludGVydmFsLm1hcCA/Pz0gbmV3IE1hcCgpKTsKICBsZXQgaWQgPSAoc2V0SW50ZXJ2YWwuaWQgPSAoc2V0SW50ZXJ2YWwuaWQgPz8gMCkgKyAxKTsKICBsZXQgb2JqID0geyBjYWxsYmFjaywgbXMgfTsKICBtYXAuc2V0KGlkLCBvYmopOwoKICBmdW5jdGlvbiBzdGFydCgpIHsKICAgIG9iai5pZCA9IG9zLnNldFRpbWVvdXQoKCkgPT4gewogICAgICBzdGFydCgpOwogICAgICBjYWxsYmFjaygpOwogICAgfSwgb2JqLm1zKTsKICB9CgogIHN0YXJ0KCk7CiAgcmV0dXJuIGlkOwp9CgpleHBvcnQgZnVuY3Rpb24gY2xlYXJJbnRlcnZhbChpZCkgewogIGxldCBtYXAgPSAoc2V0SW50ZXJ2YWwubWFwID8/PSBuZXcgTWFwKCkpOwoKICBsZXQgb2JqID0gbWFwLmdldChpZCk7CgogIGlmKG9iaikgb3MuY2xlYXJUaW1lb3V0KG9iai5pZCk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBpbmhlcml0cyhjdG9yLCBzdXBlckN0b3IpIHsKICBpZihzdXBlckN0b3IpIHsKICAgIGN0b3Iuc3VwZXJfID0gc3VwZXJDdG9yOwogICAgZGVsZXRlIGN0b3IucHJvdG90eXBlOwogICAgY3Rvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ3Rvci5wcm90b3R5cGUsIHsKICAgICAgY29uc3RydWN0b3I6IHsKICAgICAgICB2YWx1ZTogY3RvciwKICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSwKICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfQogICAgfSk7CiAgfQp9CgpleHBvcnQgZnVuY3Rpb24gZ2V0Q29uc3RydWN0b3Iob2JqKSB7CiAgcmV0dXJuIG9iai5jb25zdHJ1Y3RvciA/PyBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqKS5jb25zdHJ1Y3RvcjsKfQoKZXhwb3J0IGZ1bmN0aW9uIG1lbW9pemUoZm4sIGNhY2hlID0ge30pIHsKICBsZXQgW2dldCwgc2V0XSA9IGdldHNldChjYWNoZSk7CiAgLy9jb25zb2xlLmxvZygnbWVtb2l6ZScsIGNhY2hlLCBnZXQgPT0gV2Vha01hcC5wcm90b3R5cGUuZ2V0LCBzZXQgKyAnJyk7CiAgcmV0dXJuIGRlZmluZSgKICAgIGZ1bmN0aW9uIE1lbW9pemUobiwgLi4ucmVzdCkgewogICAgICBsZXQgcjsKICAgICAgaWYoKHIgPSBnZXQobikpKSByZXR1cm4gcjsKICAgICAgciA9IGZuLmNhbGwodGhpcywgbiwgLi4ucmVzdCk7CiAgICAgIHNldChuLCByKTsKICAgICAgcmV0dXJuIHI7CiAgICB9LAogICAgeyBjYWNoZSwgZ2V0LCBzZXQgfQogICk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBnZXRzZXQodGFyZ2V0LCAuLi5hcmdzKSB7CiAgbGV0IHJldCA9IFtdOwogIGlmKGlzRnVuY3Rpb24odGFyZ2V0KSkgewogICAgcmV0ID0gW3RhcmdldCwgaXNGdW5jdGlvbihhcmdzWzBdKSA/IGFyZ3NbMF0gOiB0YXJnZXRdOwogIH0gZWxzZSBpZihoYXNHZXRTZXQodGFyZ2V0KSkgewogICAgaWYodGFyZ2V0LmdldCA9PT0gdGFyZ2V0LnNldCkgewogICAgICBjb25zdCBHZXRTZXQgPSAoLi4uYXJncykgPT4gdGFyZ2V0LnNldCguLi5hcmdzKTsKICAgICAgcmV0ID0gW0dldFNldCwgR2V0U2V0XTsKICAgIH0gZWxzZSB7CiAgICAgIHJldCA9IFtrZXkgPT4gdGFyZ2V0LmdldChrZXkpLCAoa2V5LCB2YWx1ZSkgPT4gdGFyZ2V0LnNldChrZXksIHZhbHVlKV07CiAgICAgIC8vY29uc29sZS5sb2coJ2dldHNldCcsIHJldFsxXSArICcnLCB0YXJnZXQuZ2V0ID09PSB0YXJnZXQuc2V0KTsKICAgIH0KICB9IGVsc2UgaWYoQXJyYXkuaXNBcnJheSh0YXJnZXQpKSB7CiAgICByZXQgPSBbCiAgICAgIGtleSA9PiB0YXJnZXQuZmluZCgoW2ssIHZdKSA9PiBrZXkgPT09IGspLAogICAgICAoa2V5LCB2YWx1ZSkgPT4gewogICAgICAgIGxldCBpID0gdGFyZ2V0LmZpbmRJbmRleCgoW2ssIHZdKSA9PiBrID09PSBrZXkpOwogICAgICAgIGlmKGkgIT0gLTEpIHsKICAgICAgICAgIGlmKHZhbHVlICE9PSB1bmRlZmluZWQpIHRhcmdldFtpXVsxXSA9IHZhbHVlOwogICAgICAgICAgZWxzZSBkZWxldGUgdGFyZ2V0W2ldOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0YXJnZXQucHVzaChba2V5LCB2YWx1ZV0pOwogICAgICAgIH0KICAgICAgfQogICAgXTsKICB9IGVsc2UgaWYoaXNPYmplY3QodGFyZ2V0KSkgewogICAgcmV0ID0gW2tleSA9PiB0YXJnZXRba2V5XSwgKGtleSwgdmFsdWUpID0+ICh0YXJnZXRba2V5XSA9IHZhbHVlKV07CiAgfSBlbHNlIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoYGdldHNldCB1bmtub3duIGFyZ3VtZW50IHR5cGUgJyR7dHlwZW9mIHRhcmdldH0nYCk7CiAgfQogIGlmKGFyZ3MubGVuZ3RoKSB7CiAgICBsZXQgW2dldCwgc2V0XSA9IHJldDsKICAgIHJldCA9IFsoKSA9PiBnZXQoLi4uYXJncyksIHZhbHVlID0+IHNldCguLi5hcmdzLCB2YWx1ZSldOwogIH0KICByZXR1cm4gcmV0Owp9CgpleHBvcnQgZnVuY3Rpb24gbW9kaWZpZXIoLi4uYXJncykgewogIGxldCBncyA9IGdldHRlcnNldHRlciguLi5hcmdzKTsKICByZXR1cm4gZm4gPT4gewogICAgbGV0IHZhbHVlID0gZ3MoKTsKICAgIHJldHVybiBmbih2YWx1ZSwgbmV3VmFsdWUgPT4gZ3MobmV3VmFsdWUpKTsKICB9Owp9CgpleHBvcnQgZnVuY3Rpb24gZ2V0dGVyKHRhcmdldCwgLi4uYXJncykgewogIGlmKGlzT2JqZWN0KHRhcmdldCkgJiYgaXNGdW5jdGlvbih0YXJnZXQuZ2V0KSkgcmV0dXJuICgpID0+IHRhcmdldC5nZXQoLi4uYXJncyk7CiAgbGV0IHJldDsKICBpZihpc0Z1bmN0aW9uKHRhcmdldCkpIHsKICAgIHJldCA9IHRhcmdldDsKICB9IGVsc2UgaWYoaGFzR2V0U2V0KHRhcmdldCkpIHsKICAgIHJldCA9IGtleSA9PiB0YXJnZXQuZ2V0KGtleSk7CiAgfSBlbHNlIGlmKGlzT2JqZWN0KHRhcmdldCkpIHsKICAgIHJldCA9IGtleSA9PiB0YXJnZXRba2V5XTsKICB9IGVsc2UgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgZ2V0dGVyIHVua25vd24gYXJndW1lbnQgdHlwZSAnJHt0eXBlb2YgdGFyZ2V0fSdgKTsKICB9CiAgaWYoYXJncy5sZW5ndGgpIHsKICAgIGxldCBnZXQgPSByZXQ7CiAgICByZXQgPSAoKSA9PiBnZXQoLi4uYXJncyk7CiAgfQogIHJldHVybiByZXQ7Cn0KCmV4cG9ydCBmdW5jdGlvbiBzZXR0ZXIodGFyZ2V0LCAuLi5hcmdzKSB7CiAgaWYoaXNPYmplY3QodGFyZ2V0KSAmJiBpc0Z1bmN0aW9uKHRhcmdldC5zZXQpKSByZXR1cm4gdmFsdWUgPT4gdGFyZ2V0LnNldCguLi5hcmdzLCB2YWx1ZSk7CiAgbGV0IHJldDsKICBpZihpc0Z1bmN0aW9uKHRhcmdldCkpIHsKICAgIHJldCA9IHRhcmdldDsKICB9IGVsc2UgaWYoaGFzR2V0U2V0KHRhcmdldCkpIHsKICAgIHJldCA9IChrZXksIHZhbHVlKSA9PiB0YXJnZXQuc2V0KGtleSwgdmFsdWUpOwogIH0gZWxzZSBpZihpc09iamVjdCh0YXJnZXQpKSB7CiAgICByZXQgPSAoa2V5LCB2YWx1ZSkgPT4gKHRhcmdldFtrZXldID0gdmFsdWUpOwogIH0gZWxzZSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBzZXR0ZXIgdW5rbm93biBhcmd1bWVudCB0eXBlICcke3R5cGVvZiB0YXJnZXR9J2ApOwogIH0KICBpZihhcmdzLmxlbmd0aCkgewogICAgbGV0IHNldCA9IHJldDsKICAgIHJldCA9IHZhbHVlID0+IHNldCguLi5hcmdzLCB2YWx1ZSk7CiAgfQogIHJldHVybiByZXQ7Cn0KCi8qKgogKiBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBlaXRoZXIgc2V0cyBvciBnZXRzIChhYnN0cmFjdCkgcHJvcGVydGllcyBvbiB0aGUgdGFyZ2V0LAogKiBkZXBlbmRpbmcgb24gbnVtYmVyIG9mIGFyZ3VtZW50cyBnaXZlbgogKgogKiBAcGFyYW0gIHtNYXB8T2JqZWN0fSAgICB0YXJnZXQgICAgICAgICAgVGFyZ2V0IG9iamVjdAogKiBAcmV0dXJuIHtGdW5jdGlvbn0gICAgICAgICAgIFRoZSBnZXR0ZXIvc2V0dGVyIGZ1bmN0aW9uCiAqLwpleHBvcnQgZnVuY3Rpb24gZ2V0dGVyc2V0dGVyKG9iaiwgLi4ub3B0aW9uYWwpIHsKICBsZXQgZm47CiAgaWYoaXNPYmplY3Qob2JqKSAmJiBpc0Z1bmN0aW9uKG9iai5yZWNlaXZlcikpIHJldHVybiAoLi4udikgPT4gb2JqLnJlY2VpdmVyKC4uLm9wdGlvbmFsLCAuLi52KTsKICBpZihpc0Z1bmN0aW9uKG9iaikpIHsKICAgIGlmKGlzRnVuY3Rpb24ob3B0aW9uYWxbMF0pICYmIG9wdGlvbmFsWzBdICE9PSBvYmopIHsKICAgICAgbGV0IHNldHRlciA9IG9wdGlvbmFsLnNoaWZ0KCk7CiAgICAgIGZuID0gKC4uLm9wdGlvbmFsKSA9PiAob3B0aW9uYWwubGVuZ3RoID09IDAgPyBvYmooKSA6IHNldHRlciguLi5vcHRpb25hbCkpOwogICAgfSBlbHNlIGZuID0gb2JqOwogIH0gZWxzZSBpZihoYXNHZXRTZXQob2JqKSkgewogICAgaWYob2JqLmdldCA9PT0gb2JqLnNldCkgZm4gPSAoLi4ub3B0aW9uYWwpID0+IG9iai5zZXQoLi4ub3B0aW9uYWwpOwogICAgZWxzZSBmbiA9ICguLi5vcHRpb25hbCkgPT4gKG9wdGlvbmFsLmxlbmd0aCA8IDIgPyBvYmouZ2V0KC4uLm9wdGlvbmFsKSA6IG9iai5zZXQoLi4ub3B0aW9uYWwpKTsKICB9IGVsc2UgaWYoaXNPYmplY3Qob2JqKSkgewogICAgZm4gPSAoLi4ub3B0aW9uYWwpID0+IHsKICAgICAgY29uc3QgW2ssIHZdID0gb3B0aW9uYWw7CiAgICAgIGlmKG9wdGlvbmFsLmxlbmd0aCA9PSAxKSByZXR1cm4gb2JqW2tdOwogICAgICBvYmpba10gPSB2OwogICAgfTsKICB9IGVsc2UgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgZ2V0dGVyc2V0dGVyIHVua25vd24gYXJndW1lbnQgdHlwZSAnJHt0eXBlb2Ygb2JqfSdgKTsKICB9CiAgaWYoZm4gIT09IG9iaikgZGVmaW5lKGZuLCB7IHJlY2VpdmVyOiBvYmogfSk7CiAgaWYob3B0aW9uYWwubGVuZ3RoKSByZXR1cm4gKC4uLnYpID0+IGZuKC4uLm9wdGlvbmFsLCAuLi52KTsKICByZXR1cm4gZm47Cn0KCmV4cG9ydCBmdW5jdGlvbiBoYXNGbih0YXJnZXQpIHsKICBpZihpc09iamVjdCh0YXJnZXQpKSByZXR1cm4gaXNGdW5jdGlvbih0YXJnZXQuaGFzKSA/IGtleSA9PiB0YXJnZXQuaGFzKGtleSkgOiBrZXkgPT4ga2V5IGluIHRhcmdldDsKfQoKZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZXIodGFyZ2V0KSB7CiAgaWYoaXNPYmplY3QodGFyZ2V0KSkgcmV0dXJuIGlzRnVuY3Rpb24odGFyZ2V0LmRlbGV0ZSkgPyBrZXkgPT4gdGFyZ2V0LmRlbGV0ZShrZXkpIDoga2V5ID0+IGRlbGV0ZSB0YXJnZXRba2V5XTsKfQoKZXhwb3J0IGZ1bmN0aW9uIGdldE9yQ3JlYXRlKHRhcmdldCwgY3JlYXRlID0gKCkgPT4gKHt9KSwgc2V0KSB7CiAgY29uc3QgZ2V0ID0gZ2V0dGVyKHRhcmdldCksCiAgICBoYXMgPSBoYXNGbih0YXJnZXQpOwogIHNldCA/Pz0gc2V0dGVyKHRhcmdldCk7CiAgbGV0IHZhbHVlOwogIHJldHVybiBrZXkgPT4KICAgICh2YWx1ZSA9IGhhcy5jYWxsKHRhcmdldCwga2V5KQogICAgICA/IGdldC5jYWxsKHRhcmdldCwga2V5KQogICAgICA6ICgodmFsdWUgPSBjcmVhdGUoa2V5LCB0YXJnZXQpKSwgc2V0LmNhbGwodGFyZ2V0LCBrZXksIHZhbHVlKSwgdmFsdWUpKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIGhhc0dldFNldChvYmopIHsKICByZXR1cm4gaXNPYmplY3Qob2JqKSAmJiBbJ2dldCcsICdzZXQnXS5ldmVyeShtID0+IGlzRnVuY3Rpb24ob2JqW21dKSk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBnZXRTZXRBcmd1bWVudChnZXQsIHNldCkgewogIHJldHVybiAoLi4uYXJncykgPT4gKGFyZ3MubGVuZ3RoID4gMSA/IHNldCguLi5hcmdzKSA6IGdldChhcmdzWzBdKSk7Cn0KCmV4cG9ydCBmdW5jdGlvbiB3cmFwR2V0U2V0KGdldHRlciwgc2V0dGVyLCAuLi5hcmdzKSB7CiAgbGV0IFtnZXQsIHNldF0gPSBnZXRzZXQoLi4uYXJncyk7CgogIHJldHVybiBnZXRTZXRBcmd1bWVudCgKICAgIHByb3AgPT4gZ2V0dGVyKGdldChwcm9wKSksCiAgICAocHJvcCwgdmFsdWUpID0+IHNldChwcm9wLCBzZXR0ZXIodmFsdWUpKQogICk7Cn0KCmV4cG9ydCBmdW5jdGlvbiB3ZWFrR2V0U2V0KC4uLmFyZ3MpIHsKICByZXR1cm4gd3JhcEdldFNldCgKICAgIHdyZWYgPT4gd3JlZi5kZXJlZigpLAogICAgdmFsdWUgPT4gbmV3IFdlYWtSZWYodmFsdWUpLAogICAgLi4uYXJncwogICk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBhZGRyZW1vdmVoYXModGFyZ2V0LCAuLi5hcmdzKSB7CiAgbGV0IGZuOwogIGlmKGlzT2JqZWN0KHRhcmdldCkpIHsKICAgIGlmKHRhcmdldCBpbnN0YW5jZW9mIFNldCB8fCBbJ2FkZCcsICdkZWxldGUnLCAnaGFzJ10uZXZlcnkobiA9PiBpc0Z1bmN0aW9uKHRhcmdldFtuXSkpKQogICAgICByZXR1cm4gW2VsID0+ICh0YXJnZXQuYWRkKGVsKSwgdGFyZ2V0KSwgZWwgPT4gKHRhcmdldC5kZWxldGUoZWwpLCB0YXJnZXQpLCBlbCA9PiAodGFyZ2V0LmhhcyhlbCksIHRhcmdldCldOwoKICAgIGlmKHRhcmdldCBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICAgIGxldCBpZHg7CiAgICAgIHJldHVybiBbCiAgICAgICAgZWwgPT4gKHRhcmdldC5wdXNoKGVsKSwgdGFyZ2V0KSwKICAgICAgICBlbCA9PiB7CiAgICAgICAgICB3aGlsZShoYXMoZWwpKSB0YXJnZXQuc3BsaWNlKGlkeCwgaWR4ICsgMSk7CiAgICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICAgIH0sCiAgICAgICAgaGFzCiAgICAgIF07CiAgICAgIGNvbnN0IGhhcyA9IGVsID0+IHsKICAgICAgICByZXR1cm4gKGlkeCA9IHRhcmdldC5pbmRleE9mKGVsKSkgIT0gLTE7CiAgICAgIH07CiAgICB9CiAgfQp9CgpleHBvcnQgZnVuY3Rpb24gbG9va3VwT2JqZWN0KGdldHNldCwgaW5zdGFuY2UgPSB7fSwgaGFuZGxlcnMgPSB7fSkgewogIHJldHVybiBuZXcgUHJveHkoCiAgICBpbnN0YW5jZSwKICAgIHdlYWtBc3NpZ24oaGFuZGxlcnMsIHsKICAgICAgZ2V0KHRhcmdldCwgcHJvcCkgewogICAgICAgIHJldHVybiBnZXRzZXQobnVtZXJpY0luZGV4KHByb3ApKTsKICAgICAgfSwKICAgICAgc2V0KHRhcmdldCwgcHJvcCwgdmFsdWUpIHsKICAgICAgICBnZXRzZXQobnVtZXJpY0luZGV4KHByb3ApLCB2YWx1ZSk7CiAgICAgIH0KICAgIH0pCiAgKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIG1hcE9iamVjdCh0YXJnZXQpIHsKICBsZXQgb2JqOwogIGlmKGhhc0dldFNldCh0YXJnZXQucmVjZWl2ZXIpKSByZXR1cm4gdGFyZ2V0LnJlY2VpdmVyOwogIGlmKGhhc0dldFNldCh0YXJnZXQpKSBvYmogPSB0YXJnZXQ7CiAgZWxzZSBpZihpc0Z1bmN0aW9uKHRhcmdldCkpIG9iaiA9IHsgZ2V0OiB0YXJnZXQsIHNldDogdGFyZ2V0IH07CiAgZWxzZSBpZihpc09iamVjdCh0YXJnZXQpKQogICAgb2JqID0gewogICAgICBzZXQ6IChrZXksIHZhbHVlKSA9PiAodGFyZ2V0W2tleV0gPSB2YWx1ZSksCiAgICAgIGdldDoga2V5ID0+IHRhcmdldFtrZXldCiAgICB9OwogIGlmKG9iaiAhPT0gdGFyZ2V0KSBkZWZpbmUob2JqLCB7IHJlY2VpdmVyOiB0YXJnZXQgfSk7CiAgcmV0dXJuIG9iajsKfQoKZXhwb3J0IGZ1bmN0aW9uIG9uY2UoZm4sIHRoaXNBcmcsIG1lbW9GbikgewogIGxldCByZXQsCiAgICByYW4gPSBmYWxzZTsKCiAgcmV0dXJuIGZ1bmN0aW9uKC4uLmFyZ3MpIHsKICAgIGlmKCFyYW4pIHsKICAgICAgcmFuID0gdHJ1ZTsKICAgICAgcmV0ID0gZm4uYXBwbHkodGhpc0FyZyB8fCB0aGlzLCBhcmdzKTsKICAgIH0gZWxzZSBpZihpc0Z1bmN0aW9uKG1lbW9GbikpIHsKICAgICAgcmV0ID0gbWVtb0ZuKHJldCk7CiAgICB9CiAgICByZXR1cm4gcmV0OwogIH07Cn0KCmV4cG9ydCBmdW5jdGlvbiB3YWl0Rm9yKG1zKSB7CiAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpOwp9CgpleHBvcnQgZnVuY3Rpb24gd2FpdENhbmNlbGxhYmxlKG1zKSB7CiAgbGV0IHJzZnVuLCB0bXJpZDsKICByZXR1cm4gZGVmaW5lKAogICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgIHJzZnVuID0gcmVzb2x2ZTsKICAgICAgdG1yaWQgPSBzZXRUaW1lb3V0KCgpID0+ICgocnNmdW4gPSB0bXJpZCA9IG51bGwpLCByZXNvbHZlKCkpLCBtcyk7CiAgICB9KSwKICAgIHsgY2FuY2VsOiAoKSA9PiB0bXJpZCAmJiAoY2xlYXJUaW1lb3V0KHRtcmlkKSwgKHRtcmlkID0gbnVsbCksIHJzZnVuKCkpIH0KICApOwp9CgpleHBvcnQgZnVuY3Rpb24gZGVmaW5lKG9iaiwgLi4uYXJncykgewogIGZvcihsZXQgcHJvcHMgb2YgYXJncykgewogICAgbGV0IGRlc2MgPSB7fTsKICAgIGxldCBzeW1zID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhwcm9wcykuY29uY2F0KE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHByb3BzKSk7CiAgICBmb3IobGV0IHByb3Agb2Ygc3ltcykgewogICAgICBpZihwcm9wID09ICdfX3Byb3RvX18nKSB7CiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKG9iaiwgcHJvcHNbcHJvcF0pOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IHsgdmFsdWUsIC4uLnJlc3QgfSA9IChkZXNjW3Byb3BdID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihwcm9wcywgcHJvcCkpOwogICAgICBkZXNjW3Byb3BdLmVudW1lcmFibGUgPSBmYWxzZTsKICAgICAgaWYoaXNGdW5jdGlvbih2YWx1ZSkpIGRlc2NbcHJvcF0ud3JpdGFibGUgPSBmYWxzZTsKICAgIH0KICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG9iaiwgZGVzYyk7CiAgfQogIHJldHVybiBvYmo7Cn0KCmV4cG9ydCBmdW5jdGlvbiBkZWZpbmVHZXR0ZXIob2JqLCBrZXksIGZuLCBlbnVtZXJhYmxlID0gZmFsc2UpIHsKICBpZighb2JqLmhhc093blByb3BlcnR5KGtleSkpCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgZW51bWVyYWJsZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICBnZXQ6IGZuCiAgICB9KTsKICByZXR1cm4gb2JqOwp9CgpleHBvcnQgZnVuY3Rpb24gZGVmaW5lR2V0dGVyU2V0dGVyKG9iaiwga2V5LCBnLCBzLCBlbnVtZXJhYmxlID0gZmFsc2UpIHsKICBpZighb2JqLmhhc093blByb3BlcnR5KGtleSkpCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgZ2V0OiBnLAogICAgICBzZXQ6IHMsCiAgICAgIGVudW1lcmFibGUKICAgIH0pOwogIHJldHVybiBvYmo7Cn0KCmV4cG9ydCBmdW5jdGlvbiBkZWZpbmVHZXR0ZXJzU2V0dGVycyhvYmosIGdldHRlcnNTZXR0ZXJzKSB7CiAgZm9yKGxldCBuYW1lIGluIGdldHRlcnNTZXR0ZXJzKSBkZWZpbmVHZXR0ZXJTZXR0ZXIob2JqLCBuYW1lLCBnZXR0ZXJzU2V0dGVyc1tuYW1lXSwgZ2V0dGVyc1NldHRlcnNbbmFtZV0pOwogIHJldHVybiBvYmo7Cn0KCi8qZXhwb3J0IGZ1bmN0aW9uIGRlZmluZUdldHRlcnNTZXR0ZXJzKG9iaiwgZ2V0dGVyc1NldHRlcnMsIGVudW1lcmFibGUgPSBmYWxzZSkgewogIGxldCBwcm9wcyA9IHt9OwogIHRyeSB7CiAgICBmb3IobGV0IG5hbWUgaW4gZ2V0dGVyc1NldHRlcnMpIHByb3BzW25hbWVdID0geyBnZXQ6IGdldHRlcnNTZXR0ZXJzW25hbWVdLCBzZXQ6IGdldHRlcnNTZXR0ZXJzW25hbWVdLCBlbnVtZXJhYmxlIH07CiAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnRpZXMob2JqLCBwcm9wcyk7CiAgfSBjYXRjaChlKSB7CiAgICBmb3IobGV0IG5hbWUgaW4gZ2V0dGVyc1NldHRlcnMpCiAgICAgIHRyeSB7CiAgICAgICAgZGVmaW5lR2V0dGVyU2V0dGVyKG9iaiwgbmFtZSwgZ2V0dGVyc1NldHRlcnNbbmFtZV0sIGdldHRlcnNTZXR0ZXJzW25hbWVdKTsKICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgY29uc29sZS5sb2coYEZhaWxlZCBzZXR0aW5nIHByb3BlcnR5ICcke25hbWV9J2ApOwogICAgICB9CiAgICByZXR1cm4gb2JqOwogIH0KfSovCgpleHBvcnQgZnVuY3Rpb24qIHByb3RvdHlwZUl0ZXJhdG9yKG9iaiwgcHJlZCA9IChvYmosIGRlcHRoKSA9PiB0cnVlKSB7CiAgbGV0IGRlcHRoID0gMDsKCiAgd2hpbGUob2JqKSB7CiAgICBpZihwcmVkKG9iaiwgZGVwdGgpKSB5aWVsZCBvYmo7CiAgICBsZXQgdG1wID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iaik7CiAgICBpZih0bXAgPT09IG9iaikgYnJlYWs7CiAgICBvYmogPSB0bXA7CiAgICArK2RlcHRoOwogIH0KfQoKZXhwb3J0IGZ1bmN0aW9uIGtleXMob2JqLCBzdGFydCA9IDAsIGVuZCA9IG9iaiA9PiBvYmogPT09IE9iamVjdC5wcm90b3R5cGUpIHsKICBsZXQgcHJlZCwKICAgIGEgPSBbXSwKICAgIGRlcHRoID0gMDsKCiAgaWYoIWlzRnVuY3Rpb24oZW5kKSkgewogICAgbGV0IG4gPSBlbmQ7CiAgICBwcmVkID0gKG9iaiwgZGVwdGgpID0+IGRlcHRoID49IHN0YXJ0ICYmIGRlcHRoIDwgbjsKICAgIGVuZCA9ICgpID0+IGZhbHNlOwogIH0gZWxzZSB7CiAgICBwcmVkID0gKG9iaiwgZGVwdGgpID0+IGRlcHRoID49IHN0YXJ0OwogIH0KCiAgZm9yKGxldCBwcm90byBvZiBwcm90b3R5cGVJdGVyYXRvcihvYmosIHByZWQpKSB7CiAgICBpZihlbmQocHJvdG8sIGRlcHRoKyspKSBicmVhazsKICAgIGEucHVzaCguLi5PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHByb3RvKS5jb25jYXQoT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMocHJvdG8pKSk7CiAgfQoKICByZXR1cm4gWy4uLm5ldyBTZXQoYSldOwp9CgpleHBvcnQgZnVuY3Rpb24gZW50cmllcyhvYmosIHN0YXJ0ID0gMCwgZW5kID0gb2JqID0+IG9iaiA9PT0gT2JqZWN0LnByb3RvdHlwZSkgewogIGxldCBhID0gW107CiAgZm9yKGxldCBrZXkgb2Yga2V5cyhvYmosIHN0YXJ0LCBlbmQpKSBhLnB1c2goW2tleSwgb2JqW2tleV1dKTsKICByZXR1cm4gYTsKfQoKZXhwb3J0IGZ1bmN0aW9uIHZhbHVlcyhvYmosIHN0YXJ0ID0gMCwgZW5kID0gb2JqID0+IG9iaiA9PT0gT2JqZWN0LnByb3RvdHlwZSkgewogIGxldCBhID0gW107CiAgZm9yKGxldCBrZXkgb2Yga2V5cyhvYmosIHN0YXJ0LCBlbmQpKSBhLnB1c2gob2JqW2tleV0pOwogIHJldHVybiBhOwp9CgpleHBvcnQgZnVuY3Rpb24gZ2V0TWV0aG9kTmFtZXMob2JqLCBkZXB0aCA9IDEsIHN0YXJ0ID0gMCkgewogIGxldCBuYW1lcyA9IFtdOwogIGZvcihsZXQgbiBvZiBrZXlzKG9iaiwgc3RhcnQsIHN0YXJ0ICsgZGVwdGgpKSB7CiAgICB0cnkgewogICAgICBpZihpc0Z1bmN0aW9uKG9ialtuXSkpIG5hbWVzLnB1c2gobik7CiAgICB9IGNhdGNoKGUpIHt9CiAgfQogIHJldHVybiBuYW1lczsKfQoKZXhwb3J0IGZ1bmN0aW9uIGdldE1ldGhvZHMob2JqLCBkZXB0aCA9IDEsIHN0YXJ0ID0gMCkgewogIGxldCBtZXRob2RzID0ge307CgogIGZvcihsZXQgbiBvZiBnZXRNZXRob2ROYW1lcyhvYmosIGRlcHRoLCBzdGFydCkpIG1ldGhvZHNbbl0gPSBvYmpbbl07CgogIHJldHVybiBtZXRob2RzOwp9CgpleHBvcnQgZnVuY3Rpb24gcHJvcGVydGllcyhvYmosIG9wdGlvbnMgPSB7IGVudW1lcmFibGU6IHRydWUgfSkgewogIGxldCBkZXNjID0ge307CiAgY29uc3QgeyBtZW1vaXplOiBtZW1vID0gZmFsc2UsIC4uLm9wdHMgfSA9IG9wdGlvbnM7CiAgY29uc3QgbWZuID0gbWVtbyA/IGZuID0+IG1lbW9pemUoZm4pIDogZm4gPT4gZm47CiAgZm9yKGxldCBwcm9wIG9mIGtleXMob2JqKSkgewogICAgaWYoQXJyYXkuaXNBcnJheShvYmpbcHJvcF0pKSB7CiAgICAgIGNvbnN0IFtnZXQsIHNldF0gPSBvYmpbcHJvcF07CiAgICAgIGRlc2NbcHJvcF0gPSB7IC4uLm9wdHMsIGdldCwgc2V0IH07CiAgICB9IGVsc2UgaWYoaXNGdW5jdGlvbihvYmpbcHJvcF0pKSB7CiAgICAgIGRlc2NbcHJvcF0gPSB7IC4uLm9wdHMsIGdldDogbWZuKG9ialtwcm9wXSkgfTsKICAgIH0KICB9CiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHt9LCBkZXNjKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIHdlYWtBc3NpZ24ob2JqLCAuLi5hcmdzKSB7CiAgbGV0IGRlc2MgPSB7fTsKICBmb3IobGV0IG90aGVyIG9mIGFyZ3MpIHsKICAgIGxldCBvdGhlckRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhvdGhlcik7CiAgICBmb3IobGV0IGtleSBpbiBvdGhlckRlc2MpCiAgICAgIGlmKCEoa2V5IGluIG9iaikgJiYgZGVzY1trZXldID09PSB1bmRlZmluZWQgJiYgb3RoZXJEZXNjW2tleV0gIT09IHVuZGVmaW5lZCkgZGVzY1trZXldID0gb3RoZXJEZXNjW2tleV07CiAgfQogIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhvYmosIGRlc2MpOwp9CgpleHBvcnQgZnVuY3Rpb24gZ2V0Q29uc3RydWN0b3JDaGFpbihvYmosIC4uLnJhbmdlKSB7CiAgbGV0IHJldCA9IFtdOwogIHB1c2hVbmlxdWUocmV0LCBvYmouY29uc3RydWN0b3IpOwogIGZvcihsZXQgcHJvdG8gb2YgZ2V0UHJvdG90eXBlQ2hhaW4ob2JqLCAuLi5yYW5nZSkpIHB1c2hVbmlxdWUocmV0LCBwcm90by5jb25zdHJ1Y3Rvcik7CiAgcmV0dXJuIHJldDsKfQoKZXhwb3J0IGZ1bmN0aW9uIGhhc1Byb3RvdHlwZShvYmosIHByb3RvKSB7CiAgcmV0dXJuIGdldFByb3RvdHlwZUNoYWluKG9iaikuaW5kZXhPZihwcm90bykgIT0gLTE7Cn0KCmV4cG9ydCBmdW5jdGlvbiBmaWx0ZXIoc2VxLCBwcmVkLCB0aGlzQXJnKSB7CiAgaWYoaXNPYmplY3QocHJlZCkgJiYgcHJlZCBpbnN0YW5jZW9mIFJlZ0V4cCkgewogICAgbGV0IHJlID0gcHJlZDsKICAgIHByZWQgPSAoZWwsIGkpID0+IHJlLnRlc3QoZWwpOwogIH0KICBsZXQgciA9IFtdLAogICAgaSA9IDA7CiAgZm9yKGxldCBlbCBvZiBzZXEpIHsKICAgIGlmKHByZWQuY2FsbCh0aGlzQXJnLCBlbCwgaSsrLCBzZXEpKSByLnB1c2goZWwpOwogIH0KICByZXR1cm4gcjsKfQoKZXhwb3J0IGZ1bmN0aW9uIGZpbHRlcktleXMociwgbmVlZGxlcywga2VlcCA9IHRydWUpIHsKICBsZXQgcHJlZDsKICBpZihpc0Z1bmN0aW9uKG5lZWRsZXMpKSB7CiAgICBwcmVkID0gbmVlZGxlczsKICB9IGVsc2UgewogICAgaWYoIUFycmF5LmlzQXJyYXkobmVlZGxlcykpIG5lZWRsZXMgPSBbLi4ubmVlZGxlc107CiAgICBwcmVkID0ga2V5ID0+IChuZWVkbGVzLmluZGV4T2Yoa2V5KSAhPSAtMSkgPT09IGtlZXA7CiAgfQogIHJldHVybiBPYmplY3Qua2V5cyhyKQogICAgLmZpbHRlcihwcmVkKQogICAgLnJlZHVjZSgob2JqLCBrZXkpID0+IHsKICAgICAgb2JqW2tleV0gPSByW2tleV07CiAgICAgIHJldHVybiBvYmo7CiAgICB9LCB7fSk7Cn0KCmV4cG9ydCBjb25zdCBjdXJyeSA9CiAgKGYsIGFyciA9IFtdLCBsZW5ndGggPSBmLmxlbmd0aCkgPT4KICAoLi4uYXJncykgPT4KICAgIChhID0+IChhLmxlbmd0aCA9PT0gbGVuZ3RoID8gZiguLi5hKSA6IGN1cnJ5KGYsIGEpKSkoWy4uLmFyciwgLi4uYXJnc10pOwoKZXhwb3J0IGNvbnN0IGNsYW1wID0gY3VycnkoKG1pbiwgbWF4LCB2YWx1ZSkgPT4gTWF0aC5tYXgobWluLCBNYXRoLm1pbihtYXgsIHZhbHVlKSkpOwoKZXhwb3J0IGNvbnN0IGdlbmVyYXRlID0gKGZuLCBhZGQpID0+IHsKICBsZXQgZ2VuOwoKICBpZihpc09iamVjdChhZGQpICYmIGFkZCBpbnN0YW5jZW9mIFNldCkgewogICAgbGV0IHMgPSBhZGQ7CiAgICBhZGQgPSAoaXRlbSwgZ2VuKSA9PiB7CiAgICAgIHMuYWRkKGl0ZW0pOwogICAgICByZXR1cm4gczsKICAgIH07CiAgfQoKICBpZihpc0Z1bmN0aW9uKGFkZCkpCiAgICByZXR1cm4gZnVuY3Rpb24oLi4uYXJncykgewogICAgICBsZXQgYWNjOwogICAgICBnZW4gPSBmbi5jYWxsKHRoaXMsIC4uLmFyZ3MpOwoKICAgICAgZm9yKGxldCBpdGVtIG9mIGdlbikgYWNjID0gYWRkKGl0ZW0sIGdlbiwgYWNjKTsKICAgICAgcmV0dXJuIGFjYzsKICAgIH07CgogIHJldHVybiBmdW5jdGlvbiguLi5hcmdzKSB7CiAgICBnZW4gPSBmbi5jYWxsKHRoaXMsIC4uLmFyZ3MpOwogICAgcmV0dXJuIFsuLi5nZW5dOwogIH07Cn07CgpleHBvcnQgZnVuY3Rpb24qIHNwbGl0KGJ1ZiwgLi4ucG9pbnRzKSB7CiAgcG9pbnRzLnNvcnQoKTsKICBjb25zdCBzcGxpdEF0ID0gKGIsIHBvcywgbGVuKSA9PiB7CiAgICBsZXQgciA9IHBvcyA8IGIuYnl0ZUxlbmd0aCA/IFtzbGljZShiLCAwLCBwb3MpLCBzbGljZShiLCBwb3MpXSA6IFtudWxsLCBiXTsKICAgIHJldHVybiByOwogIH07CiAgbGV0IHByZXYsCiAgICBsZW4gPSAwOwogIGZvcihsZXQgb2Zmc2V0IG9mIHBvaW50cykgewogICAgbGV0IGF0ID0gb2Zmc2V0IC0gbGVuOwogICAgW3ByZXYsIGJ1Zl0gPSBzcGxpdEF0KGJ1ZiwgYXQsIGxlbik7CiAgICBpZihwcmV2KSB7CiAgICAgIHlpZWxkIHByZXY7CiAgICAgIGxlbiA9IG9mZnNldDsKICAgIH0KICB9CiAgaWYoYnVmKSB5aWVsZCBidWY7Cn0KCmV4cG9ydCBmdW5jdGlvbiB1bmlxdWVQcmVkKGNtcCA9IG51bGwpIHsKICByZXR1cm4gaXNGdW5jdGlvbihjbXApCiAgICA/IChlbCwgaSwgYXJyKSA9PiBhcnIuZmluZEluZGV4KGl0ZW0gPT4gY21wKGVsLCBpdGVtKSkgPT0gaQogICAgOiAoZWwsIGksIGFycikgPT4gYXJyLmluZGV4T2YoZWwpID09IGk7Cn0KCmV4cG9ydCBjb25zdCB1bmlxdWUgPSAoLi4uYXJncykgPT4gewogIGlmKEFycmF5LmlzQXJyYXkoYXJnc1swXSkpIHJldHVybiAoKGFyciwgY21wKSA9PiBhcnIuZmlsdGVyKHVuaXF1ZVByZWQoY21wKSkpKC4uLmFyZ3MpOwoKICByZXR1cm4gKGZ1bmN0aW9uKiB1bmlxdWUoc2VxKSB7CiAgICBsZXQgaXRlbXMgPSBuZXcgU2V0KCk7CiAgICBmb3IobGV0IGVsIG9mIHNlcSkgewogICAgICBpZighaXRlbXMuaGFzKGVsKSkgewogICAgICAgIHlpZWxkIGVsOwogICAgICAgIGl0ZW1zLmFkZChlbCk7CiAgICAgIH0KICAgIH0KICB9KSguLi5hcmdzKTsKfTsKCmV4cG9ydCBjb25zdCBnZXRGdW5jdGlvbkFyZ3VtZW50cyA9IGZuID0+CiAgKGZuICsgJycpCiAgICAucmVwbGFjZSgvXG4uKi9nLCAnJykKICAgIC5yZXBsYWNlKC8oPT58e3xcbikuKi9nLCAnJykKICAgIC5yZXBsYWNlKC9eZnVuY3Rpb25ccyovLCAnJykKICAgIC5yZXBsYWNlKC9eXCgoLiopXClccyokL2csICckMScpCiAgICAuc3BsaXQoLyxccyovZyk7Cgpjb25zdCBBTlNJX0JBQ0tHUk9VTkRfT0ZGU0VUID0gMTA7Cgpjb25zdCB3cmFwQW5zaTE2ID0KICAob2Zmc2V0ID0gMCkgPT4KICBjb2RlID0+CiAgICBgXHgxYlske2NvZGUgKyBvZmZzZXR9bWA7Cgpjb25zdCB3cmFwQW5zaTI1NiA9CiAgKG9mZnNldCA9IDApID0+CiAgY29kZSA9PgogICAgYFx4MWJbJHszOCArIG9mZnNldH07NTske2NvZGV9bWA7Cgpjb25zdCB3cmFwQW5zaTE2bSA9CiAgKG9mZnNldCA9IDApID0+CiAgKHJlZCwgZ3JlZW4sIGJsdWUpID0+CiAgICBgXHgxYlskezM4ICsgb2Zmc2V0fTsyOyR7cmVkfTske2dyZWVufTske2JsdWV9bWA7CgpmdW5jdGlvbiBnZXRBbnNpU3R5bGVzKCkgewogIGNvbnN0IGNvZGVzID0gbmV3IE1hcCgpOwogIGNvbnN0IHN0eWxlcyA9IHsKICAgIG1vZGlmaWVyOiB7CiAgICAgIHJlc2V0OiBbMCwgMF0sCiAgICAgIC8vIDIxIGlzbid0IHdpZGVseSBzdXBwb3J0ZWQgYW5kIDIyIGRvZXMgdGhlIHNhbWUgdGhpbmcKICAgICAgYm9sZDogWzEsIDIyXSwKICAgICAgZGltOiBbMiwgMjJdLAogICAgICBpdGFsaWM6IFszLCAyM10sCiAgICAgIHVuZGVybGluZTogWzQsIDI0XSwKICAgICAgb3ZlcmxpbmU6IFs1MywgNTVdLAogICAgICBpbnZlcnNlOiBbNywgMjddLAogICAgICBoaWRkZW46IFs4LCAyOF0sCiAgICAgIHN0cmlrZXRocm91Z2g6IFs5LCAyOV0KICAgIH0sCiAgICBjb2xvcjogewogICAgICBibGFjazogWzMwLCAzOV0sCiAgICAgIHJlZDogWzMxLCAzOV0sCiAgICAgIGdyZWVuOiBbMzIsIDM5XSwKICAgICAgeWVsbG93OiBbMzMsIDM5XSwKICAgICAgYmx1ZTogWzM0LCAzOV0sCiAgICAgIG1hZ2VudGE6IFszNSwgMzldLAogICAgICBjeWFuOiBbMzYsIDM5XSwKICAgICAgd2hpdGU6IFszNywgMzldLAoKICAgICAgLy8gQnJpZ2h0IGNvbG9yCiAgICAgIGJsYWNrQnJpZ2h0OiBbOTAsIDM5XSwKICAgICAgcmVkQnJpZ2h0OiBbOTEsIDM5XSwKICAgICAgZ3JlZW5CcmlnaHQ6IFs5MiwgMzldLAogICAgICB5ZWxsb3dCcmlnaHQ6IFs5MywgMzldLAogICAgICBibHVlQnJpZ2h0OiBbOTQsIDM5XSwKICAgICAgbWFnZW50YUJyaWdodDogWzk1LCAzOV0sCiAgICAgIGN5YW5CcmlnaHQ6IFs5NiwgMzldLAogICAgICB3aGl0ZUJyaWdodDogWzk3LCAzOV0KICAgIH0sCiAgICBiZ0NvbG9yOiB7CiAgICAgIGJnQmxhY2s6IFs0MCwgNDldLAogICAgICBiZ1JlZDogWzQxLCA0OV0sCiAgICAgIGJnR3JlZW46IFs0MiwgNDldLAogICAgICBiZ1llbGxvdzogWzQzLCA0OV0sCiAgICAgIGJnQmx1ZTogWzQ0LCA0OV0sCiAgICAgIGJnTWFnZW50YTogWzQ1LCA0OV0sCiAgICAgIGJnQ3lhbjogWzQ2LCA0OV0sCiAgICAgIGJnV2hpdGU6IFs0NywgNDldLAoKICAgICAgLy8gQnJpZ2h0IGNvbG9yCiAgICAgIGJnQmxhY2tCcmlnaHQ6IFsxMDAsIDQ5XSwKICAgICAgYmdSZWRCcmlnaHQ6IFsxMDEsIDQ5XSwKICAgICAgYmdHcmVlbkJyaWdodDogWzEwMiwgNDldLAogICAgICBiZ1llbGxvd0JyaWdodDogWzEwMywgNDldLAogICAgICBiZ0JsdWVCcmlnaHQ6IFsxMDQsIDQ5XSwKICAgICAgYmdNYWdlbnRhQnJpZ2h0OiBbMTA1LCA0OV0sCiAgICAgIGJnQ3lhbkJyaWdodDogWzEwNiwgNDldLAogICAgICBiZ1doaXRlQnJpZ2h0OiBbMTA3LCA0OV0KICAgIH0KICB9OwoKICAvLyBBbGlhcyBicmlnaHQgYmxhY2sgYXMgZ3JheSAoYW5kIGdyZXkpCiAgc3R5bGVzLmNvbG9yLmdyYXkgPSBzdHlsZXMuY29sb3IuYmxhY2tCcmlnaHQ7CiAgc3R5bGVzLmJnQ29sb3IuYmdHcmF5ID0gc3R5bGVzLmJnQ29sb3IuYmdCbGFja0JyaWdodDsKICBzdHlsZXMuY29sb3IuZ3JleSA9IHN0eWxlcy5jb2xvci5ibGFja0JyaWdodDsKICBzdHlsZXMuYmdDb2xvci5iZ0dyZXkgPSBzdHlsZXMuYmdDb2xvci5iZ0JsYWNrQnJpZ2h0OwoKICBmb3IoY29uc3QgW2dyb3VwTmFtZSwgZ3JvdXBdIG9mIE9iamVjdC5lbnRyaWVzKHN0eWxlcykpIHsKICAgIGZvcihjb25zdCBbc3R5bGVOYW1lLCBzdHlsZV0gb2YgT2JqZWN0LmVudHJpZXMoZ3JvdXApKSB7CiAgICAgIHN0eWxlc1tzdHlsZU5hbWVdID0gewogICAgICAgIG9wZW46IGBcdTAwMUJbJHtzdHlsZVswXX1tYCwKICAgICAgICBjbG9zZTogYFx1MDAxQlske3N0eWxlWzFdfW1gCiAgICAgIH07CgogICAgICBncm91cFtzdHlsZU5hbWVdID0gc3R5bGVzW3N0eWxlTmFtZV07CgogICAgICBjb2Rlcy5zZXQoc3R5bGVbMF0sIHN0eWxlWzFdKTsKICAgIH0KCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc3R5bGVzLCBncm91cE5hbWUsIHsKICAgICAgdmFsdWU6IGdyb3VwLAogICAgICBlbnVtZXJhYmxlOiBmYWxzZQogICAgfSk7CiAgfQoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc3R5bGVzLCAnY29kZXMnLCB7CiAgICB2YWx1ZTogY29kZXMsCiAgICBlbnVtZXJhYmxlOiBmYWxzZQogIH0pOwoKICBzdHlsZXMuY29sb3IuY2xvc2UgPSAnXHUwMDFCWzM5bSc7CiAgc3R5bGVzLmJnQ29sb3IuY2xvc2UgPSAnXHUwMDFCWzQ5bSc7CgogIHN0eWxlcy5jb2xvci5hbnNpID0gd3JhcEFuc2kxNigpOwogIHN0eWxlcy5jb2xvci5hbnNpMjU2ID0gd3JhcEFuc2kyNTYoKTsKICBzdHlsZXMuY29sb3IuYW5zaTE2bSA9IHdyYXBBbnNpMTZtKCk7CiAgc3R5bGVzLmJnQ29sb3IuYW5zaSA9IHdyYXBBbnNpMTYoQU5TSV9CQUNLR1JPVU5EX09GRlNFVCk7CiAgc3R5bGVzLmJnQ29sb3IuYW5zaTI1NiA9IHdyYXBBbnNpMjU2KEFOU0lfQkFDS0dST1VORF9PRkZTRVQpOwogIHN0eWxlcy5iZ0NvbG9yLmFuc2kxNm0gPSB3cmFwQW5zaTE2bShBTlNJX0JBQ0tHUk9VTkRfT0ZGU0VUKTsKCiAgLy8gRnJvbSBodHRwczovL2dpdGh1Yi5jb20vUWl4LS9jb2xvci1jb252ZXJ0L2Jsb2IvM2YwZTBkNGU5MmUyMzU3OTZjY2IxN2Y2ZTg1YzcyMDk0YTY1MWY0OS9jb252ZXJzaW9ucy5qcwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHN0eWxlcywgewogICAgcmdiVG9BbnNpMjU2OiB7CiAgICAgIHZhbHVlOiAocmVkLCBncmVlbiwgYmx1ZSkgPT4gewogICAgICAgIC8vIFdlIHVzZSB0aGUgZXh0ZW5kZWQgZ3JleXNjYWxlIHBhbGV0dGUgaGVyZSwgd2l0aCB0aGUgZXhjZXB0aW9uIG9mCiAgICAgICAgLy8gYmxhY2sgYW5kIHdoaXRlLiBub3JtYWwgcGFsZXR0ZSBvbmx5IGhhcyA0IGdyZXlzY2FsZSBzaGFkZXMuCiAgICAgICAgaWYocmVkID09PSBncmVlbiAmJiBncmVlbiA9PT0gYmx1ZSkgewogICAgICAgICAgaWYocmVkIDwgOCkgewogICAgICAgICAgICByZXR1cm4gMTY7CiAgICAgICAgICB9CgogICAgICAgICAgaWYocmVkID4gMjQ4KSB7CiAgICAgICAgICAgIHJldHVybiAyMzE7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoKChyZWQgLSA4KSAvIDI0NykgKiAyNCkgKyAyMzI7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGMgPSBbcmVkLCBncmVlbiwgYmx1ZV0ubWFwKGMgPT4gKGMgLyAyNTUpICogNSk7CiAgICAgICAgcmV0dXJuIDE2ICsgMzYgKiBjWzBdICsgNiAqIGNbMV0gKyBjWzJdOwogICAgICB9LAogICAgICBlbnVtZXJhYmxlOiBmYWxzZQogICAgfSwKICAgIGhleFRvUmdiOiB7CiAgICAgIHZhbHVlOiBoZXggPT4gewogICAgICAgIGNvbnN0IG1hdGNoZXMgPSAvKD88Y29sb3JTdHJpbmc+W2EtZlxkXXs2fXxbYS1mXGRdezN9KS9pLmV4ZWMoaGV4LnRvU3RyaW5nKDE2KSk7CiAgICAgICAgaWYoIW1hdGNoZXMpIHsKICAgICAgICAgIHJldHVybiBbMCwgMCwgMF07CiAgICAgICAgfQoKICAgICAgICBsZXQgeyBjb2xvclN0cmluZyB9ID0gbWF0Y2hlcy5ncm91cHM7CgogICAgICAgIGlmKGNvbG9yU3RyaW5nLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgY29sb3JTdHJpbmcgPSBjb2xvclN0cmluZwogICAgICAgICAgICAuc3BsaXQoJycpCiAgICAgICAgICAgIC5tYXAoY2hhcmFjdGVyID0+IGNoYXJhY3RlciArIGNoYXJhY3RlcikKICAgICAgICAgICAgLmpvaW4oJycpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgaW50ZWdlciA9IE51bWJlci5wYXJzZUludChjb2xvclN0cmluZywgMTYpOwoKICAgICAgICByZXR1cm4gWyhpbnRlZ2VyID4+IDE2KSAmIDB4ZmYsIChpbnRlZ2VyID4+IDgpICYgMHhmZiwgaW50ZWdlciAmIDB4ZmZdOwogICAgICB9LAogICAgICBlbnVtZXJhYmxlOiBmYWxzZQogICAgfSwKICAgIGhleFRvQW5zaTI1NjogewogICAgICB2YWx1ZTogaGV4ID0+IHN0eWxlcy5yZ2JUb0Fuc2kyNTYoLi4uc3R5bGVzLmhleFRvUmdiKGhleCkpLAogICAgICBlbnVtZXJhYmxlOiBmYWxzZQogICAgfSwKICAgIGFuc2kyNTZUb0Fuc2k6IHsKICAgICAgdmFsdWU6IGNvZGUgPT4gewogICAgICAgIGlmKGNvZGUgPCA4KSB7CiAgICAgICAgICByZXR1cm4gMzAgKyBjb2RlOwogICAgICAgIH0KCiAgICAgICAgaWYoY29kZSA8IDE2KSB7CiAgICAgICAgICByZXR1cm4gOTAgKyAoY29kZSAtIDgpOwogICAgICAgIH0KCiAgICAgICAgbGV0IHJlZDsKICAgICAgICBsZXQgZ3JlZW47CiAgICAgICAgbGV0IGJsdWU7CgogICAgICAgIGlmKGNvZGUgPj0gMjMyKSB7CiAgICAgICAgICByZWQgPSAoKGNvZGUgLSAyMzIpICogMTAgKyA4KSAvIDI1NTsKICAgICAgICAgIGdyZWVuID0gcmVkOwogICAgICAgICAgYmx1ZSA9IHJlZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29kZSAtPSAxNjsKCiAgICAgICAgICBjb25zdCByZW1haW5kZXIgPSBjb2RlICUgMzY7CgogICAgICAgICAgcmVkID0gTWF0aC5mbG9vcihjb2RlIC8gMzYpICogMC4yOwogICAgICAgICAgZ3JlZW4gPSBNYXRoLmZsb29yKHJlbWFpbmRlciAvIDYpICogMC4yOwogICAgICAgICAgYmx1ZSA9IChyZW1haW5kZXIgJSA2KSAqIDAuMjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHZhbHVlID0gTWF0aC5tYXgocmVkLCBncmVlbiwgYmx1ZSkgKiAyOwoKICAgICAgICBpZih2YWx1ZSA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIDMwOwogICAgICAgIH0KCiAgICAgICAgbGV0IHJlc3VsdCA9IDMwICsgKChNYXRoLnJvdW5kKGJsdWUpIDw8IDIpIHwgKE1hdGgucm91bmQoZ3JlZW4pIDw8IDEpIHwgTWF0aC5yb3VuZChyZWQpKTsKCiAgICAgICAgaWYodmFsdWUgPT09IDIpIHsKICAgICAgICAgIHJlc3VsdCArPSA2MDsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0sCiAgICAgIGVudW1lcmFibGU6IGZhbHNlCiAgICB9LAogICAgcmdiVG9BbnNpOiB7CiAgICAgIHZhbHVlOiAocmVkLCBncmVlbiwgYmx1ZSkgPT4gc3R5bGVzLmFuc2kyNTZUb0Fuc2koc3R5bGVzLnJnYlRvQW5zaTI1NihyZWQsIGdyZWVuLCBibHVlKSksCiAgICAgIGVudW1lcmFibGU6IGZhbHNlCiAgICB9LAogICAgaGV4VG9BbnNpOiB7CiAgICAgIHZhbHVlOiBoZXggPT4gc3R5bGVzLmFuc2kyNTZUb0Fuc2koc3R5bGVzLmhleFRvQW5zaTI1NihoZXgpKSwKICAgICAgZW51bWVyYWJsZTogZmFsc2UKICAgIH0KICB9KTsKCiAgcmV0dXJuIHN0eWxlczsKfQoKZXhwb3J0IGZ1bmN0aW9uIHN0cmlwQW5zaShzdHIpIHsKICByZXR1cm4gKHN0ciArICcnKS5yZXBsYWNlKG5ldyBSZWdFeHAoJ1x4MWJbWyg/KTtdezAsMn0oOz9bMC05XSkqLicsICdnJyksICcnKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIHBhZEFuc2koc3RyLCBuLCBzID0gJyAnKSB7CiAgbGV0IHsgbGVuZ3RoIH0gPSBzdHJpcEFuc2koc3RyKTsKICBsZXQgcGFkID0gJyc7CiAgZm9yKGxldCBpID0gbGVuZ3RoOyBpIDwgbjsgaSsrKSBwYWQgKz0gczsKICByZXR1cm4gcGFkOwp9CgpleHBvcnQgZnVuY3Rpb24gcGFkU3RhcnRBbnNpKHN0ciwgbiwgcyA9ICcgJykgewogIHJldHVybiBwYWRBbnNpKHN0ciwgbiwgcykgKyBzdHI7Cn0KCmV4cG9ydCBmdW5jdGlvbiBwYWRFbmRBbnNpKHN0ciwgbiwgcyA9ICcgJykgewogIHJldHVybiBzdHIgKyBwYWRBbnNpKHN0ciwgbiwgcyk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBtYXBGdW5jdGlvbmFsKGZuKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKiAoYXJnKSB7CiAgICBmb3IobGV0IGl0ZW0gb2YgYXJnKSB5aWVsZCBmbihpdGVtKTsKICB9Owp9CgpleHBvcnQgZnVuY3Rpb24gbWFwKC4uLmFyZ3MpIHsKICBsZXQgW29iaiwgZm5dID0gYXJnczsKICBsZXQgcmV0ID0gYSA9PiBhOwogIGlmKHR5cGVzLmlzSXRlcmF0b3Iob2JqKSkgewogICAgcmV0dXJuIHJldChmdW5jdGlvbiogKCkgewogICAgICBsZXQgaSA9IDA7CiAgICAgIGZvcihsZXQgaXRlbSBvZiBvYmopIHlpZWxkIGZuKGl0ZW0sIGkrKywgb2JqKTsKICAgIH0pKCk7CiAgfQogIGlmKGlzRnVuY3Rpb24ob2JqKSkgcmV0dXJuIG1hcEZ1bmN0aW9uYWwoLi4uYXJncyk7CiAgaWYoaXNGdW5jdGlvbihvYmoubWFwKSkgcmV0dXJuIG9iai5tYXAoZm4pOwoKICBpZihpc0Z1bmN0aW9uKG9iai5lbnRyaWVzKSkgewogICAgY29uc3QgY3RvciA9IG9iai5jb25zdHJ1Y3RvcjsKICAgIG9iaiA9IG9iai5lbnRyaWVzKCk7CiAgICByZXQgPSBhID0+IG5ldyBjdG9yKFsuLi5hXSk7CiAgfQoKICBpZih0eXBlcy5pc0l0ZXJhYmxlKG9iaikpCiAgICByZXR1cm4gcmV0KAogICAgICAoZnVuY3Rpb24qICgpIHsKICAgICAgICBsZXQgaSA9IDA7CiAgICAgICAgZm9yKGxldCBpdGVtIG9mIG9iaikgeWllbGQgZm4oaXRlbSwgaSsrLCBvYmopOwogICAgICB9KSgpCiAgICApOwogIHJldCA9IHt9OwogIGZvcihsZXQga2V5IGluIG9iaikgewogICAgaWYob2JqLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgbGV0IGl0ZW0gPSBmbihrZXksIG9ialtrZXldLCBvYmopOwogICAgICBpZihpdGVtKSByZXRbaXRlbVswXV0gPSBpdGVtWzFdOwogICAgfQogIH0KICByZXR1cm4gcmV0Owp9CgpleHBvcnQgZnVuY3Rpb24gcmFuZEludCguLi5hcmdzKSB7CiAgbGV0IHJhbmdlID0gYXJncy5zcGxpY2UoMCwgMik7CiAgbGV0IHJuZyA9IGFyZ3Muc2hpZnQoKSA/PyBNYXRoLnJhbmRvbTsKICBpZihyYW5nZS5sZW5ndGggPCAyKSByYW5nZS51bnNoaWZ0KDApOwogIHJldHVybiBNYXRoLnJvdW5kKHJhbmQocmFuZ2VbMV0gLSByYW5nZVswXSArIDEpICsgcmFuZ2VbMF0pOwp9CgpleHBvcnQgZnVuY3Rpb24gcmFuZEZsb2F0KG1pbiwgbWF4LCBybmcgPSBNYXRoLnJhbmRvbSkgewogIHJldHVybiBybmcoKSAqIChtYXggLSBtaW4pICsgbWluOwp9CgpleHBvcnQgZnVuY3Rpb24gcmFuZFN0cihuLCBzZXQgPSAnXzAxMjM0NTY3ODlBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6Jywgcm5nID0gTWF0aC5yYW5kb20pIHsKICBsZXQgbyA9ICcnOwoKICB3aGlsZSgtLW4gPj0gMCkgbyArPSBzZXRbTWF0aC5yb3VuZChybmcoKSAqIChzZXQubGVuZ3RoIC0gMSkpXTsKICByZXR1cm4gbzsKfQoKZXhwb3J0IGZ1bmN0aW9uIHRvQmlnSW50KGFyZykgewogIGlmKHR5cGVzLmlzQXJyYXlCdWZmZXIoYXJnKSkgewogICAgY29uc3QgYml0cyA9IGJpdHMoYXJnKS5qb2luKCcnKTsKICAgIHJldHVybiBldmFsKGAwYiR7Yml0c31uYCk7CiAgfQogIHJldHVybiBCaWdJbnQoYXJnKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIHJvdW5kRGlnaXRzKHByZWNpc2lvbikgewogIGlmKHR5cGVvZiBwcmVjaXNpb24gPT0gJ251bWJlcicpIHJldHVybiAtTWF0aC5sb2cxMChwcmVjaXNpb24pOwoKICBwcmVjaXNpb24gPSBwcmVjaXNpb24gKyAnJzsKICBsZXQgaW5kZXggPSBwcmVjaXNpb24uaW5kZXhPZignLicpOwogIGxldCBmcmFjID0gaW5kZXggPT0gLTEgPyAnJyA6IHByZWNpc2lvbi5zbGljZShpbmRleCArIDEpOwogIHJldHVybiBmcmFjLmxlbmd0aDsKCiAgcmV0dXJuIC1jbGFtcCgtSW5maW5pdHksIDAsIE1hdGguZmxvb3IoTWF0aC5sb2cxMChwcmVjaXNpb24gLSBOdW1iZXIuRVBTSUxPTikpKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIHJvdW5kVG8odmFsdWUsIHByZWMsIGRpZ2l0cywgdHlwZSA9ICdyb3VuZCcpIHsKICBpZighTnVtYmVyLmlzRmluaXRlKHZhbHVlKSkgcmV0dXJuIHZhbHVlOwogIGNvbnN0IGZuID0gTWF0aFt0eXBlXTsKICBpZihwcmVjID09IDEpIHJldHVybiBmbih2YWx1ZSk7CiAgaWYocHJlYyA8IDEgJiYgcHJlYyA+IDAgJiYgIWlzTnVtYmVyKGRpZ2l0cykpIGRpZ2l0cyA9IC1NYXRoLmxvZzEwKHByZWMpOwogIGxldCByZXQgPSBwcmVjID49IE51bWJlci5FUFNJTE9OID8gZm4odmFsdWUgLyBwcmVjKSAqIHByZWMgOiB2YWx1ZTsKICBpZihpc051bWJlcihkaWdpdHMpICYmIGRpZ2l0cyA+PSAxICYmIGRpZ2l0cyA8PSAxMDApIHJldCA9ICtyZXQudG9GaXhlZChkaWdpdHMpOwogIHJldHVybiByZXQ7Cn0KCmV4cG9ydCBmdW5jdGlvbiBsYXp5UHJvcGVydHkob2JqLCBuYW1lLCBnZXR0ZXIsIG9wdHMgPSB7fSkgewogIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBuYW1lLCB7CiAgICBnZXQ6IHR5cGVzLmlzQXN5bmNGdW5jdGlvbihnZXR0ZXIpCiAgICAgID8gYXN5bmMgZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gcmVwbGFjZVByb3BlcnR5KGF3YWl0IGdldHRlci5jYWxsKG9iaiwgbmFtZSkpOwogICAgICAgIH0KICAgICAgOiBmdW5jdGlvbigpIHsKICAgICAgICAgIGNvbnN0IHZhbHVlID0gZ2V0dGVyLmNhbGwob2JqLCBuYW1lKTsKICAgICAgICAgIGlmKHR5cGVzLmlzUHJvbWlzZSh2YWx1ZSkpIHsKICAgICAgICAgICAgdmFsdWUudGhlbih2ID0+IHsKICAgICAgICAgICAgICByZXBsYWNlUHJvcGVydHkodik7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coYGxhenlQcm9wZXJ0eSByZXNvbHZlZCBgLCBvYmpbbmFtZV0pOwogICAgICAgICAgICAgIHJldHVybiB2OwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlcGxhY2VQcm9wZXJ0eSh2YWx1ZSk7CiAgICAgICAgfSwKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgIC4uLm9wdHMKICB9KTsKCiAgZnVuY3Rpb24gcmVwbGFjZVByb3BlcnR5KHZhbHVlKSB7CiAgICBkZWxldGUgb2JqW25hbWVdOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwgbmFtZSwgeyB2YWx1ZSwgLi4ub3B0cyB9KTsKICAgIHJldHVybiB2YWx1ZTsKICB9Cn0KCmV4cG9ydCBmdW5jdGlvbiBsYXp5UHJvcGVydGllcyhvYmosIGdldHRlcnNPYmosIG9wdHMgPSB7fSkgewogIG9wdHMgPSB7IGVudW1lcmFibGU6IGZhbHNlLCAuLi5vcHRzIH07CiAgZm9yKGxldCBwcm9wIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGdldHRlcnNPYmopKSBsYXp5UHJvcGVydHkob2JqLCBwcm9wLCBnZXR0ZXJzT2JqW3Byb3BdLCBvcHRzKTsKICByZXR1cm4gb2JqOwp9CgpleHBvcnQgZnVuY3Rpb24gb2JzZXJ2ZVByb3BlcnRpZXModGFyZ2V0ID0ge30sIG9iaiwgZm4gPSAocHJvcCwgdmFsdWUpID0+IHt9LCBvcHRzID0ge30pIHsKICBvcHRzID0geyBlbnVtZXJhYmxlOiBmYWxzZSwgLi4ub3B0cyB9OwogIGZvcihsZXQgcHJvcCBvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhvYmopKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBwcm9wLCB7CiAgICAgIC4uLm9wdHMsCiAgICAgIGdldDogKCkgPT4gb2JqW3Byb3BdLAogICAgICBzZXQ6IHZhbHVlID0+IHsKICAgICAgICBsZXQgciA9IGZuKHByb3AsIHZhbHVlLCBvYmopOwogICAgICAgIGlmKHIgIT09IGZhbHNlKSBvYmpbcHJvcF0gPSB2YWx1ZTsKICAgICAgICBpZihpc0Z1bmN0aW9uKHIpKSByKHByb3AsIHZhbHVlLCBvYmopOwogICAgICB9CiAgICB9KTsKICB9CiAgcmV0dXJuIHRhcmdldDsKfQoKZXhwb3J0IGZ1bmN0aW9uIGRlY29yYXRlKGRlY29yYXRvcnMsIG9iaiwgLi4uYXJncykgewogIGlmKCFBcnJheS5pc0FycmF5KGRlY29yYXRvcnMpKSBkZWNvcmF0b3JzID0gW2RlY29yYXRvcnNdOwogIGZvcihsZXQgZGVjb3JhdG9yIG9mIGRlY29yYXRvcnMpCiAgICBmb3IobGV0IHByb3Agb2YgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMob2JqKSkKICAgICAgaWYodHlwZW9mIG9ialtwcm9wXSA9PSAnZnVuY3Rpb24nKSBvYmpbcHJvcF0gPSBkZWNvcmF0b3Iob2JqW3Byb3BdLCBvYmosIC4uLmFyZ3MpOwogIHJldHVybiBvYmo7Cn0KCmV4cG9ydCBmdW5jdGlvbiBnZXRPcHQob3B0aW9ucyA9IHt9LCBhcmdzKSB7CiAgbGV0IHNob3J0LCBsb25nOwogIGxldCByZXN1bHQgPSB7fTsKICBsZXQgcG9zaXRpb25hbCA9IChyZXN1bHRbJ0AnXSA9IFtdKTsKICBpZighKG9wdGlvbnMgaW5zdGFuY2VvZiBBcnJheSkpIG9wdGlvbnMgPSBPYmplY3QuZW50cmllcyhvcHRpb25zKTsKICBjb25zdCBmaW5kT3B0ID0gYXJnID0+CiAgICBvcHRpb25zLmZpbmQoKFtvcHRuYW1lLCBvcHRpb25dKSA9PiAoQXJyYXkuaXNBcnJheShvcHRpb24pID8gb3B0aW9uLmluZGV4T2YoYXJnKSAhPSAtMSA6IGZhbHNlKSB8fCBhcmcgPT0gb3B0bmFtZSk7CiAgbGV0IFssIHBhcmFtc10gPSBvcHRpb25zLmZpbmQob3B0ID0+IG9wdFswXSA9PSAnQCcpIHx8IFtdOwogIGlmKHR5cGVvZiBwYXJhbXMgPT0gJ3N0cmluZycpIHBhcmFtcyA9IHBhcmFtcy5zcGxpdCgnLCcpOwogIGFyZ3MgPSBhcmdzLnJlZHVjZSgoYWNjLCBhcmcpID0+IHsKICAgIGlmKC9eLVteLV0vLnRlc3QoYXJnKSkgewogICAgICBsZXQgb3B0ID0gZmluZE9wdChhcmdbMV0pOwogICAgICBpZighb3B0IHx8ICFvcHRbMV1bMF0pIHsKICAgICAgICBmb3IobGV0IGNoIG9mIGFyZy5zbGljZSgxKSkgYWNjLnB1c2goJy0nICsgY2gpOwogICAgICAgIHJldHVybiBhY2M7CiAgICAgIH0KICAgIH0KICAgIGFjYy5wdXNoKGFyZyk7CiAgICByZXR1cm4gYWNjOwogIH0sIFtdKTsKICAvL2NvbnNvbGUubG9nKCdnZXRPcHQnLCB7IGFyZ3MgfSk7CiAgZm9yKGxldCBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHsKICAgIGNvbnN0IGFyZyA9IGFyZ3NbaV07CiAgICBsZXQgb3B0OwoKICAgIGlmKGFyZ1swXSA9PSAnLScpIHsKICAgICAgbGV0IG5hbWUsIHZhbHVlLCBzdGFydCwgZW5kOwogICAgICBpZihhcmdbMV0gPT0gJy0nKSBsb25nID0gdHJ1ZTsKICAgICAgZWxzZSBzaG9ydCA9IHRydWU7CiAgICAgIHN0YXJ0ID0gc2hvcnQgPyAxIDogMjsKICAgICAgaWYoc2hvcnQpIGVuZCA9IDI7CiAgICAgIGVsc2UgaWYoKGVuZCA9IGFyZy5pbmRleE9mKCc9JykpID09IC0xKSBlbmQgPSBhcmcubGVuZ3RoOwogICAgICBuYW1lID0gYXJnLnN1YnN0cmluZyhzdGFydCwgZW5kKTsKICAgICAgaWYoKG9wdCA9IGZpbmRPcHQobmFtZSkpKSB7CiAgICAgICAgY29uc3QgW2hhc19hcmcsIGhhbmRsZXJdID0gb3B0WzFdOwogICAgICAgIGlmKGhhc19hcmcpIHsKICAgICAgICAgIC8vY29uc29sZS5sb2coJ2dldE9wdCcsIHsgbmFtZSwgdmFsdWUsIGFyZywgZW5kIH0pOwogICAgICAgICAgaWYoYXJnLmxlbmd0aCA+IGVuZCkgdmFsdWUgPSBhcmcuc3Vic3RyaW5nKGVuZCArIChhcmdbZW5kXSA9PSAnPScpKTsKICAgICAgICAgIGVsc2UgdmFsdWUgPSBhcmdzWysraV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhbHVlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYoaXNGdW5jdGlvbihoYW5kbGVyKSkKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhbHVlID0gaGFuZGxlcih2YWx1ZSwgcmVzdWx0W29wdFswXV0sIG9wdGlvbnMsIHJlc3VsdCk7CiAgICAgICAgICB9IGNhdGNoKGUpIHt9CiAgICAgICAgcmVzdWx0W29wdFswXV0gPSB2YWx1ZTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgfQogICAgaWYocGFyYW1zLmxlbmd0aCkgewogICAgICBjb25zdCBwYXJhbSA9IHBhcmFtcy5zaGlmdCgpOwogICAgICBpZigob3B0ID0gZmluZE9wdChwYXJhbSkpKSB7CiAgICAgICAgY29uc3QgWywgWywgaGFuZGxlcl1dID0gb3B0OwogICAgICAgIGxldCB2YWx1ZSA9IGFyZzsKICAgICAgICBpZihpc0Z1bmN0aW9uKGhhbmRsZXIpKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB2YWx1ZSA9IGhhbmRsZXIodmFsdWUsIHJlc3VsdFtvcHRbMF1dLCBvcHRpb25zLCByZXN1bHQpOwogICAgICAgICAgfSBjYXRjaChlKSB7fQogICAgICAgIH0KICAgICAgICBjb25zdCBuYW1lID0gb3B0WzBdOwogICAgICAgIHJlc3VsdFtvcHRbMF1dID0gdmFsdWU7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgIH0KICAgIHJlc3VsdFsnQCddID0gWy4uLihyZXN1bHRbJ0AnXSA/PyBbXSksIGFyZ107CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KCmV4cG9ydCBmdW5jdGlvbiBzaG93SGVscChvcHRzLCBleGl0Q29kZSA9IDApIHsKICBsZXQgZW50cmllcyA9IEFycmF5LmlzQXJyYXkob3B0cykgPyBvcHRzIDogT2JqZWN0LmVudHJpZXMob3B0cyk7CiAgbGV0IG1heGxlbiA9IGVudHJpZXMucmVkdWNlKChhY2MsIFtuYW1lXSkgPT4gKGFjYyA+IG5hbWUubGVuZ3RoID8gYWNjIDogbmFtZS5sZW5ndGgpLCAwKTsKCiAgbGV0IHMgPSBlbnRyaWVzLnJlZHVjZSgKICAgIChhY2MsIFtuYW1lLCBbaGFzQXJnLCBmbiwgc2hvcnRPcHRdXSkgPT4KICAgICAgYWNjICsKICAgICAgKAogICAgICAgIGAgICAgJHsoc2hvcnRPcHQgPyAnLScgKyBzaG9ydE9wdCArICcsJyA6ICcnKS5wYWRTdGFydCg0LCAnICcpfSAtLSR7bmFtZS5wYWRFbmQobWF4bGVuLCAnICcpfSBgICsKICAgICAgICAoaGFzQXJnID8gKHR5cGVvZiBoYXNBcmcgPT0gJ2Jvb2xlYW4nID8gJ0FSRycgOiBoYXNBcmcpIDogJycpCiAgICAgICkucGFkRW5kKDQwLCAnICcpICsKICAgICAgJ1xuJywKICAgIGBVc2FnZTogJHtiYXNlbmFtZShzY3JpcHRBcmdzWzBdKX0gW09QVElPTlNdIDxGSUxFUy4uLj5cblxuYAogICk7CgogIHN0ZC5wdXRzKHMgKyAnXG4nKTsKICBzdGQuZXhpdChleGl0Q29kZSk7Cn0KCmV4cG9ydCBmdW5jdGlvbiB0b1VuaXhUaW1lKGRhdGVPYmosIHV0YyA9IGZhbHNlKSB7CiAgaWYoIShkYXRlT2JqIGluc3RhbmNlb2YgRGF0ZSkpIGRhdGVPYmogPSBuZXcgRGF0ZShkYXRlT2JqKTsKICBsZXQgZXBvY2ggPSBNYXRoLmZsb29yKGRhdGVPYmouZ2V0VGltZSgpIC8gMTAwMCk7CiAgaWYodXRjKSBlcG9jaCArPSBkYXRlT2JqLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDsKICByZXR1cm4gZXBvY2g7Cn0KCmV4cG9ydCBmdW5jdGlvbiB1bml4VGltZSh1dGMgPSBmYWxzZSkgewogIHJldHVybiB0b1VuaXhUaW1lKG5ldyBEYXRlKCksIHV0Yyk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBmcm9tVW5peFRpbWUoZXBvY2gsIHV0YyA9IGZhbHNlKSB7CiAgbGV0IHQgPSBwYXJzZUludChlcG9jaCk7CiAgbGV0IGQgPSBuZXcgRGF0ZSgwKTsKICB1dGMgPyBkLnNldFVUQ1NlY29uZHModCkgOiBkLnNldFNlY29uZHModCk7CiAgcmV0dXJuIGQ7Cn0KCmV4cG9ydCBmdW5jdGlvbiByYW5nZSguLi5hcmdzKSB7CiAgbGV0IFtzdGFydCwgZW5kLCBzdGVwID0gMV0gPSBhcmdzOwogIGxldCByZXQ7CiAgc3RhcnQgLz0gc3RlcDsKICBlbmQgLz0gc3RlcDsKICBpZihzdGFydCA+IGVuZCkgewogICAgcmV0ID0gW107CiAgICB3aGlsZShzdGFydCA+PSBlbmQpIHJldC5wdXNoKHN0YXJ0LS0pOwogIH0gZWxzZSB7CiAgICByZXQgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiBlbmQgLSBzdGFydCArIDEgfSwgKHYsIGspID0+IGsgKyBzdGFydCk7CiAgfQogIGlmKHN0ZXAgIT0gMSkgewogICAgcmV0ID0gcmV0Lm1hcChuID0+IG4gKiBzdGVwKTsKICB9CiAgcmV0dXJuIHJldDsKfQoKZXhwb3J0IGZ1bmN0aW9uIGNodW5rQXJyYXkoYXJyLCBzaXplKSB7CiAgY29uc3QgZm4gPSAoYSwgdiwgaSkgPT4gewogICAgY29uc3QgaiA9IGkgJSBzaXplOwogICAgaWYoaiA9PSAwKSBhLnB1c2goW10pOwogICAgYVthLmxlbmd0aCAtIDFdLnB1c2godik7CiAgICByZXR1cm4gYTsKICB9OwoKICByZXR1cm4gYXJyLnJlZHVjZShmbiwgW10pOwp9CgpleHBvcnQgZnVuY3Rpb24gZGVjb2RlSFRNTEVudGl0aWVzKHRleHQpIHsKICBjb25zdCBlbnRpdGllcyA9IHsKICAgIGFtcDogJyYnLAogICAgYXBvczogIiciLAogICAgJyN4MjcnOiAiJyIsCiAgICAnI3gyRic6ICcvJywKICAgICcjMzknOiAiJyIsCiAgICAnIzQ3JzogJy8nLAogICAgbHQ6ICc8JywKICAgIGd0OiAnPicsCiAgICBuYnNwOiAnICcsCiAgICBxdW90OiAnIicKICB9OwogIHJldHVybiAodGV4dCArICcnKS5yZXBsYWNlKG5ldyBSZWdFeHAoJyYoW147XSspOycsICdnbScpLCAobWF0Y2gsIGVudGl0eSkgPT4gZW50aXRpZXNbZW50aXR5XSB8fCBtYXRjaCk7Cn0KCmV4cG9ydCBmdW5jdGlvbiB1Y2ZpcnN0KHN0cikgewogIGlmKCFpc1N0cmluZyhzdHIpKSBzdHIgPSBzdHIgKyAnJzsKICByZXR1cm4gc3RyLnN1YnN0cmluZygwLCAxKS50b1VwcGVyQ2FzZSgpICsgc3RyLnN1YnN0cmluZygxKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIGxjZmlyc3Qoc3RyKSB7CiAgaWYoIWlzU3RyaW5nKHN0cikpIHN0ciA9IHN0ciArICcnOwogIHJldHVybiBzdHIuc3Vic3RyaW5nKDAsIDEpLnRvTG93ZXJDYXNlKCkgKyBzdHIuc3Vic3RyaW5nKDEpOwp9CgpleHBvcnQgZnVuY3Rpb24gY2FtZWxpemUoc3RyLCBkZWxpbSA9ICcnKSB7CiAgcmV0dXJuIHN0ci5yZXBsYWNlKC9eKFtBLVpdKXxbXHMtX10rKFx3KS9nLCAobWF0Y2gsIHAxLCBwMiwgb2Zmc2V0KSA9PiB7CiAgICBpZihwMikgcmV0dXJuIGRlbGltICsgcDIudG9VcHBlckNhc2UoKTsKICAgIHJldHVybiBwMS50b0xvd2VyQ2FzZSgpOwogIH0pOwp9CgpleHBvcnQgZnVuY3Rpb24gZGVjYW1lbGl6ZShzdHIsIGRlbGltID0gJy0nKSB7CiAgcmV0dXJuIC8uW0EtWl0vLnRlc3Qoc3RyKQogICAgPyBzdHIKICAgICAgICAucmVwbGFjZSgvKFthLXpcZF0pKFtBLVpdKS9nLCAnJDEnICsgZGVsaW0gKyAnJDInKQogICAgICAgIC5yZXBsYWNlKC8oW0EtWl0rKShbQS1aXVthLXpcZF0rKS9nLCAnJDEnICsgZGVsaW0gKyAnJDInKQogICAgICAgIC50b0xvd2VyQ2FzZSgpCiAgICA6IHN0cjsKfQoKZXhwb3J0IGZ1bmN0aW9uIHNob3J0ZW4oc3RyLCBtYXggPSA0MCwgc3VmZml4ID0gJy4uLicpIHsKICBtYXggPSArbWF4OwogIGlmKGlzTmFOKG1heCkpIG1heCA9IEluZmluaXR5OwogIGlmKEFycmF5LmlzQXJyYXkoc3RyKSkgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHN0ciwgMCwgTWF0aC5taW4oc3RyLmxlbmd0aCwgbWF4KSkuY29uY2F0KFtzdWZmaXhdKTsKICBpZighaXNTdHJpbmcoc3RyKSB8fCAhTnVtYmVyLmlzRmluaXRlKG1heCkgfHwgbWF4IDwgMCkgcmV0dXJuIHN0cjsKICBzdHIgPSAnJyArIHN0cjsKCiAgaWYoc3RyLmxlbmd0aCA+IG1heCkgewogICAgbGV0IG4gPSBNYXRoLmZsb29yKChtYXggLSAoMiArIHN1ZmZpeC5sZW5ndGgpKSAvIDIpOwogICAgbGV0IHRhaWwgPSBzdHIubGVuZ3RoIC0gbjsKICAgIGxldCBsZW4gPSBNYXRoLm1pbihuLCB0YWlsKTsKICAgIGxldCBpbnNlcnQgPSAnICcgKyBzdWZmaXggKyAnICcgKyAoc3RyLmxlbmd0aCAtIChsZW4gKyBuKSkgKyAnIGJ5dGVzICcgKyBzdWZmaXggKyAnICc7CgogICAgcmV0dXJuIHN0ci5zdWJzdHJpbmcoMCwgbGVuKSArIGluc2VydCArIHN0ci5zdWJzdHJpbmcodGFpbCk7CiAgfQogIHJldHVybiBzdHI7Cn0KCmV4cG9ydCBmdW5jdGlvbiogYnl0ZXNUb1VURjgoYnl0ZXMpIHsKICBpZihieXRlcyBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSBieXRlcyA9IG5ldyBVaW50OEFycmF5KGJ5dGVzKTsKICBsZXQgc3RhdGUgPSAwLAogICAgdmFsID0gMDsKICBmb3IoY29uc3QgYyBvZiBieXRlcykgewogICAgaWYoc3RhdGUgIT09IDAgJiYgYyA+PSAweDgwICYmIGMgPCAweGMwKSB7CiAgICAgIHZhbCA9ICh2YWwgPDwgNikgfCAoYyAmIDB4M2YpOwogICAgICBzdGF0ZS0tOwogICAgICBpZihzdGF0ZSA9PT0gMCkgeWllbGQgdmFsOwogICAgfSBlbHNlIGlmKGMgPj0gMHhjMCAmJiBjIDwgMHhmOCkgewogICAgICBzdGF0ZSA9IDEgKyAoYyA+PSAweGUwKSArIChjID49IDB4ZjApOwogICAgICB2YWwgPSBjICYgKCgxIDw8ICg2IC0gc3RhdGUpKSAtIDEpOwogICAgfSBlbHNlIHsKICAgICAgc3RhdGUgPSAwOwogICAgICB5aWVsZCBjOwogICAgfQogIH0KfQoKZXhwb3J0IGZ1bmN0aW9uIGNvZGVQb2ludHNUb1N0cmluZyhjb2RlUG9pbnRzKSB7CiAgbGV0IHMgPSAnJzsKICBmb3IobGV0IGMgb2YgY29kZVBvaW50cykgcyArPSBTdHJpbmcuZnJvbUNvZGVQb2ludChjKTsKICByZXR1cm4gczsKfQoKZXhwb3J0IGZ1bmN0aW9uIGJ1ZmZlclRvU3RyaW5nKGIpIHsKICByZXR1cm4gY29kZVBvaW50c1RvU3RyaW5nKGJ5dGVzVG9VVEY4KGIpKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIGFycmF5c0luQ29tbW9uKGEpIHsKICBsZXQgaSwKICAgIGMsCiAgICBuID0gYS5sZW5ndGgsCiAgICBtaW4gPSBJbmZpbml0eTsKICB3aGlsZShuKSB7CiAgICBpZihhWy0tbl0ubGVuZ3RoIDwgbWluKSB7CiAgICAgIG1pbiA9IGFbbl0ubGVuZ3RoOwogICAgICBpID0gbjsKICAgIH0KICB9CiAgYyA9IEFycmF5LmZyb20oYS5zcGxpY2UoaSwgMSlbMF0pOwogIHJldHVybiBjLmZpbHRlcigoaXRtLCBpbmR4KSA9PiB7CiAgICBpZihjLmluZGV4T2YoaXRtKSA9PSBpbmR4KSByZXR1cm4gYS5ldmVyeShhcnIgPT4gYXJyLmluZGV4T2YoaXRtKSAhPSAtMSk7CiAgfSk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBhcnJheUZhY2FkZShwcm90bywgaXRlbUZuID0gKGNvbnRhaW5lciwgaSkgPT4gY29udGFpbmVyLmF0KGkpKSB7CiAgcmV0dXJuIGRlZmluZShwcm90bywgewogICAgKltTeW1ib2wuaXRlcmF0b3JdKCkgewogICAgICBjb25zdCB7IGxlbmd0aCB9ID0gdGhpczsKICAgICAgZm9yKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB5aWVsZCBpdGVtRm4odGhpcywgaSk7CiAgICB9LAogICAgKmtleXMoKSB7CiAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSB0aGlzOwogICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHlpZWxkIGk7CiAgICB9LAogICAgKmVudHJpZXMoKSB7CiAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSB0aGlzOwogICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHlpZWxkIFtpLCBpdGVtRm4odGhpcywgaSldOwogICAgfSwKICAgICp2YWx1ZXMoKSB7CiAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSB0aGlzOwogICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHlpZWxkIGl0ZW1Gbih0aGlzLCBpKTsKICAgIH0sCiAgICBmb3JFYWNoKGNhbGxiYWNrLCB0aGlzQXJnKSB7CiAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSB0aGlzOwogICAgICBmb3IobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIGNhbGxiYWNrLmNhbGwodGhpc0FyZywgaXRlbUZuKHRoaXMsIGkpLCBpLCB0aGlzKTsKICAgIH0sCiAgICByZWR1Y2UoY2FsbGJhY2ssIGFjY3UsIHRoaXNBcmcpIHsKICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHRoaXM7CiAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgYWNjdSA9IGNhbGxiYWNrLmNhbGwodGhpc0FyZywgYWNjdSwgaXRlbUZuKHRoaXMsIGkpLCBpLCB0aGlzKTsKICAgICAgcmV0dXJuIGFjY3U7CiAgICB9CiAgfSk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBtb2QoYSwgYikgewogIHJldHVybiBpc051bWJlcihiKSA/ICgoYSAlIGIpICsgYikgJSBiIDogbiA9PiAoKG4gJSBhKSArIGEpICUgYTsKfQoKZXhwb3J0IGZ1bmN0aW9uIHB1c2hVbmlxdWUoYXJyLCAuLi5hcmdzKSB7CiAgbGV0IHJlamVjdCA9IFtdOwogIGZvcihsZXQgYXJnIG9mIGFyZ3MpCiAgICBpZihhcnIuaW5kZXhPZihhcmcpID09IC0xKSBhcnIucHVzaChhcmcpOwogICAgZWxzZSByZWplY3QucHVzaChhcmcpOwogIHJldHVybiByZWplY3Q7Cn0KCmV4cG9ydCBmdW5jdGlvbiBpbnNlcnRlcihkZXN0LCBuZXh0ID0gKGssIHYpID0+IHt9KSB7CiAgY29uc3QgaW5zZXJ0ID0KICAgIGlzRnVuY3Rpb24oZGVzdC5zZXQpICYmIGRlc3Quc2V0Lmxlbmd0aCA+PSAyCiAgICAgID8gKGssIHYpID0+IGRlc3Quc2V0KGssIHYpCiAgICAgIDogQXJyYXkuaXNBcnJheShkZXN0KQogICAgICA/IChrLCB2KSA9PiBkZXN0LnB1c2goW2ssIHZdKQogICAgICA6IChrLCB2KSA9PiAoZGVzdFtrXSA9IHYpOwogIGxldCBmbjsKICBmbiA9IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKICAgIGluc2VydChrZXksIHZhbHVlKTsKICAgIG5leHQoa2V5LCB2YWx1ZSk7CiAgICByZXR1cm4gZm47CiAgfTsKICBmbi5kZXN0ID0gZGVzdDsKICBmbi5pbnNlcnQgPSBpbnNlcnQ7CiAgcmV0dXJuIGZuOwp9CgpleHBvcnQgZnVuY3Rpb24gaW50ZXJzZWN0KGEsIGIpIHsKICBpZighQXJyYXkuaXNBcnJheShhKSkgYSA9IFsuLi5hXTsKICByZXR1cm4gYS5maWx0ZXIoU2V0LnByb3RvdHlwZS5oYXMsIG5ldyBTZXQoYikpOwp9CgpleHBvcnQgZnVuY3Rpb24gc3ltbWV0cmljRGlmZmVyZW5jZShhLCBiKSB7CiAgcmV0dXJuIFtdLmNvbmNhdCguLi5kaWZmZXJlbmNlKGEsIGIpKTsKfQoKZXhwb3J0IGZ1bmN0aW9uKiBwYXJ0aXRpb25BcnJheShhLCBzaXplKSB7CiAgZm9yKGxldCBpID0gMDsgaSA8IGEubGVuZ3RoOyBpICs9IHNpemUpIHlpZWxkIGEuc2xpY2UoaSwgaSArIHNpemUpOwp9CgpleHBvcnQgZnVuY3Rpb24gZGlmZmVyZW5jZShhLCBiLCBpbmNsdWRlcykgewogIGlmKCFBcnJheS5pc0FycmF5KGEpKSBhID0gWy4uLmFdOwogIGlmKCFBcnJheS5pc0FycmF5KGIpKSBiID0gWy4uLmJdOwoKICBpZighaXNGdW5jdGlvbihpbmNsdWRlcykpIHJldHVybiBbYS5maWx0ZXIoeCA9PiAhYi5pbmNsdWRlcyh4KSksIGIuZmlsdGVyKHggPT4gIWEuaW5jbHVkZXMoeCkpXTsKCiAgcmV0dXJuIFthLmZpbHRlcih4ID0+ICFpbmNsdWRlcyhiLCB4KSksIGIuZmlsdGVyKHggPT4gIWluY2x1ZGVzKGEsIHgpKV07Cn0KCmV4cG9ydCBmdW5jdGlvbiBpbnRlcnNlY3Rpb24oYSwgYikgewogIGlmKCEoYSBpbnN0YW5jZW9mIFNldCkpIGEgPSBuZXcgU2V0KGEpOwogIGlmKCEoYiBpbnN0YW5jZW9mIFNldCkpIGIgPSBuZXcgU2V0KGIpOwogIGxldCBpbnRlcnNlY3Rpb24gPSBuZXcgU2V0KFsuLi5hXS5maWx0ZXIoeCA9PiBiLmhhcyh4KSkpOwogIHJldHVybiBBcnJheS5mcm9tKGludGVyc2VjdGlvbik7Cn0KCmV4cG9ydCBmdW5jdGlvbiB1bmlvbihhLCBiLCBlcXVhbGl0eSkgewogIGlmKGVxdWFsaXR5ID09PSB1bmRlZmluZWQpIHJldHVybiBbLi4ubmV3IFNldChbLi4uYSwgLi4uYl0pXTsKCiAgcmV0dXJuIHVuaXF1ZShbLi4uYSwgLi4uYl0sIGVxdWFsaXR5KTsKfQoKLyoqCiAqIGFjY2VwdHMgYXJyYXkgYW5kIGZ1bmN0aW9uIHJldHVybmluZyBgdHJ1ZWAgb3IgYGZhbHNlYCBmb3IgZWFjaCBlbGVtZW50CiAqCiAqIEBwYXJhbSAge1t0eXBlXX0gICBhcnJheSAgICBbZGVzY3JpcHRpb25dCiAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYWxsYmFjayBbZGVzY3JpcHRpb25dCiAqIEByZXR1cm4ge1t0eXBlXX0gICAgICAgICAgICBbZGVzY3JpcHRpb25dCiAqLwpleHBvcnQgZnVuY3Rpb24gcGFydGl0aW9uKGFycmF5LCBjYWxsYmFjaykgewogIGNvbnN0IG1hdGNoZXMgPSBbXSwKICAgIG5vbk1hdGNoZXMgPSBbXTsKCiAgLy8gcHVzaCBlYWNoIGVsZW1lbnQgaW50byBhcnJheSBkZXBlbmRpbmcgb24gcmV0dXJuIHZhbHVlIG9mIGBjYWxsYmFja2AKICBmb3IobGV0IGVsZW1lbnQgb2YgYXJyYXkpIChjYWxsYmFjayhlbGVtZW50KSA/IG1hdGNoZXMgOiBub25NYXRjaGVzKS5wdXNoKGVsZW1lbnQpOwoKICByZXR1cm4gW21hdGNoZXMsIG5vbk1hdGNoZXNdOwp9CgpleHBvcnQgZnVuY3Rpb24gcHVzaChvYmosIC4uLnZhbHVlcykgewogIGFzc2VydChpc09iamVjdChvYmopKTsKICBpZihpc0Z1bmN0aW9uKG9iai5wdXNoKSkgewogICAgb2JqLnB1c2goLi4udmFsdWVzKTsKICB9IGVsc2UgaWYoaXNGdW5jdGlvbihvYmouYWRkKSkgewogICAgdmFsdWVzLmZvckVhY2godiA9PiBvYmouYWRkKHYpKTsKICB9IGVsc2UgaWYodHlwZW9mIG9iai5sZW5ndGggPT0gJ251bWJlcicgJiYgKG9iai5sZW5ndGggPT09IDAgfHwgb2JqW29iai5sZW5ndGggLSAxXSAhPT0gdW5kZWZpbmVkKSkgewogICAgZm9yKGxldCBpdGVtIG9mIHZhbHVlcykgb2JqW29iai5sZW5ndGgrK10gPSBpdGVtOwogIH0gZWxzZSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoYERvbid0IGtub3cgaG93IHRvIHB1c2ggdmFsdWUgdG8gJHtjbGFzc05hbWUob2JqKX1gKTsKICB9CiAgcmV0dXJuIG9iajsKfQoKZXhwb3J0IGZ1bmN0aW9uIHJlcGVhdGVyKG4sIHdoYXQpIHsKICBpZihpc051bWJlcihuKSkgewogICAgbGV0IG1heCA9IG47CiAgICBuID0gKCkgPT4gLS1tYXggPj0gMDsKICB9CiAgaWYoaXNGdW5jdGlvbih3aGF0KSkKICAgIHJldHVybiAoZnVuY3Rpb24qICgpIHsKICAgICAgZm9yKGxldCBpID0gMDsgOyBpKyspIHsKICAgICAgICBsZXQgdmFsdWUgPSB3aGF0KCk7CiAgICAgICAgaWYoIW4odmFsdWUsIGkpKSBicmVhazsKICAgICAgICB5aWVsZCB2YWx1ZTsKICAgICAgfQogICAgfSkoKTsKICByZXR1cm4gKGZ1bmN0aW9uKiAoKSB7CiAgICBmb3IobGV0IGkgPSAwOyA7IGkrKykgewogICAgICBsZXQgdmFsdWUgPSB3aGF0OwogICAgICBpZighbih2YWx1ZSwgaSkpIGJyZWFrOwogICAgICB5aWVsZCB2YWx1ZTsKICAgIH0KICB9KSgpOwp9CgpleHBvcnQgZnVuY3Rpb24gcmVwZWF0KG4sIHdoYXQpIHsKICByZXR1cm4gcmVwZWF0ZXIobiwgd2hhdCk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBmdW5jdGlvbk5hbWUoZm4pIHsKICBpZihpc0Z1bmN0aW9uKGZuKSAmJiBpc1N0cmluZyhmbi5uYW1lKSkgcmV0dXJuIGZuLm5hbWU7CiAgdHJ5IHsKICAgIGNvbnN0IG1hdGNoZXMgPSAvZnVuY3Rpb25ccyooW14oXSopXCguKi9nLmV4ZWMoZm4gKyAnJyk7CiAgICBpZihtYXRjaGVzICYmIG1hdGNoZXNbMV0pIHJldHVybiBtYXRjaGVzWzFdOwogIH0gY2F0Y2gge30KICByZXR1cm4gbnVsbDsKfQoKZXhwb3J0IHsgZnVuY3Rpb25OYW1lIGFzIGZuTmFtZSB9OwoKZXhwb3J0IGZ1bmN0aW9uIGNsYXNzTmFtZShvYmopIHsKICBpZihpc09iamVjdChvYmopKSB7CiAgICBpZignY29uc3RydWN0b3InIGluIG9iaikgcmV0dXJuIGZ1bmN0aW9uTmFtZShvYmouY29uc3RydWN0b3IpOwogICAgaWYoU3ltYm9sLnRvU3RyaW5nVGFnIGluIG9iaikgcmV0dXJuIG9ialtTeW1ib2wudG9TdHJpbmdUYWddOwogIH0KICByZXR1cm4gbnVsbDsKfQoKZXhwb3J0IGNvbnN0IGlzQXJyb3dGdW5jdGlvbiA9IGZuID0+CiAgKGlzRnVuY3Rpb24oZm4pICYmICEoJ3Byb3RvdHlwZScgaW4gZm4pKSB8fCAvXCA9PlwgLy50ZXN0KCgnJyArIGZuKS5yZXBsYWNlKC9cbi4qL2csICcnKSk7CgovLyB0aW1lIGEgZ2l2ZW4gZnVuY3Rpb24KZXhwb3J0IGZ1bmN0aW9uIGluc3RydW1lbnQoCiAgZm4sCiAgbG9nID0gKGR1cmF0aW9uLCBuYW1lLCBhcmdzLCByZXQpID0+CiAgICBjb25zb2xlLmxvZygKICAgICAgYGZ1bmN0aW9uICcke25hbWV9J2AgKwogICAgICAgIChyZXQgIT09IHVuZGVmaW5lZCA/IGAgez0gJHtlc2NhcGUocmV0ICsgJycpLnN1YnN0cmluZygwLCAxMDApICsgJy4uLid9fWAgOiAnJykgKwogICAgICAgIGAgdGltaW5nOiAke2R1cmF0aW9uLnRvRml4ZWQoMyl9bXNgCiAgICApLAogIGxvZ0ludGVydmFsID0gMCAvLzEwMDAKKSB7CiAgLy8gY29uc3QgeyBub3csIGhydGltZSwgZnVuY3Rpb25OYW1lIH0gPSBVdGlsOwogIGxldCBsYXN0ID0gRGF0ZS5ub3coKTsKICBsZXQgZHVyYXRpb24gPSAwLAogICAgdGltZXMgPSAwOwogIGNvbnN0IG5hbWUgPSBmdW5jdGlvbk5hbWUoZm4pIHx8ICc8YW5vbnltb3VzPic7CiAgY29uc3QgYXN5bmNocm9ub3VzID0gaXNBc3luYyhmbikgfHwgaXNBc3luYyhub3cpOwogIGNvbnN0IGRvTG9nID0gYXN5bmNocm9ub3VzCiAgICA/IGFzeW5jIChhcmdzLCByZXQpID0+IHsKICAgICAgICBsZXQgdCA9IERhdGUubm93KCk7CiAgICAgICAgaWYodCAtIChhd2FpdCBsYXN0KSA+PSBsb2dJbnRlcnZhbCkgewogICAgICAgICAgbG9nKGR1cmF0aW9uIC8gdGltZXMsIG5hbWUsIGFyZ3MsIHJldCk7CiAgICAgICAgICBkdXJhdGlvbiA9IHRpbWVzID0gMDsKICAgICAgICAgIGxhc3QgPSB0OwogICAgICAgIH0KICAgICAgfQogICAgOiAoYXJncywgcmV0KSA9PiB7CiAgICAgICAgbGV0IHQgPSBEYXRlLm5vdygpOwogICAgICAgIC8vY29uc29sZS5sb2coJ2RvTG9nJywgeyBwYXNzZWQ6IHQgLSBsYXN0LCBsb2dJbnRlcnZhbCB9KTsKICAgICAgICBpZih0IC0gbGFzdCA+PSBsb2dJbnRlcnZhbCkgewogICAgICAgICAgbG9nKGR1cmF0aW9uIC8gdGltZXMsIG5hbWUsIGFyZ3MsIHJldCk7CiAgICAgICAgICBkdXJhdGlvbiA9IHRpbWVzID0gMDsKICAgICAgICAgIGxhc3QgPSB0OwogICAgICAgIH0KICAgICAgfTsKCiAgcmV0dXJuIGFzeW5jaHJvbm91cwogICAgPyBhc3luYyBmdW5jdGlvbiguLi5hcmdzKSB7CiAgICAgICAgY29uc3Qgc3RhcnQgPSBEYXRlLm5vdygpOwogICAgICAgIGxldCByZXQgPSBhd2FpdCBmbi5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgICBkdXJhdGlvbiArPSBEYXRlLm5vdygpIC0gc3RhcnQ7CiAgICAgICAgdGltZXMrKzsKICAgICAgICBhd2FpdCBkb0xvZyhhcmdzLCByZXQpOwogICAgICAgIHJldHVybiByZXQ7CiAgICAgIH0KICAgIDogZnVuY3Rpb24oLi4uYXJncykgewogICAgICAgIGNvbnN0IHN0YXJ0ID0gRGF0ZS5ub3coKTsKICAgICAgICBsZXQgcmV0ID0gZm4uYXBwbHkodGhpcywgYXJncyk7CiAgICAgICAgZHVyYXRpb24gKz0gRGF0ZS5ub3coKSAtIHN0YXJ0OwogICAgICAgIHRpbWVzKys7CiAgICAgICAgZG9Mb2coYXJncywgcmV0KTsKICAgICAgICByZXR1cm4gcmV0OwogICAgICB9Owp9CgpleHBvcnQgY29uc3QgaGFzaCA9IChuZXdNYXAgPSAoKSA9PiBuZXcgTWFwKCkpID0+IHsKICBsZXQgbWFwID0gbmV3TWFwKCk7CiAgbGV0IGNhY2hlID0gbWVtb2l6ZSgoLi4uYXJncykgPT4gZ2V0dGVyc2V0dGVyKG5ld01hcCguLi5hcmdzKSksIG5ldyBNYXAoKSk7CgogIC8vIGxldCBbZ2V0LCBzZXRdID0gZ2V0c2V0KGNhY2hlKTsKCiAgcmV0dXJuIHsKICAgIGdldChwYXRoKSB7CiAgICAgIGxldCBpID0gMCwKICAgICAgICBvYmogPSBtYXA7CiAgICAgIGZvcihsZXQgcGFydCBvZiBwYXRoKSB7CiAgICAgICAgbGV0IGNhY2hlZm4gPSBjYWNoZShvYmopID8/IGdldHRlcihvYmopOwogICAgICAgIGNvbnNvbGUubG9nKCdjYWNoZScsIHsgaSwgY2FjaGUgfSk7CiAgICAgICAgb2JqID0gY2FjaGVmbihwYXJ0KTsKICAgICAgICBjb25zb2xlLmxvZygnY2FjaGVmbicsIHsgaSwgY2FjaGVmbiB9KTsKICAgICAgfQogICAgICByZXR1cm4gb2JqOwogICAgfSwKICAgIHNldChwYXRoLCB2YWx1ZSkgewogICAgICBsZXQgaSA9IDAsCiAgICAgICAgb2JqID0gbWFwOwogICAgICBsZXQga2V5ID0gcGF0aC5wb3AoKTsKCiAgICAgIGZvcihsZXQgcGFydCBvZiBwYXRoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ2NhY2hlJywgeyBwYXJ0LCBvYmogfSk7CiAgICAgICAgbGV0IGNhY2hlZm4gPSBjYWNoZShvYmoucmVjZWl2ZXIgPz8gb2JqKTsKICAgICAgICBjb25zb2xlLmxvZygnY2FjaGVmbicsIHsgaSwgY2FjaGVmbiB9KTsKICAgICAgICBvYmogPSBjYWNoZWZuKHBhcnQpID8/IChjYWNoZWZuKHBhcnQsIGdldHRlcnNldHRlcihuZXdNYXAoKSkpLCBjYWNoZWZuKHBhcnQpKTsKICAgICAgICBjb25zb2xlLmxvZygnY2FjaGVmbicsIHsgb2JqIH0pOwogICAgICB9CiAgICAgIHJldHVybiBvYmooa2V5LCB2YWx1ZSk7CiAgICB9CiAgfTsKfTsKCmV4cG9ydCBjb25zdCBjYXRjaGFibGUgPSBmdW5jdGlvbiBDYXRjaGFibGUoc2VsZikgewogIGFzc2VydChpc0Z1bmN0aW9uKHNlbGYpKTsKCiAgaWYoIShzZWxmIGluc3RhbmNlb2YgY2F0Y2hhYmxlKSkgT2JqZWN0LnNldFByb3RvdHlwZU9mKHNlbGYsIGNhdGNoYWJsZS5wcm90b3R5cGUpOwogIGlmKCdjb25zdHJ1Y3RvcicgaW4gc2VsZikgc2VsZi5jb25zdHJ1Y3RvciA9IGNhdGNoYWJsZTsKCiAgcmV0dXJuIHNlbGY7Cn07CgpPYmplY3QuYXNzaWduKGNhdGNoYWJsZSwgewogIFtTeW1ib2wuc3BlY2llc106IGNhdGNoYWJsZSwKICBwcm90b3R5cGU6IE9iamVjdC5hc3NpZ24oZnVuY3Rpb24gKCkge30sIHsKICAgIHRoZW4oZm4pIHsKICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3JbU3ltYm9sLnNwZWNpZXNdKCguLi5hcmdzKSA9PiB7CiAgICAgICAgbGV0IHJlc3VsdDsKICAgICAgICB0cnkgewogICAgICAgICAgcmVzdWx0ID0gdGhpcyguLi5hcmdzKTsKICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHJldHVybiBmbihyZXN1bHQpOwogICAgICB9KTsKICAgIH0sCiAgICBjYXRjaChmbikgewogICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RvcltTeW1ib2wuc3BlY2llc10oKC4uLmFyZ3MpID0+IHsKICAgICAgICBsZXQgcmVzdWx0OwogICAgICAgIHRyeSB7CiAgICAgICAgICByZXN1bHQgPSB0aGlzKC4uLmFyZ3MpOwogICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgcmV0dXJuIGZuKGUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9KTsKICAgIH0KICB9KQp9KTsKCmV4cG9ydCBmdW5jdGlvbiBpc051bWVyaWModmFsdWUpIHsKICBmb3IobGV0IGYgb2YgW3YgPT4gK3YsIHBhcnNlSW50LCBwYXJzZUZsb2F0XSkgaWYoIWlzTmFOKGYodmFsdWUpKSkgcmV0dXJuIHRydWU7CiAgcmV0dXJuIGZhbHNlOwp9CgpleHBvcnQgZnVuY3Rpb24gaXNJbmRleCh2YWx1ZSkgewogIHJldHVybiAhaXNOYU4oK3ZhbHVlKSAmJiBNYXRoLmZsb29yKCt2YWx1ZSkgKyAnJyA9PSB2YWx1ZSArICcnOwp9CgpleHBvcnQgZnVuY3Rpb24gbnVtZXJpY0luZGV4KHZhbHVlKSB7CiAgcmV0dXJuIGlzSW5kZXgodmFsdWUpID8gK3ZhbHVlIDogdmFsdWU7Cn0KCmV4cG9ydCBmdW5jdGlvbiBoaXN0b2dyYW0oYXJyLCBvdXQgPSBuZXcgTWFwKCkpIHsKICBsZXQgW2dldCwgc2V0XSA9IGdldHNldChvdXQpOwoKICBjb25zdCBpbmNyID0ga2V5ID0+IHNldChrZXksIChnZXQoa2V5KSA/PyAwKSArIDEpOwogIGZvcihsZXQgaXRlbSBvZiBhcnIpIHsKICAgIGluY3IoaXRlbSk7CiAgfQogIHJldHVybiBvdXQ7Cn0KCmV4cG9ydCBmdW5jdGlvbiBwcm9wZXJ0eUxvb2t1cEhhbmRsZXJzKGhhbmRsZXIgPSBrZXkgPT4gbnVsbCkgewogIGxldCBoYW5kbGVycyA9IHsKICAgIGdldCh0YXJnZXQsIGtleSwgcmVjZWl2ZXIpIHsKICAgICAgcmV0dXJuIGhhbmRsZXIoa2V5KTsKICAgIH0KICB9OwogIGxldCB0bXAgPSBoYW5kbGVyKCk7CgogIGlmKCFpc1N0cmluZyh0bXApKQogICAgdHJ5IHsKICAgICAgbGV0IGEgPSBBcnJheS5pc0FycmF5KHRtcCkgPyB0bXAgOiBbLi4udG1wXTsKICAgICAgaWYoYSkKICAgICAgICBoYW5kbGVycy5vd25LZXlzID0gZnVuY3Rpb24odGFyZ2V0KSB7CiAgICAgICAgICByZXR1cm4gaGFuZGxlcigpOwogICAgICAgIH07CiAgICB9IGNhdGNoKGUpIHt9CgogIHJldHVybiBoYW5kbGVyczsKfQoKZXhwb3J0IGZ1bmN0aW9uIHByb3BlcnR5TG9va3VwKC4uLmFyZ3MpIHsKICBsZXQgW29iaiA9IHt9LCBoYW5kbGVyID0ga2V5ID0+IG51bGxdID0gYXJncy5sZW5ndGggPT0gMSA/IFt7fSwgLi4uYXJnc10gOiBhcmdzOwoKICByZXR1cm4gbmV3IFByb3h5KAogICAgb2JqLAogICAgcHJvcGVydHlMb29rdXBIYW5kbGVycyhmdW5jdGlvbiAoLi4uYXJncykgewogICAgICBpZihhcmdzLmxlbmd0aCA+PSAxICYmIGFyZ3NbMF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgIGxldCBba2V5XSA9IGFyZ3M7CiAgICAgICAgaWYoa2V5IGluIG9iaikgcmV0dXJuIG9ialtrZXldOwoKICAgICAgICByZXR1cm4gaGFuZGxlcihrZXkpOwogICAgICB9CiAgICAgIHJldHVybiBoYW5kbGVyKCk7CiAgICB9KQogICk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBhYmJyZXZpYXRlKHN0ciwgbWF4ID0gNDAsIHN1ZmZpeCA9ICcuLi4nKSB7CiAgbWF4ID0gK21heDsKICBpZihpc05hTihtYXgpKSBtYXggPSBJbmZpbml0eTsKICBpZihBcnJheS5pc0FycmF5KHN0cikpIHsKICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChzdHIsIDAsIE1hdGgubWluKHN0ci5sZW5ndGgsIG1heCkpLmNvbmNhdChbc3VmZml4XSk7CiAgfQogIGlmKCFpc1N0cmluZyhzdHIpIHx8ICFOdW1iZXIuaXNGaW5pdGUobWF4KSB8fCBtYXggPCAwKSByZXR1cm4gc3RyOwogIHN0ciA9ICcnICsgc3RyOwogIGlmKHN0ci5sZW5ndGggPiBtYXgpIHsKICAgIHJldHVybiBzdHIuc3Vic3RyaW5nKDAsIG1heCAtIHN1ZmZpeC5sZW5ndGgpICsgc3VmZml4OwogIH0KICByZXR1cm4gc3RyOwp9CgpleHBvcnQgZnVuY3Rpb24gdHJ5RnVuY3Rpb24oZm4sIHJlc29sdmUgPSBhID0+IGEsIHJlamVjdCA9ICgpID0+IG51bGwpIHsKICBpZighaXNGdW5jdGlvbihyZXNvbHZlKSkgewogICAgbGV0IHJ2YWwgPSByZXNvbHZlOwogICAgcmVzb2x2ZSA9ICgpID0+IHJ2YWw7CiAgfQogIGlmKCFpc0Z1bmN0aW9uKHJlamVjdCkpIHsKICAgIGxldCBjdmFsID0gcmVqZWN0OwogICAgcmVqZWN0ID0gKCkgPT4gY3ZhbDsKICB9CiAgcmV0dXJuIGlzQXN5bmMoZm4pCiAgICA/IGFzeW5jIGZ1bmN0aW9uKC4uLmFyZ3MpIHsKICAgICAgICBsZXQgcmV0OwogICAgICAgIHRyeSB7CiAgICAgICAgICByZXQgPSBhd2FpdCBmbiguLi5hcmdzKTsKICAgICAgICB9IGNhdGNoKGVycikgewogICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIsIC4uLmFyZ3MpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzb2x2ZShyZXQsIC4uLmFyZ3MpOwogICAgICB9CiAgICA6IGZ1bmN0aW9uKC4uLmFyZ3MpIHsKICAgICAgICBsZXQgcmV0OwogICAgICAgIHRyeSB7CiAgICAgICAgICByZXQgPSBmbiguLi5hcmdzKTsKICAgICAgICB9IGNhdGNoKGVycikgewogICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIsIC4uLmFyZ3MpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzb2x2ZShyZXQsIC4uLmFyZ3MpOwogICAgICB9Owp9CgpleHBvcnQgZnVuY3Rpb24gdHJ5Q2F0Y2goZm4sIHJlc29sdmUgPSBhID0+IGEsIHJlamVjdCA9ICgpID0+IG51bGwsIC4uLmFyZ3MpIHsKICBpZihpc0FzeW5jKGZuKSkKICAgIHJldHVybiBmbiguLi5hcmdzKQogICAgICAudGhlbihyZXNvbHZlKQogICAgICAuY2F0Y2gocmVqZWN0KTsKCiAgcmV0dXJuIHRyeUZ1bmN0aW9uKGZuLCByZXNvbHZlLCByZWplY3QpKC4uLmFyZ3MpOwp9CgpleHBvcnQgZnVuY3Rpb24gbWFwQWRhcHRlcihmbikgewogIGxldCByID0gewogICAgZ2V0KGtleSkgewogICAgICByZXR1cm4gZm4oa2V5KTsKICAgIH0sCiAgICBzZXQoa2V5LCB2YWx1ZSkgewogICAgICBmbihrZXksIHZhbHVlKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfTsKICBsZXQgdG1wID0gZm4oKTsKICBpZih0eXBlcy5pc0l0ZXJhYmxlKHRtcCkgfHwgdHlwZXMuaXNQcm9taXNlKHRtcCkpIHIua2V5cyA9ICgpID0+IGZuKCk7CgogIGlmKGZuW1N5bWJvbC5pdGVyYXRvcl0pIHIuZW50cmllcyA9IGZuW1N5bWJvbC5pdGVyYXRvcl07CiAgZWxzZSB7CiAgICBsZXQgZyA9IGZuKCk7CiAgICBpZih0eXBlcy5pc0l0ZXJhYmxlKGcpIHx8IHR5cGVzLmlzR2VuZXJhdG9yRnVuY3Rpb24oZykpIHIuZW50cmllcyA9ICgpID0+IGZuKCk7CiAgfQoKICByZXR1cm4gbWFwRnVuY3Rpb24ocik7Cn0KCi8qKgogKiBAcGFyYW0gQXJyYXkgICBmb3J3YXJkCiAqIEBwYXJhbSBBcnJheSAgIGJhY2t3YXJkCiAqCiAqIGNvbXBvbmVudDJwYXRoLCAgcGF0aDJlYWdsZSAgPT4gY29tcG9uZW50MmVhZ2xlCiAqICBlYWdsZTJwYXRoLCBwYXRoMmNvbXBvbmVudCA9PgogKi8KZXhwb3J0IGZ1bmN0aW9uIG1hcEZ1bmN0aW9uKG1hcCkgewogIGxldCBmbjsKICBmbiA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHsKICAgIGNvbnN0IFtrZXksIHZhbHVlXSA9IGFyZ3M7CiAgICBzd2l0Y2ggKGFyZ3MubGVuZ3RoKSB7CiAgICAgIGNhc2UgMDoKICAgICAgICByZXR1cm4gZm4ua2V5cygpOwogICAgICBjYXNlIDE6CiAgICAgICAgcmV0dXJuIGZuLmdldChrZXkpOwogICAgICBjYXNlIDI6CiAgICAgICAgcmV0dXJuIGZuLnNldChrZXksIHZhbHVlKTsKICAgIH0KICB9OwoKICBmbi5tYXAgPSAobSA9PiB7CiAgICB3aGlsZShpc0Z1bmN0aW9uKG0pICYmIG0ubWFwICE9PSB1bmRlZmluZWQpIG0gPSBtLm1hcDsKICAgIHJldHVybiBtOwogIH0pKG1hcCk7CgogIGlmKG1hcCBpbnN0YW5jZW9mIE1hcCB8fCAoaXNPYmplY3QobWFwKSAmJiBpc0Z1bmN0aW9uKG1hcC5nZXQpICYmIGlzRnVuY3Rpb24obWFwLnNldCkpKSB7CiAgICBmbi5zZXQgPSAoa2V5LCB2YWx1ZSkgPT4gKG1hcC5zZXQoa2V5LCB2YWx1ZSksIChrLCB2KSA9PiBmbihrLCB2KSk7CiAgICBmbi5nZXQgPSBrZXkgPT4gbWFwLmdldChrZXkpOwogIH0gZWxzZSBpZihtYXAgaW5zdGFuY2VvZiBDYWNoZSB8fCAoaXNPYmplY3QobWFwKSAmJiBpc0Z1bmN0aW9uKG1hcC5tYXRjaCkgJiYgaXNGdW5jdGlvbihtYXAucHV0KSkpIHsKICAgIGZuLnNldCA9IChrZXksIHZhbHVlKSA9PiAobWFwLnB1dChrZXksIHZhbHVlKSwgKGssIHYpID0+IGZuKGssIHYpKTsKICAgIGZuLmdldCA9IGtleSA9PiBtYXAubWF0Y2goa2V5KTsKICB9IGVsc2UgaWYoaXNPYmplY3QobWFwKSAmJiBpc0Z1bmN0aW9uKG1hcC5nZXRJdGVtKSAmJiBpc0Z1bmN0aW9uKG1hcC5zZXRJdGVtKSkgewogICAgZm4uc2V0ID0gKGtleSwgdmFsdWUpID0+IChtYXAuc2V0SXRlbShrZXksIHZhbHVlKSwgKGssIHYpID0+IGZuKGssIHYpKTsKICAgIGZuLmdldCA9IGtleSA9PiBtYXAuZ2V0SXRlbShrZXkpOwogIH0gZWxzZSB7CiAgICBmbi5zZXQgPSAoa2V5LCB2YWx1ZSkgPT4gKChtYXBba2V5XSA9IHZhbHVlKSwgKGssIHYpID0+IGZuKGssIHYpKTsKICAgIGZuLmdldCA9IGtleSA9PiBtYXBba2V5XTsKICB9CgogIGZuLnVwZGF0ZSA9IGZ1bmN0aW9uKGtleSwgZm4gPSAoaywgdikgPT4gdikgewogICAgbGV0IG9sZFZhbHVlID0gdGhpcy5nZXQoa2V5KTsKICAgIGxldCBuZXdWYWx1ZSA9IGZuKG9sZFZhbHVlLCBrZXkpOwogICAgaWYob2xkVmFsdWUgIT0gbmV3VmFsdWUpIHsKICAgICAgaWYobmV3VmFsdWUgPT09IHVuZGVmaW5lZCAmJiBpc0Z1bmN0aW9uKG1hcC5kZWxldGUpKSBtYXAuZGVsZXRlKGtleSk7CiAgICAgIGVsc2UgdGhpcy5zZXQoa2V5LCBuZXdWYWx1ZSk7CiAgICB9CiAgICByZXR1cm4gbmV3VmFsdWU7CiAgfTsKCiAgaWYoaXNGdW5jdGlvbihtYXAuZW50cmllcykpIHsKICAgIGZuLmVudHJpZXMgPSBmdW5jdGlvbiogKCkgewogICAgICBmb3IobGV0IFtrZXksIHZhbHVlXSBvZiBtYXAuZW50cmllcygpKSB5aWVsZCBba2V5LCB2YWx1ZV07CiAgICB9OwogICAgZm4udmFsdWVzID0gZnVuY3Rpb24qICgpIHsKICAgICAgZm9yKGxldCBba2V5LCB2YWx1ZV0gb2YgbWFwLmVudHJpZXMoKSkgeWllbGQgdmFsdWU7CiAgICB9OwogICAgZm4ua2V5cyA9IGZ1bmN0aW9uKiAoKSB7CiAgICAgIGZvcihsZXQgW2tleSwgdmFsdWVdIG9mIG1hcC5lbnRyaWVzKCkpIHlpZWxkIGtleTsKICAgIH07CiAgICBmbltTeW1ib2wuaXRlcmF0b3JdID0gZm4uZW50cmllczsKICAgIGZuW2luc3BlY3RTeW1ib2xdID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBuZXcgTWFwKHRoaXMubWFwKChba2V5LCB2YWx1ZV0pID0+IFtBcnJheS5pc0FycmF5KGtleSkgPyBrZXkuam9pbignLicpIDoga2V5LCB2YWx1ZV0pKTsKICAgIH07CiAgfSBlbHNlIGlmKGlzRnVuY3Rpb24obWFwLmtleXMpKSB7CiAgICBpZihpc0FzeW5jKG1hcC5rZXlzKSB8fCB0eXBlcy5pc1Byb21pc2UobWFwLmtleXMoKSkpIHsKICAgICAgZm4ua2V5cyA9IGFzeW5jICgpID0+IFsuLi4oYXdhaXQgbWFwLmtleXMoKSldOwoKICAgICAgZm4uZW50cmllcyA9IGFzeW5jICgpID0+IHsKICAgICAgICBsZXQgciA9IFtdOwogICAgICAgIGZvcihsZXQga2V5IG9mIGF3YWl0IGZuLmtleXMoKSkgci5wdXNoKFtrZXksIGF3YWl0IGZuLmdldChrZXkpXSk7CiAgICAgICAgcmV0dXJuIHI7CiAgICAgIH07CiAgICAgIGZuLnZhbHVlcyA9IGFzeW5jICgpID0+IHsKICAgICAgICBsZXQgciA9IFtdOwogICAgICAgIGZvcihsZXQga2V5IG9mIGF3YWl0IGZuLmtleXMoKSkgci5wdXNoKGF3YWl0IGZuLmdldChrZXkpKTsKICAgICAgICByZXR1cm4gcjsKICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIGZuLmtleXMgPSBmdW5jdGlvbiogKCkgewogICAgICAgIGZvcihsZXQga2V5IG9mIG1hcC5rZXlzKCkpIHlpZWxkIGtleTsKICAgICAgfTsKCiAgICAgIGZuLmVudHJpZXMgPSBmdW5jdGlvbiogKCkgewogICAgICAgIGZvcihsZXQga2V5IG9mIGZuLmtleXMoKSkgeWllbGQgW2tleSwgZm4oa2V5KV07CiAgICAgIH07CiAgICAgIGZuLnZhbHVlcyA9IGZ1bmN0aW9uKiAoKSB7CiAgICAgICAgZm9yKGxldCBrZXkgb2YgZm4ua2V5cygpKSB5aWVsZCBmbihrZXkpOwogICAgICB9OwogICAgfQogIH0KCiAgaWYoaXNGdW5jdGlvbihmbi5lbnRyaWVzKSkgewogICAgZm4uZmlsdGVyID0gZnVuY3Rpb24ocHJlZCkgewogICAgICByZXR1cm4gbWFwRnVuY3Rpb24oCiAgICAgICAgbmV3IE1hcCgKICAgICAgICAgIChmdW5jdGlvbiogKCkgewogICAgICAgICAgICBsZXQgaSA9IDA7CiAgICAgICAgICAgIGZvcihsZXQgW2tleSwgdmFsdWVdIG9mIGZuLmVudHJpZXMoKSkgaWYocHJlZChba2V5LCB2YWx1ZV0sIGkrKykpIHlpZWxkIFtrZXksIHZhbHVlXTsKICAgICAgICAgIH0pKCkKICAgICAgICApCiAgICAgICk7CiAgICB9OwogICAgZm4ubWFwID0gZnVuY3Rpb24odCkgewogICAgICByZXR1cm4gbWFwRnVuY3Rpb24oCiAgICAgICAgbmV3IE1hcCgKICAgICAgICAgIChmdW5jdGlvbiogKCkgewogICAgICAgICAgICBsZXQgaSA9IDA7CgogICAgICAgICAgICBmb3IobGV0IFtrZXksIHZhbHVlXSBvZiBmbi5lbnRyaWVzKCkpIHlpZWxkIHQoW2tleSwgdmFsdWVdLCBpKyspOwogICAgICAgICAgfSkoKQogICAgICAgICkKICAgICAgKTsKICAgIH07CiAgICBmbi5mb3JFYWNoID0gZnVuY3Rpb24oZm4pIHsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgZm9yKGxldCBba2V5LCB2YWx1ZV0gb2YgdGhpcy5lbnRyaWVzKCkpIGZuKFtrZXksIHZhbHVlXSwgaSsrKTsKICAgIH07CiAgfQogIGlmKGlzRnVuY3Rpb24obWFwLmRlbGV0ZSkpIGZuLmRlbGV0ZSA9IGtleSA9PiBtYXAuZGVsZXRlKGtleSk7CgogIGlmKGlzRnVuY3Rpb24obWFwLmhhcykpIGZuLmhhcyA9IGtleSA9PiBtYXAuaGFzKGtleSk7CiAgcmV0dXJuIGZuOwp9CgpleHBvcnQgZnVuY3Rpb24gbWFwV3JhcHBlcihtYXAsIHRvS2V5ID0ga2V5ID0+IGtleSwgZnJvbUtleSA9IGtleSA9PiBrZXkpIHsKICBsZXQgZm4gPSBtYXBGdW5jdGlvbihtYXApOwogIGZuLnNldCA9IChrZXksIHZhbHVlKSA9PiAobWFwLnNldCh0b0tleShrZXkpLCB2YWx1ZSksIChrLCB2KSA9PiBmbihrLCB2KSk7CiAgZm4uZ2V0ID0ga2V5ID0+IG1hcC5nZXQodG9LZXkoa2V5KSk7CiAgaWYoaXNGdW5jdGlvbihtYXAua2V5cykpIGZuLmtleXMgPSAoKSA9PiBbLi4ubWFwLmtleXMoKV0ubWFwKGZyb21LZXkpOwogIGlmKGlzRnVuY3Rpb24obWFwLmVudHJpZXMpKQogICAgZm4uZW50cmllcyA9IGZ1bmN0aW9uKiAoKSB7CiAgICAgIGZvcihsZXQgW2tleSwgdmFsdWVdIG9mIG1hcC5lbnRyaWVzKCkpIHlpZWxkIFtmcm9tS2V5KGtleSksIHZhbHVlXTsKICAgIH07CiAgaWYoaXNGdW5jdGlvbihtYXAudmFsdWVzKSkKICAgIGZuLnZhbHVlcyA9IGZ1bmN0aW9uKiAoKSB7CiAgICAgIGZvcihsZXQgdmFsdWUgb2YgbWFwLnZhbHVlcygpKSB5aWVsZCB2YWx1ZTsKICAgIH07CiAgaWYoaXNGdW5jdGlvbihtYXAuaGFzKSkgZm4uaGFzID0ga2V5ID0+IG1hcC5oYXModG9LZXkoa2V5KSk7CiAgaWYoaXNGdW5jdGlvbihtYXAuZGVsZXRlKSkgZm4uZGVsZXRlID0ga2V5ID0+IG1hcC5kZWxldGUodG9LZXkoa2V5KSk7CgogIGZuLm1hcCA9IChtID0+IHsKICAgIHdoaWxlKGlzRnVuY3Rpb24obSkgJiYgbS5tYXAgIT09IHVuZGVmaW5lZCkgbSA9IG0ubWFwOwogICAgcmV0dXJuIG07CiAgfSkobWFwKTsKCiAgcmV0dXJuIGZuOwp9CgpleHBvcnQgZnVuY3Rpb24gd2Vha01hcHBlcihjcmVhdGVGbiwgbWFwID0gbmV3IFdlYWtNYXAoKSwgaGl0Rm4pIHsKICBsZXQgc2VsZiA9IGZ1bmN0aW9uKG9iaiwgLi4uYXJncykgewogICAgbGV0IHJldDsKICAgIGlmKG1hcC5oYXMob2JqKSkgewogICAgICByZXQgPSBtYXAuZ2V0KG9iaik7CiAgICAgIGlmKGlzRnVuY3Rpb24oaGl0Rm4pKSBoaXRGbihvYmosIHJldCk7CiAgICB9IGVsc2UgewogICAgICByZXQgPSBjcmVhdGVGbihvYmosIC4uLmFyZ3MpOwogICAgICBtYXAuc2V0KG9iaiwgcmV0KTsKICAgIH0KICAgIHJldHVybiByZXQ7CiAgfTsKICBzZWxmLnNldCA9IChrLCB2KSA9PiBtYXAuc2V0KGssIHYpOwogIHNlbGYuZ2V0ID0gayA9PiBtYXAuZ2V0KGspOwogIHNlbGYubWFwID0gbWFwOwogIHJldHVybiBzZWxmOwp9CgpleHBvcnQgZnVuY3Rpb24gd3JhcEdlbmVyYXRvcihmbikgewogIHJldHVybiB0eXBlcy5pc0dlbmVyYXRvckZ1bmN0aW9uKGZuKQogICAgPyBmdW5jdGlvbiguLi5hcmdzKSB7CiAgICAgICAgcmV0dXJuIFsuLi5mbi5jYWxsKHRoaXMsIC4uLmFyZ3MpXTsKICAgICAgfQogICAgOiBmbjsKfQoKZXhwb3J0IGZ1bmN0aW9uIHdyYXBHZW5lcmF0b3JNZXRob2RzKG9iaikgewogIGZvcihsZXQgbmFtZSBvZiBrZXlzKG9iaiwgMSwgMCkpIGlmKGlzRnVuY3Rpb24ob2JqW25hbWVdKSkgb2JqW25hbWVdID0gd3JhcEdlbmVyYXRvcihvYmpbbmFtZV0pOwoKICByZXR1cm4gb2JqOwp9CgpleHBvcnQgZnVuY3Rpb24gaXNCcm93c2VyKCkgewogIGxldCByZXQgPSBmYWxzZTsKICB0cnlDYXRjaCgKICAgICgpID0+IHdpbmRvdywKICAgIHcgPT4gKGlzT2JqZWN0KHcpID8gKHJldCA9IHRydWUpIDogdW5kZWZpbmVkKSwKICAgICgpID0+IHt9CiAgKTsKICB0cnlDYXRjaCgKICAgICgpID0+IGRvY3VtZW50LAogICAgZCA9PiAoZCA9PSB3aW5kb3cuZG9jdW1lbnQgJiYgaXNPYmplY3QoZCkgPyAocmV0ID0gdHJ1ZSkgOiB1bmRlZmluZWQpLAogICAgKCkgPT4ge30KICApOwogIHJldHVybiByZXQ7Cn0KCmV4cG9ydCBmdW5jdGlvbiBzdGFydEludGVyYWN0aXZlKCkgewogIG9zLmtpbGwoZ2V0cGlkKCksIG9zLlNJR1VTUjEpOwp9CgpleHBvcnQgY29uc3QgbWF0Y2hBbGwgPSBjdXJyeShmdW5jdGlvbiogKHJlLCBzdHIpIHsKICBsZXQgbWF0Y2g7CiAgcmUgPSByZSBpbnN0YW5jZW9mIFJlZ0V4cCA/IHJlIDogbmV3IFJlZ0V4cChBcnJheS5pc0FycmF5KHJlKSA/ICcoJyArIHJlLmpvaW4oJ3wnKSArICcpJyA6IHJlLCAnZycpOwogIGRvIHsKICAgIGlmKChtYXRjaCA9IHJlLmV4ZWMoc3RyKSkpIHlpZWxkIG1hdGNoOwogIH0gd2hpbGUobWF0Y2ggIT0gbnVsbCk7Cn0pOwoKZXhwb3J0IGZ1bmN0aW9uIGluZGV4T2YoLi4uYXJncykgewogIGxldCBbb2JqLCB3aGF0LCBvZmZzZXRdID0gYXJnczsKCiAgY29uc3QgaGFzTWV0aG9kID0gdHlwZW9mIG9iaiA9PSAnc3RyaW5nJyB8fCAoaXNPYmplY3Qob2JqKSAmJiAnaW5kZXhPZicgaW4gb2JqKTsKICBjb25zdCBpc0FCID0gdHlwZXMuaXNBcnJheUJ1ZmZlcihvYmopIHx8IHR5cGVzLmlzVHlwZWRBcnJheShvYmopOwoKICBpZihhcmdzLmxlbmd0aCA9PSAxKSB7CiAgICBpZihoYXNNZXRob2QpIHJldHVybiBvYmouaW5kZXhPZi5iaW5kKG9iaik7CiAgICBpZihpc0FCKQogICAgICByZXR1cm4gKHdoYXQsIG9mZnNldCA9IDApID0+IHsKICAgICAgICBsZXQgciA9IHNlYXJjaEFycmF5QnVmZmVyKG9iaiwgd2hhdCwgb2Zmc2V0KTsKICAgICAgICByZXR1cm4gciA9PT0gbnVsbCA/IC0xIDogcjsKICAgICAgfTsKICAgIGlmKHR5cGVzLmlzQXJyYXlMaWtlKG9iaikpCiAgICAgIHJldHVybiAod2hhdCwgb2Zmc2V0ID0gMCkgPT4gewogICAgICAgIGxldCB7IGxlbmd0aCB9ID0gb2JqOwogICAgICAgIGZvcihsZXQgaSA9IG9mZnNldCA+PSAwID8gb2Zmc2V0IDogMDsgaSA8IGxlbmd0aDsgaSsrKSBpZihvYmpbaV0gPT09IHdoYXQpIHJldHVybiBpOwogICAgICAgIHJldHVybiAtMTsKICAgICAgfTsKICB9IGVsc2UgewogICAgaWYoaGFzTWV0aG9kKSByZXR1cm4gb2JqLmluZGV4T2Yod2hhdCwgb2Zmc2V0KTsKICAgIGlmKGlzQUIpIHsKICAgICAgbGV0IHIgPSBzZWFyY2hBcnJheUJ1ZmZlcihvYmosIHdoYXQsIG9mZnNldCk7CiAgICAgIHJldHVybiByID09PSBudWxsID8gLTEgOiByOwogICAgfQogICAgaWYodHlwZXMuaXNBcnJheUxpa2Uob2JqKSkgewogICAgICBsZXQgeyBsZW5ndGggfSA9IG9iajsKICAgICAgZm9yKGxldCBpID0gb2Zmc2V0ID49IDAgPyBvZmZzZXQgOiAwOyBpIDwgbGVuZ3RoOyBpKyspIGlmKG9ialtpXSA9PT0gd2hhdCkgcmV0dXJuIGk7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICB9Cn0KCmV4cG9ydCBmdW5jdGlvbiogc2VhcmNoQWxsKGhheXN0YWNrLCBuZWVkbGUsIG9mZnNldCA9IDApIHsKICBsZXQgciwKICAgIGkgPSBvZmZzZXQ7CiAgY29uc3QgYSA9IGkuY29uc3RydWN0b3IoMSksCiAgICBmbiA9IGluZGV4T2YoaGF5c3RhY2spOwogIHdoaWxlKChyID0gZm4obmVlZGxlLCBpKSkgIT0gLTEpIHsKICAgIHlpZWxkIHI7CiAgICBpID0gciArIGE7CiAgfQp9CgpleHBvcnQgZnVuY3Rpb24gYmluZFByb3BlcnRpZXMob2JqLCB0YXJnZXQsIHByb3BzLCBnZW4pIHsKICBpZihwcm9wcyBpbnN0YW5jZW9mIEFycmF5KSBwcm9wcyA9IE9iamVjdC5mcm9tRW50cmllcyhwcm9wcy5tYXAobmFtZSA9PiBbbmFtZSwgbmFtZV0pKTsKICBjb25zdCBbcHJvcE1hcCwgcHJvcE5hbWVzXSA9IEFycmF5LmlzQXJyYXkocHJvcHMpCiAgICA/IFtwcm9wcy5yZWR1Y2UoKGFjYywgbmFtZSkgPT4gKHsgLi4uYWNjLCBbbmFtZV06IG5hbWUgfSksIHt9KSwgcHJvcHNdCiAgICA6IFtwcm9wcywgT2JqZWN0LmtleXMocHJvcHMpXTsKICBnZW4gPz89IHAgPT4gdiA9PiB2ID09PSB1bmRlZmluZWQgPyB0YXJnZXRbcHJvcE1hcFtwXV0gOiAodGFyZ2V0W3Byb3BNYXBbcF1dID0gdik7CiAgY29uc3QgcHJvcEdldFNldCA9IHByb3BOYW1lcwogICAgLm1hcChrID0+IFtrLCBwcm9wTWFwW2tdXSkKICAgIC5yZWR1Y2UoCiAgICAgIChhLCBbaywgdl0pID0+ICh7CiAgICAgICAgLi4uYSwKICAgICAgICBba106IGlzRnVuY3Rpb24odikKICAgICAgICAgID8gKC4uLmFyZ3MpID0+IHYuY2FsbCh0YXJnZXQsIGssIC4uLmFyZ3MpCiAgICAgICAgICA6IChnZW4gJiYgZ2VuKGspKSB8fCAoKC4uLmFyZ3MpID0+IChhcmdzLmxlbmd0aCA+IDAgPyAodGFyZ2V0W2tdID0gYXJnc1swXSkgOiB0YXJnZXRba10pKQogICAgICB9KSwKICAgICAge30KICAgICk7CiAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoCiAgICBvYmosCiAgICBwcm9wTmFtZXMucmVkdWNlKAogICAgICAoYSwgaykgPT4gewogICAgICAgIGNvbnN0IHByb3AgPSBwcm9wc1trXTsKICAgICAgICBjb25zdCBnZXRfc2V0ID0gcHJvcEdldFNldFtrXTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgLi4uYSwKICAgICAgICAgIFtrXTogewogICAgICAgICAgICBnZXQ6IGdldF9zZXQsCiAgICAgICAgICAgIHNldDogZ2V0X3NldCwKICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZQogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0sCiAgICAgIHsKICAgICAgICBfX2dldHRlcl9zZXR0ZXJfXzogeyB2YWx1ZTogZ2VuLCBlbnVtZXJhYmxlOiBmYWxzZSB9LAogICAgICAgIF9fYm91bmRfdGFyZ2V0X186IHsgdmFsdWU6IHRhcmdldCwgZW51bWVyYWJsZTogZmFsc2UgfQogICAgICB9CiAgICApCiAgKTsKICByZXR1cm4gb2JqOwp9CgpleHBvcnQgZnVuY3Rpb24gcHJlZGljYXRlKGZuX29yX3JlZ2V4LCBwcmVkKSB7CiAgbGV0IGZuID0gZm5fb3JfcmVnZXg7CiAgaWYodHlwZW9mIGZuX29yX3JlZ2V4ID09ICdzdHJpbmcnKSBmbl9vcl9yZWdleCA9IG5ldyBSZWdFeHAoJ14nICsgZm5fb3JfcmVnZXggKyAnJCcpOwogIGlmKGlzT2JqZWN0KGZuX29yX3JlZ2V4KSAmJiBmbl9vcl9yZWdleCBpbnN0YW5jZW9mIFJlZ0V4cCkgewogICAgZm4gPSBhcmcgPT4gZm5fb3JfcmVnZXgudGVzdChhcmcgKyAnJyk7CiAgICBmbi52YWx1ZU9mID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBmbl9vcl9yZWdleDsKICAgIH07CiAgfQogIGlmKGlzRnVuY3Rpb24ocHJlZCkpIHJldHVybiBhcmcgPT4gcHJlZChhcmcsIGZuKTsKICByZXR1cm4gZm47Cn0KCmV4cG9ydCBjb25zdCBhbnNpU3R5bGVzID0gZ2V0QW5zaVN0eWxlcygpOwoKZXhwb3J0IGNvbnN0IGluc3BlY3RTeW1ib2wgPSBTeW1ib2wuZm9yKCdxdWlja2pzLmluc3BlY3QuY3VzdG9tJyk7CgpleHBvcnQgeyBleHRlbmRBcnJheSwgQXJyYXlFeHRlbnNpb25zIH0gZnJvbSAnLi9leHRlbmRBcnJheS5qcyc7CmV4cG9ydCB7IGV4dGVuZEdlbmVyYXRvciwgR2VuZXJhdG9yRXh0ZW5zaW9ucyB9IGZyb20gJy4vZXh0ZW5kR2VuZXJhdG9yLmpzJzsKZXhwb3J0IHsgZXh0ZW5kQXN5bmNHZW5lcmF0b3IsIEFzeW5jR2VuZXJhdG9yRXh0ZW5zaW9ucyB9IGZyb20gJy4vZXh0ZW5kQXN5bmNHZW5lcmF0b3IuanMnOwoKZXhwb3J0ICogZnJvbSAnbWlzYyc7CgAAAAAAAAAAfvcAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/"
				]
			]
		},
		{
			"file": "quickjs/qjs-modules/quickjs-misc.c",
			"settings":
			{
				"buffer_size": 73446,
				"line_ending": "Unix"
			}
		},
		{
			"file": "quickjs/qjs-modules/resolve-imports.js",
			"settings":
			{
				"buffer_size": 54817,
				"encoding": "UTF-8",
				"line_ending": "Unix"
			},
			"undo_stack":
			[
				[
					1,
					1,
					"revert",
					null,
					"AgAAAAAAAAAAAAAAAAAAAAAAAAAz1gAAIyEvdXNyL2Jpbi9lbnYgcWpzbQppbXBvcnQgKiBhcyBvcyBmcm9tICdvcyc7CmltcG9ydCAqIGFzIHN0ZCBmcm9tICdzdGQnOwppbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7CmltcG9ydCBpbnNwZWN0IGZyb20gJ2luc3BlY3QnOwppbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnOwppbXBvcnQgeyBMZXhlciwgVG9rZW4gfSBmcm9tICdsZXhlcic7CmltcG9ydCB7IENvbnNvbGUgfSBmcm9tICdjb25zb2xlJzsKaW1wb3J0IEVDTUFTY3JpcHRMZXhlciBmcm9tICdsaWIvbGV4ZXIvZWNtYXNjcmlwdC5qcyc7CmltcG9ydCB7IG1hcFdyYXBwZXIsIGludGVyc2VjdGlvbiwgZGlmZmVyZW5jZSwgc3ltbWV0cmljRGlmZmVyZW5jZSwgdW5pb24sIGVycm9yLCBnZXRzZXQsIG1lbW9pemUsIHJhbmRJbnQsIGdldFR5cGVOYW1lLCBnZXRUeXBlU3RyLCBpc09iamVjdCwgc2hvcnRlbiwgdG9TdHJpbmcsIHRvQXJyYXlCdWZmZXIsIGRlZmluZSwgY3VycnksIHVuaXF1ZSwgc3BsaXQsIGV4dGVuZEFycmF5LCBjYW1lbGl6ZSwgZ2V0T3B0LCBxdW90ZSwgZXNjYXBlLCB0eXBlcywgcGFkU3RhcnRBbnNpIH0gZnJvbSAndXRpbCc7CgooJ3VzZSBzdHJpY3QnKTsKKCd1c2UgbWF0aCcpOwoKY29uc3QgaW5zcGVjdFN5bWJvbCA9IFN5bWJvbC5mb3IoJ3F1aWNranMuaW5zcGVjdC5jdXN0b20nKTsKCmNsYXNzIEFyZ3VtZW50RXJyb3IgZXh0ZW5kcyBFcnJvciB7CiAgY29uc3RydWN0b3IoLi4uYXJncykgewogICAgc3VwZXIoLi4uYXJncyk7CiAgICB0aGlzLnN0YWNrID0gbnVsbDsKICB9Cn0KCmxldCBidWZmZXJzID0ge30sCiAgbW9kdWxlcyA9IHt9LAogIHNob3dUaW1pbmcsCiAgcmVtb3ZlRXhwb3J0cyA9IGZhbHNlLAogIG9ubHlJbXBvcnRzID0gZmFsc2UsCiAgZ2xvYmFsRXhwb3J0cyA9IDAsCiAgc2hvd0RlcHMgPSAwLAogIHJlbW92ZUltcG9ydHMgPSBmYWxzZSwKICByZW1vdmVDb21tZW50cyA9IGZhbHNlLAogIHJlYWRQYWNrYWdlID0gZmFsc2UsCiAgdXNlclNjcmlwdCA9IGZhbHNlLAogIHJlbGF0aXZlVG8sCiAgb3V0cHV0RmlsZSwKICByZWN1cnNpdmUsCiAgZGVidWcgPSAwLAogIHByb2Nlc3NlZCA9IG5ldyBTZXQoKSwKICBidWZmZXJSZWYgPSBuZXcgV2Vha01hcCgpLAogIGZpbGVCdWZmZXJzID0gbmV3IE1hcCgpLAogIGZpbGVNYXBzID0gbmV3IE1hcCgpLAogIGRlcGVuZGVuY3lNYXAgPSBuZXcgTWFwKCksCiAgcHJpbnRGaWxlcywKICBxdWlldCA9IGZhbHNlLAogIGltcG9ydHNGb3IgPSB7fSwKICBsb2dGaWxlID0gKCkgPT4ge30sCiAgbG9nID0gKCkgPT4ge30sCiAgZ2xvYmFsSW1wb3J0cyA9IHt9OwoKT2JqZWN0LmFzc2lnbihnbG9iYWxUaGlzLCB7CiAgYnVmZmVycywKICBmaWxlQnVmZmVycywKICBmaWxlTWFwcywKICBtb2R1bGVzLAogIEltcG9ydGVkQnksCiAgaW1wb3J0c0ZvciwKICBnbG9iYWxJbXBvcnRzLAogIGFsbEltcG9ydHMoKSB7CiAgICBsZXQgciA9IFtdOwogICAgZm9yKGxldCBzb3VyY2UgaW4gaW1wb3J0c0ZvcikgewogICAgICBsZXQgaW1wb3J0cyA9IGltcG9ydHNGb3Jbc291cmNlXTsKICAgICAgci5wdXNoKC4uLmltcG9ydHMpOwogICAgfQogICAgcmV0dXJuIFsuLi5uZXcgU2V0KHIpXTsKICB9Cn0pOwoKbGV0IGhlYWRlciA9IFtdLAogIGZvb3RlciA9IFtdOwoKbGV0IGRlcGVuZGVuY3lUcmVlID0gbWVtb2l6ZShhcmcgPT4gW10sIGRlcGVuZGVuY3lNYXApOwpsZXQgYnVmZmVyTWFwID0gZ2V0c2V0KGJ1ZmZlclJlZik7CmxldCBpZGVudGlmaWVyc1VzZWQ7CgpmdW5jdGlvbiBSZWFkSlNPTihmaWxlbmFtZSkgewogIGxldCBkYXRhID0gZnMucmVhZEZpbGVTeW5jKGZpbGVuYW1lLCAndXRmLTgnKTsKICByZXR1cm4gZGF0YSA/IEpTT04ucGFyc2UoZGF0YSkgOiBudWxsOwp9Cgpjb25zdCBSZWFkUGFja2FnZUpTT04gPSBtZW1vaXplKCgpID0+IFJlYWRKU09OKCdwYWNrYWdlLmpzb24nKSA/PyB7IF9tb2R1bGVBbGlhc2VzOiB7fSB9KTsKCmZ1bmN0aW9uIEltcG9ydGVkQnkoaW1wb3J0RmlsZSkgewogIGxldCByID0gW107CiAgZm9yKGxldCBzb3VyY2UgaW4gaW1wb3J0c0ZvcikgewogICAgbGV0IGltcG9ydHMgPSBpbXBvcnRzRm9yW3NvdXJjZV07CgogICAgaWYoaW1wb3J0cy5jb250YWlucyhpbXBvcnRGaWxlKSkgci5wdXNoKHNvdXJjZSk7CiAgfQogIHJldHVybiByOwp9CgpmdW5jdGlvbiBSZXNvbHZlQWxpYXMoZmlsZW5hbWUpIHsKICBpZih0eXBlb2YgZmlsZW5hbWUgPT0gJ3N0cmluZycpIHsKICAgIGxldCBrZXkgPSBwYXRoLm5vcm1hbGl6ZShmaWxlbmFtZSk7CiAgICBsZXQgeyBfbW9kdWxlQWxpYXNlcyB9ID0gUmVhZFBhY2thZ2VKU09OKCk7CgogICAgaWYoa2V5IGluIF9tb2R1bGVBbGlhc2VzKSByZXR1cm4gX21vZHVsZUFsaWFzZXNba2V5XTsKICB9CiAgcmV0dXJuIGZpbGVuYW1lOwp9CgpmdW5jdGlvbiBJc0ZpbGVJbXBvcnQoZmlsZW5hbWUpIHsKICBpZihyZWFkUGFja2FnZSkgZmlsZW5hbWUgPSBSZXNvbHZlQWxpYXMoZmlsZW5hbWUpOwogIGlmKC9cLnxcLy8udGVzdChmaWxlbmFtZSkpIHJldHVybiBmaWxlbmFtZTsKfQoKZnVuY3Rpb24gTm9ybWFsaXplUGF0aChwKSB7CiAgcCA9IHBhdGguYWJzb2x1dGUocCk7CiAgcCA9IHBhdGguY29sbGFwc2UocCk7CiAgcCA9IHBhdGgucmVsYXRpdmUocGF0aC5nZXRjd2QoKSwgcCk7CiAgcCA9IHBhdGgubm9ybWFsaXplKHApOwogIGlmKCFwYXRoLmlzQWJzb2x1dGUocCkpIGlmICghcC5zdGFydHNXaXRoKCcuLycpICYmICFwLnN0YXJ0c1dpdGgoJy4uLycpICYmIHAgIT0gJy4uJykgcCA9ICcuLycgKyBwOwogIHJldHVybiBwOwp9Cgpjb25zdCBGaWxlQmFubmVyQ29tbWVudCA9IChmaWxlbmFtZSwgaSkgPT4gewogIGxldCBzID0gJyc7CiAgcyArPSBgICR7aSA/ICdlbmQnIDogJ3N0YXJ0J30gb2YgJyR7LypwYXRoLmJhc2VuYW1lKi8gZmlsZW5hbWV9JyBgOwogIGxldCBuID0gTWF0aC5tYXgoMCwgTWF0aC5mbG9vcigoODAgLSA2IC0gcy5sZW5ndGgpIC8gMikpOwogIHMgPSAnLyogJyArICctJy5yZXBlYXQobikgKyBzOwogIHMgKz0gJy0nLnJlcGVhdChNYXRoLm1heCgwLCA4MCAtIDMgLSBzLmxlbmd0aCkpICsgJyAqLyc7CiAgaWYoaSA9PSAwKSBzID0gJ1xuJyArIHMgKyAnXG4nOwogIGVsc2UgcyA9IHMgKyAnXG4nOwogIHJldHVybiBzOwp9OwoKZXh0ZW5kQXJyYXkoQXJyYXkucHJvdG90eXBlKTsKCmNvbnN0IElzQnVpbHRpbiA9IG1vZHVsZU5hbWUgPT4gL15bXlwvLl0rJC8udGVzdChtb2R1bGVOYW1lKTsKY29uc3QgY29tcGFjdCA9IChuLCBtb3JlID0ge30pID0+CiAgY29uc29sZS5jb25maWcoewogICAgY29tcGFjdDogbiwKICAgIG1heEFycmF5TGVuZ3RoOiAxMDAsCiAgICAuLi5tb3JlCiAgfSk7CmNvbnN0IEFkZFVuaXF1ZSA9IChhcnIsIGl0ZW0pID0+IChhcnIuaW5kZXhPZihpdGVtKSA9PSAtMSA/IGFyci5wdXNoKGl0ZW0pIDogbnVsbCk7CmNvbnN0IEludFRvRFdvcmQgPSBpdmFsID0+IChpc05hTihpdmFsKSA9PT0gZmFsc2UgJiYgaXZhbCA8IDAgPyBpdmFsICsgNDI5NDk2NzI5NiA6IGl2YWwpOwpjb25zdCBJbnRUb0JpbmFyeSA9IGkgPT4gKGkgPT0gLTEgfHwgdHlwZW9mIGkgIT0gJ251bWJlcicgPyBpIDogJzBiJyArIEludFRvRFdvcmQoaSkudG9TdHJpbmcoMikpOwoKY29uc3QgV2hhdCA9IHsKICBJTVBPUlQ6IFN5bWJvbC5mb3IoJ2ltcG9ydCcpLAogIEVYUE9SVDogU3ltYm9sLmZvcignZXhwb3J0JykKfTsKCmNvbnN0IEltcG9ydFR5cGVzID0gewogIElNUE9SVDogMCwKICBJTVBPUlRfREVGQVVMVDogMSwKICBJTVBPUlRfTkFNRVNQQUNFOiAyCn07Cgpjb25zdCBJc09uZU9mID0gY3VycnkoKG4sIHZhbHVlKSA9PiAoQXJyYXkuaXNBcnJheShuKSA/IG4uc29tZShudW0gPT4gbnVtID09PSB2YWx1ZSkgOiBuID09PSB2YWx1ZSkpOwpjb25zdCBUb2tJcyA9IGN1cnJ5KCh0eXBlLCBsZXhlbWUsIHRvaykgPT4gewogIGlmKHRvayAhPSB1bmRlZmluZWQpIHsKICAgIGlmKGxleGVtZSAhPSB1bmRlZmluZWQpIGlmICh0eXBlb2YgbGV4ZW1lID09ICdzdHJpbmcnICYmICFJc09uZU9mKGxleGVtZSwgdG9rLmxleGVtZSkpIHJldHVybiBmYWxzZTsKICAgIGlmKHR5cGUgIT09IHVuZGVmaW5lZCkgewogICAgICBpZih0eXBlb2YgdHlwZSA9PSAnc3RyaW5nJyAmJiAhSXNPbmVPZih0eXBlLCB0b2sudHlwZSkpIHJldHVybiBmYWxzZTsKICAgICAgaWYodHlwZW9mIHR5cGUgPT0gJ251bWJlcicgJiYgIUlzT25lT2YodHlwZSwgdG9rLmlkKSkgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH0KfSk7CmNvbnN0IENvbXBhcmVSYW5nZSA9IChhLCBiKSA9PgogIGEgPT09IG51bGwgfHwgYiA9PT0gbnVsbAogICAgPyAwCiAgICA6IHR5cGVvZiBhWzBdID09ICdudW1iZXInICYmIHR5cGVvZiBiWzBdID09ICdudW1iZXInICYmIGFbMF0gIT0gYlswXQogICAgPyBhWzBdIC0gYlswXQogICAgOiBhWzFdIC0gYlsxXTsKCmNvbnN0IElzS2V5d29yZCA9IFRva0lzKCdrZXl3b3JkJyk7CmNvbnN0IElzUHVuY3R1YXRvciA9IFRva0lzKCdwdW5jdHVhdG9yJyk7CmNvbnN0IElzSWRlbnRpZmllciA9IFRva0lzKCdpZGVudGlmaWVyJyk7CmNvbnN0IElzU3RyaW5nTGl0ZXJhbCA9IFRva0lzKCdzdHJpbmdMaXRlcmFsJyk7CmNvbnN0IFB1dHNGdW5jdGlvbiA9IG91dEZuID0+IHN0ciA9PiB7CiAgbGV0IGIgPSB0eXBlcy5pc0FycmF5QnVmZmVyKHN0cikgPyBzdHIgOiB0b0FycmF5QnVmZmVyKHN0cik7CiAgcmV0dXJuIG91dEZuKGIsIGIuYnl0ZUxlbmd0aCk7Cn07Cgpjb25zdCBJc1doaXRlU3BhY2UgPSBzdHIgPT4gL15ccyokLy50ZXN0KHN0cikgfHwgc3RyLnRyaW0oKSA9PSAnJzsKCmNvbnN0IGRlYnVnTG9nID0gKHN0ciwgLi4uYXJncykgPT4gewogIGNvbnN0IHByZWQgPSBhcmcgPT4gaXNPYmplY3QoYXJnKSAmJiAnY29tcGFjdCcgaW4gYXJnOwogIGxldCBvcHRzID0gYXJncy5maWx0ZXIocHJlZCk7CgogIG9wdHMgPSBvcHRzLnJlZHVjZSgoYWNjLCBvcHQpID0+IGRlZmluZShhY2MsIG9wdCksIG9wdHMuc2hpZnQoKSA/PyB7fSk7CgogIGlmKG9wdHMuY29tcGFjdCA9PT0gdW5kZWZpbmVkKSBkZWZpbmUob3B0cywgY29tcGFjdCgxKSk7CiAgaWYob3B0cy5tYXhBcnJheUxlbmd0aCA9PT0gdW5kZWZpbmVkKSBkZWZpbmUob3B0cywgeyBtYXhBcnJheUxlbmd0aDogMTAgfSk7CiAgaWYob3B0cy5kZXB0aCA9PT0gdW5kZWZpbmVkKSBkZWZpbmUob3B0cywgeyBkZXB0aDogSW5maW5pdHkgfSk7CgogIGFyZ3MgPSBhcmdzLmZpbHRlcihhcmcgPT4gIXByZWQoYXJnKSk7CgogIG9wdHMuY29tcGFjdCA9IGZhbHNlOwoKICBjb25zb2xlLmxvZyhzdHIsIG9wdHMsIC4uLmFyZ3MpOwp9OwoKZnVuY3Rpb24gT3V0cHV0SW1wb3J0cyhpbXBvcnRzID0gZ2xvYmFsSW1wb3J0cykgewogIGxldCBzID0gJyc7CiAgZm9yKGxldCBbbmFtZSwgaWRtYXBdIG9mIE9iamVjdC5lbnRyaWVzKGltcG9ydHMpLm1hcCgoW25hbWUsIG9ial0pID0+IFtuYW1lLCBPYmplY3QuZW50cmllcyhvYmopXSkpIHsKICAgIHMgKz0gYGltcG9ydCBgOwoKICAgIGlmKGlkbWFwLmxlbmd0aCA9PSAxICYmIFsnKicsICdkZWZhdWx0J10uY29udGFpbnMoaWRtYXBbMF1bMV0pKQogICAgICBzICs9IGlkbWFwWzBdWzFdID09ICcqJyA/IGAqIGFzICR7aWRtYXBbMF1bMF19YCA6IGlkbWFwWzBdWzBdOwogICAgZWxzZQogICAgICBzICs9CiAgICAgICAgJ3sgJyArCiAgICAgICAgaWRtYXAKICAgICAgICAgIC5tYXAoKFtsb2NhbCwgbmFtZV0pID0+IChsb2NhbCA9PT0gbmFtZSA/IGxvY2FsIDogKG5hbWUgPT0gJyonID8gJ2RlZmF1bHQnIDogbmFtZSkgKyAnIGFzICcgKyBsb2NhbCkpCiAgICAgICAgICAuam9pbignLCAnKSArCiAgICAgICAgJyB9JzsKCiAgICBzICs9IGAgZnJvbSAnJHtuYW1lfSc7XG5gOwogIH0KICByZXR1cm4gczsKfQoKZnVuY3Rpb24gRmlsZVdyaXRlcihmaWxlLCBtb2RlID0gMG83NTUpIHsKICBsZXQgZmQgPSBvcy5vcGVuKGZpbGUsIG9zLk9fV1JPTkxZIHwgb3MuT19DUkVBVCB8IG9zLk9fVFJVTkMsIG1vZGUpOwogIHJldHVybiBkZWZpbmUoRmRXcml0ZXIoZmQsIGZpbGUpLCB7CiAgICBjbG9zZTogKCkgPT4gb3MuY2xvc2UoZmQpCiAgfSk7Cn0KCmZ1bmN0aW9uIEZpbGVSZXBsYWNlcihmaWxlKSB7CiAgbGV0IGZkID0gb3Mub3BlbihmaWxlICsgJy5uZXcnLCBvcy5PX1dST05MWSB8IG9zLk9fQ1JFQVQgfCBvcy5PX1RSVU5DLCAwbzY0NCk7CiAgcmV0dXJuIGRlZmluZShGZFdyaXRlcihmZCwgZmlsZSksIHsKICAgIGNsb3NlOiAoKSA9PiB7CiAgICAgIC8vY29uc29sZS5sb2coJ0ZpbGVSZXBsYWNlci5jbG9zZScsIGZkKTsKICAgICAgbGV0IHNpemUgPSBmcy5zaXplU3luYyhmZCk7CiAgICAgIG9zLmNsb3NlKGZkKTsKICAgICAgbGV0IGVyciA9IG9zLnJlbmFtZShmaWxlLCBmaWxlICsgJy5vbGQnKTsKICAgICAgZXJyID0gb3MucmVuYW1lKGZpbGUgKyAnLm5ldycsIGZpbGUpOwogICAgICAvL2NvbnNvbGUubG9nKCdvcy5yZW5hbWUoKSA9JywgZXJyKTsKICAgICAgaWYoZXJyKSB0aHJvdyBuZXcgRXJyb3IoYEZpbGVSZXBsYWNlciByZW5hbWUoKSBlcnJvcjogJHtzdGQuc3RyZXJyb3IoLWVycil9YCk7CiAgICAgIGNvbnNvbGUubG9nKGAke2ZpbGV9IHdyaXR0ZW4gKCR7c2l6ZX0gYnl0ZXMpYCk7CiAgICB9CiAgfSk7Cn0KCmZ1bmN0aW9uIEZkV3JpdGVyKGZkLCBmaWxlKSB7CiAgbGV0IGZuOwogIGZuID0gKGJ1ZiwgbGVuKSA9PiB7CiAgICBpZighdHlwZXMuaXNBcnJheUJ1ZmZlcihidWYpKSBidWYgPSB0b0FycmF5QnVmZmVyKGJ1Zik7CiAgICBsZW4gPz89IGJ1Zi5ieXRlTGVuZ3RoOwogICAgbGV0IHJlc3VsdCA9IG9zLndyaXRlKGZkLCBidWYsIDAsIGxlbik7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIGRlZmluZShmbiwgewogICAgZmQsCiAgICBmaWxlLAogICAgcHV0czogUHV0c0Z1bmN0aW9uKGZuKSwKICAgIHdyaXRlOiBmbiwKICAgIGNsb3NlOiAoKSA9PiB7fSwKICAgIHNlZWs6ICh3aGVuY2UsIG9mZnNldCkgPT4gb3Muc2VlayhmZCwgd2hlbmNlLCBvZmZzZXQpLAogICAgW1N5bWJvbC50b1N0cmluZ1RhZ106IGBGaWxlV3JpdGVyPCAke2ZkfSA+YCwKICAgIGluc3BlY3QoKSB7CiAgICAgIHJldHVybiBpbnNwZWN0KHsgZmQgfSkgPz8gdGhpc1tTeW1ib2wudG9TdHJpbmdUYWddOwogICAgfQogIH0pOwogIHJldHVybiBmbjsKfQoKZnVuY3Rpb24gQXJyYXlXcml0ZXIoCiAgYXJyLAogIHQgPSAoYnVmLCBsZW4pID0+IHsKICAgIGlmKCF0eXBlcy5pc0FycmF5QnVmZmVyKGJ1ZikpIGJ1ZiA9IHRvQXJyYXlCdWZmZXIoYnVmKTsKICAgIHJldHVybiBidWYuc2xpY2UoMCwgbGVuID8/IGJ1Zi5ieXRlTGVuZ3RoKTsKICB9CikgewogIGxldCBmbiA9IChidWYsIGxlbikgPT4gKGFyci5wdXNoKHQoYnVmLCBsZW4pKSwgbGVuKTsKCiAgZGVmaW5lKGZuLCB7CiAgICBwdXRzOiBQdXRzRnVuY3Rpb24oZm4pLAogICAgd3JpdGU6IGZuLAogICAgY2xvc2U6ICgpID0+IHt9LAogICAgW1N5bWJvbC50b1N0cmluZ1RhZ106IGBBcnJheVdyaXRlcmAsCiAgICBpbnNwZWN0KCkgewogICAgICByZXR1cm4gaW5zcGVjdCh7IGFyciB9KSA/PyB0aGlzW1N5bWJvbC50b1N0cmluZ1RhZ107CiAgICB9CiAgfSk7CiAgcmV0dXJuIGZuOwp9CgpmdW5jdGlvbiBEdW1teVdyaXRlcihuYW1lKSB7CiAgbGV0IGZuID0gKGJ1ZiwgbGVuKSA9PiBsZW47CiAgZGVmaW5lKGZuLCB7CiAgICBuYW1lLAogICAgcHV0czogUHV0c0Z1bmN0aW9uKGZuKSwKICAgIHdyaXRlOiBmbiwKICAgIGNsb3NlOiAoKSA9PiB7fSwKICAgIHNlZWs6ICgpID0+IHt9LAogICAgW1N5bWJvbC50b1N0cmluZ1RhZ106IGBEdW1teVdyaXRlcjwgJHtuYW1lfSA+YCwKICAgIGluc3BlY3QoKSB7CiAgICAgIHJldHVybiBpbnNwZWN0KHsgZmQgfSkgPz8gdGhpc1tTeW1ib2wudG9TdHJpbmdUYWddOwogICAgfQogIH0pOwogIHJldHVybiBmbjsKfQoKZnVuY3Rpb24gSW1wb3J0SWRzKHNlcSkgewogIHJldHVybiBzZXEuZmlsdGVyKHRvayA9PiBJc0lkZW50aWZpZXIobnVsbCwgdG9rKSk7Cn0KCmZ1bmN0aW9uIEltcG9ydElkTWFwKHNlcSkgewogIGxldCBpID0gMCwKICAgIG5hbWUsCiAgICBsb2NhbCwKICAgIGVudHJpZXMgPSBbXTsKICBzZXEgPSBOb25XUyhzZXEpOwoKICBpZighSXNLZXl3b3JkKCdpbXBvcnQnLCBzZXFbMF0pKSByZXR1cm4gbnVsbDsKICB3aGlsZShzZXFbaV0pIHsKICAgIGlmKHNlcVtpXS50eXBlICE9ICdrZXl3b3JkJykgYnJlYWs7CiAgICArK2k7CiAgfQogIGZvcig7IDsgaSsrKSB7CiAgICBpZihJc0tleXdvcmQoJ2Zyb20nLCBzZXFbaV0pKSBicmVhazsKICAgIGlmKHNlcVtpXS50eXBlID09ICdzdHJpbmdMaXRlcmFsJykgYnJlYWs7CiAgICBsZXQgdG9rID0gc2VxW2ldOwogICAgbGV0IHsgbG9jIH0gPSB0b2s7CiAgICAvKiBwcmV0dGllci1pZ25vcmUgKi8gLy9jb25zb2xlLmxvZygnSW1wb3J0SWRNYXAnLCBpLCBsb2MgKyAnJywgeyB0b2sgfSwgc2VxLnNsaWNlKGkgLSAxLCBpICsgMikubWFwKHQgPT4gdC5sZXhlbWUpLCBJc1B1bmN0dWF0b3IoJyonLCBzZXFbaV0pKTsKICAgIGlmKElzUHVuY3R1YXRvcignKicsIHNlcVtpXSkgJiYgc2VxW2kgKyAxXS5sZXhlbWUgPT0gJ2FzJykgewogICAgICBuYW1lID0gc2VxW2ldLmxleGVtZTsKICAgICAgbG9jYWwgPSBzZXFbaSArIDJdLmxleGVtZTsKICAgICAgZW50cmllcy5wdXNoKFtsb2NhbCwgbmFtZV0pOwogICAgICBpICs9IDM7CiAgICB9IGVsc2UgaWYoSXNLZXl3b3JkKCdmcm9tJywgc2VxW2kgKyAxXSkgJiYgc2VxW2ldLnR5cGUgPT0gJ2lkZW50aWZpZXInKSB7CiAgICAgIGxvY2FsID0gc2VxW2ldLmxleGVtZTsKICAgICAgbmFtZSA9ICdkZWZhdWx0JzsKICAgICAgZW50cmllcy5wdXNoKFtsb2NhbCwgbmFtZV0pOwogICAgfSBlbHNlIGlmKElzUHVuY3R1YXRvcigneycsIHNlcVtpXSkpIHsKICAgICAgKytpOwogICAgICB3aGlsZShzZXFbaV0pIHsKICAgICAgICBpZihJc1B1bmN0dWF0b3IoJ30nLCBzZXFbaV0pKSB7CiAgICAgICAgICBpKys7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYoSXNLZXl3b3JkKCdhcycsIHNlcVtpICsgMV0pKSB7CiAgICAgICAgICBuYW1lID0gc2VxW2ldLmxleGVtZTsKICAgICAgICAgIGxvY2FsID0gc2VxW2kgKyAyXS5sZXhlbWU7CiAgICAgICAgICBpICs9IDI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxvY2FsID0gbmFtZSA9IHNlcVtpXS5sZXhlbWU7CiAgICAgICAgfQogICAgICAgIGVudHJpZXMucHVzaChbbG9jYWwsIG5hbWVdKTsKICAgICAgICArK2k7CiAgICAgICB3aGlsZShJc1B1bmN0dWF0b3IoJywnLCBzZXFbaV0pKSArK2k7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gc3VjaCB0b2tlbiAke3NlcVtpXS5sZXhlbWV9ICR7aW5zcGVjdChlbnRyaWVzKX1gKTsKICAgIH0KICB9CiAgcmV0dXJuIGVudHJpZXM7Cn0KCmZ1bmN0aW9uIEltcEV4cFR5cGUoc2VxKSB7CiAgaWYoc2VxLnNvbWUodG9rID0+IElzS2V5d29yZCgnaW1wb3J0JywgdG9rKSkpIHJldHVybiBXaGF0LklNUE9SVDsKICBpZihzZXEuc29tZSh0b2sgPT4gSXNLZXl3b3JkKCdleHBvcnQnLCB0b2spKSkgcmV0dXJuIFdoYXQuRVhQT1JUOwp9CgpmdW5jdGlvbiBJbXBvcnRUeXBlKHNlcSkgewogIGlmKElzS2V5d29yZChbJ2ltcG9ydCcsICdleHBvcnQnXSwgc2VxWzBdKSkgc2VxLnNoaWZ0KCk7CiAgaWYoSXNQdW5jdHVhdG9yKCcqJywgc2VxWzBdKSkgewogICAgaWYoSXNLZXl3b3JkKCdhcycsIHNlcVsxXSkpIHJldHVybiBJbXBvcnRUeXBlcy5JTVBPUlRfTkFNRVNQQUNFOwogIH0gZWxzZSBpZihJc0lkZW50aWZpZXIodW5kZWZpbmVkLCBzZXFbMF0pKSB7CiAgICBpZihJc0tleXdvcmQoJ2Zyb20nLCBzZXFbMV0pKSByZXR1cm4gSW1wb3J0VHlwZXMuSU1QT1JUX0RFRkFVTFQ7CiAgfQoKICByZXR1cm4gSW1wb3J0VHlwZXMuSU1QT1JUOwp9CgpmdW5jdGlvbiBJbXBvcnRGaWxlKHNlcSkgewogIHNlcSA9IE5vbldTKHNlcSk7CiAgbGV0IGlkeCA9IHNlcS5maW5kSW5kZXgodG9rID0+IElzS2V5d29yZCgnZnJvbScsIHRvaykpOwogIHdoaWxlKHNlcVtpZHhdICYmIHNlcVtpZHhdLnR5cGUgIT0gJ3N0cmluZ0xpdGVyYWwnKSArK2lkeDsKICBpZihzZXFbaWR4XSkKICAgIGlmKHNlcVtpZHhdLnR5cGUgPT0gJ3N0cmluZ0xpdGVyYWwnKSB7CiAgICAgIGxldCBmID0gc2VxW2lkeF0ubGV4ZW1lLnJlcGxhY2UoL15bXCdcIlxgXSguKilbXCdcIlxgXSQvZywgJyQxJyk7CiAgICAgIHJldHVybiBmOwogICAgfQp9CgpmdW5jdGlvbiBFeHBvcnROYW1lKHNlcSkgewogIGxldCBpZHggPSBzZXEuZmluZEluZGV4KHRvayA9PiBJc0lkZW50aWZpZXIodW5kZWZpbmVkLCB0b2spIHx8IElzS2V5d29yZCgnZGVmYXVsdCcsIHRvaykpOwoKICB3aGlsZShzZXFbaWR4XSAmJiBzZXFbaWR4XS50eXBlICE9ICdpZGVudGlmaWVyJykgaWR4Kys7CgogIHJldHVybiBzZXFbaWR4XT8ubGV4ZW1lOwp9CgpmdW5jdGlvbiBCeXRlU2VxdWVuY2UodG9rZW5zKSB7CiAgaWYodG9rZW5zLmxlbmd0aCkgewogICAgbGV0IHsgbG9jIH0gPSB0b2tlbnNbMF07CiAgICBsZXQgc3RhcnQgPSBsb2MuYnl0ZU9mZnNldDsKICAgIGxldCB0b3RhbCA9IHRva2Vucy5yZWR1Y2UoKG4sIHQpID0+IG4gKyB0LmJ5dGVMZW5ndGgsIDApOwogICAgbGV0IGVuZCA9IHN0YXJ0ICsgdG90YWw7CiAgICAvL2xldCBsaW5lID0gdG9TdHJpbmcoQnVmZmVyRmlsZShsb2MuZmlsZSkuc2xpY2Uoc3RhcnQsIGVuZCkpOwogICAgcmV0dXJuIFtzdGFydCwgZW5kXTsKICB9Cn0KCmZ1bmN0aW9uIE1vZHVsZUxvYWRlcihtb2R1bGUpIHsKICBsZXQgZmlsZTsKCiAgaWYocGF0aC5pc0RpcmVjdG9yeShtb2R1bGUpKSB7CiAgICBmaWxlID0gTW9kdWxlTG9hZGVyKHBhdGguam9pbihtb2R1bGUsICdpbmRleC5qcycpKTsKICB9IGVsc2UgaWYocGF0aC5pc0ZpbGUobW9kdWxlKSkgewogICAgZmlsZSA9IG1vZHVsZTsKICB9IGVsc2UgaWYoIS9cLmpzJC8udGVzdChtb2R1bGUpKSB7CiAgICBmaWxlID0gTW9kdWxlTG9hZGVyKG1vZHVsZSArICcuanMnKTsKICB9CgogIHJldHVybiBmaWxlOwp9CgpmdW5jdGlvbiBQcm9jZXNzRmlsZShzb3VyY2UsIGxvZyA9ICgpID0+IHt9LCByZWN1cnNpdmUsIGRlcHRoID0gMCkgewogIGlmKGRlYnVnID4gMSkgY29uc29sZS5sb2coYFByb2Nlc3NpbmcgJHtzb3VyY2V9YCk7CgogIHNvdXJjZSA9IHBhdGgubm9ybWFsaXplKHNvdXJjZSk7CgogIGlmKHByaW50RmlsZXMpIHN0ZC5wdXRzKGAke3NvdXJjZX1cbmApOwoKICBsZXQgc3RhcnQgPSBEYXRlLm5vdygpOwogIGNvbnN0IGRpciA9IHBhdGguZGlybmFtZShzb3VyY2UpOwoKICBpZihkZWJ1ZyA+PSAyKSBjb25zb2xlLmxvZygnUHJvY2Vzc0ZpbGUnLCB7IHNvdXJjZSB9KTsKCiAgbGV0IGJ5dGVidWYgPSBCdWZmZXJGaWxlKHNvdXJjZSk7CgogIGxldCBsZW4gPSBieXRlYnVmLmJ5dGVMZW5ndGgsCiAgICB0eXBlID0gcGF0aC5leHRuYW1lKHNvdXJjZSkuc3Vic3RyaW5nKDEpLAogICAgYmFzZSA9IGNhbWVsaXplKHBhdGguYmFzZW5hbWUoc291cmNlLCAnLicgKyB0eXBlKS5yZXBsYWNlKC9bXjAtOUEtWmEtel9dL2csICdfJykpOwoKICBsZXQgbGV4ID0gewogICAganM6IG5ldyBFQ01BU2NyaXB0TGV4ZXIoYnl0ZWJ1Ziwgc291cmNlKQogIH07CgogIGxleC5tanMgPSBsZXguanM7CiAgbGV4LmNqcyA9IGxleC5qczsKICBsZXguanNvbiA9IGxleC5qczsKCiAgY29uc3QgbGV4ZXIgPSAoZ2xvYmFsVGhpcy5sZXhlciA9IGxleFt0eXBlXSk7CiAgaWYoZGVidWcgPj0gMykgY29uc29sZS5sb2coJ2xleGVyJywgbGV4ZXIpOwoKICAvLyBUID0gbGV4ZXIudG9rZW5zLnJlZHVjZSgoYWNjLCBuYW1lLCBpZCkgPT4gKHsgLi4uYWNjLCBbbmFtZV06IGlkIH0pLCB7fSk7CgogIGxldCBlID0gbmV3IFN5bnRheEVycm9yKCk7CgogIGlmKCFsZXhlcikgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBsZXhpbmc6ICR7c291cmNlfWApOwoKICBsZXhlci5oYW5kbGVyID0gbGV4ID0+IHsKICAgIGNvbnN0IHsgbG9jLCBtb2RlLCBwb3MsIHN0YXJ0LCBieXRlTGVuZ3RoLCBzdGF0ZSB9ID0gbGV4OwogICAgbG9nKCcgJy5yZXBlYXQobG9jLmNvbHVtbiAtIDEpICsgJ14nKTsKICB9OwoKICBsZXQgdG9rZW5MaXN0ID0gW10sCiAgICBkZWNsYXJhdGlvbnMgPSBbXTsKICBjb25zdCBjb2xTaXplcyA9IFsxMiwgOCwgNCwgMjAsIDMyLCAxMCwgMF07CgogIGxldCB0b2ssCiAgICBpID0gMCwKICAgIG1hc2sgPSBJbnRUb0JpbmFyeShsZXhlci5tYXNrKSwKICAgIHN0YXRlID0gbGV4ZXIudG9wU3RhdGUoKTsKICBsZXhlci5iZWdpbkNvZGUgPSAoKSA9PiAoY29kZSA9PSAnanMnID8gMGIxMDAwIDogMGIwMTAwKTsKICBjb25zdCBiYWxhbmNlciA9ICgpID0+IHsKICAgIGxldCBzZWxmOwogICAgbGV0IHN0YWNrID0gW107CiAgICBjb25zdCB0YWJsZSA9IHsgJ30nOiAneycsICddJzogJ1snLCAnKSc6ICcoJyB9OwoKICAgIHNlbGYgPSBmdW5jdGlvbiBQYXJlbnRoZXNlQmFsYW5jZXIodG9rKSB7CiAgICAgIHN3aXRjaCAodG9rPy5sZXhlbWUpIHsKICAgICAgICBjYXNlICd7JzoKICAgICAgICBjYXNlICdbJzoKICAgICAgICBjYXNlICcoJzogewogICAgICAgICAgc3RhY2sucHVzaCh0b2subGV4ZW1lKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgY2FzZSAnfSc6CiAgICAgICAgY2FzZSAnXSc6CiAgICAgICAgY2FzZSAnKSc6IHsKICAgICAgICAgIGlmKHN0YWNrLmxhc3QgIT0gdGFibGVbdG9rLmxleGVtZV0pCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgdG9wICcke3N0YWNrLmxhc3R9JyAhPSAnJHt0b2subGV4ZW1lfScgWyAke3N0YWNrLm1hcChzID0+IGAnJHtzfSdgKS5qb2luKCcsICcpfSBdYCk7CgogICAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgT2JqZWN0LmFzc2lnbihzZWxmLCB7CiAgICAgIHN0YWNrLAogICAgICByZXNldCgpIHsKICAgICAgICBzdGFjay5jbGVhcigpOwogICAgICB9LAogICAgICAvKiBwcmV0dGllci1pZ25vcmUgKi8gZ2V0IGRlcHRoKCkgewogICAgICAgIHJldHVybiBzdGFjay5sZW5ndGg7CiAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBzZWxmOwogIH07CgogIGxldCBiYWxhbmNlcnMgPSBbYmFsYW5jZXIoKV0sCiAgICBpbXBvcnRzID0gW10sCiAgICBleHBvcnRzID0gW10sCiAgICBjb21tZW50cyA9IFtdLAogICAgaW1wZXhwLAogICAgY29uZCwKICAgIGltcCA9IFtdLAogICAgc2hvd1Rva2VuID0gdG9rID0+IHsKICAgICAgaWYoCiAgICAgICAgKGxleGVyLmNvbnN0cnVjdG9yICE9IEVDTUFTY3JpcHRMZXhlciAmJiB0b2sudHlwZSAhPSAnd2hpdGVzcGFjZScpIHx8CiAgICAgICAgL14oKGltfGV4KXBvcnR8ZnJvbXxhcykkLy50ZXN0KHRvay5sZXhlbWUpCiAgICAgICkgewogICAgICAgIGxldCBhID0gWy8qKGZpbGUgKyAnOicgKyB0b2subG9jKS5wYWRFbmQoZmlsZS5sZW5ndGgrMTApLCovIHRvay50eXBlLnBhZEVuZCgyMCwgJyAnKSwgZXNjYXBlKHRvay5sZXhlbWUpXTsKICAgICAgICAvLyBzdGQucHV0cyhhLmpvaW4oJycpICsgJ1xuJyk7CiAgICAgIH0KICAgIH07CgogIGNvbnN0IFBhdGhBZGp1c3QgPSBzID0+IHsKICAgIGxldCBqID0gcGF0aC5qb2luKGRpciwgcyk7CiAgICBqID0gcGF0aC5jb2xsYXBzZShqKTsKICAgIGogPSBwYXRoLm5vcm1hbGl6ZShqKTsKICAgIGlmKHBhdGguaXNSZWxhdGl2ZShqKSkgaiA9ICcuLycgKyBqOwogICAgcmV0dXJuIE1vZHVsZUxvYWRlcihqKTsKICB9OwoKICBsZXQgcHJldlRva2VuLAogICAgZG9uZUltcG9ydHMsCiAgICB1c2VkID0gaWRlbnRpZmllcnNVc2VkID8gaWRlbnRpZmllcnNVc2VkKHNvdXJjZSkgOiBudWxsOwogIGZvcig7OykgewogICAgbGV0IHsgc3RhdGVEZXB0aCB9ID0gbGV4ZXI7CiAgICBsZXQgdmFsdWUgPSBsZXhlci5uZXh0KCk7CiAgICBsZXQgZG9uZSA9IHZhbHVlID09PSB1bmRlZmluZWQ7CiAgICBpZihkb25lKSBicmVhazsKICAgIGxldCBuZXdTdGF0ZSA9IGxleGVyLnRvcFN0YXRlKCk7CiAgICBpZihuZXdTdGF0ZSAhPSBzdGF0ZSkgewogICAgICBpZihzdGF0ZSA9PSAnVEVNUExBVEUnICYmIGxleGVyLnN0YXRlRGVwdGggPiBzdGF0ZURlcHRoKSBiYWxhbmNlcnMucHVzaChiYWxhbmNlcigpKTsKICAgICAgaWYobmV3U3RhdGUgPT0gJ1RFTVBMQVRFJyAmJiBsZXhlci5zdGF0ZURlcHRoIDwgc3RhdGVEZXB0aCkgYmFsYW5jZXJzLnBvcCgpOwogICAgfQoKICAgIGxldCBuID0gYmFsYW5jZXJzLmxhc3QuZGVwdGg7CiAgICBjb25zdCB7IHRva2VuIH0gPSBsZXhlcjsKCiAgICBpZighdG9rZW4pIGJyZWFrOwogICAgY29uc3QgeyBsZW5ndGgsIHNlcSB9ID0gdG9rZW47CgogICAgaWYodG9rZW4udHlwZSA9PSAnaWRlbnRpZmllcicpIHsKICAgICAgaWYoZG9uZUltcG9ydHMpIHsKICAgICAgICBpZih1c2VkKSB7CiAgICAgICAgICBsZXQgeyBzaXplIH0gPSB1c2VkOwogICAgICAgICAgdXNlZC5hZGQodG9rZW4ubGV4ZW1lKTsKICAgICAgICAgIGlmKGRlYnVnID49IDIpIGNvbnNvbGUubG9nKGBhZGRlZFske3NpemV9XWAsIHNvdXJjZSwgdG9rZW4ubGV4ZW1lKTsKICAgICAgICB9CiAgICAgIH0gLyplbHNlIHsKICAgICAgICBpbXBvcnRlZC5hZGQodG9rZW4ubGV4ZW1lKTsKICAgICAgfSovCiAgICB9CgogICAgaWYoZGVidWcgPiAzKSBjb25zb2xlLmxvZygndG9rZW4nLCB0b2tlbik7CiAgICAvKiAgIGlmKGRlYnVnID49IDEpIGNvbnNvbGUubG9nKCdsZXhlci5tb2RlJywgbGV4ZXIubW9kZSk7CiAgICAgKi8KICAgIGlmKG4gPT0gMCAmJiB0b2tlbi5sZXhlbWUgPT0gJ30nICYmIGxleGVyLnN0YXRlRGVwdGggPiAwKSB7CiAgICAgIGxleGVyLnBvcFN0YXRlKCk7CiAgICB9IGVsc2UgewogICAgICBiYWxhbmNlcih0b2tlbik7CiAgICAgIGlmKG4gPiAwICYmIGJhbGFuY2Vycy5sYXN0LmRlcHRoID09IDApIGxvZygnYmFsYW5jZXInKTsKICAgICAgaWYoL2NvbW1lbnQvaS50ZXN0KHRva2VuLnR5cGUpKSB7CiAgICAgICAgY29tbWVudHMucHVzaCh0b2tlbik7CiAgICAgIH0KCiAgICAgIGlmKFsnaW1wb3J0JywgJ2V4cG9ydCddLmluZGV4T2YodG9rZW4ubGV4ZW1lKSA+PSAwKSB7CiAgICAgICAgaW1wZXhwID0gV2hhdFt0b2tlbi5sZXhlbWUudG9VcHBlckNhc2UoKV07CiAgICAgICAgY29uZCA9IHRydWU7CiAgICAgICAgaW1wID0gdG9rZW4ubGV4ZW1lID09ICdleHBvcnQnID8gW3Rva2VuXSA6IFtdOwogICAgICB9CgogICAgICBpZihkZWJ1ZyA+IDMpCiAgICAgICAgY29uc29sZS5sb2coYHRva2VuWyR7aW1wLmxlbmd0aH1dYCwgdG9rZW4ubG9jICsgJycsIGNvbnNvbGUuY29uZmlnKHsgYnJlYWtMZW5ndGg6IDgwLCBjb21wYWN0OiAwIH0pLCB0b2tlbik7CgogICAgICBpZih0b2tlbi5sZXhlbWUgPT0gJzsnICYmIGNvbmQgIT09IHRydWUpIGRvbmVJbXBvcnRzID0gdHJ1ZTsKCiAgICAgIGlmKG9ubHlJbXBvcnRzICYmIGRvbmVJbXBvcnRzKSBicmVhazsKCiAgICAgIGlmKGNvbmQgPT0gdHJ1ZSkgewogICAgICAgIGlmKGltcC5pbmRleE9mKHRva2VuKSA9PSAtMSkgaW1wLnB1c2godG9rZW4pOwogICAgICAgIC8vY29uc29sZS5sb2coIGltcFswXS5sb2MrJycsY29uc29sZS5jb25maWcoe2JyZWFrTGVuZ3RoOjgwLCBjb21wYWN0OiAwfSksIE5vbldTKGltcCkpOwogICAgICAgIGlmKGltcC5sYXN0LmxleGVtZSA9PSAnOycpIHsKICAgICAgICAgIC8qIHByZXR0aWVyLWlnbm9yZSAqLyBpZihkZWJ1ZyA+IDMpIGNvbnNvbGUubG9nKCdpbXAnLCBpbXBbMF0ubG9jICsgJycsIGNvbnNvbGUuY29uZmlnKHticmVha0xlbmd0aDogODAsIGNvbXBhY3Q6IDAgfSksIFRva2VuU2VxdWVuY2UoaW1wKSArICcnKTsKICAgICAgICAgIGNvbmQgPSBmYWxzZTsKICAgICAgICAgIGlmKGltcGV4cCA9PSBXaGF0LklNUE9SVCB8fCBpbXAuc29tZShpID0+IElzS2V5d29yZCgnZnJvbScsIGkpKSkgewogICAgICAgICAgICBpZihpbXBbMV0ubGV4ZW1lICE9ICcoJykgewogICAgICAgICAgICAgIGxldCBvYmogPSBuZXcgSW1wb3J0KGltcCwgUGF0aEFkanVzdCwgZGVwdGgpOwogICAgICAgICAgICAgIGlmKG9iaikgewogICAgICAgICAgICAgICAgb2JqLnNvdXJjZSA9IHNvdXJjZTsKICAgICAgICAgICAgICAgIGltcG9ydHMucHVzaChvYmopOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGV0IG9iaiA9IG5ldyBFeHBvcnQoaW1wLCBQYXRoQWRqdXN0LCBkZXB0aCk7CiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ29iaicsY29uc29sZS5jb25maWcoe2JyZWFrTGVuZ3RoOjgwLCBjb21wYWN0OiAxfSksIG9iaiwgb2JqLmxvYysnJyk7CiAgICAgICAgICAgIGlmKG9iaikgewogICAgICAgICAgICAgIG9iai5zb3VyY2UgPSBzb3VyY2U7CgogICAgICAgICAgICAgIGV4cG9ydHMucHVzaChvYmopOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBwcmV2VG9rZW4gPSB0b2tlbjsKICAgIH0KCiAgICBzdGF0ZSA9IG5ld1N0YXRlOwogIH0KCiAgZnVuY3Rpb24gRXhwb3J0KHRva2VucywgcmVsYXRpdmVQYXRoID0gcyA9PiBzKSB7CiAgICBpZih0b2tlbnNbMF0uc2VxID09IHRva2Vuc1sxXS5zZXEpIHRva2Vucy5zaGlmdCgpOwogICAgY29uc3QgeyBsb2MsIHNlcSB9ID0gdG9rZW5zWzBdOwogICAgaWYoIS9eKGltfGV4KXBvcnQkL2kudGVzdCh0b2tlbnNbMF0ubGV4ZW1lKSkKICAgICAgdGhyb3cgbmV3IEVycm9yKGBBZGRFeHBvcnQgdG9rZW5zOiBgICsgaW5zcGVjdCh0b2tlbnMsIHsgY29tcGFjdDogZmFsc2UgfSkpOwogICAgbGV0IGRlZiA9IHRva2Vucy5maW5kSW5kZXgodG9rID0+IElzS2V5d29yZCgnZGVmYXVsdCcsIHRvaykpOwogICAgbGV0IGsgPSAxOwogICAgd2hpbGUodG9rZW5zW2tdLnR5cGUgPT0gJ3doaXRlc3BhY2UnIHx8IElzS2V5d29yZChbJ2xldCcsICdjbGFzcycsICdmdW5jdGlvbicsICdjb25zdCddLCB0b2tlbnNba10pKSBrKys7CiAgICB3aGlsZSh0b2tlbnNba10gJiYgdG9rZW5zW2tdLnR5cGUgIT0gJ2lkZW50aWZpZXInKSBrKys7CiAgICBsZXQgbmFtZSA9IEV4cG9ydE5hbWUodG9rZW5zKTsKICAgIGxldCBleHBvcnRlZCA9IGRlZiAhPSAtMSA/ICdkZWZhdWx0JyA6IG5hbWU7CiAgICBsZXQgZmlsZSA9IEltcG9ydEZpbGUodG9rZW5zKTsKICAgIGlmKGZpbGUgPT0gJyAnKSB0aHJvdyBuZXcgRXJyb3IoJ1hYWCAnICsgaW5zcGVjdCh0b2tlbnMsIHsgY29tcGFjdDogZmFsc2UgfSkpOwogICAgY29uc3QgaWR4ID0KICAgICAgZGVmICE9IC0xCiAgICAgICAgPyBkZWYKICAgICAgICA6IGZpbGUKICAgICAgICA/IHRva2Vucy5maW5kSW5kZXgodG9rID0+IHRvay5sZXhlbWUgPT0gJzsnKQogICAgICAgIDogdG9rZW5zLnNsaWNlKDEpLmZpbmRJbmRleCh0b2sgPT4gdG9rLnR5cGUgIT0gJ3doaXRlc3BhY2UnKTsKICAgIGNvbnN0IG8gPSBOb25XUyh0b2tlbnMpWzFdLmxleGVtZSA9PSAneyc7CiAgICBjb25zdCByZW1vdmUgPSBvIHx8IGRlZiAhPSAtMSA/IHRva2Vucy5zbGljZSgpIDogdG9rZW5zLnNsaWNlKDAsIGRlZiA9PSBpZHggPyBpZHggKyAyIDogaWR4ICsgMSk7CiAgICBpZihyZW1vdmVbMF0pCiAgICAgIGlmKHJlbW92ZVswXS5sZXhlbWUgIT0gJ2V4cG9ydCcpIHRocm93IG5ldyBFcnJvcihgQWRkRXhwb3J0IHRva2VuczogYCArIGluc3BlY3QodG9rZW5zLCB7IGNvbXBhY3Q6IGZhbHNlIH0pKTsKICAgIGNvbnN0IHJhbmdlID0gQnl0ZVNlcXVlbmNlKHJlbW92ZSkgPz8gQnl0ZVNlcXVlbmNlKHRva2Vucyk7CiAgICBsZXQgc291cmNlID0gbG9jLmZpbGU7CiAgICBsZXQgdHlwZSA9IEltcEV4cFR5cGUodG9rZW5zKTsKICAgIGxldCBjb2RlID0gVG9rZW5TZXF1ZW5jZSh0b2tlbnMpLnRvU3RyaW5nKCk7IC8vIHRvU3RyaW5nKEJ1ZmZlckZpbGUoc291cmNlKS5zbGljZSguLi5yYW5nZSkpOwogICAgaWYoZGVmICE9IC0xKSBpZiAoZGVidWcgPj0gMikgY29uc29sZS5sb2coJ25ldyBFeHBvcnQnLCB7IHNvdXJjZSwgZmlsZSwgY29kZSwgcmFuZ2UsIGxvYywgdG9rZW5zIH0pOwogICAgbGV0IGxlbiA9IHRva2Vucy5sZW5ndGg7CiAgICBpZihvKSB7CiAgICAgIGV4cG9ydGVkID0gdG9rZW5zLmZpbHRlcih0b2sgPT4gdG9rLnR5cGUgPT0gJ2lkZW50aWZpZXInKS5tYXAodG9rID0+IHRvay5sZXhlbWUpOwogICAgfQoKICAgIGlmKE5vbldTKHRva2VucylbMV0ubGV4ZW1lICE9ICd7JykKICAgICAgbGVuID0gdG9rZW5zLmZpbmRJbmRleCh0b2sgPT4gSXNJZGVudGlmaWVyKHVuZGVmaW5lZCwgdG9rKSB8fCBJc0tleXdvcmQoJ2RlZmF1bHQnLCB0b2spKSArIDE7CiAgICB0b2tlbnMgPSB0b2tlbnMuc2xpY2UoMCwgbGVuKTsKICAgIGxldCBleHAgPSBkZWZpbmUoCiAgICAgIHsKICAgICAgICB0eXBlOiBXaGF0LkVYUE9SVCwKICAgICAgICBmaWxlOiBmaWxlICYmIC9cLi8udGVzdChmaWxlKSA/IHJlbGF0aXZlUGF0aChmaWxlKSA6IGZpbGUsCiAgICAgICAgdG9rZW5zLAogICAgICAgIGV4cG9ydGVkLAogICAgICAgIG5hbWUsCiAgICAgICAgcmFuZ2UKICAgICAgfSwKICAgICAgewogICAgICAgIGNvZGUsCiAgICAgICAgbG9jLAogICAgICAgIGRlcHRoLAogICAgICAgIHBhdGgoKSB7CiAgICAgICAgICBjb25zdCB7IGZpbGUgfSA9IHRoaXM7CiAgICAgICAgICBpZih0eXBlb2YgZmlsZSA9PSAnc3RyaW5nJykgcmV0dXJuIHJlbGF0aXZlUGF0aChmaWxlKTsKICAgICAgICB9CiAgICAgIH0KICAgICk7CiAgICByZXR1cm4gT2JqZWN0LnNldFByb3RvdHlwZU9mKGV4cCwgRXhwb3J0LnByb3RvdHlwZSk7CiAgfQoKICBkZWZpbmUoRXhwb3J0LnByb3RvdHlwZSwgewogICAgaWRzKCkgewogICAgICByZXR1cm4gSW1wb3J0SWRzKHRoaXMudG9rZW5zKS5tYXAoKHsgbGV4ZW1lIH0pID0+IGxleGVtZSk7CiAgICB9LAogICAgaWRtYXAoKSB7CiAgICAgIHJldHVybiBJbXBvcnRJZE1hcCh0aGlzLnRva2Vucyk7CiAgICB9CiAgfSk7CgogIGZ1bmN0aW9uIEltcG9ydCh0b2tlbnMsIHJlbGF0aXZlUGF0aCA9IHMgPT4gcywgZGVwdGgpIHsKICAgIHRva2VucyA9IHRva2Vuc1swXS5zZXEgPT09IHRva2Vuc1sxXS5zZXEgPyB0b2tlbnMuc2xpY2UoMSkgOiB0b2tlbnMuc2xpY2UoKTsKCiAgICBpZighL14oaW18ZXgpcG9ydCQvaS50ZXN0KHRva2Vuc1swXS5sZXhlbWUpKQogICAgICB0aHJvdyBuZXcgRXJyb3IoYEFkZEltcG9ydCB0b2tlbnM6IGAgKyBpbnNwZWN0KHRva2VucywgeyBjb21wYWN0OiBmYWxzZSB9KSk7CiAgICBjb25zdCB0b2sgPSB0b2tlbnNbMF07CiAgICBjb25zdCB7IGxvYywgc2VxIH0gPSB0b2s7CiAgICBsZXQgc291cmNlID0gbG9jLmZpbGU7CiAgICBsZXQgdHlwZSA9IEltcEV4cFR5cGUodG9rZW5zLnNsaWNlKCkpLAogICAgICBmaWxlID0gSW1wb3J0RmlsZSh0b2tlbnMuc2xpY2UoKSk7CiAgICBjb25zdCByYW5nZSA9IEJ5dGVTZXF1ZW5jZSh0b2tlbnMuc2xpY2UoKSk7CiAgICByYW5nZVswXSA9IGxvYy5ieXRlT2Zmc2V0OwogICAgbGV0IGNvZGUgPSB0b1N0cmluZyhCdWZmZXJGaWxlKHNvdXJjZSkuc2xpY2UoLi4ucmFuZ2UpKTsKICAgIC8qIHByZXR0aWVyLWlnbm9yZSAqLyBpZihkZWJ1ZyA+IDMpIGNvbnNvbGUubG9nKCdceDFiWzE7MzFtbmV3XHgxYlsxOzMzbSBJbXBvcnRceDFiWzBtJywgY29tcGFjdCgxKSwge3NvdXJjZSwgZmlsZSwgY29kZSwgbG9jLCByYW5nZSB9KTsKICAgIGxldCBpbXAgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YoCiAgICAgIGRlZmluZSgKICAgICAgICB7CiAgICAgICAgICBmaWxlOiBSZXNvbHZlQWxpYXMoZmlsZSAmJiAvXC4vLnRlc3QoZmlsZSkgPyByZWxhdGl2ZVBhdGgoZmlsZSkgOiBmaWxlKSwKICAgICAgICAgIHJhbmdlCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0eXBlLAogICAgICAgICAgdG9rZW5zLAogICAgICAgICAgY29kZSwKICAgICAgICAgIGxvYywKICAgICAgICAgIGRlcHRoLAogICAgICAgICAgcGF0aCgpIHsKICAgICAgICAgICAgY29uc3QgeyBmaWxlIH0gPSB0aGlzOwogICAgICAgICAgICBpZih0eXBlb2YgZmlsZSA9PSAnc3RyaW5nJykgcmV0dXJuIHJlbGF0aXZlUGF0aChmaWxlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICksCiAgICAgIEltcG9ydC5wcm90b3R5cGUKICAgICk7CiAgICBsZXQgZm4gPSB7CiAgICAgIFtJbXBvcnRUeXBlcy5JTVBPUlRfTkFNRVNQQUNFXSgpIHsKICAgICAgICByZXR1cm4gdGhpcy50b2tlbnNbdGhpcy50b2tlbnMuZmluZEluZGV4KHRvayA9PiBJc0tleXdvcmQoJ2FzJywgdG9rKSkgKyAxXS5sZXhlbWU7CiAgICAgIH0sCiAgICAgIFtJbXBvcnRUeXBlcy5JTVBPUlRfREVGQVVMVF0oKSB7CiAgICAgICAgY29uc3QgeyB0b2tlbnMgfSA9IHRoaXM7CiAgICAgICAgcmV0dXJuIHRva2Vuc1t0b2tlbnMuZmluZEluZGV4KHRvayA9PiBJc0tleXdvcmQoJ2ltcG9ydCcsIHRvaykpICsgMV0ubGV4ZW1lOwogICAgICB9LAogICAgICBbSW1wb3J0VHlwZXMuSU1QT1JUXSgpIHsKICAgICAgICBjb25zdCB7IHRva2VucyB9ID0gdGhpczsKICAgICAgICBsZXQgaSA9IDAsCiAgICAgICAgICBzID0gW10sCiAgICAgICAgICBhID0gW107CiAgICAgICAgaWYoSXNLZXl3b3JkKFsnaW1wb3J0JywgJ2V4cG9ydCddLCB0b2tlbnNbaV0pKSArK2k7CiAgICAgICAgaWYoSXNQdW5jdHVhdG9yKCd7JywgdG9rZW5zW2ldKSkgKytpOwogICAgICAgIGZvcig7IHRva2Vuc1tpXSAmJiAhSXNLZXl3b3JkKCdmcm9tJywgdG9rZW5zW2ldKTsgKytpKSB7CiAgICAgICAgICBpZihJc1B1bmN0dWF0b3IoWycsJywgJ30nXSwgdG9rZW5zW2ldKSkgewogICAgICAgICAgICBpZihzLmxlbmd0aCkgYS5wdXNoKHMpOwogICAgICAgICAgICBzID0gW107CiAgICAgICAgICB9IGVsc2UgaWYoSXNJZGVudGlmaWVyKHRva2Vuc1tpXSkpIHsKICAgICAgICAgICAgcy5wdXNoKHRva2Vuc1tpXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGEgPSBhLmZsYXQoKS5maWx0ZXIodG9rID0+IHRvay50eXBlID09ICdpZGVudGlmaWVyJyk7CiAgICAgICAgcmV0dXJuIGEubWFwKHRvayA9PiB0b2subGV4ZW1lKTsKICAgICAgfQogICAgfVt0eXBlXTsKICAgIGlmKHR5cGVvZiBmbiA9PSAnZnVuY3Rpb24nKSB7CiAgICAgIGxldCBsb2NhbCA9IGZuLmNhbGwoaW1wKTsKICAgICAgZGVmaW5lKGltcCwgeyBsb2NhbCB9KTsKICAgIH0KCiAgICByZXR1cm4gaW1wOwogIH0KCiAgZGVmaW5lKEltcG9ydC5wcm90b3R5cGUsIHsKICAgIFtTeW1ib2wudG9TdHJpbmdUYWddOiAnSW1wb3J0JywKICAgIGlkcygpIHsKICAgICAgcmV0dXJuIEltcG9ydElkcyh0aGlzLnRva2Vucy5zbGljZSgpKS5tYXAoKHsgbGV4ZW1lIH0pID0+IGxleGVtZSk7CiAgICB9LAogICAgaWRtYXAoKSB7CiAgICAgIHJldHVybiBJbXBvcnRJZE1hcCh0aGlzLnRva2Vucy5zbGljZSgpKTsKICAgIH0sCiAgICB0b0NvZGUoZmlsdGVySWRzID0gaWQgPT4gdHJ1ZSkgewogICAgICBpZih0aGlzLmlkcygpLmZpbHRlcihmaWx0ZXJJZHMpLmxlbmd0aCA9PSAwKSByZXR1cm4gJyc7CiAgICAgIGxldCB0b2tlbnMgPSB0aGlzLnRva2Vucy5maWx0ZXIodG9rID0+ICh0b2sudHlwZSA9PSAnaWRlbnRpZmllcicgPyBmaWx0ZXJJZHModG9rLmxleGVtZSkgOiB0cnVlKSk7CiAgICAgIGxldCBwcmV2LCBwbndzOwogICAgICB0b2tlbnMgPSB0b2tlbnMucmVkdWNlKChhY2MsIHRvaywgaSkgPT4gewogICAgICAgIGlmKHByZXYgJiYgcHJldi50eXBlID09ICd3aGl0ZXNwYWNlJyAmJiB0b2sudHlwZSA9PSAnd2hpdGVzcGFjZScpIHJldHVybiBhY2M7CiAgICAgICAgaWYocG53cyAhPT0gdW5kZWZpbmVkICYmIFsnLCcsICd7J10uaW5kZXhPZihhY2NbcG53c10ubGV4ZW1lKSAhPSAtMSAmJiBbJywnLCAnfSddLmluZGV4T2YodG9rLmxleGVtZSkgIT0gLTEpIHsKICAgICAgICAgIGlmKHRvay5sZXhlbWUgPT0gJ30nKSBhY2Muc3BsaWNlKHBud3MsIDEpOwogICAgICAgICAgaWYodG9rLmxleGVtZSA9PSAnfScpIHsKICAgICAgICAgICAgcG53cyA9IGFjYy5sZW5ndGg7CiAgICAgICAgICAgIGFjYy5wdXNoKHRvayk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYWNjOwogICAgICAgIH0KICAgICAgICBpZih0b2sudHlwZSAhPSAnd2hpdGVzcGFjZScpIHBud3MgPSBhY2MubGVuZ3RoOwogICAgICAgIHByZXYgPSB0b2s7CiAgICAgICAgYWNjLnB1c2godG9rKTsKICAgICAgICByZXR1cm4gYWNjOwogICAgICB9LCBbXSk7CiAgICAgIHRva2VucyA9IEFkZFdoaXRlc3BhY2UodG9rZW5zKTsKICAgICAgaWYoZGVidWcgPiAzKSBjb25zb2xlLmxvZygndG9rZW5zJywgdG9rZW5zKTsKICAgICAgcmV0dXJuIFRva2VuU2VxdWVuY2UodG9rZW5zKS50b1N0cmluZygpOwogICAgfQogIH0pOwoKICBsZXQgZW5kID0gRGF0ZS5ub3coKTsKCiAgaWYoc2hvd1RpbWluZykgY29uc29sZS5sb2coYExleGluZyAnJHtzb3VyY2UucmVwbGFjZSgvXlwuXC8vLCAnJyl9JyB0b29rICR7ZW5kIC0gc3RhcnR9bXNgKTsKICBzdGFydCA9IERhdGUubm93KCk7CgogIGxldCBleHBvcnRzRnJvbSA9IGV4cG9ydHMuZmlsdGVyKGV4cCA9PiBleHAudG9rZW5zKS5maWx0ZXIoZXhwID0+IGV4cC50b2tlbnMuc29tZSh0b2sgPT4gdG9rLmxleGVtZSA9PSAnZnJvbScpKTsKCiAgaWYocGF0aC5pc1JlbGF0aXZlKHNvdXJjZSkgJiYgIS9eKFwufFwuXC4pXC8vLnRlc3Qoc291cmNlKSkgc291cmNlID0gJy4vJyArIHNvdXJjZTsKCiAgbW9kdWxlc1tzb3VyY2VdID0geyBpbXBvcnRzLCBleHBvcnRzIH07CgogIGxldCBhbGxFeHBvcnRzSW1wb3J0cyA9IGV4cG9ydHMuY29uY2F0KGltcG9ydHMpLnNvcnQoKGEsIGIpID0+IGEucmFuZ2VbMF0gLSBiLnJhbmdlWzBdKTsKICBsZXQgZmlsZUltcG9ydHMgPSBhbGxFeHBvcnRzSW1wb3J0cy5maWx0ZXIoaW1wID0+IHR5cGVvZiBpbXAuZmlsZSA9PSAnc3RyaW5nJyk7CiAgbGV0IHNwbGl0UG9pbnRzID0gdW5pcXVlKGZpbGVJbXBvcnRzLnJlZHVjZSgoYWNjLCBpbXApID0+IFsuLi5hY2MsIC4uLmltcC5yYW5nZV0sIFtdKSk7CiAgYnVmZmVyc1tzb3VyY2VdID0gWy4uLnNwbGl0KEJ1ZmZlckZpbGUoc291cmNlKSwgLi4uc3BsaXRQb2ludHMpXS5tYXAoYiA9PiBiID8/IHRvU3RyaW5nKGIsIDAsIGIuYnl0ZUxlbmd0aCkpOwoKICBpbXBvcnRzRm9yW3NvdXJjZV0gPSBhbGxFeHBvcnRzSW1wb3J0cy5maWx0ZXIoaW1wID0+IGltcC50eXBlID09IFdoYXQuSU1QT1JUKTsgLy9maWxlSW1wb3J0cy5tYXAoaSA9PiBpLmZpbGUpOwoKICBsZXQgbWFwID0gRmlsZU1hcC5mb3Ioc291cmNlKTsKICBsZXQgaW1wb3J0ZWQgPSB1c2VkICYmIG5ldyBTZXQoKTsKCiAgLyogZm9yKGxldCBpbXBleHAgb2YgZmlsZUltcG9ydHMpIHsKICAgIGxldCBmaWxlID0gUmVzb2x2ZUFsaWFzKGltcGV4cC5maWxlKTsKICAgIGxldCBzID0gKGdsb2JhbEltcG9ydHNbZmlsZV0gPz89IG5ldyBTZXQoKSk7CgogICAgZm9yKGxldCBpZCBvZiBpbXBleHAuaWRzKCkpIHMuYWRkKGlkKTsKICB9Ki8KCiAgaWYodXNlZCkgewogICAgZm9yKGxldCBpbXBleHAgb2YgMSkgewogICAgICBpZihpbXBleHAudHlwZSA9PSBXaGF0LklNUE9SVCkgewogICAgICAgIGxldCBpZHMgPSBpbXBleHAuaWRzKCk7CiAgICAgICAgZm9yKGxldCBpZCBvZiBpZHMpIGltcG9ydGVkLmFkZChpZCk7CiAgICAgIH0KICAgIH0KCiAgICBsZXQgbnVtUmVwbGFjZSA9IDA7CiAgICBmb3IobGV0IGltcGV4cCBvZiBhbGxFeHBvcnRzSW1wb3J0cykgewogICAgICBpZihpbXBleHAudHlwZSA9PSBXaGF0LklNUE9SVCkgewogICAgICAgIGxldCBpZHMgPSBpbXBleHAuaWRzKCk7CgogICAgICAgIGlmKGlkcy5zb21lKGlkID0+ICF1c2VkLmhhcyhpZCkpKSB7CiAgICAgICAgICBsZXQgeyBjb2RlLCByYW5nZSwgZmlsZSB9ID0gaW1wZXhwOwogICAgICAgICAgbGV0IG5ld0NvZGUgPSBpbXBleHAudG9Db2RlKGlkID0+IHVzZWQuaGFzKGlkKSk7CiAgICAgICAgICBpZihjb2RlICE9IG5ld0NvZGUpIHsKICAgICAgICAgICAgbWFwLnJlcGxhY2VSYW5nZShyYW5nZSwgdG9BcnJheUJ1ZmZlcihuZXdDb2RlKSk7CiAgICAgICAgICAgICsrbnVtUmVwbGFjZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZihkZWJ1ZyA+PSAxKSBjb25zb2xlLmxvZyhgaW1wb3J0ZWQgWyAke3NvdXJjZX0gXWAsIGNvbnNvbGUuY29uZmlnKHsgY29tcGFjdDogMSB9KSwgWy4uLmltcG9ydGVkXSk7CiAgICB1c2VkID0gaW50ZXJzZWN0aW9uKHVzZWQsIGltcG9ydGVkKTsKICAgIGlmKGRlYnVnID49IDEpIGNvbnNvbGUubG9nKGB1c2VkICAgICBbICR7c291cmNlfSBdYCwgY29uc29sZS5jb25maWcoeyBjb21wYWN0OiAxIH0pLCBbLi4udXNlZF0pOwoKICAgIGxldCB1bnVzZWQgPSBkaWZmZXJlbmNlKGltcG9ydGVkLCB1c2VkKTsKCiAgICBpZihkZWJ1ZyA+PSAxKSBjb25zb2xlLmxvZyhgdW51c2VkICAgWyAke3NvdXJjZX0gXWAsIGNvbnNvbGUuY29uZmlnKHsgY29tcGFjdDogMSB9KSwgWy4uLnVudXNlZF0pOwoKICAgIGlmKG51bVJlcGxhY2UpIHsKICAgICAgbGV0IG91dCA9IEZpbGVSZXBsYWNlcihzb3VyY2UpOwogICAgICBsZXQgcmVzdWx0ID0gbWFwLndyaXRlKG91dCk7CiAgICAgIG91dC5jbG9zZSgpOwogICAgfQogIH0gZWxzZSB7CiAgICBmb3IobGV0IGltcGV4cCBvZiBhbGxFeHBvcnRzSW1wb3J0cykgewogICAgICBjb25zdCB7IHR5cGUsIGZpbGUsIHJhbmdlLCBjb2RlLCBsb2MgfSA9IGltcGV4cDsKICAgICAgY29uc3QgW3N0YXJ0LCBlbmRdID0gcmFuZ2U7CiAgICAgIC8vIGxldCBieXRlYnVmID0gQnVmZmVyRmlsZShzb3VyY2UpOwogICAgICBsZXQgYnVmc3RyID0gdG9TdHJpbmcoYnl0ZWJ1Zi5zbGljZSguLi5yYW5nZSkpOwogICAgICBsZXQgYXJyYnVmID0gdG9BcnJheUJ1ZmZlcihidWZzdHIpOwoKICAgICAgbGV0IHJlcGxhY2VtZW50ID0gdHlwZSA9PSBXaGF0LkVYUE9SVCA/IG51bGwgOiAvKkZpbGVNYXAuZm9yKi8gZmlsZTsKICAgICAgbGV0IHsgYnl0ZU9mZnNldCB9ID0gbG9jOwogICAgICBsZXQgcDsKCiAgICAgIC8qIHByZXR0aWVyLWlnbm9yZSAqLyBpZihkZWJ1ZyA+IDMpIGNvbnNvbGUubG9nKCdpbXBleHAnLCBjb21wYWN0KDIpLCB7IGNvZGUsIHJhbmdlOiBuZXcgTnVtZXJpY1JhbmdlKC4uLnJhbmdlKSwgcmVwbGFjZW1lbnQsIGxvYzogbG9jICsgJyd9KTsKCiAgICAgIGlmKHR5cGVvZiBmaWxlID09ICdzdHJpbmcnICYmICFJc0ZpbGVJbXBvcnQoZmlsZSkpIHsKICAgICAgICBpZihkZWJ1ZyA+IDEpIGNvbnNvbGUubG9nKGBceDFiWzE7MzFtSW5leGlzdGVudFx4MWJbMG0gZmlsZSAnJHtmaWxlfSdgKTsKCiAgICAgICAgLy8gaWYocHJpbnRGaWxlcykgc3RkLnB1dHMoYCR7cGF0aC5ub3JtYWxpemUoc291cmNlKX06ICR7ZmlsZX1cbmApOwoKICAgICAgICByZXBsYWNlbWVudCA9IG51bGw7CiAgICAgIH0gZWxzZSBpZihmaWxlICYmIHBhdGguaXNGaWxlKGZpbGUpKSB7CiAgICAgICAgcmVwbGFjZW1lbnQgPSBmaWxlOwogICAgICB9IGVsc2UgaWYoCiAgICAgICAgKHR5cGVvZiByZXBsYWNlbWVudCA9PSAnc3RyaW5nJyAmJiAhcGF0aC5pc0ZpbGUocmVwbGFjZW1lbnQpKSB8fAogICAgICAgIHR5cGUgPT0gV2hhdC5JTVBPUlQgfHwKICAgICAgICB0eXBlb2YgZmlsZSA9PSAnc3RyaW5nJwogICAgICApIHsKICAgICAgICByZXBsYWNlbWVudCA9IG51bGw7CiAgICAgIH0gZWxzZSBpZihjb2RlLnN0YXJ0c1dpdGgoJ2V4cG9ydCcpKSB7CiAgICAgICAgaWYoIXJlbW92ZUV4cG9ydHMpIGNvbnRpbnVlOwogICAgICAgIHJlcGxhY2VtZW50ID0gZmlsZTsKICAgICAgfQoKICAgICAgbGV0IGxpc3QgPSB0eXBlID09IFdoYXQuRVhQT1JUID8gZm9vdGVyIDogaGVhZGVyOwogICAgICBsaXN0LnB1c2goaW1wZXhwKTsKCiAgICAgIC8qIHByZXR0aWVyLWlnbm9yZSAqLyBpZihkZWJ1ZyA+PSAyKSBjb25zb2xlLmxvZygnaW1wZXhwJywgY29tcGFjdCgyKSwgeyBjb2RlLCByYW5nZTogbmV3IE51bWVyaWNSYW5nZSguLi5yYW5nZSksIHJlcGxhY2VtZW50LCBsb2M6IGxvYyArICcnfSk7CiAgICAgIC8qIHByZXR0aWVyLWlnbm9yZSAqLyBpZihkZWJ1ZyA+IDEpIGNvbnNvbGUubG9nKCdpbXBleHAnLCBjb21wYWN0KDEpLCB7IHJhbmdlOiBuZXcgTnVtZXJpY1JhbmdlKC4uLnJhbmdlKSwgbG9jOiBsb2MgKyAnJ30pOwoKICAgICAgbGV0IHN0cjsKICAgICAgaWYocmFuZ2UpIHN0ciA9IHRvU3RyaW5nKG1hcC5idWZmZXIuc2xpY2UoLi4ucmFuZ2UpKTsKCiAgICAgIG1hcC5yZXBsYWNlUmFuZ2UocmFuZ2UsIHJlcGxhY2VtZW50KTsKICAgIH0KICB9CgogIGlmKHJlbW92ZUNvbW1lbnRzICYmIGNvbW1lbnRzLmxlbmd0aCkgewogICAgaSA9IC0xOwogICAgZGVidWdMb2coYFJlbW92aW5nICR7Y29tbWVudHMubGVuZ3RofSBjb21tZW50cyBmcm9tICcke3NvdXJjZX0nYCk7CiAgICBmb3IobGV0IHsgYnl0ZVJhbmdlLCBsZXhlbWUgfSBvZiBjb21tZW50cykgewogICAgICBsZXQgc2wgPSBieXRlYnVmLnNsaWNlKC4uLmJ5dGVSYW5nZSk7CiAgICAgIGlmKGRlYnVnID4gMSkKICAgICAgICBkZWJ1Z0xvZyhgY29tbWVudFskeysraX1dYCwgY29tcGFjdCgyKSwgewogICAgICAgICAgYnl0ZVJhbmdlLAogICAgICAgICAgc3RyOiB0b1N0cmluZyhzbCkKICAgICAgICB9KTsKCiAgICAgIG1hcC5yZXBsYWNlUmFuZ2UoYnl0ZVJhbmdlLCBudWxsKTsKICAgIH0KICB9CgogIGVuZCA9IERhdGUubm93KCk7CgogIC8vIGNvbnNvbGUubG9nKGBTdWJzdGl0dXRpbmcgJyR7c291cmNlLnJlcGxhY2UoL15cLlwvLywgJycpfScgdG9vayAke2VuZCAtIHN0YXJ0fW1zYCk7CiAgcHJvY2Vzc2VkLmFkZChzb3VyY2UpOwoKICBpZihyZWN1cnNpdmUgPiAwKSB7CiAgICBmb3IobGV0IGltcCBvZiBmaWxlSW1wb3J0cykgewogICAgICBsZXQgeyBmaWxlLCByYW5nZSwgdG9rZW5zIH0gPSBpbXA7CgogICAgICBpZihyZWFkUGFja2FnZSkgewogICAgICAgIGxldCBhbGlhcyA9IFJlc29sdmVBbGlhcyhmaWxlKTsKICAgICAgICBpZihhbGlhcyAhPSBmaWxlKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhgXHgxYlsxOzMxbUFsaWFzaW5nICcke2ZpbGV9JyB0byAnJHthbGlhc30nXHgxYlswbWApOwogICAgICAgICAgZmlsZSA9IGFsaWFzOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYoIS9cLnxcLy8udGVzdChmaWxlKSkgewogICAgICAgIC8vY29uc29sZS5sb2coYEJ1aWx0aW4gbW9kdWxlICcke2ZpbGV9J2ApOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICBpZighcGF0aC5pc0ZpbGUoZmlsZSkpIHsKICAgICAgICBjb25zb2xlLmxvZyhgUGF0aCBtdXN0IGV4aXN0ICcke2ZpbGV9J2ApOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICBpZihwcm9jZXNzZWQuaGFzKGZpbGUpIHx8IGZpbGUgPT0gc291cmNlKSB7CiAgICAgICAgLy9jb25zb2xlLmxvZyhgQWxyZWFkeSBwcm9jZXNzZWQgJyR7ZmlsZX0nYCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIGZpbGUgPSBOb3JtYWxpemVQYXRoKGZpbGUpOwogICAgICBmaWxlID0gTW9kdWxlTG9hZGVyKGZpbGUpOwoKICAgICAgaWYoZmlsZSkgewogICAgICAgIHByb2Nlc3NlZC5hZGQoZmlsZSk7CgogICAgICAgIEFkZERlcChzb3VyY2UsIGZpbGUpOwoKICAgICAgICBpZihkZWJ1ZyA+IDIpIGNvbnNvbGUubG9nKGBSZWN1cnNpbmdgLCB7IHNvdXJjZSwgZmlsZSB9KTsKCiAgICAgICAgUHJvY2Vzc0ZpbGUoZmlsZSwgbG9nLCB0eXBlb2YgcmVjdXJzaXZlID09ICdudW1iZXInID8gcmVjdXJzaXZlIC0gMSA6IHJlY3Vyc2l2ZSwgZGVwdGggKyAxKTsKICAgICAgfQogICAgfQogIH0KCiAgc3RkLmdjKCk7CgogIGlmKHNob3dEZXBzKSB7CiAgICBsZXQgZGVwcyA9IFsuLi5EZXBlbmRlbmN5VHJlZShzb3VyY2UsICcgJywgZmFsc2UsIDAsICcgICAgJyldOwogICAgY29uc29sZS5sb2coYERlcGVuZGVuY2llcyBvZiAnJHtzb3VyY2V9JzpcbiR7U3ByZWFkQW5kSm9pbihkZXBzKX1gKTsKICAgIC8vY29uc29sZS5sb2coYGRlcGVuZGVuY3lNYXBgLFsuLi5kZXBlbmRlbmN5TWFwXSk7CiAgfQoKICByZXR1cm4gbWFwOwp9CgpmdW5jdGlvbiBBZGREZXAoc291cmNlLCBmaWxlKSB7CiAgc291cmNlID0gTm9ybWFsaXplUGF0aChzb3VyY2UpOwoKICBpZihkZWJ1ZyA+IDIpIGNvbnNvbGUubG9nKGBBZGQgZGVwZW5kZW5jeSAnJHtmaWxlfScgdG8gJyR7c291cmNlfSdgKTsKICBkZXBlbmRlbmN5VHJlZShzb3VyY2UpLnB1c2goZmlsZSk7Cn0KCmZ1bmN0aW9uIElzV1ModG9rKSB7CiAgcmV0dXJuIHRvay50eXBlID09ICd3aGl0ZXNwYWNlJzsKfQoKZnVuY3Rpb24gTm9uV1ModG9rZW5zKSB7CiAgcmV0dXJuIHRva2Vucy5maWx0ZXIodG9rID0+ICFJc1dTKHRvaykpOwp9CgpmdW5jdGlvbiBMZWFkaW5nV1Moc3RyKSB7CiAgbGV0IG0gPSBzdHIubWF0Y2goL1teXHNdLyk7CiAgcmV0dXJuIG0/LmluZGV4ID8/IDA7Cn0KCmZ1bmN0aW9uIFRva2VuU2VxdWVuY2UodG9rZW5zKSB7CiAgcmV0dXJuIGRlZmluZSgKICAgIHRva2Vucy5tYXAodG9rID0+IHRvay5sZXhlbWUpLAogICAgewogICAgICB0b1N0cmluZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5qb2luKCcnKTsKICAgICAgfQogICAgfQogICk7Cn0KCmZ1bmN0aW9uIEFkZFdoaXRlc3BhY2UodG9rZW5zKSB7CiAgcmV0dXJuIHRva2Vucy5yZWR1Y2UoKGFjYywgdG9rKSA9PiB7CiAgICBpZihhY2MubGVuZ3RoKSB7CiAgICAgIGlmKHRvay5sZXhlbWUgIT0gJywnKQogICAgICAgIGlmKCFJc1dTKGFjY1thY2MubGVuZ3RoIC0gMV0pICYmICFJc1dTKHRvaykpIGFjYy5wdXNoKHsgdHlwZTogJ3doaXRlc3BhY2UnLCBsZXhlbWU6ICcgJyB9KTsKICAgIH0KCiAgICBhY2MucHVzaCh0b2spOwogICAgcmV0dXJuIGFjYzsKICB9LCBbXSk7Cn0KCmZ1bmN0aW9uIFVucXVvdGUobGV4ZW1lKSB7CiAgcmV0dXJuIGxleGVtZS5yZXBsYWNlKC8oXltcJ1wiXGBdfFtcJ1wiXGBdJCkvZywgJycpOwp9CgpmdW5jdGlvbiBMaXRlcmFsU2VxdWVuY2UodG9rZW5zKSB7CiAgcmV0dXJuIHRva2Vucy5yZWR1Y2UoKGFjYywgdG9rKSA9PiBhY2MgKyB0b2subGV4ZW1lLCAnJyk7Cn0KCmZ1bmN0aW9uIFVudGlsRU9MKGlkeCwgdG9rZW5zKSB7CiAgcmV0dXJuIFVudGlsKGlkeCwgdG9rZW5zLCBUb2tJcyhudWxsLCAnOycpKTsKfQoKZnVuY3Rpb24gVW50aWwoaWR4LCB0b2tlbnMsIHByZWQgPSBUb2tJcyhudWxsLCBbJzsnLCAnXG4nXSkpIHsKICBsZXQgaTsKICBmb3IoaSA9IGlkeDsgdG9rZW5zW2ldOyBpKyspIHsKICAgIGlmKHByZWQodG9rZW5zW2ldKSkgYnJlYWs7CiAgfQoKICByZXR1cm4gdG9rZW5zLnNsaWNlKGlkeCwgaSk7Cn0KCmZ1bmN0aW9uIFdob2xlTGluZShpZHgsIHRva2VucykgewogIGxldCBpLCBqOwogIGZvcihpID0gaWR4OyB0b2tlbnNbaV07IGkrKykgewogICAgaWYoWyc7JywgJ1xuJ10uaW5kZXhPZih0b2tlbnNbaV0ubGV4ZW1lKSAhPSAtMSkgYnJlYWs7CiAgfQoKICBmb3IoaiA9IGlkeDsgaiA+IDA7IGotLSkgewogICAgY29uc3QgdG9rID0gdG9rZW5zW2ogLSAxXTsKICAgIGlmKCF0b2sgfHwgWyc7JywgJ1xuJ10uaW5kZXhPZih0b2tlbnNbaiAtIDFdLmxleGVtZSkgIT0gLTEpIGJyZWFrOwogIH0KCiAgcmV0dXJuIHRva2Vucy5zbGljZShqLCBpKTsKfQoKZnVuY3Rpb24gUmFuZ2UoZmlsZSwgc3RhcnQsIGVuZCkgewogIGxldCBidWY7CiAgaWYoKGJ1ZiA9IEJ1ZmZlckZpbGUoZmlsZSkpKSB7CiAgICB0aGlzLmZpbGUgPSBmaWxlOwogICAgdGhpcy5zdGFydCA9IHN0YXJ0ID8/IDA7CiAgICB0aGlzLmVuZCA9IGVuZCA/PyBidWYuYnl0ZUxlbmd0aDsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgcmV0dXJuIG51bGw7Cn0KClJhbmdlLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewogIGxldCBidWYgPSBCdWZmZXJGaWxlKHRoaXMuZmlsZSk7CiAgcmV0dXJuIGJ1Zi5zbGljZSh0aGlzLnN0YXJ0LCB0aGlzLmVuZCk7Cn07CgpmdW5jdGlvbiBJblJhbmdlKFtzdGFydCwgZW5kXSwgaSkgewogIGlmKGkgPj0gc3RhcnQgJiYgaSA8IGVuZCkgcmV0dXJuIHRydWU7CiAgcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBJc1JhbmdlKG9iaikgewogIHJldHVybiBpc09iamVjdChvYmopICYmICgnbGVuZ3RoJyBpbiBvYmogfHwgJ3N0YXJ0JyBpbiBvYmogfHwgb2JqIGluc3RhbmNlb2YgTnVtZXJpY1JhbmdlKTsKfQoKY2xhc3MgTnVtZXJpY1JhbmdlIGV4dGVuZHMgQXJyYXkgewogIGNvbnN0cnVjdG9yKHN0YXJ0LCBlbmQpIHsKICAgIHN1cGVyKDIpOwogICAgaWYoaXNOYU4oK3N0YXJ0KSkgc3RhcnQgPSAwOwogICAgdGhpc1swXSA9ICtzdGFydDsKICAgIGlmKGlzTmFOKCtlbmQpKSBlbmQgPSB0aGlzWzBdOwogICAgdGhpc1sxXSA9IGVuZDsKICB9CgogIGdldCBzdGFydCgpIHsKICAgIHJldHVybiB0aGlzWzBdOwogIH0KCiAgc2V0IHN0YXJ0KHZhbHVlKSB7CiAgICB0aGlzWzBdID0gK3ZhbHVlOwogIH0KCiAgZ2V0IGVuZCgpIHsKICAgIHJldHVybiB0aGlzWzFdOwogIH0KCiAgc2V0IGVuZCh2YWx1ZSkgewogICAgdGhpc1sxXSA9ICt2YWx1ZTsKICB9CgogIGdldCBzaXplKCkgewogICAgcmV0dXJuIHRoaXNbMV0gLSB0aGlzWzBdOwogIH0KCiAgY2xvbmUoKSB7CiAgICByZXR1cm4gbmV3IE51bWVyaWNSYW5nZSguLi50aGlzKTsKICB9CgogIGluc2lkZShuKSB7CiAgICBsZXQgW3MsIGVdID0gdGhpczsKICAgIHJldHVybiBuID49IHMgJiYgbiA8IGU7CiAgfQoKICBzdGF0aWMgZnJvbShyYW5nZSkgewogICAgaWYoaXNPYmplY3QocmFuZ2UpICYmIHJhbmdlIGluc3RhbmNlb2YgTnVtZXJpY1JhbmdlKSByZXR1cm4gcmFuZ2U7CgogICAgdHJ5IHsKICAgICAgbGV0IHIgPSBuZXcgTnVtZXJpY1JhbmdlKC4uLnJhbmdlKTsKICAgICAgcmFuZ2UgPSByOwogICAgfSBjYXRjaChlKSB7fQoKICAgIGNvbnNvbGUubG9nKCdOdW1lcmljUmFuZ2UuZnJvbScsIHJhbmdlKTsKICAgIHJldHVybiByYW5nZTsKICB9CgogIHN0YXRpYyAqaG9sZXMocmFuZ2VzLCBvbmx5ID0gZmFsc2UpIHsKICAgIGxldCBwcmV2ID0gWzAsIDBdOwogICAgbGV0IGkgPSAtMTsKICAgIGZvcihsZXQgcmFuZ2Ugb2YgcmFuZ2VzKSB7CiAgICAgIGlmKElzUmFuZ2UocmFuZ2UpKSB7CiAgICAgICAgcmFuZ2UgPSBbLi4ucmFuZ2VdOwogICAgICAgIGNvbnNvbGUubG9nKCdyYW5nZSMnICsgKytpLCBpbnNwZWN0KHJhbmdlKSk7CiAgICAgICAgaWYoSXNSYW5nZShwcmV2KSAmJiBJc1JhbmdlKHJhbmdlKSkgewogICAgICAgICAgbGV0IFtzdGFydCwgZW5kXSA9IHJhbmdlOwogICAgICAgICAgaWYoc3RhcnQgPj0gcHJldlsxXSkgeWllbGQgbmV3IE51bWVyaWNSYW5nZShwcmV2WzFdLCBzdGFydCk7CiAgICAgICAgfQogICAgICAgIGlmKCFvbmx5KSB7CiAgICAgICAgICBpZighKGlzT2JlY3QocmFuZ2UpICYmIHJhbmdlIGluc3RhbmNlb2YgTnVtZXJpY1JhbmdlKSkgcmFuZ2UgPSBuZXcgTnVtZXJpY1JhbmdlKC4uLnJhbmdlKTsKICAgICAgICAgIHlpZWxkIHJhbmdlOwogICAgICAgIH0KICAgICAgfQogICAgICBwcmV2ID0gcmFuZ2U7CiAgICB9CiAgfQoKICBzdGF0aWMgYmV0d2VlbihbczEsIGUxXSwgW3MyLCBlMl0pIHsKICAgIGlmKHMyID4gZTEpIHJldHVybiBbZTEsIHMyXTsKICAgIGlmKHMxID4gZTIpIHJldHVybiBbZTIsIHMxXTsKICB9Cn0KCmRlZmluZShOdW1lcmljUmFuZ2UucHJvdG90eXBlLCB7CiAgW1N5bWJvbC50b1N0cmluZ1RhZ106ICdOdW1lcmljUmFuZ2UnLAogIFtpbnNwZWN0U3ltYm9sXShkZXB0aCwgb3B0cykgewogICAgY29uc3QgW3N0YXJ0LCBlbmRdID0gdGhpczsKICAgIGxldCBzID0gJyc7CiAgICBjb25zdCBwYWQgPSBzID0+IChzICsgJycpLnBhZEVuZCg1KTsKICAgIHMgKz0gYFx4MWJbMTszNm0ke3BhZChzdGFydCl9XHgxYlswbWA7CiAgICBzICs9IGAgLSBgOwogICAgcyArPSBgXHgxYlsxOzM2bSR7cGFkKCcrJyArIChlbmQgLSBzdGFydCkpfVx4MWJbMG1gOwogICAgcyA9IGBbICR7c30gXWA7CiAgICByZXR1cm4gczsKICB9Cn0pOwoKY2xhc3MgRmlsZU1hcCBleHRlbmRzIEFycmF5IHsKICBzdGF0aWMgYnVmZmVycyA9IG1hcFdyYXBwZXIoZmlsZUJ1ZmZlcnMpOwogIHN0YXRpYyBmaWxlbmFtZXMgPSBtYXBXcmFwcGVyKGJ1ZmZlclJlZik7CgogIGNvbnN0cnVjdG9yKGZpbGUsIGJ1ZikgewogICAgc3VwZXIoKTsKICAgIGlmKHR5cGVvZiBmaWxlICE9ICdudW1iZXInKSB7CiAgICAgIHRoaXMuZmlsZSA9IGZpbGU7CiAgICAgIGJ1ZiA/Pz0gQnVmZmVyRmlsZShmaWxlKTsKICAgICAgaWYoIWJ1ZikgdGhyb3cgbmV3IEVycm9yKGBGaWxlTWFwIGJ1ZiA9PSAke2J1Zn1gKTsKICAgICAgdGhpcy5wdXNoKFtbMCwgYnVmLmJ5dGVMZW5ndGhdLCBidWZdKTsKICAgICAgZmlsZU1hcHMuc2V0KGZpbGUsIHRoaXMpOwogICAgfQogIH0KCiAgZ2V0IGJ1ZmZlcigpIHsKICAgIHJldHVybiBGaWxlTWFwLmJ1ZmZlcnMocGF0aC5ub3JtYWxpemUodGhpcy5maWxlKSk7CiAgfQoKICBzdGF0aWMgZW1wdHkoZmlsZSkgewogICAgaWYodHlwZW9mIGZpbGUgPT0gJ3N0cmluZycpIGZpbGUgPSBGaWxlTWFwLmZvcihmaWxlKTsKICAgIGlmKGlzT2JqZWN0KGZpbGUpICYmIGZpbGUgaW5zdGFuY2VvZiBGaWxlTWFwKSByZXR1cm4gZmlsZS5pc0VtcHR5KCk7CiAgfQoKICBpc0VtcHR5KCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgc3RhdGljIGZvcihmaWxlLCBidWYpIHsKICAgIGxldCBtOwogICAgaWYoZmlsZSAmJiAobSA9IGZpbGVNYXBzLmdldChmaWxlKSkpIHJldHVybiBtOwogICAgaWYoaXNPYmplY3QoZmlsZSkgJiYgZmlsZSBpbnN0YW5jZW9mIEZpbGVNYXApIHJldHVybiBmaWxlOwogICAgZWxzZSBpZihmaWxlID09PSBudWxsICYmICFidWYpIHsKICAgICAgbGV0IG9iaiA9IHsKICAgICAgICBpc0VtcHR5KCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSwKICAgICAgICB0b1N0cmluZygpIHsKICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9LAogICAgICAgIFtTeW1ib2wudG9TdHJpbmdUYWddOiAnRmlsZU1hcChlbXB0eSknCiAgICAgIH07CiAgICAgIHJldHVybiBPYmplY3Quc2V0UHJvdG90eXBlT2Yob2JqLCBGaWxlTWFwLnByb3RvdHlwZSk7CiAgICB9CiAgICBpZihmaWxlTWFwcy5oYXMoZmlsZSkpIHJldHVybiBmaWxlTWFwcy5nZXQoZmlsZSk7CiAgICBidWYgPz89IEZpbGVNYXAuYnVmZmVycyhwYXRoLm5vcm1hbGl6ZShmaWxlKSk7CiAgICByZXR1cm4gbmV3IEZpbGVNYXAoZmlsZSwgYnVmKTsKICB9CgogIGZpbmRTbGljZShwb3MpIHsKICAgIGNvbnN0IG4gPSB0aGlzLmxlbmd0aDsKICAgIGZvcihsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgbGV0IHJhbmdlOwogICAgICBpZigocmFuZ2UgPSB0aGlzLnJhbmdlc1tpXSkpIHsKICAgICAgICByYW5nZSA9IFsuLi5yYW5nZV07CiAgICAgICAgaWYoSW5SYW5nZShbLi4ucmFuZ2VdLCBwb3MpKSByZXR1cm4gaTsKICAgICAgfQogICAgfQoKICAgIC8vICByZXR1cm4gLTE7CiAgICByZXR1cm4gdGhpcy5maW5kSW5kZXgoKFtyYW5nZSwgYnVmXSkgPT4gcmFuZ2UgJiYgSW5SYW5nZShbLi4ucmFuZ2VdLCBwb3MpKTsKICB9CgogIHNwbGl0QXQocG9zKSB7CiAgICBsZXQgaTsKICAgIGlmKChpID0gdGhpcy5maW5kUG9zKHBvcykpICE9IC0xKSB7CiAgICAgIGNvbnNvbGUubG9nKCdzcGxpdEF0JywgeyBpIH0pOwogICAgICBsZXQgW3JhbmdlLCBidWZdID0gdGhpc1tpXTsKICAgICAgbGV0IFtzdGFydCwgZW5kXSA9IHJhbmdlOwoKICAgICAgaWYoc3RhcnQgPT09IHBvcykgcmV0dXJuIGk7CgogICAgICB0aGlzLnNwbGljZShpICsgMSwgMCwgW25ldyBOdW1lcmljUmFuZ2UoKHJhbmdlWzFdID0gcG9zKSwgZW5kKSwgYnVmXSk7CiAgICAgIHJldHVybiBpICsgMTsKICAgIH0KICAgIHJldHVybiAtMTsKICB9CgogIGZpbmRQb3MocG9zKSB7CiAgICBjb25zdCBuID0gdGhpcy5sZW5ndGg7CgogICAgZm9yKGxldCBpID0gMDsgaSA8IG47IGkrKykgewogICAgICBsZXQgW3JhbmdlLCBidWZdID0gdGhpc1tpXTsKICAgICAgbGV0IG5leHQgPSB0aGlzW2kgKyAxXTsKICAgICAgaWYocmFuZ2UpIHsKICAgICAgICBsZXQgW3N0YXJ0LCBlbmRdID0gcmFuZ2U7CiAgICAgICAgaWYocG9zIDwgZW5kKSByZXR1cm4gaTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIC0xOwogIH0KCiAgaW5zZXJ0QXQocG9zLCBmaWxlKSB7CiAgICBsZXQgaTsKICAgIGxldCBlbnRyeSA9IHR5cGVzLmlzQXJyYXlCdWZmZXIoZmlsZSkgPyBbbnVsbCwgZmlsZV0gOiBbbnVsbCwgbnVsbCwgZmlsZV07CgogICAgaWYocG9zIDw9IHRoaXMucmFuZ2VBdCgwKVswXSkgewogICAgICB0aGlzLnVuc2hpZnQoZW50cnkpOwogICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBpZigoaSA9IHRoaXMuc3BsaXRBdChwb3MpKSAhPSAtMSkgewogICAgICB0aGlzLnNwbGljZShpLCAwLCBlbnRyeSk7CiAgICAgIHJldHVybiBpOwogICAgfQogIH0KCiAgaW5zZXJ0KGluZGV4LCBmaWxlKSB7CiAgICBsZXQgZW50cnkgPSB0eXBlcy5pc0FycmF5QnVmZmVyKGZpbGUpID8gW251bGwsIGZpbGVdIDogW251bGwsIG51bGwsIGZpbGVdOwogICAgdGhpcy5zcGxpY2UoaW5kZXgsIDAsIGVudHJ5KTsKICAgIHJldHVybiBpbmRleDsKICB9CgogIHJlcGxhY2VSYW5nZShyYW5nZSwgZmlsZSkgewogICAgaWYoQXJyYXkuaXNBcnJheShyYW5nZSkgJiYgIShyYW5nZSBpbnN0YW5jZW9mIE51bWVyaWNSYW5nZSkpIHJhbmdlID0gbmV3IE51bWVyaWNSYW5nZSguLi5yYW5nZSk7CiAgICBjb25zdCBzbGljZUluZGV4ID0gbiA9PiB7CiAgICAgIGxldCBpLCByLCBpdGVtOwogICAgICBpZih0aGlzWzBdICYmIHRoaXNbMF1bMF0gIT0gbnVsbCkgewogICAgICAgIGNvbnN0IHJhbmdlID0gbmV3IE51bWVyaWNSYW5nZSguLi50aGlzWzBdWzBdKTsKICAgICAgICBpZihuIDwgcmFuZ2Uuc3RhcnQpIHJldHVybiAwOwogICAgICB9CiAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSB0aGlzOwogICAgICBmb3IoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGlmKCF0eXBlcy5pc0FycmF5QnVmZmVyKHRoaXNbaV1bMV0pKSBjb250aW51ZTsKCiAgICAgICAgaWYodGhpc1tpXSAmJiAoaXRlbSA9IHRoaXNbaV1bMF0pKSB7CiAgICAgICAgICBjb25zdCBbc3RhcnQsIGVuZF0gPSBpdGVtOwogICAgICAgICAgaWYobiA8IGVuZCkgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBpOwogICAgfTsKICAgIC8qIHByZXR0aWVyLWlnbm9yZSAqLyBpZihkZWJ1ZyA+IDEpIGNvbnNvbGUubG9nKCdGaWxlTWFwLnJlcGxhY2VSYW5nZScsIGNvbXBhY3QoMiwgeyBjdXN0b21JbnNwZWN0OiB0cnVlIH0pLCB7IGZpbGUsIHJhbmdlOiBbcmFuZ2VbMF0sIHJhbmdlWzFdXSB9KTsKCiAgICBsZXQgaSA9IHNsaWNlSW5kZXgocmFuZ2VbMF0pOwogICAgbGV0IGogPSBzbGljZUluZGV4KHJhbmdlWzFdKTsKCiAgICBjb25zdCB7IGxlbmd0aCB9ID0gdGhpczsKCiAgICBpZihyYW5nZVswXSA8IHRoaXNbaV1bMF0pIHJhbmdlWzBdID0gdGhpc1tpXVswXTsKCiAgICBpZighdGhpc1tpXVswXSkKICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgIGByYW5nZT0ke3JhbmdlfVxubGVuZ3RoPSR7dGhpcy5sZW5ndGh9XG5zdGFydD0ke2l9XG5lbmQ9JHtqfVxudGhpc1ske2l9XT0ke2luc3BlY3QodGhpc1tpXSl9XG50aGlzWyR7CiAgICAgICAgICBpIC0gMQogICAgICAgIH1dPSR7aW5zcGVjdCh0aGlzW2kgLSAxXSl9XG50aGlzWyR7aSArIDF9XT0ke2luc3BlY3QodGhpc1tpICsgMV0pfWAKICAgICAgKTsKCiAgICBsZXQgWywgYnVmXSA9IHRoaXNbaV07CiAgICBsZXQgZW1wdHkgPSB0eXBlb2YgZmlsZSAhPSAnc3RyaW5nJzsKICAgIGxldCBlbnRyeSA9IFtyYW5nZSwgbnVsbF0uY29uY2F0KGVtcHR5ID8gW10gOiBbZmlsZV0pOwoKICAgIGlmKHJhbmdlWzBdID4gdGhpc1tpXVswXVswXSkgewogICAgICBpZihpID09IGopIHsKICAgICAgICBsZXQgW3JhbmdlXSA9IHRoaXNbaV07CiAgICAgICAgbGV0IGluc2VydCA9IFtuZXcgTnVtZXJpY1JhbmdlKC4uLnJhbmdlKSwgYnVmXTsKICAgICAgICB0aGlzLnNwbGljZSgrK2osIDAsIGluc2VydCk7CiAgICAgIH0KICAgICAgdGhpc1tpXVswXVsxXSA9IHJhbmdlWzBdOwoKICAgICAgaWYodGhpc1tqXSAmJiB0aGlzW2pdWzBdKSB0aGlzW2pdWzBdWzBdID0gcmFuZ2VbMV07CiAgICB9IGVsc2UgewogICAgICB0aGlzW2ldWzBdWzBdID0gcmFuZ2VbMV07CiAgICAgIGxldCBbW3N0YXJ0LCBlbmRdXSA9IHRoaXNbaV07CgogICAgICBsZXQgcmVtYWluID0gZW5kIC0gc3RhcnQ7CgogICAgICB0aGlzLnNwbGljZShpLCByZW1haW4gPT0gMCA/IDEgOiAwLCAuLi4oZW1wdHkgPyBbXSA6IFtlbnRyeV0pKTsKICAgICAgZmlsZSA9IG51bGw7CiAgICB9CgogICAgaWYoZmlsZSAhPSBudWxsKSB0aGlzLnNwbGljZShpICsgMSwgMCwgZW50cnkpOwoKICAgIC8qIHByZXR0aWVyLWlnbm9yZSAqLyBpZihkZWJ1ZyA+IDIpIGNvbnNvbGUubG9nKCdGaWxlTWFwLnJlcGxhY2VSYW5nZScsIGNvbnNvbGUuY29uZmlnKHsgY29tcGFjdDogMTAgfSksIHsgaSwgaiwgbGVuZ3RoLCB0aGlzOiB0aGlzIH0pOwoKICAgIC8vaWYodGhpcy5yYW5nZUF0KDApWzBdICE9IDApIHRocm93IG5ldyBFcnJvcignSW5jb25zaXN0ZW50IEZpbGVNYXAnKTsKICB9CgogIHN0cmluZ0F0KG4pIHsKICAgIGxldCBhcnIgPSBbXTsKICAgIGxldCB3ciA9IEFycmF5V3JpdGVyKGFyciwgKGJ1ZiwgbGVuKSA9PiB0b1N0cmluZyhidWYsIGxlbikpOwogICAgbGV0IGl0ZW0gPSB0aGlzLmF0KG4pID8/ICcnOwoKICAgIGlmKGlzT2JqZWN0KGl0ZW0pICYmICd3cml0ZScgaW4gaXRlbSkgaXRlbS53cml0ZSh3cik7CiAgICBlbHNlIGlmKHR5cGVvZiBpdGVtID09ICdzdHJpbmcnKSB3ci5wdXRzKGl0ZW0pOwogICAgZWxzZSB3ci53cml0ZShpdGVtKTsKICAgIHJldHVybiBhcnIuam9pbignJyk7CiAgfQoKICByYW5nZUF0KG4pIHsKICAgIGlmKG4gaW4gdGhpcykgewogICAgICBsZXQgcjsKICAgICAgaWYodGhpc1tuXVswXSkgciA9IHRoaXNbbl1bMF07CiAgICAgIGVsc2UgaWYodHlwZXMuaXNBcnJheUJ1ZmZlcih0aGlzW25dWzFdKSkgewogICAgICAgIGxldCBzdGFydCA9IG4gPiAwID8gdGhpcy5yYW5nZUF0KG4gLSAxKVsxXSA6IDA7CiAgICAgICAgbGV0IGVuZCA9IHN0YXJ0ICsgdGhpc1tuXVsxXS5ieXRlTGVuZ3RoOwogICAgICAgIHIgPSBbc3RhcnQsIGVuZF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgciA9IFtuID4gMCA/IHRoaXMucmFuZ2VBdChuIC0gMSlbMV0gOiAwLCBuICsgMSA8IHRoaXMubGVuZ3RoID8gdGhpcy5yYW5nZUF0KG4gKyAxKVswXSA6IEluZmluaXR5XTsKICAgICAgfQogICAgICByZXR1cm4gciA/IG5ldyBOdW1lcmljUmFuZ2UoLi4ucikgOiBudWxsOwogICAgfQogIH0KCiAgZ2V0IHJhbmdlcygpIHsKICAgIGxldCByID0gW107CiAgICBsZXQgeyBsZW5ndGggfSA9IHRoaXM7CiAgICBmb3IobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHIucHVzaCh0aGlzW2ldWzBdID09PSBudWxsID8gbnVsbCA6IHRoaXMucmFuZ2VBdChpKSk7CiAgICByZXR1cm4gcjsKICB9CgogIGR1bXAoKSB7CiAgICBjb25zdCBzb3VyY2UgPSB0aGlzLmZpbGU7CiAgICByZXR1cm4gKAogICAgICBgRmlsZU1hcCB7XG5cdGZpbGU6IFx4MWJbMzg7NTsyMTVtJHtzb3VyY2V9LFxuXHRceDFiWzBtWyBgICsKICAgICAgWy4uLnRoaXNdCiAgICAgICAgLm1hcCgoaXRlbSwgaSkgPT4gaXRlbS5jb25jYXQoW3RoaXMuYXQoaSldKSkKICAgICAgICAucmVkdWNlKChhY2MsIFtyYW5nZSwgYnVmLCBzdHJdLCBpKSA9PiB7CiAgICAgICAgICBsZXQgcyA9IGFjYyArIGBcblx0XHRbIGA7CiAgICAgICAgICBzICs9ICgnJyArIChyYW5nZSA/ICdbJyArIE51bWVyaWNSYW5nZS5mcm9tKHJhbmdlKSArICddJyA6IHJhbmdlKSkucGFkRW5kKDEwKTsKICAgICAgICAgIHMgKz0gJywgJzsKICAgICAgICAgIGlmKGlzT2JqZWN0KGJ1ZikgJiYgJ2J5dGVMZW5ndGgnIGluIGJ1ZikgewogICAgICAgICAgICBsZXQgZmlsZW5hbWUgPSBidWZmZXJSZWYuZ2V0KGJ1Zik7CiAgICAgICAgICAgIGJ1ZiA9IGZpbGVuYW1lID8/IGA8dGhpcz5gOwogICAgICAgICAgfQoKICAgICAgICAgIGlmKHR5cGVvZiBidWYgPT0gJ3N0cmluZycpIGJ1ZiA9IHBhdGgubm9ybWFsaXplKGJ1Zik7CiAgICAgICAgICBzICs9IGluc3BlY3QoYnVmLCB7IG1heEFycmF5TGVuZ3RoOiAzMCB9KTsKICAgICAgICAgIHMgKz0gYCBdLGA7CiAgICAgICAgICByZXR1cm4gczsKICAgICAgICB9LCAnJykgKwogICAgICBgXG5cdF1cbn1gCiAgICApOwogIH0KCiAgYXQoaSkgewogICAgaWYoIXRoaXNbaV0pIHJldHVybiBudWxsOwogICAgY29uc3QgW3JhbmdlLCBidWYsIGZpbGVdID0gdGhpc1tpXTsKICAgIC8vY29uc29sZS5sb2coYGF0KCR7aX0pYCwgeyByYW5nZSwgYnVmLCBmaWxlIH0pOwoKICAgIGlmKHR5cGVzLmlzQXJyYXlCdWZmZXIoYnVmKSkgcmV0dXJuIGJ1Zi5zbGljZSguLi4ocmFuZ2UgPz8gW10pKTsKCiAgICBpZihidWYgPT0gbnVsbCAmJiB0eXBlb2YgZmlsZSA9PSAnc3RyaW5nJykgewogICAgICBpZighcGF0aC5pc0ZpbGUoZmlsZSkpIHRocm93IEVycm9yKGBGaWxlTWFwXHgxYlsxOzM1bTwke3RoaXMuZmlsZX0+XHgxYlswbSBJbmV4aXN0ZW50IGZpbGUgJyR7ZmlsZX0nYCk7CiAgICAgIHJldHVybiBGaWxlTWFwLmZvcihmaWxlKTsKICAgIH0KICB9CgogIHRvQXJyYXkoKSB7CiAgICByZXR1cm4gdGhpcy5tYXAoKHMsIGkpID0+IHsKICAgICAgcyA9IHRoaXMuYXQoaSk7CiAgICAgIGlmKGlzT2JqZWN0KHMpICYmICd0b0FycmF5JyBpbiBzKSBzID0gcy50b0FycmF5KCk7CiAgICAgIHJldHVybiBzOwogICAgfSk7CiAgfQoKICBob2xlcygpIHsKICAgIGxldCByYW5nZXMgPSBbLi4udGhpcy5tYXAoKFtyYW5nZV0pID0+IHJhbmdlKV0uc29ydChDb21wYXJlUmFuZ2UpOwogICAgbGV0IGl0ZXIgPSBOdW1lcmljUmFuZ2UuaG9sZXMocmFuZ2VzLCB0cnVlKTsKICAgIGxldCBob2xlcyA9IFsuLi5pdGVyXTsKICAgIGxldCBsZW4gPSBob2xlcy5sZW5ndGg7CiAgICBmb3IobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgY29uc3QgaG9sZSA9IGhvbGVzW2ldOwogICAgICBjb25zdCBbcmFuZ2VdID0gdGhpc1tpXTsKICAgICAgY29uc29sZS5sb2coJyMnICsgKGkgKyAxKSwgY29tcGFjdCgyKSwgaW5zcGVjdCh7IGhvbGUsIHJhbmdlIH0sIHsgY29tcGFjdDogMiwgZGVwdGg6IEluZmluaXR5IH0pKTsKICAgIH0KICAgIHJldHVybiBob2xlczsKICB9CgogIGZpcnN0Q2h1bmsoKSB7CiAgICByZXR1cm4gdGhpcy5maW5kSW5kZXgoKFtyYW5nZSwgYnVmXSwgaSkgPT4gcmFuZ2UgJiYgYnVmICYmICFJc1doaXRlU3BhY2UodG9TdHJpbmcoYnVmLnNsaWNlKC4uLnJhbmdlKSkpKTsKICB9CgogIGxhc3RDaHVuaygpIHsKICAgIHJldHVybiB0aGlzLmZpbmRMYXN0SW5kZXgoKFtyYW5nZSwgYnVmXSwgaSkgPT4gcmFuZ2UgJiYgYnVmICYmICFJc1doaXRlU3BhY2UodG9TdHJpbmcoYnVmLnNsaWNlKC4uLnJhbmdlKSkpKTsKICB9CgogIHdyaXRlKG91dCwgZGVwdGggPSAwLCBzZXJpYWwpIHsKICAgIGlmKGRlYnVnID4gMykgZGVidWdMb2coYEZpbGVNYXBceDFiWzE7MzVtPCR7dGhpcy5maWxlfT5ceDFiWzBtLndyaXRlYCwgY29tcGFjdCgxKSwgeyBvdXQsIGRlcHRoLCBzZXJpYWwgfSk7CiAgICBsZXQgciwKICAgICAgd3JpdHRlbiA9IDA7CiAgICBsZXQgeyBsZW5ndGggfSA9IHRoaXM7CiAgICBzZXJpYWwgPz89IHJhbmRJbnQoMCwgMTAwMCk7CiAgICBpZih0aGlzLnNlcmlhbCA9PT0gc2VyaWFsKSByZXR1cm4gMDsKICAgIHRoaXMuc2VyaWFsID0gc2VyaWFsOwogICAgaWYodHlwZW9mIG91dCA9PSAnc3RyaW5nJykgb3V0ID0gRmlsZVdyaXRlcihvdXQpOwogICAgbGV0IGZpcnN0ID0gdGhpcy5maXJzdENodW5rKCk7CiAgICBsZXQgbGFzdCA9IHRoaXMubGFzdENodW5rKCk7CgogICAgaWYoZGVidWcgPiAzKQogICAgICBkZWJ1Z0xvZyhgRmlsZU1hcFx4MWJbMTszNW08JHt0aGlzLmZpbGV9Plx4MWJbMG0ud3JpdGVgLCBjb21wYWN0KDIpLCB7CiAgICAgICAgY2h1bmtzOiBbdGhpcy5hdChmaXJzdCksIHRoaXMuYXQobGFzdCldCiAgICAgIH0pOwogICAgZm9yKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIGxldCBzdHIgPSB0aGlzLmF0KGkpOwogICAgICBpZihzdHIgPT09IG51bGwgfHwgc3RyID09PSB1bmRlZmluZWQpIGNvbnRpbnVlOwogICAgICBsZXQgbGVuID0gc3RyLmJ5dGVMZW5ndGggPz8gc3RyLmxlbmd0aDsKICAgICAgaWYoaXNPYmplY3Qoc3RyKSkgewogICAgICAgIGlmKHN0ciBpbnN0YW5jZW9mIEZpbGVNYXApIHsKICAgICAgICAgIGlmKHN0ci5zZXJpYWwgPT09IHNlcmlhbCkgewogICAgICAgICAgICByID0gMDsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICByID0gc3RyLndyaXRlKG91dCwgZGVwdGggKyAxLCBzZXJpYWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZihkZXB0aCA+IDAgJiYgaSA9PSBmaXJzdCkgb3V0LnB1dHMoRmlsZUJhbm5lckNvbW1lbnQodGhpcy5maWxlLCAwKSk7CiAgICAgICAgICByID0gb3V0LndyaXRlKHN0ciwgbGVuKTsKICAgICAgICAgIGlmKGRlcHRoID4gMCAmJiBpID09IGxhc3QpIG91dC5wdXRzKEZpbGVCYW5uZXJDb21tZW50KHRoaXMuZmlsZSwgMSkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBsZXQgdHlwZSA9IGdldFR5cGVOYW1lKHN0cik7CiAgICAgICAgY29uc29sZS5sb2coJ2ludmFsaWQgdHlwZTonLCB0eXBlKTsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IodHlwZSk7CiAgICAgIH0KICAgICAgaWYoZGVidWcgPiAzKSBkZWJ1Z0xvZyhgRmlsZU1hcFx4MWJbMTszNW08JHt0aGlzLmZpbGV9Plx4MWJbMG0ud3JpdGVgLCBgWyR7aSArIDF9LyR7bGVuZ3RofV1gLCBgcmVzdWx0PSR7cn1gKTsKICAgICAgaWYociA8IDApIHsKICAgICAgICBsZXQgZXJyID0gZXJyb3IoKTsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Vycm9yIHdyaXRpbmcgJyArIGxlbiArICcgYnl0ZXM6ICcgKyBpbnNwZWN0KGVycikpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHdyaXR0ZW4gKz0gcjsKICAgIH0KCiAgICByZXR1cm4gd3JpdHRlbjsKICB9CgogIHRvU3RyaW5nKCkgewogICAgY29uc3QgbiA9IHRoaXMubGVuZ3RoOwogICAgbGV0IHMgPSAnJzsKICAgIGZvcihsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHMgKz0gdGhpcy5zdHJpbmdBdChpKTsKICAgIHJldHVybiBzOwogIH0KCiAgW2luc3BlY3RTeW1ib2xdKGRlcHRoLCBvcHRzKSB7CiAgICBvcHRzID0gewogICAgICAuLi5vcHRzLAogICAgICBjb21wYWN0OiAyLAogICAgICBtYXhBcnJheUxlbmd0aDogSW5maW5pdHksCiAgICAgIG1heFN0cmluZ0xlbmd0aDogNDAsCiAgICAgIHN0cmluZ0JyZWFrTmV3bGluZTogZmFsc2UsCiAgICAgIGN1c3RvbUluc3BlY3Q6IHRydWUsCiAgICAgIGRlcHRoOiBkZXB0aCArIDQKICAgIH07CgogICAgbGV0IGFyciA9IFsuLi50aGlzXS5tYXAoKGl0ZW0sIGkpID0+IHsKICAgICAgbGV0IFtyYW5nZSwgYnVmLCByZXBsYWNlbWVudF0gPSBpdGVtOwoKICAgICAgY29uc3QgaXNCdWYgPSBpc09iamVjdChidWYpICYmIHR5cGVzLmlzQXJyYXlCdWZmZXIoYnVmKTsKICAgICAgY29uc3QgZmlsZW5hbWUgPSBpc0J1ZiA/IEZpbGVNYXAuZmlsZW5hbWVzKGJ1ZikgOiB1bmRlZmluZWQ7CgogICAgICByZXR1cm4gWwogICAgICAgIHR5cGVzLmlzQXJyYXlCdWZmZXIoYnVmKSA/IHJhbmdlIDogbnVsbCwKICAgICAgICBmaWxlbmFtZSA/IGA8QnVmZmVyW1x4MWJbMTszNm0ke2J1Zi5ieXRlTGVuZ3RofVx4MWJbMTswbV0gXHgxYlsxOzMzbScke2ZpbGVuYW1lfSdceDFiWzBtPmAgOiBidWYsCiAgICAgICAgcmVwbGFjZW1lbnQKICAgICAgXQogICAgICAgIC5zbGljZSgwLCBpdGVtLmxlbmd0aCkKICAgICAgICAubWFwKChwYXJ0LCBpKSA9PgogICAgICAgICAgcGFkU3RhcnRBbnNpKAogICAgICAgICAgICB0eXBlb2YgcGFydCA9PSAnc3RyaW5nJwogICAgICAgICAgICAgID8gcGFydAogICAgICAgICAgICAgIDogaW5zcGVjdChwYXJ0LCB7IC4uLm9wdHMsIGNvbXBhY3Q6IDEsIGN1c3RvbUluc3BlY3Q6IHRydWUsIG1heEFycmF5TGVuZ3RoOiAxMCB9KSArCiAgICAgICAgICAgICAgICAgIChpIDwgaXRlbS5sZW5ndGggLSAxID8gJywnIDogJycpLAogICAgICAgICAgICBbMjAsIDM0LCAwXVtpXQogICAgICAgICAgKQogICAgICAgICkKICAgICAgICAuam9pbignICcpOwogICAgfSk7CgogICAgcmV0dXJuICgKICAgICAgYEZpbGVNYXBceDFiWzE7MzVtPCR7dGhpcy5maWxlfT5ceDFiWzBtIFtcbiAgYCArCiAgICAgIGFyci5tYXAoKGl0ZW0sIGkpID0+IGBbICR7KCcjJyArIGkpLnBhZFN0YXJ0KDMpfSAke2l0ZW19IF1gKS5qb2luKCcsXG4gICcpICsKICAgICAgYFxuXVxuYAogICAgKTsKICB9Cn0KCkZpbGVNYXAucHJvdG90eXBlW1N5bWJvbC50b1N0cmluZ1RhZ10gPSAnRmlsZU1hcCc7CgpmdW5jdGlvbiBCdWZmZXJGaWxlKGZpbGUsIGJ1ZikgewogIGZpbGUgPSBwYXRoLm5vcm1hbGl6ZShmaWxlKTsKICBpZighYnVmKSBidWYgPSBmaWxlQnVmZmVycy5nZXQoZmlsZSkgPz8gYnVmZmVyc1tmaWxlXTsKICBpZighYnVmKSBidWYgPSBidWZmZXJzW2ZpbGVdID8/IGZzLnJlYWRGaWxlU3luYyhmaWxlLCB7IGZsYWc6ICdyJyB9KTsKICBpZih0eXBlb2YgYnVmID09ICdvYmplY3QnICYmIGJ1ZiAhPT0gbnVsbCkgewogICAgYnVmZmVyUmVmLnNldChidWYsIGZpbGUpOwogICAgZmlsZUJ1ZmZlcnMuc2V0KGZpbGUsIGJ1Zik7CiAgICBidWYuZmlsZSA9IGZpbGU7CiAgfQogIHJldHVybiBidWY7Cn0KCmZ1bmN0aW9uIEJ1ZmZlckxlbmd0aHMoZmlsZSkgewogIHJldHVybiBidWZmZXJzW2ZpbGVdLm1hcChiID0+IGIuYnl0ZUxlbmd0aCk7Cn0KCmZ1bmN0aW9uIEJ1ZmZlck9mZnNldHMoZmlsZSkgewogIHJldHVybiBidWZmZXJzW2ZpbGVdLnJlZHVjZSgoW3BvcywgbGlzdF0sIGIpID0+IFtwb3MgKyBiLmJ5dGVMZW5ndGgsIGxpc3QuY29uY2F0KFtwb3NdKV0sIFswLCBbXV0pWzFdOwp9CgpmdW5jdGlvbiBCdWZmZXJSYW5nZXMoZmlsZSkgewogIHJldHVybiBidWZmZXJzW2ZpbGVdLnJlZHVjZSgoW3BvcywgbGlzdF0sIGIpID0+IFtwb3MgKyBiLmJ5dGVMZW5ndGgsIGxpc3QuY29uY2F0KFtbcG9zLCBiLmJ5dGVMZW5ndGhdXSldLCBbMCwgW11dKVsxXTsKfQoKZnVuY3Rpb24gV3JpdGVGaWxlKG5hbWUsIGRhdGEsIG9wdHMgPSB7fSkgewogIGNvbnN0IHsgbW9kZSA9IDBvNjQ0LCB2ZXJib3NlID0gdHJ1ZSB9ID0gb3B0czsKCiAgaWYodHlwZW9mIGRhdGEgPT0gJ3N0cmluZycpIGRhdGEgPSB0b0FycmF5QnVmZmVyKGRhdGEpOwoKICBpZih0eXBlcy5pc0FycmF5QnVmZmVyKGRhdGEpKSBkYXRhID0gW2RhdGFdOwoKICBsZXQgZmQgPSBmcy5vcGVuU3luYyhuYW1lLCBvcy5PX1dST05MWSB8IG9zLk9fVFJVTkMgfCBvcy5PX0NSRUFULCBtb2RlKTsKICBsZXQgciA9IDA7CiAgZm9yKGxldCBpdGVtIG9mIGRhdGEpIHsKICAgIHIgKz0gZnMud3JpdGVTeW5jKGZkLCB0b0FycmF5QnVmZmVyKGl0ZW0gKyAnJykpOwogIH0KICBmcy5jbG9zZVN5bmMoZmQpOwogIGxldCBzdGF0ID0gZnMuc3RhdFN5bmMobmFtZSk7CiAgaWYodmVyYm9zZSkgZGVidWcoYFdyb3RlICR7bmFtZX06ICR7c3RhdD8uc2l6ZX0gYnl0ZXNgKTsKICByZXR1cm4gc3RhdD8uc2l6ZTsKfQoKZnVuY3Rpb24gRHVtcExleGVyKGxleCkgewogIGNvbnN0IHsgc2l6ZSwgcG9zLCBzdGFydCwgbGluZSwgY29sdW1uLCBsaW5lU3RhcnQsIGxpbmVFbmQsIGNvbHVtbkluZGV4IH0gPSBsZXg7CiAgcmV0dXJuICdMZXhlciAnICsgaW5zcGVjdCh7IHN0YXJ0LCBwb3MsIHNpemUgfSk7Cn0KCmZ1bmN0aW9uIER1bXBUb2tlbih0b2spIHsKICBjb25zdCB7IGxlbmd0aCwgb2Zmc2V0LCBjaGFycywgbG9jIH0gPSB0b2s7CiAgcmV0dXJuIGDimIUgVG9rZW4gJHtpbnNwZWN0KHsgY2hhcnMsIG9mZnNldCwgbGVuZ3RoLCBsb2MgfSwgeyBkZXB0aDogMSB9KX1gOwp9CgpmdW5jdGlvbiogRGVwZW5kZW5jeVRyZWUoCiAgcm9vdCwKICBpbmRlbnQgPSAnICcsCiAgc3BhY2luZyA9IGZhbHNlLAogIGRlcHRoID0gMCwKICBwcmUgPSAnJywKICBmbiA9IChuYW1lLCBkZXB0aCkgPT4gYCR7bmFtZX0gKCR7ZGVwdGh9KWAKKSB7CiAgaWYoIUFycmF5LmlzQXJyYXkoZGVwZW5kZW5jeVRyZWUocm9vdCkpKQogICAgdGhyb3cgbmV3IEVycm9yKGBObyBzdWNoIGZpbGUgJyR7cm9vdH0nIGluIGRlcGVuZGVuY3kgTWFwIChbJHtbLi4uZGVwZW5kZW5jeU1hcC5rZXlzKCldfV0pYCk7CgogIGlmKGRlcHRoID09IDApIHlpZWxkIHByZSArIHN0cmlwTGVhZGluZ0RvdFNsYXNoKGZuKHJvb3QsIGRlcHRoKSkgKyBgXG5gOwoKICBsZXQgYSA9IGRlcGVuZGVuY3lNYXAuZ2V0KHJvb3QpOwogIGxldCBpID0gMCwKICAgIG4gPSBhLmxlbmd0aDsKCiAgZm9yKGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICBpZihzcGFjaW5nKSB5aWVsZCAocHJlICsgaW5kZW50ICsgYOKUgiAgYCArICdcbicpLnJlcGVhdChOdW1iZXIoc3BhY2luZykpOwoKICAgIHlpZWxkIHByZSArCiAgICAgIGluZGVudCArCiAgICAgIChuID09IDEgPyBg4pSU4pSAIGAgOiBpIDwgbiAtIDEgPyBg4pSc4pSAIGAgOiBg4pSU4pSAIGApICsKICAgICAgc3RyaXBMZWFkaW5nRG90U2xhc2goZm4oYVtpXSwgZGVwdGggKyAxKSkgKwogICAgICAnXG4nOwoKICAgIHlpZWxkKiBEZXBlbmRlbmN5VHJlZSgKICAgICAgYVtpXSwKICAgICAgaW5kZW50LAogICAgICBzcGFjaW5nLAogICAgICBkZXB0aCArIDEsCiAgICAgIHByZSArIGluZGVudCArIChuID09IDEgPyBgICAgYCA6IGkgPCBuIC0gMSA/IGDilIIgIGAgOiBgICAgYCkKICAgICk7CiAgfQoKICBmdW5jdGlvbiBzdHJpcExlYWRpbmdEb3RTbGFzaChuKSB7CiAgICBpZihuLnN0YXJ0c1dpdGgoJy4vJykpIG4gPSBuLnNsaWNlKDIpOwogICAgcmV0dXJuIG47CiAgfQp9CgpmdW5jdGlvbiBTcHJlYWRBbmRKb2luKGl0ZXJhdG9yLCBzZXBhcmF0b3IgPSAnJykgewogIHJldHVybiBbLi4uaXRlcmF0b3JdLmpvaW4oc2VwYXJhdG9yKTsKfQoKZnVuY3Rpb24qIFByaW50VXNlcnNjcmlwdEJhbm5lcihmaWVsZHMpIHsKICBjb25zdCBkZWZhdWx0cyA9IHsKICAgIG5hbWU6ICdodHRwczovL2dpdGh1Yi5jb20vcnNlbm4nLAogICAgbmFtZXNwYWNlOiAnaHR0cHM6Ly9naXRodWIuY29tL3JzZW5uJywKICAgIHZlcnNpb246ICcxLjAnLAogICAgZGVzY3JpcHRpb246ICcnLAogICAgYXV0aG9yOiAnUm9tYW4gTC4gU2VubicsCiAgICBtYXRjaDogJ2h0dHAqOi8vKi8qJywKICAgIGljb246ICdkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhBUUFCQUFBQUFDSDVCQUVLQUFFQUxBQUFBQUFCQUFFQUFBSUNUQUVBT3c9PScsCiAgICBncmFudDogJ25vbmUnCiAgfTsKCiAgbGV0IGtleXMgPSBPYmplY3Qua2V5cyhkZWZhdWx0cykuY29uY2F0KE9iamVjdC5rZXlzKGZpZWxkcykpLnVuaXF1ZSgpOwogIHlpZWxkIGAvLyA9PVVzZXJTY3JpcHQ9PWA7CiAgZm9yKGxldCBuYW1lIG9mIGtleXMpIHsKICAgIGNvbnN0IHZhbHVlID0gZmllbGRzW25hbWVdID8/IGRlZmF1bHRzW25hbWVdOwoKICAgIHlpZWxkIGAvLyBAJHtuYW1lLnBhZEVuZCgxMil9ICR7dmFsdWV9YDsKICB9CgogIHlpZWxkIGAvLyA9PS9Vc2VyU2NyaXB0PT1gOwp9CgpmdW5jdGlvbiBQcmludEVTNkltcG9ydChpbXApIHsKICByZXR1cm4gewogICAgW0ltcG9ydFR5cGVzLklNUE9SVF9OQU1FU1BBQ0VdOiAoeyBsb2NhbCwgZmlsZSB9KSA9PiBgaW1wb3J0ICogYXMgJHtsb2NhbH0gZnJvbSAnJHtmaWxlfSc7YCwKICAgIFtJbXBvcnRUeXBlcy5JTVBPUlRfREVGQVVMVF06ICh7IGxvY2FsLCBmaWxlIH0pID0+IGBpbXBvcnQgJHtsb2NhbH0gZnJvbSAnJHtmaWxlfSc7YCwKICAgIFtJbXBvcnRUeXBlcy5JTVBPUlRdOiAoeyBsb2NhbCwgZmlsZSB9KSA9PiBgaW1wb3J0IHsgJHtsb2NhbC5qb2luKCcsICcpfSB9IGZyb20gJyR7ZmlsZX0nO2AKICB9W2ltcC50eXBlXShpbXApOwp9CgpmdW5jdGlvbiBQcmludENKU0ltcG9ydCh7IHR5cGUsIGxvY2FsLCBmaWxlIH0pIHsKICByZXR1cm4gewogICAgW0ltcG9ydFR5cGVzLklNUE9SVF9OQU1FU1BBQ0VdOiAoKSA9PiBgY29uc3QgJHtsb2NhbH0gPSByZXF1aXJlKCcke2ZpbGV9Jyk7YCwKICAgIFtJbXBvcnRUeXBlcy5JTVBPUlRfREVGQVVMVF06ICgpID0+IGBjb25zdCAke2xvY2FsfSA9IHJlcXVpcmUoJyR7ZmlsZX0nKTtgLAogICAgW0ltcG9ydFR5cGVzLklNUE9SVF06ICgpID0+IGBjb25zdCB7ICR7bG9jYWwuam9pbignLCAnKX0gfSA9IHJlcXVpcmUoJyR7ZmlsZX0nKTtgCiAgfVt0eXBlXSgpOwp9CgpmdW5jdGlvbiBtYWluKC4uLmFyZ3MpIHsKICBPYmplY3QuYXNzaWduKGdsb2JhbFRoaXMsIHsKICAgIElzS2V5d29yZCwKICAgIElzUHVuY3R1YXRvciwKICAgIE5vbldTLAogICAgTGVhZGluZ1dTLAogICAgSW1wb3J0SWRzLAogICAgSW1wb3J0SWRNYXAsCiAgICBGaWxlTWFwLAogICAgTnVtZXJpY1JhbmdlLAogICAgQXJyYXlXcml0ZXIsCiAgICBEdW1teVdyaXRlciwKICAgIEZkV3JpdGVyLAogICAgRmlsZVdyaXRlciwKICAgIE91dHB1dEltcG9ydHMsCiAgICBSZXNvbHZlQWxpYXMKICB9KTsKCiAgZ2xvYmFsVGhpcy5jb25zb2xlID0gbmV3IENvbnNvbGUoc3RkLmVyciwgewogICAgaW5zcGVjdE9wdGlvbnM6IHsKICAgICAgY29sb3JzOiB0cnVlLAogICAgICBkZXB0aDogSW5maW5pdHksCiAgICAgIHN0cmluZ0JyZWFrTmV3bGluZTogdHJ1ZSwKICAgICAgbWF4U3RyaW5nTGVuZ3RoOiAxMDAwLAogICAgICBtYXhBcnJheUxlbmd0aDogMTAwLAogICAgICBjb21wYWN0OiAxLAogICAgICBoaWRlS2V5czogW1N5bWJvbC50b1N0cmluZ1RhZyAvKiwgJ2NvZGUnKi9dCiAgICB9CiAgfSk7CgogIGxldCBvcHRpbmQgPSAwLAogICAgY29kZSA9ICdjJywKICAgIGV4cCA9IHRydWU7CgogIGxldCBvdXQgPSBGZFdyaXRlcigxLCAnc3Rkb3V0Jyk7CiAgbGV0IHN0cmVhbSA9IGRlZmluZSgKICAgIHsgaW5kZW50OiAwIH0sCiAgICB7CiAgICAgIGxpbmVzOiBbXSwKICAgICAgd3JpdGUoYnVmLCBsZW4pIHsKICAgICAgICBsZXQgcyA9IHRvU3RyaW5nKGJ1ZiwgMCwgbGVuKTsKICAgICAgICByZXR1cm4gdGhpcy5wdXRzKHMpOwogICAgICB9LAogICAgICBwdXRzKHMpIHsKICAgICAgICBsZXQgcGFkID0gJyAgJy5yZXBlYXQodGhpcy5pbmRlbnQpOwogICAgICAgIHRoaXMubGluZXMucHVzaCguLi5zLnNwbGl0KC9ccj9cbi9nKS5tYXAobGluZSA9PiBwYWQgKyBsaW5lKSk7CiAgICAgICAgcmV0dXJuIHMubGVuZ3RoOwogICAgICB9LAogICAgICBjbG9zZSgpIHsKICAgICAgICBsZXQgcHJldiA9ICcnOwogICAgICAgIGNvbnN0IGlzV1MgPSBzID0+IHMudHJpbSgpID09ICcnOwogICAgICAgIGZvcihsZXQgbGluZSBvZiB0aGlzLmxpbmVzKSB7CiAgICAgICAgICBpZighKGlzV1MobGluZSkgJiYgaXNXUyhwcmV2KSkpIHsKICAgICAgICAgICAgb3V0LnB1dHMobGluZS50cmltRW5kKCkgKyAnXG4nKTsKICAgICAgICAgIH0KICAgICAgICAgIHByZXYgPSBsaW5lOwogICAgICAgIH0KICAgICAgICBvdXQuY2xvc2UoKTsKICAgICAgfQogICAgfQogICk7CgogIGxldCBvcHRzOwogIGxldCBwYXJhbXMgPSBnZXRPcHQoCiAgICAob3B0cyA9IHsKICAgICAgaGVscDogW2ZhbHNlLCBudWxsLCAnaCddLAogICAgICBkZWJ1ZzogW2ZhbHNlLCAoKSA9PiArK2RlYnVnLCAneCddLAogICAgICBpbnRlcmFjdGl2ZTogW2ZhbHNlLCBudWxsLCAneSddLAogICAgICBsb2c6IFt0cnVlLCBmaWxlID0+IChsb2dGaWxlID0gRmlsZVdyaXRlcihmaWxlKSksICd2J10sCiAgICAgIHNvcnQ6IFtmYWxzZSwgbnVsbCwgJ3MnXSwKICAgICAgJ2Nhc2Utc2Vuc2l0aXZlJzogW2ZhbHNlLCBudWxsLCAnYyddLAogICAgICBxdWlldDogW2ZhbHNlLCAocXVpZXQgPSAocXVpZXQgfCAwKSArIDEpLCAncSddLAogICAgICBleHBvcnQ6IFtmYWxzZSwgKCkgPT4gKGV4cCA9IHRydWUpLCAnZSddLAogICAgICBpbXBvcnRzOiBbZmFsc2UsICgpID0+IChvbmx5SW1wb3J0cyA9IHRydWUpLCAnaSddLAogICAgICAncmVsYXRpdmUtdG8nOiBbdHJ1ZSwgYXJnID0+IChyZWxhdGl2ZVRvID0gcGF0aC5hYnNvbHV0ZShhcmcpKSwgJ1InXSwKICAgICAgb3V0cHV0OiBbdHJ1ZSwgZmlsZSA9PiAob3V0cHV0RmlsZSA9IGZpbGUpLCAnbyddLAogICAgICByZWN1cnNpdmU6IFtmYWxzZSwgKCkgPT4gKHJlY3Vyc2l2ZSA9IHRydWUpLCAnciddLAogICAgICAnbm8tcmVjdXJzaXZlJzogW2ZhbHNlLCAoKSA9PiAocmVjdXJzaXZlID0gZmFsc2UpLCAnUiddLAogICAgICAncmVtb3ZlLWV4cG9ydHMnOiBbZmFsc2UsICgpID0+IChyZW1vdmVFeHBvcnRzID0gdHJ1ZSksICdFJ10sCiAgICAgICdyZW1vdmUtaW1wb3J0cyc6IFtmYWxzZSwgKCkgPT4gKHJlbW92ZUltcG9ydHMgPSB0cnVlKSwgJ0knXSwKICAgICAgJ2NoZWNrLWltcG9ydHMnOiBbZmFsc2UsICgpID0+IChzY3JpcHRBcmdzWzBdID0gJ2NoZWNrLWltcG9ydHMnKSwgbnVsbF0sCiAgICAgICdsaXN0LWltcG9ydHMnOiBbZmFsc2UsICgpID0+IChzY3JpcHRBcmdzWzBdID0gJ2xpc3QtaW1wb3J0cycpLCBudWxsXSwKICAgICAgJ3JlbW92ZS1jb21tZW50cyc6IFtmYWxzZSwgKCkgPT4gKHJlbW92ZUNvbW1lbnRzID0gdHJ1ZSksICdDJ10sCiAgICAgICdnbG9iYWwtZXhwb3J0cyc6IFtmYWxzZSwgKCkgPT4gKytnbG9iYWxFeHBvcnRzLCAnRyddLAogICAgICAnc2hvdy1kZXBlbmRlbmNpZXMnOiBbZmFsc2UsICgpID0+ICsrc2hvd0RlcHMsICdkJ10sCiAgICAgICdwcmludC1maWxlcyc6IFtmYWxzZSwgKCkgPT4gKHByaW50RmlsZXMgPSB0cnVlKSwgJ2wnXSwKICAgICAgJ25vLXByaW50LWZpbGVzJzogW2ZhbHNlLCAoKSA9PiAocHJpbnRGaWxlcyA9IGZhbHNlKSwgJ0wnXSwKICAgICAgJ3JlYWQtcGFja2FnZSc6IFtmYWxzZSwgKCkgPT4gKHJlYWRQYWNrYWdlID0gdHJ1ZSksICdwJ10sCiAgICAgICduby1yZWFkLXBhY2thZ2UnOiBbZmFsc2UsICgpID0+IChyZWFkUGFja2FnZSA9IGZhbHNlKSwgJ1AnXSwKICAgICAgdXNlcnNjcmlwdDogW2ZhbHNlLCAoKSA9PiAodXNlclNjcmlwdCA9IHRydWUpLCAnVSddLAogICAgICB0aW1lOiBbZmFsc2UsICgpID0+IChzaG93VGltaW5nID0gdHJ1ZSksICd0J10sCiAgICAgICdAJzogJ2ZpbGVzJwogICAgfSksCiAgICBhcmdzCiAgKTsKCiAgZnVuY3Rpb24gU2hvd0hlbHAoKSB7CiAgICBsZXQgZW50cmllcyA9IE9iamVjdC5lbnRyaWVzKG9wdHMpOwogICAgbGV0IG1heGxlbiA9IGVudHJpZXMucmVkdWNlKChhY2MsIFtuYW1lXSkgPT4gKGFjYyA+IG5hbWUubGVuZ3RoID8gYWNjIDogbmFtZS5sZW5ndGgpLCAwKTsKCiAgICBsZXQgcyA9IE9iamVjdC5lbnRyaWVzKG9wdHMpLnJlZHVjZSgKICAgICAgKGFjYywgW25hbWUsIFtoYXNBcmcsIGZuLCBzaG9ydE9wdF1dKSA9PgogICAgICAgIGFjYyArCiAgICAgICAgKAogICAgICAgICAgYCAgICAkeyhzaG9ydE9wdCA/ICctJyArIHNob3J0T3B0ICsgJywnIDogJycpLnBhZFN0YXJ0KDQsICcgJyl9IC0tJHtuYW1lLnBhZEVuZChtYXhsZW4sICcgJyl9IGAgKwogICAgICAgICAgKGhhc0FyZyA/ICh0eXBlb2YgaGFzQXJnID09ICdib29sZWFuJyA/ICdBUkcnIDogaGFzQXJnKSA6ICcnKQogICAgICAgICkucGFkRW5kKDQwLCAnICcpICsKICAgICAgICAnXG4nLAogICAgICBgVXNhZ2U6ICR7cGF0aC5iYXNlbmFtZShzY3JpcHRBcmdzWzBdKX0gW09QVElPTlNdIDxGSUxFUy4uLj5cblxuYAogICAgKTsKICAgIHN0ZC5wdXRzKHMgKyAnXG4nKTsKICAgIHN0ZC5leGl0KDApOwogIH0KCiAgaWYocGFyYW1zLmhlbHApIFNob3dIZWxwKCk7CgogIGxldCBmaWxlcyA9IHBhcmFtc1snQCddOwoKICBpZigvY2hlY2staW1wb3J0Ly50ZXN0KHNjcmlwdEFyZ3NbMF0pKSB7CiAgICBpZGVudGlmaWVyc1VzZWQgPSBtZW1vaXplKGFyZyA9PiBuZXcgU2V0KCkpOwogICAgaWYocHJpbnRGaWxlcyA9PT0gdW5kZWZpbmVkKSBwcmludEZpbGVzID0gZmFsc2U7CiAgICBvbmx5SW1wb3J0cyA9IGZhbHNlOwogICAgb3V0cHV0RmlsZSA9IG51bGw7CiAgICBvdXQgPSBEdW1teVdyaXRlcignL2Rldi9udWxsJyk7CiAgfSBlbHNlIGlmKC9saXN0LWltcG9ydC8udGVzdChzY3JpcHRBcmdzWzBdKSkgewogICAgaWYocHJpbnRGaWxlcyA9PT0gdW5kZWZpbmVkKSBwcmludEZpbGVzID0gdHJ1ZTsKICAgIHF1aWV0ID0gdHJ1ZTsKICAgIG9ubHlJbXBvcnRzID0gdHJ1ZTsKICAgIG91dHB1dEZpbGUgPSBudWxsOwogICAgb3V0ID0gRHVtbXlXcml0ZXIoJy9kZXYvbnVsbCcpOwogIH0gZWxzZSB7CiAgICBpZih0eXBlb2YgcmVjdXJzaXZlID09ICd1bmRlZmluZWQnKSByZWN1cnNpdmUgPSB0cnVlOwogIH0KCiAgaWYodHlwZW9mIHJlY3Vyc2l2ZSA9PSAndW5kZWZpbmVkJykgcmVjdXJzaXZlID0gZmFsc2U7CgogIGNvbnN0IHsgc29ydCwgJ2Nhc2Utc2Vuc2l0aXZlJzogY2FzZVNlbnNpdGl2ZSB9ID0gcGFyYW1zOwoKICBpZihvdXRwdXRGaWxlKSBvdXQgPSBGaWxlV3JpdGVyKG91dHB1dEZpbGUpOwogIGdsb2JhbFRoaXMub3V0ID0gb3V0OwoKICBsZXQgYXJnTGlzdCA9IFsuLi5zY3JpcHRBcmdzXTsKICBsb2cgPSBxdWlldCA/ICgpID0+IHt9IDogKC4uLmFyZ3MpID0+IGNvbnNvbGUubG9nKGAke2ZpbGV9OmAsIC4uLmFyZ3MpOwoKICBsb2dGaWxlKGBTdGFydCBvZjogJHthcmdMaXN0LmpvaW4oJyAnKX1cbmApOwoKICBjb25zdCBSZWxhdGl2ZVBhdGggPSBmaWxlID0+IChwYXRoLmlzQWJzb2x1dGUoZmlsZSkgPyBmaWxlIDogZmlsZS5zdGFydHNXaXRoKCcuLycpID8gZmlsZSA6ICcuLycgKyBmaWxlKTsKCiAgaWYoIWZpbGVzLmxlbmd0aCkgdGhyb3cgbmV3IEFyZ3VtZW50RXJyb3IoJ0V4cGVjdGluZyBhcmd1bWVudCA8ZmlsZXMuLi4+Jyk7CgogIGxldCByZXN1bHRzID0gKGdsb2JhbFRoaXMucmVzdWx0cyA9IFtdKTsKCiAgZm9yKGxldCBmaWxlIG9mIGZpbGVzKSB7CiAgICBmaWxlID0gUmVsYXRpdmVQYXRoKGZpbGUpOwoKICAgIGxldCByZXN1bHQgPSBQcm9jZXNzRmlsZShmaWxlLCBsb2csIHJlY3Vyc2l2ZSwgMCk7CgogICAgaWYoZGVidWcgPiAxKSBjb25zb2xlLmxvZygncmVzdWx0JywgY29tcGFjdChmYWxzZSwgeyBkZXB0aDogSW5maW5pdHkgfSksIHJlc3VsdCk7CgogICAgcmVzdWx0cy5wdXNoKHJlc3VsdCk7CiAgfQoKICAvKmNvbnNvbGUubG9nKCdoZWFkZXInLCBjb25zb2xlLmNvbmZpZyh7IGNvbXBhY3Q6IDIgfSksIGhlYWRlcik7CiAgY29uc29sZS5sb2coJ2dsb2JhbEltcG9ydHMnLCBjb25zb2xlLmNvbmZpZyh7IGNvbXBhY3Q6IDEgfSksIGdsb2JhbEltcG9ydHMpOyovCgogIGZvcihsZXQgaW1wIG9mIGFsbEltcG9ydHMoKSkgewogICAgbGV0IHsgZmlsZSwgc291cmNlLCB0b2tlbnMgfSA9IGltcDsKICAgIGxldCBpZG1hcCA9IGltcC5pZG1hcCgpOwogICAgLy9jb25zb2xlLmxvZygnaW1wJywgeyBmaWxlLCBzb3VyY2UsIGlkbWFwIH0pOwogICAgaWYoSXNGaWxlSW1wb3J0KGZpbGUpKSBjb250aW51ZTsKICAgIGxldCBtYXAgPSAoZ2xvYmFsSW1wb3J0c1tSZXNvbHZlQWxpYXMoZmlsZSldID8/PSB7fSk7CgogICAgaWYoaWRtYXApIGZvcihsZXQgW2xvY2FsLCBuYW1lXSBvZiBpZG1hcCkgbWFwW2xvY2FsXSA9IG5hbWU7CiAgfQoKICBsZXQgc3RyID0gT3V0cHV0SW1wb3J0cyhnbG9iYWxJbXBvcnRzKTsKCiAgcmVzdWx0c1swXS5pbnNlcnQoMSwgdG9BcnJheUJ1ZmZlcihzdHIpKTsKCiAgaWYoIXJlbW92ZUltcG9ydHMpIHsKICAgIGxldCBiaW5kaW5ncyA9IFtdLAogICAgICBpbXBvcnRMaW5lcyA9IFtdOwogICAgY29uc3QgQ29udGFpbnNBbnkgPSAoYXJyLCB0b2tlbnMpID0+IHRva2Vucy5zb21lKHRvayA9PiBhcnIuaW5kZXhPZih0b2spICE9IC0xKTsKICAgIGxldCBsaW5lcyA9IGhlYWRlcgogICAgICAuZmlsdGVyKGltcGV4cCA9PiBJc0J1aWx0aW4oaW1wZXhwLmZpbGUpKQogICAgICAuZmlsdGVyKGhkciA9PiAhaGRyLmNvZGUuc3RhcnRzV2l0aCgnZXhwb3J0JykpCiAgICAgIC5yZWR1Y2UoCiAgICAgICAgKFthY2MsIHByZXZdLCBoZHIpID0+IHsKICAgICAgICAgIGxldCB7IGNvZGUgfSA9IGhkcjsKICAgICAgICAgIGxldCBkaXNhYmxlID0gQ29udGFpbnNBbnkoYmluZGluZ3MsIGhkci5pZHMoKSk7CiAgICAgICAgICBpZihwcmV2ICE9IGhkci5zb3VyY2UpIHsKICAgICAgICAgICAgYWNjLnB1c2goJycpOwogICAgICAgICAgICBhY2MucHVzaChgYCk7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IGR1cGxpY2F0ZSA9IGltcG9ydExpbmVzLmluZGV4T2YoY29kZSkgIT0gLTE7CiAgICAgICAgICBpbXBvcnRMaW5lcy5wdXNoKGNvZGUpOwogICAgICAgICAgaWYoIWR1cGxpY2F0ZSAmJiBkaXNhYmxlKSBjb2RlID0gJyc7CiAgICAgICAgICBpZighZHVwbGljYXRlKSB7CiAgICAgICAgICAgIGJpbmRpbmdzLnB1c2goLi4uaGRyLmlkcygpKTsKICAgICAgICAgICAgYWNjLnB1c2goY29kZSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIFthY2MsIGhkci5zb3VyY2VdOwogICAgICAgIH0sCiAgICAgICAgW1tdLCBudWxsXQogICAgICApWzBdOwogICAgLy9pZihsaW5lcy5sZW5ndGgpIGxpbmVzID0gW0ZpbGVCYW5uZXJDb21tZW50KCdoZWFkZXInLCAwKSwgLi4ubGluZXMsICcnLCBGaWxlQmFubmVyQ29tbWVudCgnaGVhZGVyJywgMSldOwogICAgaWYoZGVidWcgPiAyKSBjb25zb2xlLmxvZygnbGluZXMnLCBsaW5lcyk7CgogICAgb3V0LnB1dHMobGluZXMucmVkdWNlKChhY2MsIGxpbmUpID0+IGFjYyArIGxpbmUudHJpbSgpICsgJ1xuJywgJycpKTsKICB9CgogIGlmKHVzZXJTY3JpcHQpIHsKICAgIGZvcihsZXQgbGluZSBvZiBQcmludFVzZXJzY3JpcHRCYW5uZXIoewogICAgICBuYW1lOiBvdXQuZmlsZSwKICAgICAgJ3J1bi1hdCc6ICdkb2N1bWVudC1zdGFydCcsCiAgICAgIHZlcnNpb246ICcxLjAnLAogICAgICBkZXNjcmlwdGlvbjogZmlsZXMuam9pbignLCAnKSwKICAgICAgZG93bmxvYWRVUkw6IGBodHRwczovL2xvY2FsaG9zdDo5MDAwLyR7b3V0LmZpbGV9YCwKICAgICAgdXBkYXRlVVJMOiBgaHR0cHM6Ly9sb2NhbGhvc3Q6OTAwMC8ke291dC5maWxlfWAKICAgIH0pKQogICAgICBzdHJlYW0ucHV0cyhsaW5lKTsKCiAgICBzdHJlYW0ucHV0cygiXG4oZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcbiIpOwogICAgKytzdHJlYW0uaW5kZW50OwogIH0KCiAgaWYoZGVidWcgPiAxKSBjb25zb2xlLmxvZygnb3V0Jywgb3V0LCBvdXQuZmlsZSk7CgogIGlmKG91dC5maWxlKSB7CiAgICAvL2NvbnNvbGUubG9nKCdyZXN1bHRzWzBdJywgcmVzdWx0c1swXSk7CiAgICBsZXQgbmJ5dGVzOwogICAgdHJ5IHsKICAgICAgbmJ5dGVzID0gcmVzdWx0c1swXS53cml0ZShzdHJlYW0pOwogICAgfSBjYXRjaChlcnJvcikgewogICAgICBjb25zb2xlLmxvZyhgd3JpdGUgZXJyb3IgKCcke291dC5maWxlfScpOmAsIGVycm9yKTsKICAgICAgc3RkLmV4aXQoMSk7CiAgICB9CgogICAgaWYoZGVidWcgPj0gMSkgY29uc29sZS5sb2coYCR7bmJ5dGVzfSBieXRlcyB3cml0dGVuIHRvICcke291dC5maWxlfSdgKTsKICB9CgogIGlmKGdsb2JhbEV4cG9ydHMpIHsKICAgIGxldCBtYXhEZXB0aCA9IGdsb2JhbEV4cG9ydHMgLSAxOwogICAgbGV0IGV4cG9ydGVkTmFtZXMgPSBmb290ZXIuZmlsdGVyKCh7IGRlcHRoIH0pID0+IGRlcHRoIDw9IG1heERlcHRoKTsKICAgIC8vIGNvbnNvbGUubG9nKGBmb290ZXJgLCBleHBvcnRlZE5hbWVzLm1hcChpbXBleHAgPT4gIFtpbXBleHAuZGVwdGgsaW1wZXhwLm5hbWVdKSk7CgogICAgaWYoZGVidWcgPiAzKSBjb25zb2xlLmxvZyhgZXhwb3J0ZWROYW1lc2AsIGV4cG9ydGVkTmFtZXMpOwoKICAgIGV4cG9ydGVkTmFtZXMgPSBleHBvcnRlZE5hbWVzCiAgICAgIC5tYXAoKHsgbmFtZSB9KSA9PiBuYW1lKQogICAgICAudW5pcXVlKCkKICAgICAgLmZpbHRlcihuYW1lID0+IHR5cGVvZiBuYW1lID09ICdzdHJpbmcnKTsKCiAgICBzdHJlYW0ucHV0cyhgXG5PYmplY3QuYXNzaWduKGdsb2JhbFRoaXMsIHsgJHtleHBvcnRlZE5hbWVzLmpvaW4oJywgJyl9IH0pO1xuYCk7CiAgfQoKICBpZih1c2VyU2NyaXB0KSB7CiAgICAtLXN0cmVhbS5pbmRlbnQ7CiAgICBzdHJlYW0ucHV0cygnfSkoKTtcbicpOwogIH0KCiAgc3RyZWFtLmNsb3NlKCk7CgogIGlmKHBhcmFtcy5pbnRlcmFjdGl2ZSkgb3Mua2lsbChwcm9jZXNzLnBpZCwgb3MuU0lHVVNSMSk7CgogIGxvZ0ZpbGUoYFByb2Nlc3NlZCBmaWxlczogJHtTcHJlYWRBbmRKb2luKGRlcGVuZGVuY3lNYXAua2V5cygpLCAnICcpfVxuYCk7Cn0KCnRyeSB7CiAgbWFpbiguLi5zY3JpcHRBcmdzLnNsaWNlKDEpKTsKfSBjYXRjaChlcnJvcikgewogIGNvbnNvbGUubG9nKGAke2Vycm9yLmNvbnN0cnVjdG9yLm5hbWV9OiAke2Vycm9yLm1lc3NhZ2V9JHtlcnJvci5zdGFjayA/ICdcbicgKyBlcnJvci5zdGFjayA6ICcnfWApOwogIHN0ZC5leGl0KDEpOwp9CgAAAAAAAAAAIdYAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/"
				]
			]
		},
		{
			"file": "lib/geom/graph.js",
			"settings":
			{
				"buffer_size": 11141,
				"line_ending": "Unix"
			},
			"undo_stack":
			[
			]
		},
		{
			"file": "lib/json/path.js",
			"settings":
			{
				"buffer_size": 18898,
				"encoding": "UTF-8",
				"line_ending": "Unix"
			}
		},
		{
			"file": "quickjs/qjs-modules/lib/extendArray.js",
			"settings":
			{
				"buffer_size": 4304,
				"line_ending": "Unix"
			}
		},
		{
			"file": "lib/xml/parse.js",
			"settings":
			{
				"buffer_size": 7066,
				"encoding": "UTF-8",
				"line_ending": "Unix"
			},
			"undo_stack":
			[
				[
					15,
					1,
					"toggle_comment",
					{
						"block": true
					},
					"AgAAAH0bAAAAAAAAfxsAAAAAAAAAAAAA2RoAAAAAAADbGgAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAB9GwAAAAAAANkaAAAAAAAAAAAAAAAA8L8"
				]
			]
		},
		{
			"file": "lib/json/util.js",
			"settings":
			{
				"buffer_size": 2514,
				"encoding": "UTF-8",
				"line_ending": "Unix"
			},
			"undo_stack":
			[
				[
					14,
					1,
					"toggle_comment",
					{
						"block": true
					},
					"AgAAAM0JAAAAAAAAzwkAAAAAAAAAAAAA5AgAAAAAAADmCAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADNCQAAAAAAAOQIAAAAAAAAAAAAAAAA8L8"
				]
			]
		},
		{
			"file": "quickjs/qjs-modules/src/utils.c",
			"settings":
			{
				"buffer_size": 93358,
				"encoding": "UTF-8",
				"line_ending": "Unix"
			},
			"undo_stack":
			[
				[
					19,
					1,
					"insert",
					{
						"characters": "\n"
					},
					"AgAAAGv8AAAAAAAAbPwAAAAAAAAAAAAAbPwAAAAAAABu/AAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABr/AAAAAAAAGv8AAAAAAAAAAAAAABgYkA"
				],
				[
					37,
					1,
					"left_delete",
					null,
					"AgAAAK/6AAAAAAAAr/oAAAAAAAABAAAAL2v8AAAAAAAAa/wAAAAAAAACAAAAICA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAACw+gAAAAAAALD6AAAAAAAAAAAAAAAA8L8"
				],
				[
					38,
					1,
					"right_delete",
					null,
					"AQAAAK/6AAAAAAAAr/oAAAAAAAABAAAALw",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAACv+gAAAAAAAK/6AAAAAAAAAAAAAAAA8L8"
				],
				[
					40,
					1,
					"right_delete",
					null,
					"AQAAAMb6AAAAAAAAxvoAAAAAAAABAAAAXA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADG+gAAAAAAAMb6AAAAAAAAAAAAAAAA8L8"
				],
				[
					41,
					1,
					"insert",
					{
						"characters": " "
					},
					"AQAAAMb6AAAAAAAAx/oAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADG+gAAAAAAAMb6AAAAAAAAAAAAAAAA8L8"
				],
				[
					42,
					1,
					"right_delete",
					null,
					"AQAAAMf6AAAAAAAAx/oAAAAAAAABAAAAbg",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADH+gAAAAAAAMf6AAAAAAAAAAAAAAAA8L8"
				]
			]
		},
		{
			"file": "lib/geom/transformation.js",
			"settings":
			{
				"buffer_size": 21591,
				"line_ending": "Unix"
			},
			"undo_stack":
			[
				[
					10,
					1,
					"insert",
					{
						"characters": "matrix="
					},
					"BwAAANgVAAAAAAAA2RUAAAAAAAAAAAAA2RUAAAAAAADaFQAAAAAAAAAAAADaFQAAAAAAANsVAAAAAAAAAAAAANsVAAAAAAAA3BUAAAAAAAAAAAAA3BUAAAAAAADdFQAAAAAAAAAAAADdFQAAAAAAAN4VAAAAAAAAAAAAAN4VAAAAAAAA3xUAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADYFQAAAAAAANgVAAAAAAAAAAAAAAAA8L8"
				],
				[
					12,
					6,
					"right_delete",
					null,
					"BgAAAOwVAAAAAAAA7BUAAAAAAAABAAAAdOwVAAAAAAAA7BUAAAAAAAABAAAAZewVAAAAAAAA7BUAAAAAAAABAAAAU+wVAAAAAAAA7BUAAAAAAAABAAAAZewVAAAAAAAA7BUAAAAAAAABAAAAbOwVAAAAAAAA7BUAAAAAAAABAAAAZg",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADsFQAAAAAAAOwVAAAAAAAAAAAAAAAA8L8"
				],
				[
					13,
					1,
					"insert",
					{
						"characters": "te"
					},
					"AgAAAOwVAAAAAAAA7RUAAAAAAAAAAAAA7RUAAAAAAADuFQAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAADsFQAAAAAAAOwVAAAAAAAAAAAAAAAA8L8"
				],
				[
					24,
					4,
					"right_delete",
					null,
					"BAAAAEgWAAAAAAAASBYAAAAAAAABAAAAU0gWAAAAAAAASBYAAAAAAAABAAAAZUgWAAAAAAAASBYAAAAAAAABAAAAbEgWAAAAAAAASBYAAAAAAAABAAAAZg",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABIFgAAAAAAAEgWAAAAAAAAAAAAAAAA8L8"
				],
				[
					29,
					1,
					"revert",
					null,
					"AwAAAAAAAAAAAAAAAAAAAAAAAABPVAAAaW1wb3J0IHsgTWF0cml4LCBpc01hdHJpeCB9IGZyb20gJy4uL2dlb20vbWF0cml4LmpzJzsKaW1wb3J0IHsgUG9pbnQgfSBmcm9tICcuLi9nZW9tL3BvaW50LmpzJzsKaW1wb3J0IHsgY2xhc3NOYW1lLCBkZWZpbmUsIGRlZmluZUdldHRlciwgZnVuY3Rpb25OYW1lLCBpbW11dGFibGVDbGFzcywgaXNPYmplY3QgfSBmcm9tICcuLi9taXNjLmpzJzsKCmNvbnN0IFJBRDJERUcgPSAxODAgLyBNYXRoLlBJOwpjb25zdCBERUcyUkFEID0gTWF0aC5QSSAvIDE4MDsKCmV4cG9ydCBjbGFzcyBUcmFuc2Zvcm1hdGlvbiB7CiAgLy90eXBlTmFtZSA9IG51bGw7CgogIGNvbnN0cnVjdG9yKHRyYW5zZm9ybWF0aW9uKSB7CiAgICBpZih0cmFuc2Zvcm1hdGlvbiBpbnN0YW5jZW9mIFRyYW5zZm9ybWF0aW9uKSByZXR1cm4gdHJhbnNmb3JtYXRpb247CiAgICBpZih0cmFuc2Zvcm1hdGlvbiBpbnN0YW5jZW9mIFRyYW5zZm9ybWF0aW9uTGlzdCkgcmV0dXJuIHRyYW5zZm9ybWF0aW9uOwoKICAgIGlmKHR5cGVvZiB0cmFuc2Zvcm1hdGlvbiA9PSAnc3RyaW5nJykgcmV0dXJuIFRyYW5zZm9ybWF0aW9uLmZyb21TdHJpbmcodHJhbnNmb3JtYXRpb24pOwogICAgLy9kZWZpbmUodGhpcywgeyB0eXBlTmFtZSB9KTsKICAgIC8vdGhpcy50eXBlID0gdHlwZTsKICAgIC8vCiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUcmFuc2Zvcm1hdGlvbicpOwoKICAgIHJldHVybiB0aGlzOwogIH0KCiAgZ2V0IFtTeW1ib2wudG9TdHJpbmdUYWddKCkgewogICAgcmV0dXJuIGZ1bmN0aW9uTmFtZSh0aGlzLmNvbnN0cnVjdG9yKTsKICB9CgogIGdldCB0eXBlKCkgewogICAgbGV0IHR5cGUgPQogICAgICB0aGlzLnR5cGVOYW1lIHx8CiAgICAgIGNsYXNzTmFtZSh0aGlzKQogICAgICAgIC50b0xvd2VyQ2FzZSgpCiAgICAgICAgLnJlcGxhY2UoL3RyYW5zZm9ybShhdGlvbik/LywgJycpCiAgICAgICAgLnJlcGxhY2UoLyhpb258aW5nKSQvLCAnZScpOwogICAgcmV0dXJuIHR5cGU7CiAgfQoKICBnZXQgW1N5bWJvbC5pc0NvbmNhdFNwcmVhZGFibGVdKCkgewogICAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IgPT09IFRyYW5zZm9ybWF0aW9uTGlzdCB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcykgPT0gVHJhbnNmb3JtYXRpb25MaXN0LnByb3RvdHlwZSB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3IgPT0gVHJhbnNmb3JtYXRpb25MaXN0OwogIH0KICBnZXQgYXhlcygpIHsKICAgIHJldHVybiB0aGlzLmF4aXMgIT09IHVuZGVmaW5lZCA/IFt0aGlzLmF4aXNdIDogWyd4JywgJ3knLCAneiddLmZpbHRlcihheGlzID0+IGF4aXMgaW4gdGhpcyk7CiAgfQogIGdldCBwcm9wcygpIHsKICAgIHJldHVybiB0aGlzLmF4ZXMuY29uY2F0KFsnYXhpcycsICdhbmdsZSddLmZpbHRlcihrZXkgPT4ga2V5IGluIHRoaXMpKTsKICB9CgogIGhhcyhheGlzKSB7CiAgICBpZih0aGlzLmF4aXMgIT09IHVuZGVmaW5lZCkgcmV0dXJuIGF4aXMgPT09IHRoaXMuYXhpczsKICAgIHJldHVybiBheGlzIGluIHRoaXM7CiAgfQoKICBnZXQgaXMzRCgpIHsKICAgIHJldHVybiB0aGlzLmhhcygneicpOwogIH0KCiAgZW50cmllcygpIHsKICAgIHJldHVybiB0aGlzLnByb3BzLm1hcChwcm9wID0+IFtwcm9wLCB0aGlzW3Byb3BdXSk7CiAgfQoKICB0b0pTT04oKSB7CiAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKHRoaXMuZW50cmllcygpKTsKICB9CgogIHZlY3Rvcih1bml0KSB7CiAgICBpZih1bml0ID09PSB1bmRlZmluZWQpIHVuaXQgPSB0aGlzLnVuaXQ7CiAgICByZXR1cm4gKHRoaXMuaXMzRCA/IFsneCcsICd5JywgJ3onXSA6IFsneCcsICd5J10pLm1hcCh1bml0ID8gYXhpcyA9PiB0aGlzW2F4aXNdICsgdW5pdCA6IGF4aXMgPT4gdGhpc1theGlzXSk7CiAgfQoKICB0b1N0cmluZyh0VW5pdCkgewogICAgcmV0dXJuIGAke3RoaXMudHlwZX0ke3RoaXMuaXMzRCA/ICczZCcgOiAnJ30oJHt0aGlzLnZlY3Rvcih0VW5pdCkuam9pbignLCAnKX0pYDsKICB9CiAgY2xvbmUoKSB7CiAgICBsZXQgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHRoaXMpOwogICAgbGV0IHByb3BzID0gdGhpcy5wcm9wcy5yZWR1Y2UoKGFjYywgcHJvcCkgPT4gKHsgLi4uYWNjLCBbcHJvcF06IGRlc2NbcHJvcF0gfSksIHt9KTsKICAgIHJldHVybiBPYmplY3QuY3JlYXRlKE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKSwgcHJvcHMpOwogIH0KCiAgc3RhdGljIGZyb21TdHJpbmcoYXJnKSB7CiAgICBsZXQgY21kTGVuID0gYXJnLmluZGV4T2YoJygnKTsKICAgIGxldCBhcmdTdHIgPSBhcmcuc2xpY2UoY21kTGVuICsgMSwgYXJnLmluZGV4T2YoJyknKSk7CiAgICBsZXQgYXJncyA9IGFyZ1N0ci5zcGxpdCgvWyxcc1wgXSsvZyk7CiAgICBsZXQgY21kID0gYXJnLnN1YnN0cmluZygwLCBjbWRMZW4pOwogICAgbGV0IHQ7CiAgICBsZXQgdW5pdDsKCiAgICBhcmdzID0gYXJncwogICAgICAuZmlsdGVyKGFyZyA9PiAvXlstKzAtOS5dK1thLXpdKiQvLnRlc3QoYXJnKSkKICAgICAgLm1hcChhcmcgPT4gewogICAgICAgIGlmKC9bYS16XSQvLnRlc3QoYXJnKSkgewogICAgICAgICAgdW5pdCA9IGFyZy5yZXBsYWNlKC9bLSswLTkuXSovZywgJycpOwogICAgICAgICAgYXJnID0gYXJnLnJlcGxhY2UoL1thLXpdKiQvZywgJycpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICthcmc7CiAgICAgIH0pOwogICAgLy9jb25zb2xlLmxvZygnZnJvbVN0cmluZycsIHsgY21kLCBhcmdzIH0pOwoKICAgIGNvbnN0IGlzM0QgPSBjbWQudG9Mb3dlckNhc2UoKS5lbmRzV2l0aCgnM2QnKTsKICAgIGlmKGlzM0QpIGNtZCA9IGNtZC5zbGljZSgwLCAtMik7CgogICAgaWYoY21kLnN0YXJ0c1dpdGgoJ3JvdGF0JykpIHsKICAgICAgY29uc3QgYXhpcyA9IGlzM0QgPyAnJyA6IGNtZC5zbGljZSg2KTsKICAgICAgYXJncyA9IGF4aXMgIT0gJycgPyBbYXJnc1swXSwgYXhpc10gOiBhcmdzOwogICAgICB0ID0gbmV3IFJvdGF0aW9uKC4uLmFyZ3MpOwogICAgfSBlbHNlIGlmKGNtZC5zdGFydHNXaXRoKCd0cmFuc2xhdCcpKSB7CiAgICAgIGNvbnN0IGF4aXMgPSBpczNEID8gJycgOiBjbWQuc2xpY2UoOSk7CiAgICAgIGFyZ3MgPSBheGlzICE9ICcnID8gW2FyZ3NbMF0sIGF4aXNdIDogYXJnczsKICAgICAgdCA9IG5ldyBUcmFuc2xhdGlvbiguLi5hcmdzKTsKICAgIH0gZWxzZSBpZihjbWQuc3RhcnRzV2l0aCgnc2NhbCcpKSB7CiAgICAgIGNvbnN0IGF4aXMgPSBpczNEID8gJycgOiBjbWQuc2xpY2UoNSk7CiAgICAgIGFyZ3MgPSBheGlzICE9ICcnID8gW2FyZ3NbMF0sIGF4aXNdIDogYXJnczsKICAgICAgdCA9IG5ldyBTY2FsaW5nKC4uLmFyZ3MpOwogICAgfSBlbHNlIGlmKGNtZC5zdGFydHNXaXRoKCdtYXRyaXgnKSkgewogICAgICBjb25zdCBbYSwgYiwgYywgZCwgZSwgZl0gPSBhcmdzOwogICAgICB0ID0gbmV3IE1hdHJpeFRyYW5zZm9ybWF0aW9uKGEsIGMsIGUsIGIsIGQsIGYpOwogICAgfQogICAgaWYodW5pdCkgdC51bml0ID0gdW5pdDsKICAgIHJldHVybiB0OwogIH0KCiAgLypbU3ltYm9sLnRvU3RyaW5nVGFnXSgpIHsKICAgIHJldHVybiB0aGlzLnRvU3RyaW5nKCk7CiAgfSovCgogIFtTeW1ib2wudG9QcmltaXRpdmVdKGhpbnQpIHsKICAgIC8vIGNvbnNvbGUubG9nKCJoaW50OiIsaGludCk7CiAgICBpZihoaW50ID09ICdzdHJpbmcnIHx8IGhpbnQgPT0gJ2RlZmF1bHQnKSByZXR1cm4gdGhpcy50b1N0cmluZygpOwoKICAgIHJldHVybiB0aGlzLnRvU3RyaW5nKCkgIT0gJyc7CiAgfQoKICBzdGF0aWMgZ2V0IHJvdGF0aW9uKCkgewogICAgcmV0dXJuIFJvdGF0aW9uOwogIH0KICBzdGF0aWMgZ2V0IHRyYW5zbGF0aW9uKCkgewogICAgcmV0dXJuIFRyYW5zbGF0aW9uOwogIH0KICBzdGF0aWMgZ2V0IHNjYWxpbmcoKSB7CiAgICByZXR1cm4gU2NhbGluZzsKICB9CiAgc3RhdGljIGdldCBtYXRyaXgoKSB7CiAgICByZXR1cm4gTWF0cml4VHJhbnNmb3JtYXRpb247CiAgfQp9CgovL1RyYW5zZm9ybWF0aW9uLnByb3RvdHlwZVtTeW1ib2wudG9TdHJpbmdUYWddPSdUcmFuc2Zvcm1hdGlvbic7CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoVHJhbnNmb3JtYXRpb24sIFN5bWJvbC5oYXNJbnN0YW5jZSwgewogIHZhbHVlKGluc3QpIHsKICAgIHJldHVybiBbVHJhbnNmb3JtYXRpb24sIE1hdHJpeFRyYW5zZm9ybWF0aW9uLCBSb3RhdGlvbiwgVHJhbnNsYXRpb24sIFNjYWxpbmcsIFRyYW5zZm9ybWF0aW9uTGlzdF0uc29tZShjdG9yID0+IE9iamVjdC5nZXRQcm90b3R5cGVPZihpbnN0KSA9PSBjdG9yLnByb3RvdHlwZSk7CiAgfQp9KTsKCmV4cG9ydCBjb25zdCBJbW11dGFibGVUcmFuc2Zvcm1hdGlvbiA9IGltbXV0YWJsZUNsYXNzKFRyYW5zZm9ybWF0aW9uKTsKCmV4cG9ydCBjbGFzcyBSb3RhdGlvbiBleHRlbmRzIFRyYW5zZm9ybWF0aW9uIHsKICBhbmdsZSA9IDA7CiAgLy9heGlzID0gdW5kZWZpbmVkOwoKICBjb25zdHJ1Y3RvcihhbmdsZSwgeCwgeSkgewogICAgc3VwZXIoJ3JvdGF0ZScpOwoKICAgIGlmKHR5cGVvZiB4ID09ICdzdHJpbmcnICYmIFsneCcsICd5JywgJ3onXS5pbmRleE9mKHgudG9Mb3dlckNhc2UoKSkgIT0gLTEpIHsKICAgICAgdGhpcy5heGlzID0geC50b0xvd2VyQ2FzZSgpOwogICAgfSBlbHNlIGlmKCFpc05hTigreCkgJiYgIWlzTmFOKCt5KSkgewogICAgICB0aGlzLmNlbnRlciA9IFsreCwgK3ldOwogICAgfQogICAgLy9lbHNlIHRoaXMuYXhpcyA9ICd6JzsKICAgIHRoaXMuYW5nbGUgPSBhbmdsZTsKICB9CgogIGludmVydCgpIHsKICAgIHJldHVybiBuZXcgUm90YXRpb24oLXRoaXMuYW5nbGUsIHRoaXMuYXhpcyk7CiAgfQoKICBnZXQgdmFsdWVzKCkgewogICAgcmV0dXJuIHsgW3RoaXMuYXhpcyB8fCAneiddOiB0aGlzLmFuZ2xlIH07CiAgfQoKICBnZXQgaXMzRCgpIHsKICAgIHJldHVybiB0aGlzLmF4aXMgPT0gJ3onOwogIH0KCiAgaXNaZXJvKCkgewogICAgcmV0dXJuIHRoaXMuYW5nbGUgPT0gMDsKICB9CgogIHRvU3RyaW5nKHJVbml0KSB7CiAgICByVW5pdCA9IHJVbml0IHx8IHRoaXMudW5pdCB8fCAnJzsKICAgIGNvbnN0IGF4aXMgPSB0aGlzLmF4aXMgIT09IHVuZGVmaW5lZCA/IHRoaXMuYXhpcy50b1VwcGVyQ2FzZSgpIDogJyc7CiAgICBjb25zdCBhbmdsZSA9IHRoaXMuY29uc3RydWN0b3IuY29udmVydEFuZ2xlKHRoaXMuYW5nbGUsIHJVbml0KTsKICAgIHJldHVybiBgcm90YXRlJHt0aGlzLmlzM0QgPyBheGlzIDogJyd9KCR7YW5nbGV9JHtyVW5pdH0ke3RoaXMuY2VudGVyID8gdGhpcy5jZW50ZXIubWFwKGNvb3JkID0+IGAsICR7Y29vcmR9YCkuam9pbignJykgOiAnJ30pYDsKICB9CgogIHRvU291cmNlKCkgewogICAgbGV0IG8gPSAnbmV3ICcgKyBjbGFzc05hbWUodGhpcykgKyAnKCcgKyB0aGlzLmFuZ2xlICsgJyknOwogICAgcmV0dXJuIG87CiAgfQoKICB0b01hdHJpeChtYXRyaXggPSBNYXRyaXguaWRlbnRpdHkoKSkgewogICAgY29uc3QgeyBjZW50ZXIsIGFuZ2xlIH0gPSB0aGlzOwogICAgaWYoY2VudGVyKSBtYXRyaXgudHJhbnNsYXRlU2VsZiguLi5bLi4uY2VudGVyXS5tYXAoY29vcmQgPT4gLWNvb3JkKSk7CiAgbWF0cml4PSAgbWF0cml4LnJvdGF0ZShERUcyUkFEICogYW5nbGUpOwogICAgaWYoY2VudGVyKSBtYXRyaXgudHJhbnNsYXRlU2VsZiguLi5jZW50ZXIpOwogICAgcmV0dXJuIG1hdHJpeC5yb3VuZCgpOwogIH0KCiAgYWNjdW11bGF0ZShvdGhlcikgewogICAgaWYodGhpcy50eXBlICE9PSBvdGhlci50eXBlICYmIHRoaXMuYXhpcyAhPT0gb3RoZXIuYXhpcykgdGhyb3cgbmV3IEVycm9yKGNsYXNzTmFtZSh0aGlzKSArICc6IGFjY3VtdWxhdGUgbWlzbWF0Y2gnKTsKICAgIHJldHVybiBuZXcgUm90YXRpb24odGhpcy5hbmdsZSArIG90aGVyLmFuZ2xlLCB0aGlzLmF4aXMpOwogIH0KCiAgc3RhdGljIGNvbnZlcnRBbmdsZShhbmdsZSwgdW5pdCkgewogICAgc3dpdGNoICh1bml0KSB7CiAgICAgIGNhc2UgJ2RlZyc6CiAgICAgICAgcmV0dXJuIGFuZ2xlOwogICAgICBjYXNlICdyYWQnOgogICAgICAgIHJldHVybiBERUcyUkFEICogYW5nbGU7CiAgICAgIGNhc2UgJ3R1cm4nOgogICAgICAgIHJldHVybiBhbmdsZSAvIDM2MDsKICAgICAgZGVmYXVsdDoKICAgICAgICByZXR1cm4gYW5nbGU7CiAgICB9CiAgfQp9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoUm90YXRpb24ucHJvdG90eXBlLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdSb3RhdGlvbicsIGVudW1lcmFibGU6IGZhbHNlIH0pOwoKZXhwb3J0IGNvbnN0IEltbXV0YWJsZVJvdGF0aW9uID0gaW1tdXRhYmxlQ2xhc3MoUm90YXRpb24pOwoKZXhwb3J0IGNsYXNzIFRyYW5zbGF0aW9uIGV4dGVuZHMgVHJhbnNmb3JtYXRpb24gewogIHggPSAwOwogIHkgPSAwOwogIC8veiA9IHVuZGVmaW5lZDsKCiAgY29uc3RydWN0b3IoLi4uYXJncykgewogICAgc3VwZXIoJ3RyYW5zbGF0ZScpOwoKICAgIGlmKHR5cGVvZiBhcmdzWzFdID09ICdzdHJpbmcnICYmIFsneCcsICd5JywgJ3onXS5pbmRleE9mKGFyZ3NbMV0udG9Mb3dlckNhc2UoKSkgIT0gLTEpIHsKICAgICAgY29uc3QgbiA9IGFyZ3Muc2hpZnQoKTsKICAgICAgY29uc3QgYXhpcyA9IGFyZ3Muc2hpZnQoKS50b0xvd2VyQ2FzZSgpOwogICAgICB0aGlzW2F4aXNdID0gbjsKICAgIH0gZWxzZSB7CiAgICAgIGxldCBudW1EaW0gPSBbLi4uYXJncywgJy4nXS5maW5kSW5kZXgoYSA9PiBpc05hTigrYSkpOwogICAgICBjb25zdCBbeCA9IDAsIHkgPSAwLCB6XSA9IGFyZ3Muc3BsaWNlKDAsIG51bURpbSk7CiAgICAgIHRoaXMueCA9ICt4OwogICAgICB0aGlzLnkgPSAreTsKICAgICAgaWYoeiAhPT0gdW5kZWZpbmVkKSB0aGlzLnogPSArejsKICAgIH0KICAgIGlmKGFyZ3MubGVuZ3RoID4gMCAmJiB0eXBlb2YgYXJnc1swXSA9PSAnc3RyaW5nJykgdGhpcy51bml0ID0gYXJncy5zaGlmdCgpOwogIH0KCiAgZ2V0IHZhbHVlcygpIHsKICAgIGNvbnN0IHsgeCwgeSwgeiB9ID0gdGhpczsKICAgIHJldHVybiAneicgaW4gdGhpcyA/IHsgeCwgeSwgeiB9IDogeyB4LCB5IH07CiAgfQoKICBpc1plcm8oKSB7CiAgICBjb25zdCB7IHgsIHksIHogfSA9IHRoaXM7CiAgICByZXR1cm4gJ3onIGluIHRoaXMgPyB4ID09IDAgJiYgeSA9PSAwICYmIHogPT0gMCA6IHggPT0gMCAmJiB5ID09IDA7CiAgfQoKICB0b01hdHJpeChtYXRyaXggPSBNYXRyaXguaWRlbnRpdHkoKSkgewogICAgY29uc3QgeyB4LCB5IH0gPSB0aGlzOwogICAgcmV0dXJuIG1hdHJpeC50cmFuc2xhdGUoeCwgeSk7CiAgfQoKICAvKmNsb25lKCkgewogICAgY29uc3QgeyB4LCB5LCB6IH0gPSB0aGlzOwogICAgcmV0dXJuIHogIT09IHVuZGVmaW5lZCA/IG5ldyBUcmFuc2xhdGlvbih4LCB5LCB6KSA6IG5ldyBUcmFuc2xhdGlvbih4LCB5KTsKICB9Ki8KCiAgaW52ZXJ0KCkgewogICAgY29uc3QgeyB4LCB5LCB6IH0gPSB0aGlzOwogICAgcmV0dXJuIHogIT09IHVuZGVmaW5lZCA/IG5ldyBUcmFuc2xhdGlvbigteCwgLXksIC16KSA6IG5ldyBUcmFuc2xhdGlvbihNYXRoLmFicyh4KSA9PSAwID8gMCA6IC14LCBNYXRoLmFicyh5KSA9PSAwID8gMCA6IC15KTsKICB9CgogIGFjY3VtdWxhdGUob3RoZXIpIHsKICAgIGlmKHRoaXMudHlwZSAhPT0gb3RoZXIudHlwZSkgdGhyb3cgbmV3IEVycm9yKGNsYXNzTmFtZSh0aGlzKSArICc6IGFjY3VtdWxhdGUgbWlzbWF0Y2gnKTsKCiAgICBpZih0aGlzLmlzM0QpIHJldHVybiBuZXcgVHJhbnNsYXRpb24odGhpcy54ICsgb3RoZXIueCwgdGhpcy55ICsgb3RoZXIueSwgdGhpcy56ICsgb3RoZXIueik7CiAgICByZXR1cm4gbmV3IFRyYW5zbGF0aW9uKHRoaXMueCArIG90aGVyLngsIHRoaXMueSArIG90aGVyLnkpOwogIH0KfQpPYmplY3QuZGVmaW5lUHJvcGVydHkoVHJhbnNsYXRpb24ucHJvdG90eXBlLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdUcmFuc2xhdGlvbicsIGVudW1lcmFibGU6IGZhbHNlIH0pOwoKZXhwb3J0IGNvbnN0IEltbXV0YWJsZVRyYW5zbGF0aW9uID0gaW1tdXRhYmxlQ2xhc3MoVHJhbnNsYXRpb24pOwoKZXhwb3J0IGNsYXNzIFNjYWxpbmcgZXh0ZW5kcyBUcmFuc2Zvcm1hdGlvbiB7CiAgeCA9IDE7CiAgeSA9IDE7CiAgLy96ID0gdW5kZWZpbmVkOwoKICBjb25zdHJ1Y3RvciguLi5hcmdzKSB7CiAgICBzdXBlcignc2NhbGUnKTsKCiAgICBpZih0eXBlb2YgYXJnc1sxXSA9PSAnc3RyaW5nJyAmJiBbJ3gnLCAneScsICd6J10uaW5kZXhPZihhcmdzWzFdLnRvTG93ZXJDYXNlKCkpICE9IC0xKSB7CiAgICAgIGNvbnN0IG4gPSBhcmdzLnNoaWZ0KCk7CiAgICAgIGNvbnN0IGF4aXMgPSBhcmdzLnNoaWZ0KCkudG9Mb3dlckNhc2UoKTsKICAgICAgdGhpc1theGlzXSA9IG47CiAgICB9IGVsc2UgewogICAgICBjb25zdCBbeCA9IDEsIHksIHpdID0gYXJncy5zcGxpY2UoMCwgMyk7CiAgICAgIHRoaXMueCA9ICt4OwogICAgICB0aGlzLnkgPSB5ID09PSB1bmRlZmluZWQgPyB0aGlzLnggOiAreTsKICAgICAgaWYoeiAhPT0gdW5kZWZpbmVkKSB0aGlzLnogPSArejsKICAgIH0KICB9CgogIGdldCB2YWx1ZXMoKSB7CiAgICBjb25zdCB7IHgsIHksIHogfSA9IHRoaXM7CiAgICByZXR1cm4gJ3onIGluIHRoaXMgPyB7IHgsIHksIHogfSA6IHsgeCwgeSB9OwogIH0KCiAgdG9NYXRyaXgobWF0cml4ID0gTWF0cml4LmlkZW50aXR5KCkpIHsKICAgIGNvbnN0IHsgeCwgeSB9ID0gdGhpczsKICAgIHJldHVybiBtYXRyaXguc2NhbGVTZWxmKHgsIHkpOwogIH0KCiAgaXNaZXJvKCkgewogICAgY29uc3QgeyB4LCB5LCB6IH0gPSB0aGlzOwogICAgcmV0dXJuICd6JyBpbiB0aGlzID8geCA9PSAxICYmIHkgPT0gMSAmJiB6ID09IDEgOiB4ID09IDEgJiYgeSA9PSAxOwogIH0KCiAgdG9TdHJpbmcoKSB7CiAgICBjb25zdCB2ZWN0b3IgPSB0aGlzLnZlY3RvcignJyk7CiAgICBjb25zdCBjb29yZHMgPSB2ZWN0b3Iuam9pbignLCAnKTsKCiAgICByZXR1cm4gYCR7dGhpcy50eXBlfSR7dGhpcy5pczNEID8gJzNkJyA6ICcnfSgke2Nvb3Jkc30pYDsKICB9CgogIC8qY2xvbmUoKSB7CiAgICBjb25zdCB7IHgsIHksIHogfSA9IHRoaXM7CiAgICByZXR1cm4geiAhPT0gdW5kZWZpbmVkID8gbmV3IFNjYWxpbmcoeCwgeSwgeikgOiBuZXcgU2NhbGluZyh4LCB5KTsKICB9Ki8KCiAgaW52ZXJ0KCkgewogICAgY29uc3QgeyB4LCB5LCB6IH0gPSB0aGlzOwogICAgcmV0dXJuIHogIT09IHVuZGVmaW5lZCA/IG5ldyBTY2FsaW5nKDEgLyB4LCAxIC8geSwgMSAvIHopIDogbmV3IFNjYWxpbmcoMSAvIHgsIDEgLyB5KTsKICB9CgogIGFjY3VtdWxhdGUob3RoZXIpIHsKICAgIGlmKHRoaXMudHlwZSAhPT0gb3RoZXIudHlwZSkgdGhyb3cgbmV3IEVycm9yKGNsYXNzTmFtZSh0aGlzKSArICc6IGFjY3VtdWxhdGUgbWlzbWF0Y2gnKTsKCiAgICBpZih0aGlzLmlzM0QpIHJldHVybiBuZXcgU2NhbGluZyh0aGlzLnggKiBvdGhlci54LCB0aGlzLnkgKiBvdGhlci55LCB0aGlzLnogKiBvdGhlci56KTsKICAgIHJldHVybiBuZXcgU2NhbGluZyh0aGlzLnggKiBvdGhlci54LCB0aGlzLnkgKiBvdGhlci55KTsKICB9Cn0KT2JqZWN0LmRlZmluZVByb3BlcnR5KFNjYWxpbmcucHJvdG90eXBlLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdTY2FsaW5nJywgZW51bWVyYWJsZTogZmFsc2UgfSk7CgpleHBvcnQgY29uc3QgSW1tdXRhYmxlU2NhbGluZyA9IGltbXV0YWJsZUNsYXNzKFNjYWxpbmcpOwoKZXhwb3J0IGNsYXNzIE1hdHJpeFRyYW5zZm9ybWF0aW9uIGV4dGVuZHMgVHJhbnNmb3JtYXRpb24gewogIG1hdHJpeCA9IE1hdHJpeC5JREVOVElUWTsKCiAgY29uc3RydWN0b3IoaW5pdCkgewogICAgc3VwZXIoJ21hdHJpeCcpOwoKICAgIGlmKGluaXQgaW5zdGFuY2VvZiBNYXRyaXgpIHRoaXMubWF0cml4ID0gaW5pdDsKICAgIGVsc2UgaWYoaXNNYXRyaXgoaW5pdCkpIHRoaXMubWF0cml4ID0gbmV3IE1hdHJpeChpbml0KTsKICAgIGVsc2UgdGhpcy5tYXRyaXggPSBuZXcgTWF0cml4KC4uLmFyZ3VtZW50cyk7CiAgfQoKICBnZXQgdmFsdWVzKCkgewogICAgcmV0dXJuIHRoaXMubWF0cml4LnZhbHVlcygpOwogIH0KCiAgdG9NYXRyaXgobWF0cml4ID0gTWF0cml4LmlkZW50aXR5KCkpIHsKICAgIHJldHVybiBtYXRyaXgubXVsdGlwbHlTZWxmKHRoaXMubWF0cml4KTsKICB9CgogIHRvU3RyaW5nKCkgewogICAgcmV0dXJuIHRoaXMubWF0cml4LnRvU3RyaW5nKCcnKTsKICB9CgogIGludmVydCgpIHsKICAgIHJldHVybiBuZXcgTWF0cml4VHJhbnNmb3JtYXRpb24odGhpcy5tYXRyaXguaW52ZXJ0KCkpOwogIH0KCiAgaXNaZXJvKCkgewogICAgcmV0dXJuIHRoaXMubWF0cml4LmlzSWRlbnRpdHkoKTsKICB9CgogIGFjY3VtdWxhdGUob3RoZXIpIHsKICAgIGlmKHRoaXMudHlwZSAhPT0gb3RoZXIudHlwZSkgdGhyb3cgbmV3IEVycm9yKGNsYXNzTmFtZSh0aGlzKSArICc6IGFjY3VtdWxhdGUgbWlzbWF0Y2gnKTsKCiAgICByZXR1cm4gbmV3IE1hdHJpeFRyYW5zZm9ybWF0aW9uKHRoaXMubWF0cml4Lm11bHRpcGx5KG90aGVyLm1hdHJpeCkpOwogIH0KfQpPYmplY3QuZGVmaW5lUHJvcGVydHkoTWF0cml4VHJhbnNmb3JtYXRpb24ucHJvdG90eXBlLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsKICB2YWx1ZTogJ01hdHJpeFRyYW5zZm9ybWF0aW9uJywKICBlbnVtZXJhYmxlOiBmYWxzZQp9KTsKCmV4cG9ydCBjb25zdCBJbW11dGFibGVNYXRyaXhUcmFuc2Zvcm1hdGlvbiA9IGltbXV0YWJsZUNsYXNzKE1hdHJpeFRyYW5zZm9ybWF0aW9uKTsKCmV4cG9ydCBjbGFzcyBUcmFuc2Zvcm1hdGlvbkxpc3QgZXh0ZW5kcyBBcnJheSB7CiAgY29uc3RydWN0b3IoaW5pdCwgdFVuaXQsIHJVbml0KSB7CiAgICBzdXBlcigpOwogICAgaWYoaXNPYmplY3QoaW5pdCkpIHsKICAgICAgaWYodFVuaXQgPT09IHVuZGVmaW5lZCkgdFVuaXQgPSBpbml0LnRyYW5zbGF0aW9uVW5pdCB8fCBpbml0LnRVbml0OwogICAgICBpZihyVW5pdCA9PSB1bmRlZmluZWQpIHJVbml0ID0gaW5pdC5yb3RhdGlvblVuaXQgfHwgaW5pdC5yVW5pdDsKICAgIH0KICAgIGlmKGluaXQpIHsKICAgICAgdGhpcy5pbml0aWFsaXplKGluaXQpOwogICAgfQogICAgaWYodHlwZW9mIHRVbml0ID09ICdzdHJpbmcnKSB0aGlzLnRyYW5zbGF0aW9uVW5pdCA9IHRVbml0OwogICAgaWYodHlwZW9mIHJVbml0ID09ICdzdHJpbmcnKSB0aGlzLnJvdGF0aW9uVW5pdCA9IHJVbml0OwoKICAgIHJldHVybiB0aGlzOwogIH0KCiAgaW5pdGlhbGl6ZShpbml0KSB7CiAgICBpZih0eXBlb2YgaW5pdCA9PSAnbnVtYmVyJykgd2hpbGUodGhpcy5sZW5ndGggPCBpbml0KSB0aGlzLnB1c2godW5kZWZpbmVkKTsKICAgIGVsc2UgaWYodHlwZW9mIGluaXQgPT0gJ3N0cmluZycpIFRyYW5zZm9ybWF0aW9uTGlzdC5wcm90b3R5cGUuZnJvbVN0cmluZy5jYWxsKHRoaXMsIGluaXQpOwogICAgZWxzZSBpZihpbml0IGluc3RhbmNlb2YgQXJyYXkpIFRyYW5zZm9ybWF0aW9uTGlzdC5wcm90b3R5cGUuZnJvbUFycmF5LmNhbGwodGhpcywgaW5pdCk7CiAgICBlbHNlIHRocm93IG5ldyBFcnJvcignTm8gc3VjaCBpbml0aWFsaXphdGlvbjogJyArIGluaXQpOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBnZXQgW1N5bWJvbC5pc0NvbmNhdFNwcmVhZGFibGVdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKgogIFtTeW1ib2wudG9TdHJpbmdUYWddKCkgewogICAgcmV0dXJuIHRoaXMudG9Tb3VyY2UoKTsKICB9Ki8KCiAgc3RhdGljIGdldCBbU3ltYm9sLnNwZWNpZXNdKCkgewogICAgcmV0dXJuIFRyYW5zZm9ybWF0aW9uTGlzdDsKICB9CgogIGdldCBbU3ltYm9sLnNwZWNpZXNdKCkgewogICAgcmV0dXJuIFRyYW5zZm9ybWF0aW9uTGlzdDsKICB9CgogIGZyb21TdHJpbmcoc3RyKSB7CiAgICBsZXQgbiwKICAgICAgYSA9IFtdOwoKICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpICs9IG4pIHsKICAgICAgbGV0IHMgPSBzdHIuc2xpY2UoaSk7CiAgICAgIG4gPSBzLmluZGV4T2YoJyknKSArIDE7CiAgICAgIGlmKG4gPT0gMCkgbiA9IHN0ci5sZW5ndGg7CiAgICAgIHMgPSBzLnNsaWNlKDAsIG4pLnRyaW0oKTsKICAgICAgaWYocyAhPSAnJykgYS5wdXNoKHMpOwogICAgfQogICAgcmV0dXJuIHRoaXMuZnJvbUFycmF5KGEpOwogIH0KCiAgZnJvbUFycmF5KGFycikgewogICAgZm9yKGxldCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCBhcmcgPSBhcnJbaV07CgogICAgICBpZihhcmcgaW5zdGFuY2VvZiBUcmFuc2Zvcm1hdGlvbikgdGhpcy5wdXNoKGFyZyk7CiAgICAgIGVsc2UgaWYodHlwZW9mIGFyZyA9PSAnc3RyaW5nJykgdGhpcy5wdXNoKFRyYW5zZm9ybWF0aW9uLmZyb21TdHJpbmcoYXJnKSk7CiAgICAgIGVsc2UgdGhyb3cgbmV3IEVycm9yKCdObyBzdWNoIHRyYW5zZm9ybWF0aW9uOiAnICsgYXJnKTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9CgogIGdldCB0cmFuc2xhdGlvblVuaXQoKSB7CiAgICByZXR1cm4gKGlzT2JqZWN0KHRoaXMudHJhbnNsYXRpb24pICYmIHRoaXMudHJhbnNsYXRpb24udW5pdCkgfHwgdGhpcy50VW5pdDsKICB9CiAgc2V0IHRyYW5zbGF0aW9uVW5pdCh2YWx1ZSkgewogICAgaWYoaXNPYmplY3QodGhpcy50cmFuc2xhdGlvbikpIHRoaXMudHJhbnNsYXRpb24udW5pdCA9IHZhbHVlOwogICAgZWxzZSB0aGlzLnRVbml0ID0gdmFsdWU7CiAgfQoKICBnZXQgcm90YXRpb25Vbml0KCkgewogICAgcmV0dXJuIChpc09iamVjdCh0aGlzLnJvdGF0aW9uKSAmJiB0aGlzLnJvdGF0aW9uLnVuaXQpIHx8IHRoaXMuclVuaXQ7CiAgfQogIHNldCByb3RhdGlvblVuaXQodmFsdWUpIHsKICAgIGlmKGlzT2JqZWN0KHRoaXMucm90YXRpb24pKSB0aGlzLnJvdGF0aW9uLnVuaXQgPSB2YWx1ZTsKICAgIGVsc2UgdGhpcy5yVW5pdCA9IHZhbHVlOwogIH0KICBzdGF0aWMgZnJvbVN0cmluZyhzdHIpIHsKICAgIHJldHVybiBuZXcgVHJhbnNmb3JtYXRpb25MaXN0KCkuZnJvbVN0cmluZyhzdHIpOwogIH0KCiAgc3RhdGljIGZyb21BcnJheShhcnIpIHsKICAgIHJldHVybiBuZXcgVHJhbnNmb3JtYXRpb25MaXN0KCkuZnJvbUFycmF5KGFycik7CiAgfQoKICBzdGF0aWMgZnJvbU1hdHJpeChtYXRyaXgpIHsKICAgIG1hdHJpeCA9IG1hdHJpeCBpbnN0YW5jZW9mIE1hdHJpeCA/IG1hdHJpeCA6IG5ldyBNYXRyaXgobWF0cml4KTsKCiAgICBjb25zdCB0cmFuc2Zvcm1hdGlvbnMgPSBNYXRyaXguZGVjb21wb3NlKG1hdHJpeCwgdHJ1ZSk7CgogICAgZGVmaW5lKHRyYW5zZm9ybWF0aW9ucy5zY2FsZSwgewogICAgICB0b0FycmF5KCkgewogICAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnldOwogICAgICB9CiAgICB9KTsKICAgIGRlZmluZSh0cmFuc2Zvcm1hdGlvbnMudHJhbnNsYXRlLCB7CiAgICAgIHRvQXJyYXkoKSB7CiAgICAgICAgcmV0dXJuIFt0aGlzLngsIHRoaXMueV07CiAgICAgIH0KICAgIH0pOwoKICAgIGxldCByZXQgPSBuZXcgVHJhbnNmb3JtYXRpb25MaXN0KCk7CgogICAgcmV0LnRyYW5zbGF0ZSguLi50cmFuc2Zvcm1hdGlvbnMudHJhbnNsYXRlLnRvQXJyYXkoKSk7CiAgICByZXQucm90YXRlKHRyYW5zZm9ybWF0aW9ucy5yb3RhdGUpOwogICAgcmV0LnNjYWxlKC4uLnRyYW5zZm9ybWF0aW9ucy5zY2FsZS50b0FycmF5KCkpOwoKICAgIHJldHVybiByZXQ7CiAgfQoKICBwdXNoKC4uLmFyZ3MpIHsKICAgIGZvcihsZXQgYXJnIG9mIGFyZ3MpIHsKICAgICAgaWYodHlwZW9mIGFyZyA9PSAnc3RyaW5nJykgYXJnID0gVHJhbnNmb3JtYXRpb24uZnJvbVN0cmluZyhhcmcpOwogICAgICBlbHNlIGlmKGlzTWF0cml4KGFyZykpIGFyZyA9IG5ldyBNYXRyaXhUcmFuc2Zvcm1hdGlvbihhcmcpOwoKICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guY2FsbCh0aGlzLCBhcmcpOwogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBjbG9uZSgpIHsKICAgIHJldHVybiB0aGlzLm1hcCh0ID0+IHQuY2xvbmUoKSk7IC8vIHRoaXMuc2xpY2UoKTsKICB9CgogIG1hcChmbikgewogICAgcmV0dXJuIHRoaXMuYmFzZUNhbGwoQXJyYXkucHJvdG90eXBlLm1hcCkoZm4pOwogIH0KCiAgc2xpY2UoLi4uYXJncykgewogICAgcmV0dXJuIHRoaXMuYmFzZUNhbGwoQXJyYXkucHJvdG90eXBlLnNsaWNlKSguLi5hcmdzKTsKICB9CgogIHNwbGljZSguLi5hcmdzKSB7CiAgICByZXR1cm4gdGhpcy5iYXNlQ2FsbChBcnJheS5wcm90b3R5cGUuc3BsaWNlKSguLi5hcmdzKTsKICB9CgogIGNvbmNhdCguLi5hcmdzKSB7CiAgICByZXR1cm4gdGhpcy5iYXNlQ2FsbChBcnJheS5wcm90b3R5cGUuY29uY2F0KSguLi5hcmdzKTsKICB9CgogIGZpbHRlcihwcmVkKSB7CiAgICByZXR1cm4gdGhpcy5iYXNlQ2FsbChBcnJheS5wcm90b3R5cGUuZmlsdGVyKShwcmVkKTsKICB9CgogIGJhc2VDYWxsKGMgPSBBcnJheS5wcm90b3R5cGUubWFwKSB7CiAgICByZXR1cm4gKC4uLmFyZ3MpID0+IHsKICAgICAgY29uc3QgeyB0VW5pdCwgclVuaXQgfSA9IHRoaXM7CiAgICAgIGxldCByID0gYy5jYWxsKHRoaXMsIC4uLmFyZ3MpOwogICAgICBpZih0VW5pdCkgci50VW5pdCA9IHRVbml0OwogICAgICBpZihyVW5pdCkgci5yVW5pdCA9IHJVbml0OwogICAgICByZXR1cm4gcjsKICAgIH07CiAgfQoKICB1bnNoaWZ0KC4uLmFyZ3MpIHsKICAgIGZvcihsZXQgYXJnIG9mIGFyZ3MucmV2ZXJzZSgpKSB7CiAgICAgIGlmKHR5cGVvZiBhcmcgPT0gJ3N0cmluZycpIGFyZyA9IFRyYW5zZm9ybWF0aW9uLmZyb21TdHJpbmcoYXJnKTsKICAgICAgQXJyYXkucHJvdG90eXBlLnVuc2hpZnQuY2FsbCh0aGlzLCBhcmcpOwogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfQoKICByb3RhdGUoLi4uYXJncykgewogICAgbGV0IHJvdGF0aW9uID0gbmV3IFJvdGF0aW9uKC4uLmFyZ3MpOwogICAgaWYoIXJvdGF0aW9uLmlzWmVybygpKSBBcnJheS5wcm90b3R5cGUucHVzaC5jYWxsKHRoaXMsIHJvdGF0aW9uKTsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgdHJhbnNsYXRlKHgsIHkpIHsKICAgIGxldCB0cmFucyA9IHRoaXMuZmlsdGVyKHQgPT4gIXQudHlwZS5zdGFydHNXaXRoKCd0cmFuc2xhdCcpKTsKICAgIGxldCB2ZWMgPSBuZXcgUG9pbnQoeCwgeSk7CgogICAgLy90cmFucy50b01hdHJpeCgpLnRyYW5zZm9ybVBvaW50KHZlYyk7CgogICAgdmVjID0gdmVjLnJvdW5kKDAuMDAwMDEsIDUpOwogICAgLy9jb25zb2xlLmxvZygiZnJvbToiLCBuZXcgUG9pbnQoeCx5KSwgIiB0bzoiLCB2ZWMpOwogICAgbGV0IHRyYW5zbGF0aW9uID0gbmV3IFRyYW5zbGF0aW9uKHZlYy54LCB2ZWMueSk7CgogICAgaWYoIXRyYW5zbGF0aW9uLmlzWmVybygpKSAvKiAgICBpZihNYXRoLmFicyh2ZWMueCkgIT0gMCB8fCBNYXRoLmFicyh2ZWMueSkgIT0gMCkgKi8gQXJyYXkucHJvdG90eXBlLnB1c2guY2FsbCh0aGlzLCB0cmFuc2xhdGlvbik7CgogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBzY2FsZSguLi5hcmdzKSB7CiAgICBsZXQgc2NhbGluZyA9IG5ldyBTY2FsaW5nKC4uLmFyZ3MpOwogICAgaWYoIXNjYWxpbmcuaXNaZXJvKCkpIEFycmF5LnByb3RvdHlwZS5wdXNoLmNhbGwodGhpcywgc2NhbGluZyk7CiAgICByZXR1cm4gdGhpczsKICB9CgogIG1hdHJpeCguLi5hcmdzKSB7CiAgICBsZXQgbWF0cml4VHJhbnNmb3JtYXRpb24gPSBuZXcgTWF0cml4VHJhbnNmb3JtYXRpb24oLi4uYXJncyk7CiAgICBpZighbWF0cml4VHJhbnNmb3JtYXRpb24uaXNaZXJvKCkpIEFycmF5LnByb3RvdHlwZS5wdXNoLmNhbGwodGhpcywgbWF0cml4VHJhbnNmb3JtYXRpb24pOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICB0b1N0cmluZyh0VW5pdCwgclVuaXQpIHsKICAgIGlmKHRoaXMubGVuZ3RoID4gMCkgewogICAgICB0VW5pdCA9IHRVbml0IHx8IHRoaXMudHJhbnNsYXRpb25Vbml0OwogICAgICByVW5pdCA9IHJVbml0IHx8IHRoaXMucm90YXRpb25Vbml0OwogICAgICBsZXQgciA9IHRoaXMubWFwKHQgPT4gdCAmJiB0LnR5cGUgJiYgdC50b1N0cmluZyh0LnR5cGUuc3RhcnRzV2l0aCgnc2NhbCcpID8gJycgOiB0LnR5cGUuc3RhcnRzV2l0aCgncm90YXQnKSA/IHJVbml0IDogdFVuaXQpKS5qb2luKCcgJyk7CiAgICAgIHJldHVybiByOwogICAgfQogICAgcmV0dXJuICcnOwogIH0KCiAgdG9ET00oKSB7CiAgICByZXR1cm4gdGhpcy50b1N0cmluZygncHgnLCAnZGVnJyk7CiAgfQoKICAvKiAgW1N5bWJvbC50b1N0cmluZ1RhZ10oKSB7CiAgICByZXR1cm4gdGhpcy50b1N0cmluZygpOwogIH0qLwoKICB0b1NvdXJjZSgpIHsKICAgIGxldCBzID0gJ25ldyAnICsgY2xhc3NOYW1lKHRoaXMpICsgJyhbJzsKCiAgICBzICs9IHRoaXMubWFwKHQgPT4gdC50b1NvdXJjZSgpKS5qb2luKCcsICcpOwogICAgcmV0dXJuIHMgKyAnXSknOwogIH0KCiAgdG9NYXRyaWNlcygpIHsKICAgIHJldHVybiBbLi4udGhpcy5tYXAodCA9PiB0LnRvTWF0cml4KCkpXTsKICB9CgogIHRvTWF0cml4KCkgewogICAgcmV0dXJuIG5ldyBNYXRyaXgoKS5tdWx0aXBseSguLi50aGlzLnRvTWF0cmljZXMoKSk7CiAgfQoKICB1bmRvKCkgewogICAgbGV0IHJldCA9IG5ldyBUcmFuc2Zvcm1hdGlvbkxpc3QoKTsKCiAgICBmb3IobGV0IGkgPSB0aGlzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBBcnJheS5wcm90b3R5cGUucHVzaC5jYWxsKHJldCwgdGhpc1tpXS5pbnZlcnQoKSk7CgogICAgcmV0dXJuIHJldDsKICB9CgogIG1lcmdlKC4uLmFyZ3MpIHsKICAgIGZvcihsZXQgYXJnIG9mIGFyZ3MpIHsKICAgICAgaWYodHlwZW9mIGFyZyA9PSAnc3RyaW5nJykgYXJnID0gVHJhbnNmb3JtYXRpb25MaXN0LmZyb21TdHJpbmcoYXJnKTsKCiAgICAgIFRyYW5zZm9ybWF0aW9uTGlzdC5wcm90b3R5cGUucHVzaC5hcHBseSh0aGlzLCBhcmcpOwogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBkZWNvbXBvc2UoZGVncmVlcyA9IHRydWUsIHRyYW5zZm9ybWF0aW9uTGlzdCA9IHRydWUpIHsKICAgIGxldCBtYXRyaXggPSB0aGlzLnRvTWF0cml4KCk7CiAgICBjb25zdCB7IHRyYW5zbGF0ZSwgcm90YXRlLCBzY2FsZSB9ID0gbWF0cml4LmRlY29tcG9zZShkZWdyZWVzKTsKICAgIGxldCBkZWNvbXBvc2VkID0geyB0cmFuc2xhdGUsIHJvdGF0ZSwgc2NhbGUgfTsKCiAgICBpZih0cmFuc2Zvcm1hdGlvbkxpc3QpIHsKICAgICAgbGV0IHJldCA9IG5ldyBUcmFuc2Zvcm1hdGlvbkxpc3QoKTsKICAgICAgcmV0LnRyYW5zbGF0ZSh0cmFuc2xhdGUueCwgdHJhbnNsYXRlLnksIHRyYW5zbGF0ZS56KTsKICAgICAgcmV0LnJvdGF0ZShyb3RhdGUpOwogICAgICByZXQuc2NhbGUoc2NhbGUueCwgc2NhbGUueSwgc2NhbGUueik7CiAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgZGVjb21wb3NlZC5zY2FsZS50b0FycmF5ID0gZGVjb21wb3NlZC50cmFuc2xhdGUudG9BcnJheSA9IGZ1bmN0aW9uIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnldOwogICAgfTsKICAgIHJldHVybiBkZWNvbXBvc2VkOwogIH0KCiAgZmluZExhc3RJbmRleChwcmVkaWNhdGUpIHsKICAgIGZvcihsZXQgaSA9IHRoaXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgY29uc3QgeCA9IHRoaXNbaV07CiAgICAgIGlmKHByZWRpY2F0ZSh4KSkgcmV0dXJuIGk7CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CgogIGZpbmRMYXN0KHByZWRpY2F0ZSkgewogICAgbGV0IGluZGV4ID0gdGhpcy5maW5kTGFzdEluZGV4KHByZWRpY2F0ZSk7CiAgICByZXR1cm4gdGhpc1tpbmRleF07CiAgfQoKICBnZXQgcm90YXRpb24oKSB7CiAgICByZXR1cm4gdGhpcy5maW5kTGFzdChpdGVtID0+IGl0ZW0gJiYgaXRlbS50eXBlICYmIGl0ZW0udHlwZS5zdGFydHNXaXRoKCdyb3RhdCcpKTsKICB9CiAgc2V0IHJvdGF0aW9uKHZhbHVlKSB7CiAgICBsZXQgaW5kZXggPSB0aGlzLmZpbmRMYXN0SW5kZXgoaXRlbSA9PiBpdGVtLnR5cGUuc3RhcnRzV2l0aCgncm90YXQnKSk7CiAgICB2YWx1ZSA9IHZhbHVlIGluc3RhbmNlb2YgUm90YXRpb24gPyB2YWx1ZSA6IG5ldyBSb3RhdGlvbih2YWx1ZSk7CiAgICBBcnJheS5wcm90b3R5cGUuc3BsaWNlLmNhbGwodGhpcywgaW5kZXgsIDEsIHZhbHVlKTsKICB9CgogIGdldCBzY2FsaW5nKCkgewogICAgcmV0dXJuIHRoaXMuZmluZExhc3QoaXRlbSA9PiBpdGVtICYmIGl0ZW0udHlwZSAmJiBpdGVtLnR5cGUuc3RhcnRzV2l0aCgnc2NhbCcpKTsKICB9CiAgc2V0IHNjYWxpbmcodmFsdWUpIHsKICAgIGxldCBpbmRleCA9IHRoaXMuZmluZExhc3RJbmRleChpdGVtID0+IGl0ZW0udHlwZS5zdGFydHNXaXRoKCdzY2FsJykpOwogICAgdmFsdWUgPSB2YWx1ZSBpbnN0YW5jZW9mIFNjYWxpbmcgPyB2YWx1ZSA6IG5ldyBTY2FsaW5nKHZhbHVlKTsKICAgIEFycmF5LnByb3RvdHlwZS5zcGxpY2UuY2FsbCh0aGlzLCBpbmRleCwgMSwgdmFsdWUpOwogIH0KCiAgZ2V0IHRyYW5zbGF0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuZmluZExhc3QoaXRlbSA9PiBpdGVtICYmIGl0ZW0udHlwZSAmJiB0eXBlb2YgaXRlbS50eXBlID09ICdzdHJpbmcnICYmIGl0ZW0udHlwZS5zdGFydHNXaXRoKCd0cmFuc2xhdCcpKTsKICB9CgogIHNldCB0cmFuc2xhdGlvbih2YWx1ZSkgewogICAgbGV0IGluZGV4ID0gdGhpcy5maW5kTGFzdEluZGV4KGl0ZW0gPT4gaXRlbSAmJiBpdGVtLnR5cGUgJiYgaXRlbS50eXBlLnN0YXJ0c1dpdGgoJ3RyYW5zbCcpKTsKICAgIHZhbHVlID0gdmFsdWUgaW5zdGFuY2VvZiBUcmFuc2xhdGlvbiA/IHZhbHVlIDogbmV3IFRyYW5zbGF0aW9uKHZhbHVlKTsKICAgIEFycmF5LnByb3RvdHlwZS5zcGxpY2UuY2FsbCh0aGlzLCBpbmRleCwgMSwgdmFsdWUpOwogIH0KICAvKiAgbWFwKC4uLmFyZ3MpIHsKICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUubWFwLmFwcGx5KEFycmF5LmZyb20odGhpcyksIGFyZ3MpOwogIH0qLwoKICBnZXQgbGFzdCgpIHsKICAgIHJldHVybiB0aGlzLmF0KC0xKTsKICB9CiAgZ2V0IGZpcnN0KCkgewogICAgcmV0dXJuIHRoaXMuYXQoMCk7CiAgfQoKICBhdChwb3MpIHsKICAgIGlmKHBvcyA8IDApIHBvcyArPSB0aGlzLmxlbmd0aDsKICAgIHJldHVybiB0aGlzW3Bvc107CiAgfQoKICBjb2xsYXBzZSgpIHsKICAgIGxldCByZXQgPSBuZXcgVHJhbnNmb3JtYXRpb25MaXN0KCk7CgogICAgZm9yKGxldCBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHsKICAgICAgbGV0IGl0ZW0gPSB0aGlzW2ldOwogICAgICBpZihpICsgMSA8IHRoaXMubGVuZ3RoICYmIHRoaXNbaSArIDFdLnR5cGUgPT0gdGhpc1tpXS50eXBlKSB7CiAgICAgICAgaXRlbSA9IGl0ZW0uYWNjdW11bGF0ZSh0aGlzW2kgKyAxXSk7CiAgICAgICAgaSsrOwogICAgICB9IGVsc2UgewogICAgICAgIGl0ZW0gPSBpdGVtLmNsb25lKCk7CiAgICAgIH0KICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guY2FsbChyZXQsIGl0ZW0pOwogICAgfQogICAgcmV0dXJuIHJldDsKICB9CgogIGNvbGxhcHNlQWxsKCkgewogICAgcmV0dXJuIFRyYW5zZm9ybWF0aW9uTGlzdC5mcm9tTWF0cml4KHRoaXMudG9NYXRyaXgoKSk7CiAgfQoKICBnZXQgYW5nbGUoKSB7CiAgICBsZXQgbWF0cml4ID0gdGhpcy50b01hdHJpeCgpOwogICAgbGV0IHQgPSBtYXRyaXguZGVjb21wb3NlKCk7CiAgICBsZXQgeyByb3RhdGUgfSA9IHQ7CiAgICAvL2NvbnNvbGUubG9nKCdST1RBVElPTjonLCByb3RhdGUpOwogICAgcmV0dXJuIHJvdGF0ZTsKICB9CgogIGludmVydCgpIHsKICAgIC8vcmV0dXJuIHRoaXMucmVkdWNlKChhY2MsIHQpID0+IFt0LmludmVydCgpLCAuLi5hY2NdLCBbXSk7CiAgICByZXR1cm4gbmV3IFRyYW5zZm9ybWF0aW9uTGlzdCh0aGlzLnJlZHVjZVJpZ2h0KChhY2MsIHQpID0+IFsuLi5hY2MsIHQuaW52ZXJ0KCldLCBbXSkpOwogIH0KCiAgam9pbihzZXAgPSAnICcpIHsKICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuam9pbi5jYWxsKHRoaXMsIHNlcCk7CiAgfQoKICBjbGVhcigpIHsKICAgIEFycmF5LnByb3RvdHlwZS5zcGxpY2UuY2FsbCh0aGlzLCAwLCB0aGlzLmxlbmd0aCk7CiAgICByZXR1cm4gdGhpczsKICB9CgogIGFwcGx5KG9iaiwgcm91bmQgPSB0cnVlKSB7CiAgICBpZih0eXBlb2Ygb2JqLnRyYW5zZm9ybSA9PSAnZnVuY3Rpb24nKSB7CiAgICAgIGNvbnN0IG1hdHJpeCA9IHRoaXMudG9NYXRyaXgoKTsKICAgICAgcmV0dXJuIG9iai50cmFuc2Zvcm0obWF0cml4LCByb3VuZCk7CiAgICB9CiAgfQp9Ck9iamVjdC5kZWZpbmVQcm9wZXJ0eShUcmFuc2Zvcm1hdGlvbkxpc3QucHJvdG90eXBlLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsKICB2YWx1ZTogJ1RyYW5zZm9ybWF0aW9uTGlzdCcsCiAgZW51bWVyYWJsZTogZmFsc2UKfSk7Cgpjb25zdCB7IGNvbmNhdCwgY29weVdpdGhpbiwgZmluZCwgZmluZEluZGV4LCBsYXN0SW5kZXhPZiwgcG9wLCBwdXNoLCBzaGlmdCwgdW5zaGlmdCwgc2xpY2UsIHNwbGljZSwgaW5jbHVkZXMsIGluZGV4T2YsIGVudHJpZXMsIGZpbHRlciwgbWFwLCBldmVyeSwgc29tZSwgcmVkdWNlLCByZWR1Y2VSaWdodCB9ID0gQXJyYXkucHJvdG90eXBlOwoKZGVmaW5lKAogIFRyYW5zZm9ybWF0aW9uTGlzdC5wcm90b3R5cGUsCiAgewogICAgY29weVdpdGhpbiwKICAgIGZpbmQsCiAgICBmaW5kSW5kZXgsCiAgICBsYXN0SW5kZXhPZiwKICAgIHBvcCwKICAgIHNoaWZ0LAogICAgaW5jbHVkZXMsCiAgICBpbmRleE9mLAogICAgZW50cmllcywKICAgIGV2ZXJ5LAogICAgc29tZSwKICAgIHJlZHVjZSwKICAgIHJlZHVjZVJpZ2h0CiAgfSwKICB7CiAgICBbU3ltYm9sLml0ZXJhdG9yXSgpIHsKICAgICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZVtTeW1ib2wuaXRlcmF0b3JdLmNhbGwodGhpcyk7CiAgICB9LAogICAgW1N5bWJvbC5pc0NvbmNhdFNwcmVhZGFibGVdKCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9Cik7CgovL09iamVjdC5zZXRQcm90b3R5cGVPZihUcmFuc2Zvcm1hdGlvbkxpc3QucHJvdG90eXBlLCBUcmFuc2Zvcm1hdGlvbi5wcm90b3R5cGUpOwoKZXhwb3J0IGNvbnN0IEltbXV0YWJsZVRyYW5zZm9ybWF0aW9uTGlzdCA9IGltbXV0YWJsZUNsYXNzKFRyYW5zZm9ybWF0aW9uTGlzdCk7CgpJbW11dGFibGVUcmFuc2Zvcm1hdGlvbkxpc3QucHJvdG90eXBlLnJvdGF0ZSA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHsKICByZXR1cm4gdGhpcy5jb25jYXQoW25ldyBJbW11dGFibGVSb3RhdGlvbiguLi5hcmdzKV0pOwp9OwoKSW1tdXRhYmxlVHJhbnNmb3JtYXRpb25MaXN0LnByb3RvdHlwZS50cmFuc2xhdGUgPSBmdW5jdGlvbiguLi5hcmdzKSB7CiAgcmV0dXJuIHRoaXMuY29uY2F0KFtuZXcgSW1tdXRhYmxlVHJhbnNsYXRpb24oLi4uYXJncyldKTsKfTsKCkltbXV0YWJsZVRyYW5zZm9ybWF0aW9uTGlzdC5wcm90b3R5cGUuc2NhbGUgPSBmdW5jdGlvbiguLi5hcmdzKSB7CiAgcmV0dXJuIHRoaXMuY29uY2F0KFtuZXcgSW1tdXRhYmxlU2NhbGluZyguLi5hcmdzKV0pOwp9OwoKZGVmaW5lR2V0dGVyKEltbXV0YWJsZVRyYW5zZm9ybWF0aW9uTGlzdCwgU3ltYm9sLnNwZWNpZXMsICgpID0+IEltbXV0YWJsZVRyYW5zZm9ybWF0aW9uTGlzdCk7CgAAAAAAAAAA01QAAAAAAAAAAAAAAAAAAAAAAADTVAAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABIFgAAAAAAAEgWAAAAAAAAAAAAAAAA8L8"
				],
				[
					11,
					4,
					"right_delete",
					null,
					"BAAAAHEiAAAAAAAAcSIAAAAAAAABAAAAU3EiAAAAAAAAcSIAAAAAAAABAAAAZXEiAAAAAAAAcSIAAAAAAAABAAAAbHEiAAAAAAAAcSIAAAAAAAABAAAAZg",
					"AQAAAAAAAAABAAAAcSIAAAAAAABxIgAAAAAAAAAAAAAAAPC/"
				],
				[
					37,
					1,
					"insert",
					{
						"characters": "matrix="
					},
					"BwAAAM0VAAAAAAAAzhUAAAAAAAAAAAAAzhUAAAAAAADPFQAAAAAAAAAAAADPFQAAAAAAANAVAAAAAAAAAAAAANAVAAAAAAAA0RUAAAAAAAAAAAAA0RUAAAAAAADSFQAAAAAAAAAAAADSFQAAAAAAANMVAAAAAAAAAAAAANMVAAAAAAAA1BUAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAzRUAAAAAAADNFQAAAAAAAAAAAAAAAPC/"
				],
				[
					40,
					4,
					"right_delete",
					null,
					"BAAAAOQVAAAAAAAA5BUAAAAAAAABAAAAU+QVAAAAAAAA5BUAAAAAAAABAAAAZeQVAAAAAAAA5BUAAAAAAAABAAAAbOQVAAAAAAAA5BUAAAAAAAABAAAAZg",
					"AQAAAAAAAAABAAAA5BUAAAAAAADkFQAAAAAAAAAAAAAAAPC/"
				],
				[
					46,
					1,
					"insert",
					{
						"characters": "matrix="
					},
					"BwAAAEcWAAAAAAAASBYAAAAAAAAAAAAASBYAAAAAAABJFgAAAAAAAAAAAABJFgAAAAAAAEoWAAAAAAAAAAAAAEoWAAAAAAAASxYAAAAAAAAAAAAASxYAAAAAAABMFgAAAAAAAAAAAABMFgAAAAAAAE0WAAAAAAAAAAAAAE0WAAAAAAAAThYAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAARxYAAAAAAABHFgAAAAAAAAAAAAAAAPC/"
				],
				[
					48,
					4,
					"right_delete",
					null,
					"BAAAAF4WAAAAAAAAXhYAAAAAAAABAAAAU14WAAAAAAAAXhYAAAAAAAABAAAAZV4WAAAAAAAAXhYAAAAAAAABAAAAbF4WAAAAAAAAXhYAAAAAAAABAAAAZg",
					"AQAAAAAAAAABAAAAXhYAAAAAAABeFgAAAAAAAAAAAAAAAPC/"
				],
				[
					62,
					4,
					"right_delete",
					null,
					"BAAAAPUnAAAAAAAA9ScAAAAAAAABAAAAU/UnAAAAAAAA9ScAAAAAAAABAAAAZfUnAAAAAAAA9ScAAAAAAAABAAAAbPUnAAAAAAAA9ScAAAAAAAABAAAAZg",
					"AQAAAAAAAAABAAAA9ScAAAAAAAD1JwAAAAAAAAAAAAAAAPC/"
				],
				[
					71,
					1,
					"insert",
					{
						"characters": "Self"
					},
					"BAAAAPUnAAAAAAAA9icAAAAAAAAAAAAA9icAAAAAAAD3JwAAAAAAAAAAAAD3JwAAAAAAAPgnAAAAAAAAAAAAAPgnAAAAAAAA+ScAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAA9ScAAAAAAAD1JwAAAAAAAAAAAAAAAPC/"
				],
				[
					78,
					1,
					"revert",
					null,
					"AgAAAAAAAAAAAAAAAAAAAAAAAADVVAAAaW1wb3J0IHsgTWF0cml4LCBpc01hdHJpeCB9IGZyb20gJy4uL2dlb20vbWF0cml4LmpzJzsKaW1wb3J0IHsgUG9pbnQgfSBmcm9tICcuLi9nZW9tL3BvaW50LmpzJzsKaW1wb3J0IHsgY2xhc3NOYW1lLCBkZWZpbmUsIGRlZmluZUdldHRlciwgZnVuY3Rpb25OYW1lLCBpbW11dGFibGVDbGFzcywgaXNPYmplY3QgfSBmcm9tICcuLi9taXNjLmpzJzsKCmNvbnN0IFJBRDJERUcgPSAxODAgLyBNYXRoLlBJOwpjb25zdCBERUcyUkFEID0gTWF0aC5QSSAvIDE4MDsKCmV4cG9ydCBjbGFzcyBUcmFuc2Zvcm1hdGlvbiB7CiAgLy90eXBlTmFtZSA9IG51bGw7CgogIGNvbnN0cnVjdG9yKHRyYW5zZm9ybWF0aW9uKSB7CiAgICBpZih0cmFuc2Zvcm1hdGlvbiBpbnN0YW5jZW9mIFRyYW5zZm9ybWF0aW9uKSByZXR1cm4gdHJhbnNmb3JtYXRpb247CiAgICBpZih0cmFuc2Zvcm1hdGlvbiBpbnN0YW5jZW9mIFRyYW5zZm9ybWF0aW9uTGlzdCkgcmV0dXJuIHRyYW5zZm9ybWF0aW9uOwoKICAgIGlmKHR5cGVvZiB0cmFuc2Zvcm1hdGlvbiA9PSAnc3RyaW5nJykgcmV0dXJuIFRyYW5zZm9ybWF0aW9uLmZyb21TdHJpbmcodHJhbnNmb3JtYXRpb24pOwogICAgLy9kZWZpbmUodGhpcywgeyB0eXBlTmFtZSB9KTsKICAgIC8vdGhpcy50eXBlID0gdHlwZTsKICAgIC8vCiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdUcmFuc2Zvcm1hdGlvbicpOwoKICAgIHJldHVybiB0aGlzOwogIH0KCiAgZ2V0IFtTeW1ib2wudG9TdHJpbmdUYWddKCkgewogICAgcmV0dXJuIGZ1bmN0aW9uTmFtZSh0aGlzLmNvbnN0cnVjdG9yKTsKICB9CgogIGdldCB0eXBlKCkgewogICAgbGV0IHR5cGUgPQogICAgICB0aGlzLnR5cGVOYW1lIHx8CiAgICAgIGNsYXNzTmFtZSh0aGlzKQogICAgICAgIC50b0xvd2VyQ2FzZSgpCiAgICAgICAgLnJlcGxhY2UoL3RyYW5zZm9ybShhdGlvbik/LywgJycpCiAgICAgICAgLnJlcGxhY2UoLyhpb258aW5nKSQvLCAnZScpOwogICAgcmV0dXJuIHR5cGU7CiAgfQoKICBnZXQgW1N5bWJvbC5pc0NvbmNhdFNwcmVhZGFibGVdKCkgewogICAgcmV0dXJuICgKICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9PT0gVHJhbnNmb3JtYXRpb25MaXN0IHx8CiAgICAgIE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKSA9PSBUcmFuc2Zvcm1hdGlvbkxpc3QucHJvdG90eXBlIHx8CiAgICAgIE9iamVjdC5nZXRQcm90b3R5cGVPZih0aGlzKS5jb25zdHJ1Y3RvciA9PSBUcmFuc2Zvcm1hdGlvbkxpc3QKICAgICk7CiAgfQogIGdldCBheGVzKCkgewogICAgcmV0dXJuIHRoaXMuYXhpcyAhPT0gdW5kZWZpbmVkID8gW3RoaXMuYXhpc10gOiBbJ3gnLCAneScsICd6J10uZmlsdGVyKGF4aXMgPT4gYXhpcyBpbiB0aGlzKTsKICB9CiAgZ2V0IHByb3BzKCkgewogICAgcmV0dXJuIHRoaXMuYXhlcy5jb25jYXQoWydheGlzJywgJ2FuZ2xlJ10uZmlsdGVyKGtleSA9PiBrZXkgaW4gdGhpcykpOwogIH0KCiAgaGFzKGF4aXMpIHsKICAgIGlmKHRoaXMuYXhpcyAhPT0gdW5kZWZpbmVkKSByZXR1cm4gYXhpcyA9PT0gdGhpcy5heGlzOwogICAgcmV0dXJuIGF4aXMgaW4gdGhpczsKICB9CgogIGdldCBpczNEKCkgewogICAgcmV0dXJuIHRoaXMuaGFzKCd6Jyk7CiAgfQoKICBlbnRyaWVzKCkgewogICAgcmV0dXJuIHRoaXMucHJvcHMubWFwKHByb3AgPT4gW3Byb3AsIHRoaXNbcHJvcF1dKTsKICB9CgogIHRvSlNPTigpIHsKICAgIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXModGhpcy5lbnRyaWVzKCkpOwogIH0KCiAgdmVjdG9yKHVuaXQpIHsKICAgIGlmKHVuaXQgPT09IHVuZGVmaW5lZCkgdW5pdCA9IHRoaXMudW5pdDsKICAgIHJldHVybiAodGhpcy5pczNEID8gWyd4JywgJ3knLCAneiddIDogWyd4JywgJ3knXSkubWFwKHVuaXQgPyBheGlzID0+IHRoaXNbYXhpc10gKyB1bml0IDogYXhpcyA9PiB0aGlzW2F4aXNdKTsKICB9CgogIHRvU3RyaW5nKHRVbml0KSB7CiAgICByZXR1cm4gYCR7dGhpcy50eXBlfSR7dGhpcy5pczNEID8gJzNkJyA6ICcnfSgke3RoaXMudmVjdG9yKHRVbml0KS5qb2luKCcsICcpfSlgOwogIH0KICBjbG9uZSgpIHsKICAgIGxldCBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnModGhpcyk7CiAgICBsZXQgcHJvcHMgPSB0aGlzLnByb3BzLnJlZHVjZSgoYWNjLCBwcm9wKSA9PiAoeyAuLi5hY2MsIFtwcm9wXTogZGVzY1twcm9wXSB9KSwge30pOwogICAgcmV0dXJuIE9iamVjdC5jcmVhdGUoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpLCBwcm9wcyk7CiAgfQoKICBzdGF0aWMgZnJvbVN0cmluZyhhcmcpIHsKICAgIGxldCBjbWRMZW4gPSBhcmcuaW5kZXhPZignKCcpOwogICAgbGV0IGFyZ1N0ciA9IGFyZy5zbGljZShjbWRMZW4gKyAxLCBhcmcuaW5kZXhPZignKScpKTsKICAgIGxldCBhcmdzID0gYXJnU3RyLnNwbGl0KC9bLFxzXCBdKy9nKTsKICAgIGxldCBjbWQgPSBhcmcuc3Vic3RyaW5nKDAsIGNtZExlbik7CiAgICBsZXQgdDsKICAgIGxldCB1bml0OwoKICAgIGFyZ3MgPSBhcmdzCiAgICAgIC5maWx0ZXIoYXJnID0+IC9eWy0rMC05Ll0rW2Etel0qJC8udGVzdChhcmcpKQogICAgICAubWFwKGFyZyA9PiB7CiAgICAgICAgaWYoL1thLXpdJC8udGVzdChhcmcpKSB7CiAgICAgICAgICB1bml0ID0gYXJnLnJlcGxhY2UoL1stKzAtOS5dKi9nLCAnJyk7CiAgICAgICAgICBhcmcgPSBhcmcucmVwbGFjZSgvW2Etel0qJC9nLCAnJyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gK2FyZzsKICAgICAgfSk7CiAgICAvL2NvbnNvbGUubG9nKCdmcm9tU3RyaW5nJywgeyBjbWQsIGFyZ3MgfSk7CgogICAgY29uc3QgaXMzRCA9IGNtZC50b0xvd2VyQ2FzZSgpLmVuZHNXaXRoKCczZCcpOwogICAgaWYoaXMzRCkgY21kID0gY21kLnNsaWNlKDAsIC0yKTsKCiAgICBpZihjbWQuc3RhcnRzV2l0aCgncm90YXQnKSkgewogICAgICBjb25zdCBheGlzID0gaXMzRCA/ICcnIDogY21kLnNsaWNlKDYpOwogICAgICBhcmdzID0gYXhpcyAhPSAnJyA/IFthcmdzWzBdLCBheGlzXSA6IGFyZ3M7CiAgICAgIHQgPSBuZXcgUm90YXRpb24oLi4uYXJncyk7CiAgICB9IGVsc2UgaWYoY21kLnN0YXJ0c1dpdGgoJ3RyYW5zbGF0JykpIHsKICAgICAgY29uc3QgYXhpcyA9IGlzM0QgPyAnJyA6IGNtZC5zbGljZSg5KTsKICAgICAgYXJncyA9IGF4aXMgIT0gJycgPyBbYXJnc1swXSwgYXhpc10gOiBhcmdzOwogICAgICB0ID0gbmV3IFRyYW5zbGF0aW9uKC4uLmFyZ3MpOwogICAgfSBlbHNlIGlmKGNtZC5zdGFydHNXaXRoKCdzY2FsJykpIHsKICAgICAgY29uc3QgYXhpcyA9IGlzM0QgPyAnJyA6IGNtZC5zbGljZSg1KTsKICAgICAgYXJncyA9IGF4aXMgIT0gJycgPyBbYXJnc1swXSwgYXhpc10gOiBhcmdzOwogICAgICB0ID0gbmV3IFNjYWxpbmcoLi4uYXJncyk7CiAgICB9IGVsc2UgaWYoY21kLnN0YXJ0c1dpdGgoJ21hdHJpeCcpKSB7CiAgICAgIGNvbnN0IFthLCBiLCBjLCBkLCBlLCBmXSA9IGFyZ3M7CiAgICAgIHQgPSBuZXcgTWF0cml4VHJhbnNmb3JtYXRpb24oYSwgYywgZSwgYiwgZCwgZik7CiAgICB9CiAgICBpZih1bml0KSB0LnVuaXQgPSB1bml0OwogICAgcmV0dXJuIHQ7CiAgfQoKICAvKltTeW1ib2wudG9TdHJpbmdUYWddKCkgewogICAgcmV0dXJuIHRoaXMudG9TdHJpbmcoKTsKICB9Ki8KCiAgW1N5bWJvbC50b1ByaW1pdGl2ZV0oaGludCkgewogICAgLy8gY29uc29sZS5sb2coImhpbnQ6IixoaW50KTsKICAgIGlmKGhpbnQgPT0gJ3N0cmluZycgfHwgaGludCA9PSAnZGVmYXVsdCcpIHJldHVybiB0aGlzLnRvU3RyaW5nKCk7CgogICAgcmV0dXJuIHRoaXMudG9TdHJpbmcoKSAhPSAnJzsKICB9CgogIHN0YXRpYyBnZXQgcm90YXRpb24oKSB7CiAgICByZXR1cm4gUm90YXRpb247CiAgfQogIHN0YXRpYyBnZXQgdHJhbnNsYXRpb24oKSB7CiAgICByZXR1cm4gVHJhbnNsYXRpb247CiAgfQogIHN0YXRpYyBnZXQgc2NhbGluZygpIHsKICAgIHJldHVybiBTY2FsaW5nOwogIH0KICBzdGF0aWMgZ2V0IG1hdHJpeCgpIHsKICAgIHJldHVybiBNYXRyaXhUcmFuc2Zvcm1hdGlvbjsKICB9Cn0KCi8vVHJhbnNmb3JtYXRpb24ucHJvdG90eXBlW1N5bWJvbC50b1N0cmluZ1RhZ109J1RyYW5zZm9ybWF0aW9uJzsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShUcmFuc2Zvcm1hdGlvbiwgU3ltYm9sLmhhc0luc3RhbmNlLCB7CiAgdmFsdWUoaW5zdCkgewogICAgcmV0dXJuIFtUcmFuc2Zvcm1hdGlvbiwgTWF0cml4VHJhbnNmb3JtYXRpb24sIFJvdGF0aW9uLCBUcmFuc2xhdGlvbiwgU2NhbGluZywgVHJhbnNmb3JtYXRpb25MaXN0XS5zb21lKAogICAgICBjdG9yID0+IE9iamVjdC5nZXRQcm90b3R5cGVPZihpbnN0KSA9PSBjdG9yLnByb3RvdHlwZQogICAgKTsKICB9Cn0pOwoKZXhwb3J0IGNvbnN0IEltbXV0YWJsZVRyYW5zZm9ybWF0aW9uID0gaW1tdXRhYmxlQ2xhc3MoVHJhbnNmb3JtYXRpb24pOwoKZXhwb3J0IGNsYXNzIFJvdGF0aW9uIGV4dGVuZHMgVHJhbnNmb3JtYXRpb24gewogIGFuZ2xlID0gMDsKICAvL2F4aXMgPSB1bmRlZmluZWQ7CgogIGNvbnN0cnVjdG9yKGFuZ2xlLCB4LCB5KSB7CiAgICBzdXBlcigncm90YXRlJyk7CgogICAgaWYodHlwZW9mIHggPT0gJ3N0cmluZycgJiYgWyd4JywgJ3knLCAneiddLmluZGV4T2YoeC50b0xvd2VyQ2FzZSgpKSAhPSAtMSkgewogICAgICB0aGlzLmF4aXMgPSB4LnRvTG93ZXJDYXNlKCk7CiAgICB9IGVsc2UgaWYoIWlzTmFOKCt4KSAmJiAhaXNOYU4oK3kpKSB7CiAgICAgIHRoaXMuY2VudGVyID0gWyt4LCAreV07CiAgICB9CiAgICAvL2Vsc2UgdGhpcy5heGlzID0gJ3onOwogICAgdGhpcy5hbmdsZSA9IGFuZ2xlOwogIH0KCiAgaW52ZXJ0KCkgewogICAgcmV0dXJuIG5ldyBSb3RhdGlvbigtdGhpcy5hbmdsZSwgdGhpcy5heGlzKTsKICB9CgogIGdldCB2YWx1ZXMoKSB7CiAgICByZXR1cm4geyBbdGhpcy5heGlzIHx8ICd6J106IHRoaXMuYW5nbGUgfTsKICB9CgogIGdldCBpczNEKCkgewogICAgcmV0dXJuIHRoaXMuYXhpcyA9PSAneic7CiAgfQoKICBpc1plcm8oKSB7CiAgICByZXR1cm4gdGhpcy5hbmdsZSA9PSAwOwogIH0KCiAgdG9TdHJpbmcoclVuaXQpIHsKICAgIHJVbml0ID0gclVuaXQgfHwgdGhpcy51bml0IHx8ICcnOwogICAgY29uc3QgYXhpcyA9IHRoaXMuYXhpcyAhPT0gdW5kZWZpbmVkID8gdGhpcy5heGlzLnRvVXBwZXJDYXNlKCkgOiAnJzsKICAgIGNvbnN0IGFuZ2xlID0gdGhpcy5jb25zdHJ1Y3Rvci5jb252ZXJ0QW5nbGUodGhpcy5hbmdsZSwgclVuaXQpOwogICAgcmV0dXJuIGByb3RhdGUke3RoaXMuaXMzRCA/IGF4aXMgOiAnJ30oJHthbmdsZX0ke3JVbml0fSR7CiAgICAgIHRoaXMuY2VudGVyID8gdGhpcy5jZW50ZXIubWFwKGNvb3JkID0+IGAsICR7Y29vcmR9YCkuam9pbignJykgOiAnJwogICAgfSlgOwogIH0KCiAgdG9Tb3VyY2UoKSB7CiAgICBsZXQgbyA9ICduZXcgJyArIGNsYXNzTmFtZSh0aGlzKSArICcoJyArIHRoaXMuYW5nbGUgKyAnKSc7CiAgICByZXR1cm4gbzsKICB9CgogIHRvTWF0cml4KG1hdHJpeCA9IE1hdHJpeC5pZGVudGl0eSgpKSB7CiAgICBjb25zdCB7IGNlbnRlciwgYW5nbGUgfSA9IHRoaXM7CiAgICBpZihjZW50ZXIpIG1hdHJpeD1tYXRyaXgudHJhbnNsYXRlKC4uLlsuLi5jZW50ZXJdLm1hcChjb29yZCA9PiAtY29vcmQpKTsKICAgIG1hdHJpeCA9IG1hdHJpeC5yb3RhdGUoREVHMlJBRCAqIGFuZ2xlKTsKICAgIGlmKGNlbnRlcikgbWF0cml4PW1hdHJpeC50cmFuc2xhdGUoLi4uY2VudGVyKTsKICAgIHJldHVybiBtYXRyaXgucm91bmQoKTsKICB9CgogIGFjY3VtdWxhdGUob3RoZXIpIHsKICAgIGlmKHRoaXMudHlwZSAhPT0gb3RoZXIudHlwZSAmJiB0aGlzLmF4aXMgIT09IG90aGVyLmF4aXMpCiAgICAgIHRocm93IG5ldyBFcnJvcihjbGFzc05hbWUodGhpcykgKyAnOiBhY2N1bXVsYXRlIG1pc21hdGNoJyk7CiAgICByZXR1cm4gbmV3IFJvdGF0aW9uKHRoaXMuYW5nbGUgKyBvdGhlci5hbmdsZSwgdGhpcy5heGlzKTsKICB9CgogIHN0YXRpYyBjb252ZXJ0QW5nbGUoYW5nbGUsIHVuaXQpIHsKICAgIHN3aXRjaCAodW5pdCkgewogICAgICBjYXNlICdkZWcnOgogICAgICAgIHJldHVybiBhbmdsZTsKICAgICAgY2FzZSAncmFkJzoKICAgICAgICByZXR1cm4gREVHMlJBRCAqIGFuZ2xlOwogICAgICBjYXNlICd0dXJuJzoKICAgICAgICByZXR1cm4gYW5nbGUgLyAzNjA7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuIGFuZ2xlOwogICAgfQogIH0KfQoKT2JqZWN0LmRlZmluZVByb3BlcnR5KFJvdGF0aW9uLnByb3RvdHlwZSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnUm90YXRpb24nLCBlbnVtZXJhYmxlOiBmYWxzZSB9KTsKCmV4cG9ydCBjb25zdCBJbW11dGFibGVSb3RhdGlvbiA9IGltbXV0YWJsZUNsYXNzKFJvdGF0aW9uKTsKCmV4cG9ydCBjbGFzcyBUcmFuc2xhdGlvbiBleHRlbmRzIFRyYW5zZm9ybWF0aW9uIHsKICB4ID0gMDsKICB5ID0gMDsKICAvL3ogPSB1bmRlZmluZWQ7CgogIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHsKICAgIHN1cGVyKCd0cmFuc2xhdGUnKTsKCiAgICBpZih0eXBlb2YgYXJnc1sxXSA9PSAnc3RyaW5nJyAmJiBbJ3gnLCAneScsICd6J10uaW5kZXhPZihhcmdzWzFdLnRvTG93ZXJDYXNlKCkpICE9IC0xKSB7CiAgICAgIGNvbnN0IG4gPSBhcmdzLnNoaWZ0KCk7CiAgICAgIGNvbnN0IGF4aXMgPSBhcmdzLnNoaWZ0KCkudG9Mb3dlckNhc2UoKTsKICAgICAgdGhpc1theGlzXSA9IG47CiAgICB9IGVsc2UgewogICAgICBsZXQgbnVtRGltID0gWy4uLmFyZ3MsICcuJ10uZmluZEluZGV4KGEgPT4gaXNOYU4oK2EpKTsKICAgICAgY29uc3QgW3ggPSAwLCB5ID0gMCwgel0gPSBhcmdzLnNwbGljZSgwLCBudW1EaW0pOwogICAgICB0aGlzLnggPSAreDsKICAgICAgdGhpcy55ID0gK3k7CiAgICAgIGlmKHogIT09IHVuZGVmaW5lZCkgdGhpcy56ID0gK3o7CiAgICB9CiAgICBpZihhcmdzLmxlbmd0aCA+IDAgJiYgdHlwZW9mIGFyZ3NbMF0gPT0gJ3N0cmluZycpIHRoaXMudW5pdCA9IGFyZ3Muc2hpZnQoKTsKICB9CgogIGdldCB2YWx1ZXMoKSB7CiAgICBjb25zdCB7IHgsIHksIHogfSA9IHRoaXM7CiAgICByZXR1cm4gJ3onIGluIHRoaXMgPyB7IHgsIHksIHogfSA6IHsgeCwgeSB9OwogIH0KCiAgaXNaZXJvKCkgewogICAgY29uc3QgeyB4LCB5LCB6IH0gPSB0aGlzOwogICAgcmV0dXJuICd6JyBpbiB0aGlzID8geCA9PSAwICYmIHkgPT0gMCAmJiB6ID09IDAgOiB4ID09IDAgJiYgeSA9PSAwOwogIH0KCiAgdG9NYXRyaXgobWF0cml4ID0gTWF0cml4LmlkZW50aXR5KCkpIHsKICAgIGNvbnN0IHsgeCwgeSB9ID0gdGhpczsKICAgIHJldHVybiBtYXRyaXgudHJhbnNsYXRlKHgsIHkpOwogIH0KCiAgLypjbG9uZSgpIHsKICAgIGNvbnN0IHsgeCwgeSwgeiB9ID0gdGhpczsKICAgIHJldHVybiB6ICE9PSB1bmRlZmluZWQgPyBuZXcgVHJhbnNsYXRpb24oeCwgeSwgeikgOiBuZXcgVHJhbnNsYXRpb24oeCwgeSk7CiAgfSovCgogIGludmVydCgpIHsKICAgIGNvbnN0IHsgeCwgeSwgeiB9ID0gdGhpczsKICAgIHJldHVybiB6ICE9PSB1bmRlZmluZWQKICAgICAgPyBuZXcgVHJhbnNsYXRpb24oLXgsIC15LCAteikKICAgICAgOiBuZXcgVHJhbnNsYXRpb24oTWF0aC5hYnMoeCkgPT0gMCA/IDAgOiAteCwgTWF0aC5hYnMoeSkgPT0gMCA/IDAgOiAteSk7CiAgfQoKICBhY2N1bXVsYXRlKG90aGVyKSB7CiAgICBpZih0aGlzLnR5cGUgIT09IG90aGVyLnR5cGUpIHRocm93IG5ldyBFcnJvcihjbGFzc05hbWUodGhpcykgKyAnOiBhY2N1bXVsYXRlIG1pc21hdGNoJyk7CgogICAgaWYodGhpcy5pczNEKSByZXR1cm4gbmV3IFRyYW5zbGF0aW9uKHRoaXMueCArIG90aGVyLngsIHRoaXMueSArIG90aGVyLnksIHRoaXMueiArIG90aGVyLnopOwogICAgcmV0dXJuIG5ldyBUcmFuc2xhdGlvbih0aGlzLnggKyBvdGhlci54LCB0aGlzLnkgKyBvdGhlci55KTsKICB9Cn0KT2JqZWN0LmRlZmluZVByb3BlcnR5KFRyYW5zbGF0aW9uLnByb3RvdHlwZSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnVHJhbnNsYXRpb24nLCBlbnVtZXJhYmxlOiBmYWxzZSB9KTsKCmV4cG9ydCBjb25zdCBJbW11dGFibGVUcmFuc2xhdGlvbiA9IGltbXV0YWJsZUNsYXNzKFRyYW5zbGF0aW9uKTsKCmV4cG9ydCBjbGFzcyBTY2FsaW5nIGV4dGVuZHMgVHJhbnNmb3JtYXRpb24gewogIHggPSAxOwogIHkgPSAxOwogIC8veiA9IHVuZGVmaW5lZDsKCiAgY29uc3RydWN0b3IoLi4uYXJncykgewogICAgc3VwZXIoJ3NjYWxlJyk7CgogICAgaWYodHlwZW9mIGFyZ3NbMV0gPT0gJ3N0cmluZycgJiYgWyd4JywgJ3knLCAneiddLmluZGV4T2YoYXJnc1sxXS50b0xvd2VyQ2FzZSgpKSAhPSAtMSkgewogICAgICBjb25zdCBuID0gYXJncy5zaGlmdCgpOwogICAgICBjb25zdCBheGlzID0gYXJncy5zaGlmdCgpLnRvTG93ZXJDYXNlKCk7CiAgICAgIHRoaXNbYXhpc10gPSBuOwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgW3ggPSAxLCB5LCB6XSA9IGFyZ3Muc3BsaWNlKDAsIDMpOwogICAgICB0aGlzLnggPSAreDsKICAgICAgdGhpcy55ID0geSA9PT0gdW5kZWZpbmVkID8gdGhpcy54IDogK3k7CiAgICAgIGlmKHogIT09IHVuZGVmaW5lZCkgdGhpcy56ID0gK3o7CiAgICB9CiAgfQoKICBnZXQgdmFsdWVzKCkgewogICAgY29uc3QgeyB4LCB5LCB6IH0gPSB0aGlzOwogICAgcmV0dXJuICd6JyBpbiB0aGlzID8geyB4LCB5LCB6IH0gOiB7IHgsIHkgfTsKICB9CgogIHRvTWF0cml4KG1hdHJpeCA9IE1hdHJpeC5pZGVudGl0eSgpKSB7CiAgICBjb25zdCB7IHgsIHkgfSA9IHRoaXM7CiAgICByZXR1cm4gbWF0cml4LnNjYWxlKHgsIHkpOwogIH0KCiAgaXNaZXJvKCkgewogICAgY29uc3QgeyB4LCB5LCB6IH0gPSB0aGlzOwogICAgcmV0dXJuICd6JyBpbiB0aGlzID8geCA9PSAxICYmIHkgPT0gMSAmJiB6ID09IDEgOiB4ID09IDEgJiYgeSA9PSAxOwogIH0KCiAgdG9TdHJpbmcoKSB7CiAgICBjb25zdCB2ZWN0b3IgPSB0aGlzLnZlY3RvcignJyk7CiAgICBjb25zdCBjb29yZHMgPSB2ZWN0b3Iuam9pbignLCAnKTsKCiAgICByZXR1cm4gYCR7dGhpcy50eXBlfSR7dGhpcy5pczNEID8gJzNkJyA6ICcnfSgke2Nvb3Jkc30pYDsKICB9CgogIC8qY2xvbmUoKSB7CiAgICBjb25zdCB7IHgsIHksIHogfSA9IHRoaXM7CiAgICByZXR1cm4geiAhPT0gdW5kZWZpbmVkID8gbmV3IFNjYWxpbmcoeCwgeSwgeikgOiBuZXcgU2NhbGluZyh4LCB5KTsKICB9Ki8KCiAgaW52ZXJ0KCkgewogICAgY29uc3QgeyB4LCB5LCB6IH0gPSB0aGlzOwogICAgcmV0dXJuIHogIT09IHVuZGVmaW5lZCA/IG5ldyBTY2FsaW5nKDEgLyB4LCAxIC8geSwgMSAvIHopIDogbmV3IFNjYWxpbmcoMSAvIHgsIDEgLyB5KTsKICB9CgogIGFjY3VtdWxhdGUob3RoZXIpIHsKICAgIGlmKHRoaXMudHlwZSAhPT0gb3RoZXIudHlwZSkgdGhyb3cgbmV3IEVycm9yKGNsYXNzTmFtZSh0aGlzKSArICc6IGFjY3VtdWxhdGUgbWlzbWF0Y2gnKTsKCiAgICBpZih0aGlzLmlzM0QpIHJldHVybiBuZXcgU2NhbGluZyh0aGlzLnggKiBvdGhlci54LCB0aGlzLnkgKiBvdGhlci55LCB0aGlzLnogKiBvdGhlci56KTsKICAgIHJldHVybiBuZXcgU2NhbGluZyh0aGlzLnggKiBvdGhlci54LCB0aGlzLnkgKiBvdGhlci55KTsKICB9Cn0KT2JqZWN0LmRlZmluZVByb3BlcnR5KFNjYWxpbmcucHJvdG90eXBlLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdTY2FsaW5nJywgZW51bWVyYWJsZTogZmFsc2UgfSk7CgpleHBvcnQgY29uc3QgSW1tdXRhYmxlU2NhbGluZyA9IGltbXV0YWJsZUNsYXNzKFNjYWxpbmcpOwoKZXhwb3J0IGNsYXNzIE1hdHJpeFRyYW5zZm9ybWF0aW9uIGV4dGVuZHMgVHJhbnNmb3JtYXRpb24gewogIG1hdHJpeCA9IE1hdHJpeC5JREVOVElUWTsKCiAgY29uc3RydWN0b3IoaW5pdCkgewogICAgc3VwZXIoJ21hdHJpeCcpOwoKICAgIGlmKGluaXQgaW5zdGFuY2VvZiBNYXRyaXgpIHRoaXMubWF0cml4ID0gaW5pdDsKICAgIGVsc2UgaWYoaXNNYXRyaXgoaW5pdCkpIHRoaXMubWF0cml4ID0gbmV3IE1hdHJpeChpbml0KTsKICAgIGVsc2UgdGhpcy5tYXRyaXggPSBuZXcgTWF0cml4KC4uLmFyZ3VtZW50cyk7CiAgfQoKICBnZXQgdmFsdWVzKCkgewogICAgcmV0dXJuIHRoaXMubWF0cml4LnZhbHVlcygpOwogIH0KCiAgdG9NYXRyaXgobWF0cml4ID0gTWF0cml4LmlkZW50aXR5KCkpIHsKICAgIHJldHVybiBtYXRyaXgubXVsdGlwbHlTZWxmKHRoaXMubWF0cml4KTsKICB9CgogIHRvU3RyaW5nKCkgewogICAgcmV0dXJuIHRoaXMubWF0cml4LnRvU3RyaW5nKCcnKTsKICB9CgogIGludmVydCgpIHsKICAgIHJldHVybiBuZXcgTWF0cml4VHJhbnNmb3JtYXRpb24odGhpcy5tYXRyaXguaW52ZXJ0KCkpOwogIH0KCiAgaXNaZXJvKCkgewogICAgcmV0dXJuIHRoaXMubWF0cml4LmlzSWRlbnRpdHkoKTsKICB9CgogIGFjY3VtdWxhdGUob3RoZXIpIHsKICAgIGlmKHRoaXMudHlwZSAhPT0gb3RoZXIudHlwZSkgdGhyb3cgbmV3IEVycm9yKGNsYXNzTmFtZSh0aGlzKSArICc6IGFjY3VtdWxhdGUgbWlzbWF0Y2gnKTsKCiAgICByZXR1cm4gbmV3IE1hdHJpeFRyYW5zZm9ybWF0aW9uKHRoaXMubWF0cml4Lm11bHRpcGx5KG90aGVyLm1hdHJpeCkpOwogIH0KfQpPYmplY3QuZGVmaW5lUHJvcGVydHkoTWF0cml4VHJhbnNmb3JtYXRpb24ucHJvdG90eXBlLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsKICB2YWx1ZTogJ01hdHJpeFRyYW5zZm9ybWF0aW9uJywKICBlbnVtZXJhYmxlOiBmYWxzZQp9KTsKCmV4cG9ydCBjb25zdCBJbW11dGFibGVNYXRyaXhUcmFuc2Zvcm1hdGlvbiA9IGltbXV0YWJsZUNsYXNzKE1hdHJpeFRyYW5zZm9ybWF0aW9uKTsKCmV4cG9ydCBjbGFzcyBUcmFuc2Zvcm1hdGlvbkxpc3QgZXh0ZW5kcyBBcnJheSB7CiAgY29uc3RydWN0b3IoaW5pdCwgdFVuaXQsIHJVbml0KSB7CiAgICBzdXBlcigpOwogICAgaWYoaXNPYmplY3QoaW5pdCkpIHsKICAgICAgaWYodFVuaXQgPT09IHVuZGVmaW5lZCkgdFVuaXQgPSBpbml0LnRyYW5zbGF0aW9uVW5pdCB8fCBpbml0LnRVbml0OwogICAgICBpZihyVW5pdCA9PSB1bmRlZmluZWQpIHJVbml0ID0gaW5pdC5yb3RhdGlvblVuaXQgfHwgaW5pdC5yVW5pdDsKICAgIH0KICAgIGlmKGluaXQpIHsKICAgICAgdGhpcy5pbml0aWFsaXplKGluaXQpOwogICAgfQogICAgaWYodHlwZW9mIHRVbml0ID09ICdzdHJpbmcnKSB0aGlzLnRyYW5zbGF0aW9uVW5pdCA9IHRVbml0OwogICAgaWYodHlwZW9mIHJVbml0ID09ICdzdHJpbmcnKSB0aGlzLnJvdGF0aW9uVW5pdCA9IHJVbml0OwoKICAgIHJldHVybiB0aGlzOwogIH0KCiAgaW5pdGlhbGl6ZShpbml0KSB7CiAgICBpZih0eXBlb2YgaW5pdCA9PSAnbnVtYmVyJykgd2hpbGUodGhpcy5sZW5ndGggPCBpbml0KSB0aGlzLnB1c2godW5kZWZpbmVkKTsKICAgIGVsc2UgaWYodHlwZW9mIGluaXQgPT0gJ3N0cmluZycpIFRyYW5zZm9ybWF0aW9uTGlzdC5wcm90b3R5cGUuZnJvbVN0cmluZy5jYWxsKHRoaXMsIGluaXQpOwogICAgZWxzZSBpZihpbml0IGluc3RhbmNlb2YgQXJyYXkpIFRyYW5zZm9ybWF0aW9uTGlzdC5wcm90b3R5cGUuZnJvbUFycmF5LmNhbGwodGhpcywgaW5pdCk7CiAgICBlbHNlIHRocm93IG5ldyBFcnJvcignTm8gc3VjaCBpbml0aWFsaXphdGlvbjogJyArIGluaXQpOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBnZXQgW1N5bWJvbC5pc0NvbmNhdFNwcmVhZGFibGVdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKgogIFtTeW1ib2wudG9TdHJpbmdUYWddKCkgewogICAgcmV0dXJuIHRoaXMudG9Tb3VyY2UoKTsKICB9Ki8KCiAgc3RhdGljIGdldCBbU3ltYm9sLnNwZWNpZXNdKCkgewogICAgcmV0dXJuIFRyYW5zZm9ybWF0aW9uTGlzdDsKICB9CgogIGdldCBbU3ltYm9sLnNwZWNpZXNdKCkgewogICAgcmV0dXJuIFRyYW5zZm9ybWF0aW9uTGlzdDsKICB9CgogIGZyb21TdHJpbmcoc3RyKSB7CiAgICBsZXQgbiwKICAgICAgYSA9IFtdOwoKICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpICs9IG4pIHsKICAgICAgbGV0IHMgPSBzdHIuc2xpY2UoaSk7CiAgICAgIG4gPSBzLmluZGV4T2YoJyknKSArIDE7CiAgICAgIGlmKG4gPT0gMCkgbiA9IHN0ci5sZW5ndGg7CiAgICAgIHMgPSBzLnNsaWNlKDAsIG4pLnRyaW0oKTsKICAgICAgaWYocyAhPSAnJykgYS5wdXNoKHMpOwogICAgfQogICAgcmV0dXJuIHRoaXMuZnJvbUFycmF5KGEpOwogIH0KCiAgZnJvbUFycmF5KGFycikgewogICAgZm9yKGxldCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCBhcmcgPSBhcnJbaV07CgogICAgICBpZihhcmcgaW5zdGFuY2VvZiBUcmFuc2Zvcm1hdGlvbikgdGhpcy5wdXNoKGFyZyk7CiAgICAgIGVsc2UgaWYodHlwZW9mIGFyZyA9PSAnc3RyaW5nJykgdGhpcy5wdXNoKFRyYW5zZm9ybWF0aW9uLmZyb21TdHJpbmcoYXJnKSk7CiAgICAgIGVsc2UgdGhyb3cgbmV3IEVycm9yKCdObyBzdWNoIHRyYW5zZm9ybWF0aW9uOiAnICsgYXJnKTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9CgogIGdldCB0cmFuc2xhdGlvblVuaXQoKSB7CiAgICByZXR1cm4gKGlzT2JqZWN0KHRoaXMudHJhbnNsYXRpb24pICYmIHRoaXMudHJhbnNsYXRpb24udW5pdCkgfHwgdGhpcy50VW5pdDsKICB9CiAgc2V0IHRyYW5zbGF0aW9uVW5pdCh2YWx1ZSkgewogICAgaWYoaXNPYmplY3QodGhpcy50cmFuc2xhdGlvbikpIHRoaXMudHJhbnNsYXRpb24udW5pdCA9IHZhbHVlOwogICAgZWxzZSB0aGlzLnRVbml0ID0gdmFsdWU7CiAgfQoKICBnZXQgcm90YXRpb25Vbml0KCkgewogICAgcmV0dXJuIChpc09iamVjdCh0aGlzLnJvdGF0aW9uKSAmJiB0aGlzLnJvdGF0aW9uLnVuaXQpIHx8IHRoaXMuclVuaXQ7CiAgfQogIHNldCByb3RhdGlvblVuaXQodmFsdWUpIHsKICAgIGlmKGlzT2JqZWN0KHRoaXMucm90YXRpb24pKSB0aGlzLnJvdGF0aW9uLnVuaXQgPSB2YWx1ZTsKICAgIGVsc2UgdGhpcy5yVW5pdCA9IHZhbHVlOwogIH0KICBzdGF0aWMgZnJvbVN0cmluZyhzdHIpIHsKICAgIHJldHVybiBuZXcgVHJhbnNmb3JtYXRpb25MaXN0KCkuZnJvbVN0cmluZyhzdHIpOwogIH0KCiAgc3RhdGljIGZyb21BcnJheShhcnIpIHsKICAgIHJldHVybiBuZXcgVHJhbnNmb3JtYXRpb25MaXN0KCkuZnJvbUFycmF5KGFycik7CiAgfQoKICBzdGF0aWMgZnJvbU1hdHJpeChtYXRyaXgpIHsKICAgIG1hdHJpeCA9IG1hdHJpeCBpbnN0YW5jZW9mIE1hdHJpeCA/IG1hdHJpeCA6IG5ldyBNYXRyaXgobWF0cml4KTsKCiAgICBjb25zdCB0cmFuc2Zvcm1hdGlvbnMgPSBNYXRyaXguZGVjb21wb3NlKG1hdHJpeCwgdHJ1ZSk7CgogICAgZGVmaW5lKHRyYW5zZm9ybWF0aW9ucy5zY2FsZSwgewogICAgICB0b0FycmF5KCkgewogICAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnldOwogICAgICB9CiAgICB9KTsKICAgIGRlZmluZSh0cmFuc2Zvcm1hdGlvbnMudHJhbnNsYXRlLCB7CiAgICAgIHRvQXJyYXkoKSB7CiAgICAgICAgcmV0dXJuIFt0aGlzLngsIHRoaXMueV07CiAgICAgIH0KICAgIH0pOwoKICAgIGxldCByZXQgPSBuZXcgVHJhbnNmb3JtYXRpb25MaXN0KCk7CgogICAgcmV0LnRyYW5zbGF0ZSguLi50cmFuc2Zvcm1hdGlvbnMudHJhbnNsYXRlLnRvQXJyYXkoKSk7CiAgICByZXQucm90YXRlKHRyYW5zZm9ybWF0aW9ucy5yb3RhdGUpOwogICAgcmV0LnNjYWxlKC4uLnRyYW5zZm9ybWF0aW9ucy5zY2FsZS50b0FycmF5KCkpOwoKICAgIHJldHVybiByZXQ7CiAgfQoKICBwdXNoKC4uLmFyZ3MpIHsKICAgIGZvcihsZXQgYXJnIG9mIGFyZ3MpIHsKICAgICAgaWYodHlwZW9mIGFyZyA9PSAnc3RyaW5nJykgYXJnID0gVHJhbnNmb3JtYXRpb24uZnJvbVN0cmluZyhhcmcpOwogICAgICBlbHNlIGlmKGlzTWF0cml4KGFyZykpIGFyZyA9IG5ldyBNYXRyaXhUcmFuc2Zvcm1hdGlvbihhcmcpOwoKICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guY2FsbCh0aGlzLCBhcmcpOwogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBjbG9uZSgpIHsKICAgIHJldHVybiB0aGlzLm1hcCh0ID0+IHQuY2xvbmUoKSk7IC8vIHRoaXMuc2xpY2UoKTsKICB9CgogIG1hcChmbikgewogICAgcmV0dXJuIHRoaXMuYmFzZUNhbGwoQXJyYXkucHJvdG90eXBlLm1hcCkoZm4pOwogIH0KCiAgc2xpY2UoLi4uYXJncykgewogICAgcmV0dXJuIHRoaXMuYmFzZUNhbGwoQXJyYXkucHJvdG90eXBlLnNsaWNlKSguLi5hcmdzKTsKICB9CgogIHNwbGljZSguLi5hcmdzKSB7CiAgICByZXR1cm4gdGhpcy5iYXNlQ2FsbChBcnJheS5wcm90b3R5cGUuc3BsaWNlKSguLi5hcmdzKTsKICB9CgogIGNvbmNhdCguLi5hcmdzKSB7CiAgICByZXR1cm4gdGhpcy5iYXNlQ2FsbChBcnJheS5wcm90b3R5cGUuY29uY2F0KSguLi5hcmdzKTsKICB9CgogIGZpbHRlcihwcmVkKSB7CiAgICByZXR1cm4gdGhpcy5iYXNlQ2FsbChBcnJheS5wcm90b3R5cGUuZmlsdGVyKShwcmVkKTsKICB9CgogIGJhc2VDYWxsKGMgPSBBcnJheS5wcm90b3R5cGUubWFwKSB7CiAgICByZXR1cm4gKC4uLmFyZ3MpID0+IHsKICAgICAgY29uc3QgeyB0VW5pdCwgclVuaXQgfSA9IHRoaXM7CiAgICAgIGxldCByID0gYy5jYWxsKHRoaXMsIC4uLmFyZ3MpOwogICAgICBpZih0VW5pdCkgci50VW5pdCA9IHRVbml0OwogICAgICBpZihyVW5pdCkgci5yVW5pdCA9IHJVbml0OwogICAgICByZXR1cm4gcjsKICAgIH07CiAgfQoKICB1bnNoaWZ0KC4uLmFyZ3MpIHsKICAgIGZvcihsZXQgYXJnIG9mIGFyZ3MucmV2ZXJzZSgpKSB7CiAgICAgIGlmKHR5cGVvZiBhcmcgPT0gJ3N0cmluZycpIGFyZyA9IFRyYW5zZm9ybWF0aW9uLmZyb21TdHJpbmcoYXJnKTsKICAgICAgQXJyYXkucHJvdG90eXBlLnVuc2hpZnQuY2FsbCh0aGlzLCBhcmcpOwogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfQoKICByb3RhdGUoLi4uYXJncykgewogICAgbGV0IHJvdGF0aW9uID0gbmV3IFJvdGF0aW9uKC4uLmFyZ3MpOwogICAgaWYoIXJvdGF0aW9uLmlzWmVybygpKSBBcnJheS5wcm90b3R5cGUucHVzaC5jYWxsKHRoaXMsIHJvdGF0aW9uKTsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgdHJhbnNsYXRlKHgsIHkpIHsKICAgIGxldCB0cmFucyA9IHRoaXMuZmlsdGVyKHQgPT4gIXQudHlwZS5zdGFydHNXaXRoKCd0cmFuc2xhdCcpKTsKICAgIGxldCB2ZWMgPSBuZXcgUG9pbnQoeCwgeSk7CgogICAgLy90cmFucy50b01hdHJpeCgpLnRyYW5zZm9ybVBvaW50KHZlYyk7CgogICAgdmVjID0gdmVjLnJvdW5kKDAuMDAwMDEsIDUpOwogICAgLy9jb25zb2xlLmxvZygiZnJvbToiLCBuZXcgUG9pbnQoeCx5KSwgIiB0bzoiLCB2ZWMpOwogICAgbGV0IHRyYW5zbGF0aW9uID0gbmV3IFRyYW5zbGF0aW9uKHZlYy54LCB2ZWMueSk7CgogICAgaWYoIXRyYW5zbGF0aW9uLmlzWmVybygpKQogICAgICAvKiAgICBpZihNYXRoLmFicyh2ZWMueCkgIT0gMCB8fCBNYXRoLmFicyh2ZWMueSkgIT0gMCkgKi8gQXJyYXkucHJvdG90eXBlLnB1c2guY2FsbCh0aGlzLCB0cmFuc2xhdGlvbik7CgogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBzY2FsZSguLi5hcmdzKSB7CiAgICBsZXQgc2NhbGluZyA9IG5ldyBTY2FsaW5nKC4uLmFyZ3MpOwogICAgaWYoIXNjYWxpbmcuaXNaZXJvKCkpIEFycmF5LnByb3RvdHlwZS5wdXNoLmNhbGwodGhpcywgc2NhbGluZyk7CiAgICByZXR1cm4gdGhpczsKICB9CgogIG1hdHJpeCguLi5hcmdzKSB7CiAgICBsZXQgbWF0cml4VHJhbnNmb3JtYXRpb24gPSBuZXcgTWF0cml4VHJhbnNmb3JtYXRpb24oLi4uYXJncyk7CiAgICBpZighbWF0cml4VHJhbnNmb3JtYXRpb24uaXNaZXJvKCkpIEFycmF5LnByb3RvdHlwZS5wdXNoLmNhbGwodGhpcywgbWF0cml4VHJhbnNmb3JtYXRpb24pOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICB0b1N0cmluZyh0VW5pdCwgclVuaXQpIHsKICAgIGlmKHRoaXMubGVuZ3RoID4gMCkgewogICAgICB0VW5pdCA9IHRVbml0IHx8IHRoaXMudHJhbnNsYXRpb25Vbml0OwogICAgICByVW5pdCA9IHJVbml0IHx8IHRoaXMucm90YXRpb25Vbml0OwogICAgICBsZXQgciA9IHRoaXMubWFwKAogICAgICAgIHQgPT4gdCAmJiB0LnR5cGUgJiYgdC50b1N0cmluZyh0LnR5cGUuc3RhcnRzV2l0aCgnc2NhbCcpID8gJycgOiB0LnR5cGUuc3RhcnRzV2l0aCgncm90YXQnKSA/IHJVbml0IDogdFVuaXQpCiAgICAgICkuam9pbignICcpOwogICAgICByZXR1cm4gcjsKICAgIH0KICAgIHJldHVybiAnJzsKICB9CgogIHRvRE9NKCkgewogICAgcmV0dXJuIHRoaXMudG9TdHJpbmcoJ3B4JywgJ2RlZycpOwogIH0KCiAgLyogIFtTeW1ib2wudG9TdHJpbmdUYWddKCkgewogICAgcmV0dXJuIHRoaXMudG9TdHJpbmcoKTsKICB9Ki8KCiAgdG9Tb3VyY2UoKSB7CiAgICBsZXQgcyA9ICduZXcgJyArIGNsYXNzTmFtZSh0aGlzKSArICcoWyc7CgogICAgcyArPSB0aGlzLm1hcCh0ID0+IHQudG9Tb3VyY2UoKSkuam9pbignLCAnKTsKICAgIHJldHVybiBzICsgJ10pJzsKICB9CgogIHRvTWF0cmljZXMoKSB7CiAgICByZXR1cm4gWy4uLnRoaXMubWFwKHQgPT4gdC50b01hdHJpeCgpKV07CiAgfQoKICB0b01hdHJpeCgpIHsKICAgIHJldHVybiBuZXcgTWF0cml4KCkubXVsdGlwbHkoLi4udGhpcy50b01hdHJpY2VzKCkpOwogIH0KCiAgdW5kbygpIHsKICAgIGxldCByZXQgPSBuZXcgVHJhbnNmb3JtYXRpb25MaXN0KCk7CgogICAgZm9yKGxldCBpID0gdGhpcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgQXJyYXkucHJvdG90eXBlLnB1c2guY2FsbChyZXQsIHRoaXNbaV0uaW52ZXJ0KCkpOwoKICAgIHJldHVybiByZXQ7CiAgfQoKICBtZXJnZSguLi5hcmdzKSB7CiAgICBmb3IobGV0IGFyZyBvZiBhcmdzKSB7CiAgICAgIGlmKHR5cGVvZiBhcmcgPT0gJ3N0cmluZycpIGFyZyA9IFRyYW5zZm9ybWF0aW9uTGlzdC5mcm9tU3RyaW5nKGFyZyk7CgogICAgICBUcmFuc2Zvcm1hdGlvbkxpc3QucHJvdG90eXBlLnB1c2guYXBwbHkodGhpcywgYXJnKTsKICAgIH0KICAgIHJldHVybiB0aGlzOwogIH0KCiAgZGVjb21wb3NlKGRlZ3JlZXMgPSB0cnVlLCB0cmFuc2Zvcm1hdGlvbkxpc3QgPSB0cnVlKSB7CiAgICBsZXQgbWF0cml4ID0gdGhpcy50b01hdHJpeCgpOwogICAgY29uc3QgeyB0cmFuc2xhdGUsIHJvdGF0ZSwgc2NhbGUgfSA9IG1hdHJpeC5kZWNvbXBvc2UoZGVncmVlcyk7CiAgICBsZXQgZGVjb21wb3NlZCA9IHsgdHJhbnNsYXRlLCByb3RhdGUsIHNjYWxlIH07CgogICAgaWYodHJhbnNmb3JtYXRpb25MaXN0KSB7CiAgICAgIGxldCByZXQgPSBuZXcgVHJhbnNmb3JtYXRpb25MaXN0KCk7CiAgICAgIHJldC50cmFuc2xhdGUodHJhbnNsYXRlLngsIHRyYW5zbGF0ZS55LCB0cmFuc2xhdGUueik7CiAgICAgIHJldC5yb3RhdGUocm90YXRlKTsKICAgICAgcmV0LnNjYWxlKHNjYWxlLngsIHNjYWxlLnksIHNjYWxlLnopOwogICAgICByZXR1cm4gcmV0OwogICAgfQoKICAgIGRlY29tcG9zZWQuc2NhbGUudG9BcnJheSA9IGRlY29tcG9zZWQudHJhbnNsYXRlLnRvQXJyYXkgPSBmdW5jdGlvbiB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55XTsKICAgIH07CiAgICByZXR1cm4gZGVjb21wb3NlZDsKICB9CgogIGZpbmRMYXN0SW5kZXgocHJlZGljYXRlKSB7CiAgICBmb3IobGV0IGkgPSB0aGlzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzW2ldOwogICAgICBpZihwcmVkaWNhdGUoeCkpIHJldHVybiBpOwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQoKICBmaW5kTGFzdChwcmVkaWNhdGUpIHsKICAgIGxldCBpbmRleCA9IHRoaXMuZmluZExhc3RJbmRleChwcmVkaWNhdGUpOwogICAgcmV0dXJuIHRoaXNbaW5kZXhdOwogIH0KCiAgZ2V0IHJvdGF0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuZmluZExhc3QoaXRlbSA9PiBpdGVtICYmIGl0ZW0udHlwZSAmJiBpdGVtLnR5cGUuc3RhcnRzV2l0aCgncm90YXQnKSk7CiAgfQogIHNldCByb3RhdGlvbih2YWx1ZSkgewogICAgbGV0IGluZGV4ID0gdGhpcy5maW5kTGFzdEluZGV4KGl0ZW0gPT4gaXRlbS50eXBlLnN0YXJ0c1dpdGgoJ3JvdGF0JykpOwogICAgdmFsdWUgPSB2YWx1ZSBpbnN0YW5jZW9mIFJvdGF0aW9uID8gdmFsdWUgOiBuZXcgUm90YXRpb24odmFsdWUpOwogICAgQXJyYXkucHJvdG90eXBlLnNwbGljZS5jYWxsKHRoaXMsIGluZGV4LCAxLCB2YWx1ZSk7CiAgfQoKICBnZXQgc2NhbGluZygpIHsKICAgIHJldHVybiB0aGlzLmZpbmRMYXN0KGl0ZW0gPT4gaXRlbSAmJiBpdGVtLnR5cGUgJiYgaXRlbS50eXBlLnN0YXJ0c1dpdGgoJ3NjYWwnKSk7CiAgfQogIHNldCBzY2FsaW5nKHZhbHVlKSB7CiAgICBsZXQgaW5kZXggPSB0aGlzLmZpbmRMYXN0SW5kZXgoaXRlbSA9PiBpdGVtLnR5cGUuc3RhcnRzV2l0aCgnc2NhbCcpKTsKICAgIHZhbHVlID0gdmFsdWUgaW5zdGFuY2VvZiBTY2FsaW5nID8gdmFsdWUgOiBuZXcgU2NhbGluZyh2YWx1ZSk7CiAgICBBcnJheS5wcm90b3R5cGUuc3BsaWNlLmNhbGwodGhpcywgaW5kZXgsIDEsIHZhbHVlKTsKICB9CgogIGdldCB0cmFuc2xhdGlvbigpIHsKICAgIHJldHVybiB0aGlzLmZpbmRMYXN0KGl0ZW0gPT4gaXRlbSAmJiBpdGVtLnR5cGUgJiYgdHlwZW9mIGl0ZW0udHlwZSA9PSAnc3RyaW5nJyAmJiBpdGVtLnR5cGUuc3RhcnRzV2l0aCgndHJhbnNsYXQnKSk7CiAgfQoKICBzZXQgdHJhbnNsYXRpb24odmFsdWUpIHsKICAgIGxldCBpbmRleCA9IHRoaXMuZmluZExhc3RJbmRleChpdGVtID0+IGl0ZW0gJiYgaXRlbS50eXBlICYmIGl0ZW0udHlwZS5zdGFydHNXaXRoKCd0cmFuc2wnKSk7CiAgICB2YWx1ZSA9IHZhbHVlIGluc3RhbmNlb2YgVHJhbnNsYXRpb24gPyB2YWx1ZSA6IG5ldyBUcmFuc2xhdGlvbih2YWx1ZSk7CiAgICBBcnJheS5wcm90b3R5cGUuc3BsaWNlLmNhbGwodGhpcywgaW5kZXgsIDEsIHZhbHVlKTsKICB9CiAgLyogIG1hcCguLi5hcmdzKSB7CiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLm1hcC5hcHBseShBcnJheS5mcm9tKHRoaXMpLCBhcmdzKTsKICB9Ki8KCiAgZ2V0IGxhc3QoKSB7CiAgICByZXR1cm4gdGhpcy5hdCgtMSk7CiAgfQogIGdldCBmaXJzdCgpIHsKICAgIHJldHVybiB0aGlzLmF0KDApOwogIH0KCiAgYXQocG9zKSB7CiAgICBpZihwb3MgPCAwKSBwb3MgKz0gdGhpcy5sZW5ndGg7CiAgICByZXR1cm4gdGhpc1twb3NdOwogIH0KCiAgY29sbGFwc2UoKSB7CiAgICBsZXQgcmV0ID0gbmV3IFRyYW5zZm9ybWF0aW9uTGlzdCgpOwoKICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGxldCBpdGVtID0gdGhpc1tpXTsKICAgICAgaWYoaSArIDEgPCB0aGlzLmxlbmd0aCAmJiB0aGlzW2kgKyAxXS50eXBlID09IHRoaXNbaV0udHlwZSkgewogICAgICAgIGl0ZW0gPSBpdGVtLmFjY3VtdWxhdGUodGhpc1tpICsgMV0pOwogICAgICAgIGkrKzsKICAgICAgfSBlbHNlIHsKICAgICAgICBpdGVtID0gaXRlbS5jbG9uZSgpOwogICAgICB9CiAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmNhbGwocmV0LCBpdGVtKTsKICAgIH0KICAgIHJldHVybiByZXQ7CiAgfQoKICBjb2xsYXBzZUFsbCgpIHsKICAgIHJldHVybiBUcmFuc2Zvcm1hdGlvbkxpc3QuZnJvbU1hdHJpeCh0aGlzLnRvTWF0cml4KCkpOwogIH0KCiAgZ2V0IGFuZ2xlKCkgewogICAgbGV0IG1hdHJpeCA9IHRoaXMudG9NYXRyaXgoKTsKICAgIGxldCB0ID0gbWF0cml4LmRlY29tcG9zZSgpOwogICAgbGV0IHsgcm90YXRlIH0gPSB0OwogICAgLy9jb25zb2xlLmxvZygnUk9UQVRJT046Jywgcm90YXRlKTsKICAgIHJldHVybiByb3RhdGU7CiAgfQoKICBpbnZlcnQoKSB7CiAgICAvL3JldHVybiB0aGlzLnJlZHVjZSgoYWNjLCB0KSA9PiBbdC5pbnZlcnQoKSwgLi4uYWNjXSwgW10pOwogICAgcmV0dXJuIG5ldyBUcmFuc2Zvcm1hdGlvbkxpc3QodGhpcy5yZWR1Y2VSaWdodCgoYWNjLCB0KSA9PiBbLi4uYWNjLCB0LmludmVydCgpXSwgW10pKTsKICB9CgogIGpvaW4oc2VwID0gJyAnKSB7CiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLmpvaW4uY2FsbCh0aGlzLCBzZXApOwogIH0KCiAgY2xlYXIoKSB7CiAgICBBcnJheS5wcm90b3R5cGUuc3BsaWNlLmNhbGwodGhpcywgMCwgdGhpcy5sZW5ndGgpOwogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBhcHBseShvYmosIHJvdW5kID0gdHJ1ZSkgewogICAgaWYodHlwZW9mIG9iai50cmFuc2Zvcm0gPT0gJ2Z1bmN0aW9uJykgewogICAgICBjb25zdCBtYXRyaXggPSB0aGlzLnRvTWF0cml4KCk7CiAgICAgIHJldHVybiBvYmoudHJhbnNmb3JtKG1hdHJpeCwgcm91bmQpOwogICAgfQogIH0KfQpPYmplY3QuZGVmaW5lUHJvcGVydHkoVHJhbnNmb3JtYXRpb25MaXN0LnByb3RvdHlwZSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7CiAgdmFsdWU6ICdUcmFuc2Zvcm1hdGlvbkxpc3QnLAogIGVudW1lcmFibGU6IGZhbHNlCn0pOwoKY29uc3QgewogIGNvbmNhdCwKICBjb3B5V2l0aGluLAogIGZpbmQsCiAgZmluZEluZGV4LAogIGxhc3RJbmRleE9mLAogIHBvcCwKICBwdXNoLAogIHNoaWZ0LAogIHVuc2hpZnQsCiAgc2xpY2UsCiAgc3BsaWNlLAogIGluY2x1ZGVzLAogIGluZGV4T2YsCiAgZW50cmllcywKICBmaWx0ZXIsCiAgbWFwLAogIGV2ZXJ5LAogIHNvbWUsCiAgcmVkdWNlLAogIHJlZHVjZVJpZ2h0Cn0gPSBBcnJheS5wcm90b3R5cGU7CgpkZWZpbmUoCiAgVHJhbnNmb3JtYXRpb25MaXN0LnByb3RvdHlwZSwKICB7CiAgICBjb3B5V2l0aGluLAogICAgZmluZCwKICAgIGZpbmRJbmRleCwKICAgIGxhc3RJbmRleE9mLAogICAgcG9wLAogICAgc2hpZnQsCiAgICBpbmNsdWRlcywKICAgIGluZGV4T2YsCiAgICBlbnRyaWVzLAogICAgZXZlcnksCiAgICBzb21lLAogICAgcmVkdWNlLAogICAgcmVkdWNlUmlnaHQKICB9LAogIHsKICAgIFtTeW1ib2wuaXRlcmF0b3JdKCkgewogICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlW1N5bWJvbC5pdGVyYXRvcl0uY2FsbCh0aGlzKTsKICAgIH0sCiAgICBbU3ltYm9sLmlzQ29uY2F0U3ByZWFkYWJsZV0oKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0KKTsKCi8vT2JqZWN0LnNldFByb3RvdHlwZU9mKFRyYW5zZm9ybWF0aW9uTGlzdC5wcm90b3R5cGUsIFRyYW5zZm9ybWF0aW9uLnByb3RvdHlwZSk7CgpleHBvcnQgY29uc3QgSW1tdXRhYmxlVHJhbnNmb3JtYXRpb25MaXN0ID0gaW1tdXRhYmxlQ2xhc3MoVHJhbnNmb3JtYXRpb25MaXN0KTsKCkltbXV0YWJsZVRyYW5zZm9ybWF0aW9uTGlzdC5wcm90b3R5cGUucm90YXRlID0gZnVuY3Rpb24oLi4uYXJncykgewogIHJldHVybiB0aGlzLmNvbmNhdChbbmV3IEltbXV0YWJsZVJvdGF0aW9uKC4uLmFyZ3MpXSk7Cn07CgpJbW11dGFibGVUcmFuc2Zvcm1hdGlvbkxpc3QucHJvdG90eXBlLnRyYW5zbGF0ZSA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHsKICByZXR1cm4gdGhpcy5jb25jYXQoW25ldyBJbW11dGFibGVUcmFuc2xhdGlvbiguLi5hcmdzKV0pOwp9OwoKSW1tdXRhYmxlVHJhbnNmb3JtYXRpb25MaXN0LnByb3RvdHlwZS5zY2FsZSA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHsKICByZXR1cm4gdGhpcy5jb25jYXQoW25ldyBJbW11dGFibGVTY2FsaW5nKC4uLmFyZ3MpXSk7Cn07CgpkZWZpbmVHZXR0ZXIoSW1tdXRhYmxlVHJhbnNmb3JtYXRpb25MaXN0LCBTeW1ib2wuc3BlY2llcywgKCkgPT4gSW1tdXRhYmxlVHJhbnNmb3JtYXRpb25MaXN0KTsKAAAAAAAAAABXVAAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAA+ScAAAAAAAD5JwAAAAAAAAAAAAAAAPC/"
				]
			]
		},
		{
			"file": "lib/eagle/node.js",
			"settings":
			{
				"buffer_size": 16500,
				"encoding": "UTF-8",
				"line_ending": "Unix"
			},
			"undo_stack":
			[
				[
					13,
					1,
					"insert",
					{
						"characters": "\n"
					},
					"AgAAALUpAAAAAAAAtikAAAAAAAAAAAAAtikAAAAAAAC6KQAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAtSkAAAAAAAC1KQAAAAAAAAAAAAAAAPC/"
				],
				[
					31,
					1,
					"insert",
					{
						"characters": " this.constructor"
					},
					"EgAAAKcpAAAAAAAAqCkAAAAAAAAAAAAAtykAAAAAAAC3KQAAAAAAAAQAAAAgICAgqCkAAAAAAACpKQAAAAAAAAAAAACpKQAAAAAAAKopAAAAAAAAAAAAAKopAAAAAAAAqykAAAAAAAAAAAAAqykAAAAAAACsKQAAAAAAAAAAAACsKQAAAAAAAK0pAAAAAAAAAAAAAK0pAAAAAAAArikAAAAAAAAAAAAArikAAAAAAACvKQAAAAAAAAAAAACvKQAAAAAAALApAAAAAAAAAAAAALApAAAAAAAAsSkAAAAAAAAAAAAAsSkAAAAAAACyKQAAAAAAAAAAAACyKQAAAAAAALMpAAAAAAAAAAAAALMpAAAAAAAAtCkAAAAAAAAAAAAAtCkAAAAAAAC1KQAAAAAAAAAAAAC1KQAAAAAAALYpAAAAAAAAAAAAALYpAAAAAAAAtykAAAAAAAAAAAAAtykAAAAAAAC4KQAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAApykAAAAAAACnKQAAAAAAAAAAAAAAAPC/"
				],
				[
					32,
					1,
					"insert",
					{
						"characters": ";"
					},
					"AQAAALgpAAAAAAAAuSkAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAuCkAAAAAAAC4KQAAAAAAAAAAAAAAAPC/"
				],
				[
					33,
					1,
					"insert",
					{
						"characters": " //"
					},
					"AwAAALkpAAAAAAAAuikAAAAAAAAAAAAAuikAAAAAAAC7KQAAAAAAAAAAAAC7KQAAAAAAALwpAAAAAAAAAAAAAA",
					"AQAAAAAAAAABAAAAuSkAAAAAAAC5KQAAAAAAAAAAAAAAAPC/"
				]
			]
		},
		{
			"file": "lib/eagle/element.js",
			"settings":
			{
				"buffer_size": 33225,
				"line_ending": "Unix"
			},
			"undo_stack":
			[
			]
		},
		{
			"file": "lib/geom/matrix.js",
			"settings":
			{
				"buffer_size": 20683,
				"encoding": "UTF-8",
				"line_ending": "Unix"
			},
			"undo_stack":
			[
			]
		},
		{
			"file": "lib/eagle/components/text.js",
			"settings":
			{
				"buffer_size": 2589,
				"encoding": "UTF-8",
				"line_ending": "Unix"
			},
			"undo_stack":
			[
				[
					18,
					1,
					"insert",
					{
						"characters": "\n"
					},
					"AQAAAI4BAAAAAAAAjwEAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAACOAQAAAAAAAI4BAAAAAAAAAAAAAAAA8L8"
				],
				[
					42,
					2,
					"right_delete",
					null,
					"AgAAACAGAAAAAAAAIAYAAAAAAAAHAAAAY29uc29sZSAGAAAAAAAAIAYAAAAAAAABAAAALg",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAAgBgAAAAAAACcGAAAAAAAAAAAAAAAA8L8"
				],
				[
					43,
					1,
					"insert",
					{
						"characters": "\n"
					},
					"AgAAACAGAAAAAAAAIQYAAAAAAAAAAAAAIQYAAAAAAAAjBgAAAAAAAAAAAAA",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAAgBgAAAAAAACAGAAAAAAAAAAAAAAAA8L8"
				]
			]
		},
		{
			"file": "lib/eagle/renderUtils.js",
			"redo_stack":
			[
				[
					13,
					1,
					"insert",
					{
						"characters": "g1"
					},
					"AwAAAPoCAAAAAAAA+gIAAAAAAAABAAAAMfoCAAAAAAAA/QIAAAAAAAAAAAAA+QIAAAAAAAD5AgAAAAAAAAEAAABn",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAAD7AgAAAAAAAPsCAAAAAAAAAAAAAAAA8L8"
				]
			],
			"settings":
			{
				"buffer_size": 15996,
				"encoding": "UTF-8",
				"line_ending": "Unix"
			}
		},
		{
			"file": "lib/eagle/renderer.js",
			"settings":
			{
				"buffer_size": 893,
				"encoding": "UTF-8",
				"line_ending": "Unix"
			},
			"undo_stack":
			[
				[
					28,
					1,
					"insert",
					{
						"characters": " "
					},
					"AgAAAFcDAAAAAAAAWAMAAAAAAAAAAAAAWAMAAAAAAABYAwAAAAAAADsAAAAgIGNvbnNvbGUubG9nKCdERUJVRzonLCBERUJVRyk7CiAgY29uc29sZS5sb2coJ2xvZzonLCBsb2cpOw",
					"AgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPC/AAAAAAEAAABXAwAAAAAAAJIDAAAAAAAAAAAAAAAA8L8"
				]
			]
		},
		{
			"file": "lib/geom/size.js",
			"settings":
			{
				"buffer_size": 9300,
				"line_ending": "Unix"
			}
		}
	],
	"build_system": "",
	"build_system_choices":
	[
	],
	"build_varint": "",
	"command_palette":
	{
		"height": 0.0,
		"last_filter": "",
		"selected_items":
		[
			[
				"out",
				"Browse Mode: Outline (Right)"
			],
			[
				"outline",
				"Browse Mode: Outline (Right)"
			],
			[
				"prettier",
				"JsPrettier: Format Code"
			],
			[
				"pre",
				"Project: Edit Project"
			],
			[
				"prett",
				"JsPrettier: Format Code"
			],
			[
				"",
				"Auto indent"
			],
			[
				"list pack",
				"Package Control: List Packages"
			],
			[
				"install",
				"Package Control: Install Package"
			],
			[
				"edit ",
				"Color Scheme Editor: Edit current color scheme"
			],
			[
				"edit",
				"Color Scheme Editor: Edit current color scheme"
			],
			[
				"remove",
				"Package Control: Remove Package"
			],
			[
				"outli",
				"Browse Mode: Outline (Right)"
			],
			[
				"debugger",
				"Preferences: Debugger Settings"
			],
			[
				"add re",
				"Package Control: Add Repository"
			],
			[
				"scheme",
				"Color Scheme Editor: Edit current color scheme"
			],
			[
				"outlin",
				"Browse Mode: Outline (Right)"
			],
			[
				"INSTALL",
				"Package Control: Install Package"
			],
			[
				"disable",
				"Package Control: Disable Package"
			],
			[
				"Package Control: disable",
				"Package Control: Disable Package"
			],
			[
				"Package Control: ",
				"Package Control: Disable Package"
			],
			[
				"adap",
				"Debugger: Install Adapters"
			],
			[
				"install ada",
				"Debugger: Install Adapters"
			],
			[
				"adapter",
				"Debugger: Install Adapters"
			],
			[
				"debug",
				"Debugger: Install Adapters"
			],
			[
				"Package Control: remove",
				"Package Control: Remove Package"
			],
			[
				"debu",
				"Debugger: Install Adapters"
			],
			[
				"instal",
				"Package Control: Install Package"
			]
		],
		"width": 0.0
	},
	"console":
	{
		"height": 289.0,
		"history":
		[
		]
	},
	"distraction_free":
	{
		"menu_visible": true,
		"show_minimap": false,
		"show_open_files": false,
		"show_tabs": false,
		"side_bar_visible": false,
		"status_bar_visible": false
	},
	"expanded_folders":
	[
		"/home/roman/Projects/plot-cv",
		"/home/roman/Projects/plot-cv/imgui",
		"/home/roman/Projects/plot-cv/lib",
		"/home/roman/Projects/plot-cv/lib/dsp",
		"/home/roman/Projects/plot-cv/lib/eagle"
	],
	"file_history":
	[
		"/home/roman/Projects/plot-cv/quickjs-misc.c.ast.bjson",
		"/home/roman/Projects/plot-cv/resolve-imports.js",
		"/home/roman/Projects/plot-cv/lib/util.js",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/lib/dom.js",
		"/home/roman/Projects/plot-cv/lib/geom/bbox.js",
		"/home/roman/Projects/plot-cv/lib/geom/transformation.js",
		"/home/roman/Projects/plot-cv/lib/geom/matrix.js",
		"/home/roman/Projects/plot-cv/lib/geom/point.js",
		"/home/roman/Projects/plot-cv/package.json",
		"/home/roman/Projects/plot-cv/io-helpers.js",
		"/home/roman/Projects/plot-cv/lib/geom/pointList.js",
		"/home/roman/Projects/plot-cv/lib/misc.js",
		"/home/roman/.config/sublime-text/Packages/User/Themes/Luscious.tmTheme",
		"/home/roman/Projects/plot-cv/lib/dom/svg.js",
		"/home/roman/mnt/samsung-roman/Projects/an-tronics/Mind-Synchronizing-Generator-PinHdrPotX.svg",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/quickjs-lexer.c",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/include/location.h",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/resolve-imports.js",
		"/home/roman/Projects/plot-cv/svg-crop-pad.js",
		"/home/roman/Projects/plot-cv/40106-4069-Synth.cropped.svg",
		"/home/roman/mnt/samsung-roman/Projects/an-tronics/40106-4069-Synth.svg",
		"/home/roman/Projects/plot-cv/lib/eagle/element.js",
		"/home/roman/Projects/plot-cv/lib/svg/path.js",
		"/home/roman/Projects/plot-cv/lib/geom/size.js",
		"/home/roman/Projects/plot-cv/lib/eda/units.js",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/lib/css3-selectors.js",
		"/home/roman/mnt/samsung-roman/Projects/an-tronics/StyroCutter-556-heatsink-5V.svg",
		"/home/roman/Projects/plot-cv/plot-cv.sublime-project",
		"/home/roman/Projects/plot-cv/os-helpers.js",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/lib/util.js",
		"/home/roman/Projects/plot-cv/eagle-commands.js",
		"/home/roman/Projects/plot-cv/lib/eagle/document.js",
		"/home/roman/Projects/plot-cv/lib/geom/trbl.js",
		"/home/roman/Projects/plot-cv/lib/geom/line.js",
		"/home/roman/Projects/plot-cv/lib/geom/rect.js",
		"/home/roman/Projects/plot-cv/lib/dom.js",
		"/home/roman/Projects/plot-cv/lib/grammars/ebnf.ebnf",
		"/home/roman/Projects/plot-cv/cli-helpers.js",
		"/home/roman/Projects/plot-cv/eagle-shell.js",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/lib/repl.js",
		"/home/roman/Projects/plot-cv/CMakeLists.txt",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/src/lexer.c",
		"/home/roman/Projects/plot-cv/draw.js",
		"/home/roman/Projects/plot-cv/quickjs/quickjs.h",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/tests/test_lexer.js",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/src/utils.c",
		"/home/roman/Projects/plot-cv/quickjs/qjs-net/lib/jsutils.c",
		"/home/roman/Projects/plot-cv/draw.html",
		"/home/roman/Projects/plot-cv/debugger-client.js",
		"/home/roman/Projects/plot-cv/debugger-server.js",
		"/home/roman/Projects/plot-cv/lib/dom/element.js",
		"/home/roman/Projects/plot-cv/fire.js",
		"/home/roman/Projects/plot-cv/upload-server.js",
		"/home/roman/Projects/plot-cv/quickjs/quickjs-libc.c",
		"/home/roman/Projects/plot-cv/quickjs/quickjs.c",
		"/home/roman/Projects/plot-cv/quickjs/qjscalc.js",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/list-exports.js",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/src/buffer-utils.c",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/include/lexer.h",
		"/home/roman/Projects/plot-cv/lib/ecmascript.js",
		"/home/roman/Projects/plot-cv/getModuleProps.js",
		"/home/roman/Projects/plot-cv/test-operators.js",
		"/home/roman/Projects/plot-cv/data/test-websocket.functions.js",
		"/home/roman/Projects/plot-cv/test-nanovg.js",
		"/home/roman/Projects/plot-cv/lib/alea.js",
		"/home/roman/Projects/plot-cv/upload.js",
		"/usr/include/sqlite3.h",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/src/js-utils.c",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/quickjs-internal.h",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/src/qjsm.c",
		"/home/roman/Projects/plot-cv/test-sqlite3.js",
		"/home/roman/Projects/plot-cv/sqlite3.js",
		"/home/roman/Projects/plot-cv/ast-shell.js",
		"/home/roman/Projects/plot-cv/clang-ast.js",
		"/home/roman/Projects/mariadb-10.3-10.3.38/scripts/mysql_system_tables.sql",
		"/home/roman/Projects/plot-cv/test-bjson.js",
		"/home/roman/Projects/mariadb-10.3-10.3.38/scripts/fill_help_tables.sql",
		"/home/roman/Projects/plot-cv/quickjs/run-test262.c",
		"/home/roman/Projects/plot-cv/quickjs/qjs-net/build-libwebsockets.sh",
		"/home/roman/Projects/plot-cv/quickjs/qjs-net/build/build.ninja",
		"/home/roman/Projects/plot-cv/lib/fd-graph.js",
		"/home/roman/Projects/plot-cv/lib/eagle/components/textElement.js",
		"/home/roman/Projects/plot-cv/lib/eagle/components/symbol.js",
		"/home/roman/Projects/plot-cv/lib/eagle/components/pin.js",
		"/home/roman/Projects/plot-cv/555-PWM-Motor-Speed-Controller-alt-schematic.svg",
		"/home/roman/Projects/plot-cv/555-PWM-Motor-Speed-Controller-alt-board.svg",
		"/home/roman/Projects/an-tronics/eagle/555-PWM-Motor-Speed-Controller-alt.brd",
		"/home/roman/Projects/an-tronics/eagle/555-PWM-Motor-Speed-Controller-alt.sch",
		"/home/roman/Projects/plot-cv/lib/eagle/renderUtils.js",
		"/home/roman/Projects/plot-cv/lib/dsp/util.js",
		"/home/roman/Projects/plot-cv/Zeichnung.svg",
		"/home/roman/Projects/plot-cv/lib/eagle/svg/ZoomRedraw.svg",
		"/home/roman/Projects/plot-cv/lib/eagle/components/text.js",
		"/home/roman/Projects/plot-cv/lib/eagle/schematicRenderer.js",
		"/home/roman/Projects/plot-cv/lib/eagle/svgRenderer.js",
		"/home/roman/Projects/plot-cv/qjs-opencv/line.js",
		"/home/roman/Projects/plot-cv/lib/eagle/boardRenderer.js",
		"/home/roman/Projects/plot-cv/eagle2svg.js",
		"/home/roman/Projects/plot-cv/lib/eagle/project.js",
		"/home/roman/Projects/plot-cv/lib/eagle/nodeList.js",
		"/home/roman/Projects/plot-cv/lib/eagle/common.js",
		"/home/roman/Projects/plot-cv/lib/dom/preactComponent.js",
		"/home/roman/Projects/plot-cv/lib/eagle/node.js",
		"/home/roman/Projects/plot-cv/lib/eagle/ref.js",
		"/home/roman/Projects/plot-cv/lib/eagle/components/grid.js",
		"/home/roman/Projects/plot-cv/lib/eagle/elementProxy.js",
		"/home/roman/Projects/plot-cv/lib/eagle/components/smd.js",
		"/home/roman/Projects/plot-cv/lib/eagle/components/wirePath.js",
		"/home/roman/Projects/plot-cv/lib/eagle/components/wire.js",
		"/home/roman/Projects/plot-cv/lib/eagle/nodeMap.js",
		"/home/roman/Projects/plot-cv/lib/eagle/renderer.js",
		"/home/roman/Projects/plot-cv/lib/eagle/components/circle.js",
		"/home/roman/Projects/plot-cv/lib/eagle/components/pad.js",
		"/home/roman/Projects/plot-cv/lib/eagle/components/via.js",
		"/home/roman/Projects/plot-cv/lib/eagle/libraryRenderer.js",
		"/home/roman/Projects/plot-cv/lib/eagle/components.js",
		"/home/roman/Projects/plot-cv/quickjs/cmake/functions.cmake",
		"/home/roman/Projects/plot-cv/qjs-opencv/cmake/functions.cmake",
		"/home/roman/Projects/plot-cv/cmake/functions.cmake",
		"/home/roman/Projects/plot-cv/lib/container/spatial-hash.js",
		"/home/roman/Projects/plot-cv/lib/container/Hash-Multimap.js",
		"/home/roman/Projects/plot-cv/lib/container/componentMap.js",
		"/home/roman/Projects/plot-cv/lib/container/multikeymap.js",
		"/home/roman/Projects/plot-cv/lib/eagle/components/drawing.js",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/quickjs-misc.c",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/util-w-2.diff",
		"/home/roman/Projects/plot-cv/quickjs/qjs-modules/new.diff",
		"/home/roman/Projects/plot-cv/lib/eda/colorCoding.js"
	],
	"find":
	{
		"height": 38.0
	},
	"find_in_files":
	{
		"height": 142.0,
		"where_history":
		[
			"/home/roman/Projects/plot-cv,*.c,*.h,*.js",
			"/home/roman/Projects/plot-cv,*.js",
			"/home/roman/Projects/plot-cv,*.c,*.h,*.js",
			""
		]
	},
	"find_state":
	{
		"case_sensitive": true,
		"find_history":
		[
			"GetBounds",
			"precision",
			"getWidthHeight",
			"output-dir",
			"attributeLists",
			"translateSelf",
			"getprototypechain",
			"\"getPrototypeCha",
			"getPrototypeChain",
			"isObject",
			"ion isObject",
			"isObject",
			"getCallers",
			"getCalles",
			"Util\\.",
			"== last",
			"last",
			"Searching",
			"if\\(.*Util.getPlatform",
			"getPlatform",
			"Util.getPlatform\\(",
			"Util.getPlatform",
			"^js_error",
			"getPlatf",
			"Util.getPlat",
			"^js[^ ]*error",
			"^jsm_.*error",
			"_error",
			"'doc'",
			"reduce",
			"'args'",
			"'args",
			"DEBUG:",
			"Text.render.2",
			"Text.render",
			"renderer.palette",
			"'render'",
			"'render",
			"([Ss]tack|[Ee]rror)",
			"[Ss]tack",
			"[Ee]rror",
			"Saving to",
			"D",
			"setDebug\\(",
			"DEBUG =",
			"DEBUG",
			"log",
			"debugFlag",
			"Renderer",
			"Text.render",
			"toString =",
			"toString",
			"'mm'",
			"size.*unit",
			"debug",
			"clip-path",
			"AllPar",
			"clip-path",
			"xref",
			"clip-path",
			"clip3",
			"#clip3",
			"M 27\\.199933 474\\.158751 L 27\\.199933 486\\.086916 ",
			"M 27.199933 474.158751 L 27.199933 486.086916 ",
			"Positioned",
			"<clipPath",
			"clip.*path",
			"clip.*path\n",
			"clip.*path",
			"clip-path",
			"serialize",
			"FileWriter",
			"FileWriterw",
			"FileWriter",
			"open\\(",
			"written",
			"WriteFile",
			"\\, \\{mode\\:0o755\\}",
			"WriteFile",
			"verb",
			"WriteFile",
			"GetB",
			"ERROR",
			"GetPoints",
			"new Point",
			"pathToPoints",
			"GetPoints",
			"pathToPoints",
			"GetPoints",
			"map =",
			"filter =",
			"'z'",
			"filter =",
			"GetPoints",
			"roundTo",
			"round =",
			"at =",
			"deref =",
			"deref",
			"GetPoints",
			"GetTransformedPoints",
			"GetBounds",
			"pointsToAbsolute",
			"splitPath",
			"Element",
			"ELement",
			"parseValues",
			"parse",
			"parseS",
			"parseSVG",
			"parseSVGPath",
			"path293",
			"GetBounds",
			"GetPoints",
			"formMatrix",
			"ElementTransform",
			"AllTra",
			"AllTransforms",
			"GetTransform",
			"getTransformationMatrix",
			"AllTransforms",
			"Symbol.iterator",
			"'multiply'",
			"Matrix.multiply",
			"multiply'",
			"Util\\.",
			"Util.inherit",
			"Util\\.extend"
		],
		"highlight": true,
		"in_selection": false,
		"preserve_case": false,
		"regex": true,
		"replace_history":
		[
			"MakePoint",
			"",
			"define",
			"PointList\\.prototype",
			"};\\n\nPointList.",
			"}\\n\nfunction",
			"",
			"isObject",
			"roundTo",
			"define",
			"padding"
		],
		"reverse": false,
		"scrollbar_highlights": true,
		"show_context": true,
		"use_buffer2": true,
		"use_gitignore": true,
		"whole_word": false,
		"wrap": true
	},
	"groups":
	[
		{
			"sheets":
			[
			]
		},
		{
			"sheets":
			[
				{
					"buffer": 0,
					"file": "svg-crop-pad.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 15936,
						"regions":
						{
						},
						"selection":
						[
							[
								9189,
								9198
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 440,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680972776.15,
							"tabs_extra_last_activated_sheet_index": 0,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 4493.0,
						"zoom_level": 1.0
					},
					"stack_index": 1,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 1,
					"file": "lib/geom/bbox.js",
					"selected": true,
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 7020,
						"regions":
						{
						},
						"selection":
						[
							[
								3715,
								3719
							]
						],
						"settings":
						{
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 1420.0,
						"zoom_level": 1.0
					},
					"stack_index": 0,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 2,
					"file": "eagle2svg.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 2498,
						"regions":
						{
						},
						"selection":
						[
							[
								2395,
								2395
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 89,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680972947.11,
							"tabs_extra_last_activated_sheet_index": 1,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 714.0,
						"zoom_level": 1.0
					},
					"stack_index": 6,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 3,
					"file": "quickjs/qjs-modules/src/qjsm.c",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 46181,
						"regions":
						{
						},
						"selection":
						[
							[
								5227,
								5227
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 215,
							"syntax": "Packages/C Improved/C Improved.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680890674.74,
							"tabs_extra_last_activated_sheet_index": 2,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 2267.0,
						"zoom_level": 1.0
					},
					"stack_index": 17,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 4,
					"file": "lib/eagle/svgRenderer.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 11951,
						"regions":
						{
							"col_0000AAFF":
							{
								"flags": 16,
								"regions":
								[
									[
										11011,
										11018
									]
								],
								"scope": "col_0000AAFF"
							},
							"col_0000AAFF_icon":
							{
								"flags": 16,
								"icon": "Packages/User/Color Highlight.cache/col_0000AAFF_circle.png",
								"regions":
								[
									[
										10995,
										10995
									]
								],
								"scope": "col_gutter"
							},
							"col_4BA54BFF":
							{
								"flags": 16,
								"regions":
								[
									[
										11522,
										11529
									]
								],
								"scope": "col_4BA54BFF"
							},
							"col_4BA54BFF_icon":
							{
								"flags": 16,
								"icon": "Packages/User/Color Highlight.cache/col_4BA54BFF_circle.png",
								"regions":
								[
									[
										11498,
										11498
									]
								],
								"scope": "col_gutter"
							},
							"col_A5A5A5FF":
							{
								"flags": 16,
								"regions":
								[
									[
										5217,
										5233
									]
								],
								"scope": "col_A5A5A5FF"
							},
							"col_A5A5A5FF_icon":
							{
								"flags": 16,
								"icon": "Packages/User/Color Highlight.cache/col_A5A5A5FF_circle.png",
								"regions":
								[
									[
										5154,
										5154
									]
								],
								"scope": "col_gutter"
							},
							"col_FF00FFFF":
							{
								"flags": 16,
								"regions":
								[
									[
										7783,
										7787
									]
								],
								"scope": "col_FF00FFFF"
							},
							"col_FF00FFFF_icon":
							{
								"flags": 16,
								"icon": "Packages/User/Color Highlight.cache/col_FF00FFFF_circle.png",
								"regions":
								[
									[
										7764,
										7764
									]
								],
								"scope": "col_gutter"
							},
							"col_FF33FFFF":
							{
								"flags": 16,
								"regions":
								[
									[
										11566,
										11573
									]
								],
								"scope": "col_FF33FFFF"
							},
							"col_FF33FFFF_icon":
							{
								"flags": 16,
								"icon": "Packages/User/Color Highlight.cache/col_FF33FFFF_circle.png",
								"regions":
								[
									[
										11535,
										11535
									]
								],
								"scope": "col_gutter"
							},
							"col_FFFFFFFF":
							{
								"flags": 16,
								"regions":
								[
									[
										10948,
										10955
									]
								],
								"scope": "col_FFFFFFFF"
							},
							"col_FFFFFFFF_icon":
							{
								"flags": 16,
								"icon": "Packages/User/Color Highlight.cache/col_FFFFFFFF_circle.png",
								"regions":
								[
									[
										10923,
										10923
									]
								],
								"scope": "col_gutter"
							}
						},
						"selection":
						[
							[
								2360,
								2360
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 54,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680972952.23,
							"tabs_extra_last_activated_sheet_index": 3,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 293.0,
						"zoom_level": 1.0
					},
					"stack_index": 5,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 5,
					"file": "quickjs/qjs-modules/lib/util.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 63358,
						"regions":
						{
						},
						"selection":
						[
							[
								0,
								0
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 0,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680972954.08,
							"tabs_extra_last_activated_sheet_index": 4,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 32061.0,
						"zoom_level": 1.0
					},
					"stack_index": 4,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 6,
					"file": "quickjs/qjs-modules/quickjs-misc.c",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 73446,
						"regions":
						{
						},
						"selection":
						[
							[
								0,
								0
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 0,
							"syntax": "Packages/C Improved/C Improved.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680936590.27,
							"tabs_extra_last_activated_sheet_index": 5,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 8357.0,
						"zoom_level": 1.0
					},
					"stack_index": 11,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 7,
					"file": "quickjs/qjs-modules/resolve-imports.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 54817,
						"regions":
						{
						},
						"selection":
						[
							[
								0,
								0
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 1487,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680892453.82,
							"tabs_extra_last_activated_sheet_index": 5,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 20593.0,
						"zoom_level": 1.0
					},
					"stack_index": 13,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 8,
					"file": "lib/geom/graph.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 11141,
						"regions":
						{
						},
						"selection":
						[
							[
								1600,
								1600
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 56,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680974866.03,
							"tabs_extra_last_activated_sheet_index": 7,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"stack_index": 2,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 9,
					"file": "lib/json/path.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 18898,
						"regions":
						{
						},
						"selection":
						[
							[
								987,
								992
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 311,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680892721.8,
							"tabs_extra_last_activated_sheet_index": 7,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"stack_index": 12,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 10,
					"file": "quickjs/qjs-modules/lib/extendArray.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 4304,
						"regions":
						{
						},
						"selection":
						[
							[
								333,
								339
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 14,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680972955.7,
							"tabs_extra_last_activated_sheet_index": 9,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"stack_index": 3,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 11,
					"file": "lib/xml/parse.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 7066,
						"regions":
						{
						},
						"selection":
						[
							[
								7043,
								7043
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 273,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680891492.58,
							"tabs_extra_last_activated_sheet_index": 7,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 3079.0,
						"zoom_level": 1.0
					},
					"stack_index": 14,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 12,
					"file": "lib/json/util.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 2514,
						"regions":
						{
						},
						"selection":
						[
							[
								2511,
								2278
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 71,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680891020.74,
							"tabs_extra_last_activated_sheet_index": 7,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 461.0,
						"zoom_level": 1.0
					},
					"stack_index": 16,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 13,
					"file": "quickjs/qjs-modules/src/utils.c",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 93358,
						"regions":
						{
						},
						"selection":
						[
							[
								0,
								0
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 2467,
							"syntax": "Packages/C Improved/C Improved.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680891370.52,
							"tabs_extra_last_activated_sheet_index": 8,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 34131.0,
						"zoom_level": 1.0
					},
					"stack_index": 15,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 14,
					"file": "lib/geom/transformation.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 21591,
						"regions":
						{
						},
						"selection":
						[
							[
								10233,
								10233
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 379,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680936773.19,
							"tabs_extra_last_activated_sheet_index": 13,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 4927.0,
						"zoom_level": 1.0
					},
					"stack_index": 9,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 15,
					"file": "lib/eagle/node.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 16500,
						"regions":
						{
						},
						"selection":
						[
							[
								10684,
								10684
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 351,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680937112.11,
							"tabs_extra_last_activated_sheet_index": 14,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 4535.0,
						"zoom_level": 1.0
					},
					"stack_index": 7,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 16,
					"file": "lib/eagle/element.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 33225,
						"regions":
						{
						},
						"selection":
						[
							[
								30299,
								30865
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 863,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680936825.86,
							"tabs_extra_last_activated_sheet_index": 15,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 11801.0,
						"zoom_level": 1.0
					},
					"stack_index": 8,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 17,
					"file": "lib/geom/matrix.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 20683,
						"regions":
						{
						},
						"selection":
						[
							[
								4253,
								4253
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 150,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680936718.48,
							"tabs_extra_last_activated_sheet_index": 14,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 1735.0,
						"zoom_level": 1.0
					},
					"stack_index": 10,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 18,
					"file": "lib/eagle/components/text.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 2589,
						"regions":
						{
						},
						"selection":
						[
							[
								2422,
								2422
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 57,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680890271.68,
							"tabs_extra_last_activated_sheet_index": 7,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 83.0,
						"zoom_level": 1.0
					},
					"stack_index": 19,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 19,
					"file": "lib/eagle/renderUtils.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 15996,
						"regions":
						{
						},
						"selection":
						[
							[
								1474,
								1474
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 45,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680889686.37,
							"tabs_extra_last_activated_sheet_index": 5,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"stack_index": 20,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 20,
					"file": "lib/eagle/renderer.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 893,
						"regions":
						{
						},
						"selection":
						[
							[
								34,
								35
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 0,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680890270.93,
							"tabs_extra_last_activated_sheet_index": 9,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 0.0,
						"zoom_level": 1.0
					},
					"stack_index": 18,
					"stack_multiselect": false,
					"type": "text"
				},
				{
					"buffer": 21,
					"file": "lib/geom/size.js",
					"semi_transient": false,
					"settings":
					{
						"buffer_size": 9300,
						"regions":
						{
						},
						"selection":
						[
							[
								7062,
								7072
							]
						],
						"settings":
						{
							"auto_complete_triggers":
							[
								{
									"characters": "./",
									"selector": "text.html, text.xml"
								},
								{
									"rhs_empty": true,
									"selector": "punctuation.accessor"
								}
							],
							"function_name_status_row": 207,
							"syntax": "Packages/JavaScriptNext - ES6 Syntax/JavaScriptNext.tmLanguage",
							"tab_size": 2,
							"tabs_extra_last_activated": 1680889297.92,
							"tabs_extra_last_activated_sheet_index": 1,
							"translate_tabs_to_spaces": true
						},
						"translation.x": 0.0,
						"translation.y": 2519.0,
						"zoom_level": 1.0
					},
					"stack_index": 21,
					"stack_multiselect": false,
					"type": "text"
				}
			]
		}
	],
	"incremental_find":
	{
		"height": 23.0
	},
	"input":
	{
		"height": 42.0
	},
	"layout":
	{
		"cells":
		[
			[
				2,
				0,
				3,
				2
			],
			[
				0,
				0,
				2,
				2
			]
		],
		"cols":
		[
			0.0,
			0.2,
			0.8,
			1.0
		],
		"rows":
		[
			0.0,
			0.5,
			1.0
		]
	},
	"menu_visible": true,
	"output.find_results":
	{
		"height": 0.0
	},
	"pinned_build_system": "Run with qjsm",
	"project": "plot-cv.sublime-project",
	"replace":
	{
		"height": 42.0
	},
	"save_all_on_build": false,
	"select_file":
	{
		"height": 0.0,
		"last_filter": "",
		"selected_items":
		[
			[
				"bbox",
				"lib/geom/bbox.js"
			],
			[
				"svg-cr",
				"svg-crop-pad.js"
			],
			[
				"eagle2",
				"eagle2svg.js"
			],
			[
				"node.js",
				"lib/eagle/node.js"
			],
			[
				"matrix.js",
				"lib/geom/matrix.js"
			],
			[
				"transform",
				"lib/geom/transformation.js"
			],
			[
				"eagle2sv",
				"eagle2svg.js"
			],
			[
				"misc.c",
				"quickjs/qjs-modules/quickjs-misc.c"
			],
			[
				"quickjs-misc.c",
				"quickjs-misc.c.ast.bjson"
			],
			[
				"modules/lib/util.js",
				"quickjs/qjs-modules/lib/util.js"
			],
			[
				"json/path",
				"lib/json/path.js"
			],
			[
				"geom/grap",
				"lib/geom/graph.js"
			],
			[
				"extendArra",
				"quickjs/qjs-modules/lib/extendArray.js"
			],
			[
				"resolve-im",
				"quickjs/qjs-modules/resolve-imports.js"
			],
			[
				"xml/parse",
				"lib/xml/parse.js"
			],
			[
				"util.js",
				"lib/util.js"
			],
			[
				"utils.c",
				"quickjs/qjs-modules/src/utils.c"
			],
			[
				"json/util",
				"lib/json/util.js"
			],
			[
				"qjsm",
				"quickjs/qjs-modules/src/qjsm.c"
			],
			[
				"lib/util.js",
				"quickjs/qjs-modules/lib/util.js"
			],
			[
				"svgRen",
				"lib/eagle/svgRenderer.js"
			],
			[
				"eagle/ren",
				"lib/eagle/renderer.js"
			],
			[
				"text.js",
				"lib/eagle/components/text.js"
			],
			[
				"transforma",
				"lib/geom/transformation.js"
			],
			[
				"size.js",
				"lib/geom/size.js"
			],
			[
				"svg-cro",
				"svg-crop-pad.js"
			],
			[
				"-lexer",
				"quickjs/qjs-modules/quickjs-lexer.c"
			],
			[
				"location.h",
				"quickjs/qjs-modules/include/location.h"
			],
			[
				"res",
				"quickjs/qjs-modules/resolve-imports.js"
			],
			[
				"io-help",
				"io-helpers.js"
			],
			[
				"pointList",
				"lib/geom/pointList.js"
			],
			[
				"PointList",
				"lib/geom/pointList.js"
			],
			[
				"point.js",
				"lib/geom/point.js"
			],
			[
				"svg.js",
				"lib/dom/svg.js"
			],
			[
				"matrix",
				"lib/geom/matrix.js"
			],
			[
				"trans",
				"lib/geom/transformation.js"
			],
			[
				"misc",
				"lib/misc.js"
			],
			[
				"util",
				"lib/util.js"
			],
			[
				"misc.js",
				"lib/misc.js"
			],
			[
				"io-he",
				"io-helpers.js"
			],
			[
				"package.js",
				"package.json"
			],
			[
				"bbox.js",
				"lib/geom/bbox.js"
			],
			[
				"svg/path.js",
				"lib/svg/path.js"
			],
			[
				"units",
				"lib/eda/units.js"
			],
			[
				"rect.js",
				"lib/geom/rect.js"
			],
			[
				"lib/ut",
				"lib/util.js"
			],
			[
				"trbl",
				"lib/geom/trbl.js"
			],
			[
				"point",
				"lib/geom/point.js"
			],
			[
				"point.j",
				"lib/geom/point.js"
			],
			[
				"line.js",
				"lib/geom/line.js"
			],
			[
				"dom.js",
				"lib/dom.js"
			],
			[
				"bbox.j",
				"lib/geom/bbox.js"
			],
			[
				"repl.js",
				"quickjs/qjs-modules/lib/repl.js"
			],
			[
				"svg-crop",
				"svg-crop-pad.js"
			],
			[
				"cli-help",
				"cli-helpers.js"
			],
			[
				"project",
				"lib/eagle/project.js"
			],
			[
				"eagle-comm",
				"eagle-commands.js"
			],
			[
				"lib/util",
				"quickjs/qjs-modules/lib/util.js"
			],
			[
				"eagle-shell",
				"eagle-shell.js"
			],
			[
				"io-helper",
				"io-helpers.js"
			],
			[
				"os-helper",
				"os-helpers.js"
			],
			[
				"cmakelists",
				"CMakeLists.txt"
			],
			[
				"lexer.c",
				"quickjs/qjs-modules/src/lexer.c"
			],
			[
				"-lexer.c",
				"quickjs/qjs-modules/quickjs-lexer.c"
			],
			[
				"ecma",
				"lib/ecmascript.js"
			],
			[
				"lexer.c ",
				"quickjs/qjs-modules/src/lexer.c"
			],
			[
				"lexer.h",
				"quickjs/qjs-modules/include/lexer.h"
			],
			[
				"quickjs-lex",
				"quickjs/qjs-modules/quickjs-lexer.c"
			],
			[
				"test_lexer",
				"quickjs/qjs-modules/tests/test_lexer.js"
			],
			[
				"buffer-u",
				"quickjs/qjs-modules/src/buffer-utils.c"
			],
			[
				"upload-server",
				"upload-server.js"
			],
			[
				"fire.js",
				"fire.js"
			],
			[
				"debugger-cli",
				"debugger-client.js"
			],
			[
				"debugger-ser",
				"debugger-server.js"
			],
			[
				"upload-ser",
				"upload-server.js"
			],
			[
				"debugger-server",
				"debugger-server.js"
			],
			[
				"quickjs-libc",
				"quickjs/quickjs-libc.c"
			],
			[
				"quickjs.c",
				"quickjs/quickjs.c"
			],
			[
				"quickjs-lib",
				"quickjs/quickjs-libc.c"
			],
			[
				"list-ex",
				"quickjs/qjs-modules/list-exports.js"
			],
			[
				"draw.js",
				"draw.js"
			],
			[
				"draw.html",
				"draw.html"
			],
			[
				"getMod",
				"getModuleProps.js"
			],
			[
				"test-op",
				"test-operators.js"
			],
			[
				"nanovg",
				"test-nanovg.js"
			],
			[
				"alea",
				"lib/alea.js"
			],
			[
				"upload.js",
				"upload.js"
			],
			[
				"fire",
				"fire.js"
			],
			[
				"clang-as",
				"clang-ast.js"
			],
			[
				"jsut",
				"quickjs/qjs-modules/src/js-utils.c"
			],
			[
				"qjsm.c",
				"quickjs/qjs-modules/src/qjsm.c"
			],
			[
				"ast-shell",
				"ast-shell.js"
			],
			[
				"quickjs-in",
				"quickjs/qjs-modules/quickjs-internal.h"
			],
			[
				"run-test",
				"quickjs/run-test262.c"
			],
			[
				"quickjs.h",
				"quickjs/quickjs.h"
			],
			[
				"build-libwe",
				"quickjs/qjs-net/build-libwebsockets.sh"
			],
			[
				"ast-she",
				"ast-shell.js"
			],
			[
				"eagle-she",
				"eagle-shell.js"
			],
			[
				"pin.js",
				"lib/eagle/components/pin.js"
			],
			[
				"",
				"~/Projects/an-tronics/eagle/555-PWM-Motor-Speed-Controller-alt.sch"
			],
			[
				"preactCom",
				"lib/dom/preactComponent.js"
			],
			[
				"symb",
				"lib/eagle/components/symbol.js"
			],
			[
				"schematicren",
				"lib/eagle/schematicRenderer.js"
			],
			[
				"svgre",
				"lib/eagle/svgRenderer.js"
			],
			[
				"boardren",
				"lib/eagle/boardRenderer.js"
			],
			[
				"element",
				"lib/eagle/element.js"
			],
			[
				"svgRend",
				"lib/eagle/svgRenderer.js"
			],
			[
				"boardRen",
				"lib/eagle/boardRenderer.js"
			],
			[
				"document",
				"lib/eagle/document.js"
			],
			[
				"boardRe",
				"lib/eagle/boardRenderer.js"
			],
			[
				"renderUtil",
				"lib/eagle/renderUtils.js"
			],
			[
				"project.js",
				"lib/eagle/project.js"
			],
			[
				"nodeList",
				"lib/eagle/nodeList.js"
			],
			[
				"elemen",
				"lib/eagle/element.js"
			],
			[
				"svgRe",
				"lib/eagle/svgRenderer.js"
			],
			[
				"common",
				"lib/eagle/common.js"
			],
			[
				"ref.js",
				"lib/eagle/ref.js"
			],
			[
				"element.js",
				"lib/eagle/element.js"
			],
			[
				"common.j",
				"lib/eagle/common.js"
			],
			[
				"nodeLi",
				"lib/eagle/nodeList.js"
			],
			[
				"common.js",
				"lib/eagle/common.js"
			],
			[
				"elementP",
				"lib/eagle/elementProxy.js"
			],
			[
				"smd.js",
				"lib/eagle/components/smd.js"
			],
			[
				"wirePa",
				"lib/eagle/components/wirePath.js"
			],
			[
				"wire.js",
				"lib/eagle/components/wire.js"
			],
			[
				"nodeMap",
				"lib/eagle/nodeMap.js"
			],
			[
				"renderer.js",
				"lib/eagle/renderer.js"
			],
			[
				"functions.cmake",
				"qjs-opencv/cmake/functions.cmake"
			]
		],
		"width": 0.0
	},
	"select_project":
	{
		"height": 500.0,
		"last_filter": "",
		"selected_items":
		[
			[
				"",
				"~/Projects/plot-cv/plot-cv.sublime-project"
			]
		],
		"width": 380.0
	},
	"select_symbol":
	{
		"height": 309.0,
		"last_filter": "",
		"selected_items":
		[
			[
				"",
				"WS"
			]
		],
		"width": 784.0
	},
	"selected_group": 0,
	"settings":
	{
	},
	"show_minimap": true,
	"show_open_files": false,
	"show_tabs": true,
	"side_bar_visible": true,
	"side_bar_width": 248.0,
	"status_bar_visible": true,
	"template_settings":
	{
	}
}
